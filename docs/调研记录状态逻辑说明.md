# 📋 调研记录状态逻辑说明

## 🔄 状态类型定义

调研记录系统支持以下5种状态：

| 状态 | 标识 | 颜色 | 说明 |
|-----|------|------|------|
| 🟢 进行中 | `active` | 绿色 | 调研正在正常进行中 |
| 🟡 已暂停 | `paused` | 橙色 | 调研暂时停止，可以恢复 |
| 🔴 已终止 | `terminated` | 红色 | 调研永久停止，不可恢复 |
| ✅ 已完成 | `completed` | 蓝色 | 调研顺利完成，有结果输出 |
| 📋 待开始 | `pending` | 灰色 | 调研计划已制定，但尚未开始 |

## 🔄 状态转换规则

### 1. 新建调研记录
- **初始状态**: `active` (进行中)
- **触发条件**: 用户点击"新建调研记录"按钮并填写完成表单
- **可执行操作**: 更新进度、暂停调研、添加调研事项

### 2. 暂停调研 (active → paused)
- **触发条件**: 点击"⏸️ 暂停调研"按钮
- **适用场景**: 
  - 资源不足，需要暂时停止
  - 等待外部条件满足
  - 优先级调整，需要让位给其他项目
- **可执行操作**: 恢复调研、终止调研、查看详情

### 3. 恢复调研 (paused → active)
- **触发条件**: 点击"▶️ 恢复调研"按钮
- **适用场景**: 
  - 资源重新分配到位
  - 外部条件已满足
  - 优先级重新提升
- **可执行操作**: 更新进度、暂停调研、添加调研事项

### 4. 终止调研 (paused → terminated)
- **触发条件**: 点击"❌ 终止调研"按钮
- **适用场景**: 
  - 调研目标不再需要
  - 技术路线证明不可行
  - 资源永久性不足
  - 战略方向调整
- **可执行操作**: 查看详情（只读）
- **⚠️ 注意**: 终止后不可恢复，请谨慎操作

### 5. 完成调研 (active → completed)
- **触发条件**: 进度达到100%时自动转换，或手动标记完成
- **适用场景**: 
  - 所有调研阶段都已完成
  - 调研结果已输出
  - 调研目标已达成
- **可执行操作**: 查看详情、导出报告

## 🎯 操作按钮显示逻辑

### 进行中状态 (active)
```vue
<a-button @click="showUpdateProgress(record.id)">📝 更新进度</a-button>
<a-button @click="pauseResearch(record.id)">⏸️ 暂停调研</a-button>
<a-button @click="showAddItemDialog(record.id)">➕ 添加事项</a-button>
```

### 已暂停状态 (paused)
```vue
<a-button @click="resumeResearch(record.id)">▶️ 恢复调研</a-button>
<a-button @click="terminateResearch(record.id)" danger>❌ 终止调研</a-button>
<a-button @click="showDetail(record.id)">👁️ 查看详情</a-button>
```

### 已完成状态 (completed)
```vue
<a-button @click="showDetail(record.id)">👁️ 查看详情</a-button>
<a-button @click="exportReport(record.id)">📊 导出报告</a-button>
```

### 已终止状态 (terminated)
```vue
<a-button @click="showDetail(record.id)">👁️ 查看详情</a-button>
<!-- 只有查看功能，不可进行其他操作 -->
```

## 📊 状态统计逻辑

页面顶部的状态统计会实时更新：

```javascript
const statusStats = computed(() => {
  const stats = {
    total: researchRecords.value.length,
    active: researchRecords.value.filter(r => r.status === 'active').length,
    paused: researchRecords.value.filter(r => r.status === 'paused').length,
    completed: researchRecords.value.filter(r => r.status === 'completed').length,
    terminated: researchRecords.value.filter(r => r.status === 'terminated').length
  }
  return stats
})
```

## 🔍 筛选逻辑

用户可以根据状态筛选调研记录：

- **全部**: 显示所有状态的记录
- **进行中**: 只显示 `active` 状态的记录
- **已暂停**: 只显示 `paused` 状态的记录
- **已完成**: 只显示 `completed` 状态的记录
- **已终止**: 只显示 `terminated` 状态的记录

## 💡 最佳实践建议

### 1. 状态转换时机
- **暂停**: 当预计停止时间 < 2周时使用暂停
- **终止**: 当确定不再继续时使用终止
- **完成**: 当所有预定目标都达成时标记完成

### 2. 操作记录
- 每次状态变更都会自动记录时间戳
- 建议在暂停/终止时添加原因说明
- 重要的状态变更应该通知相关人员

### 3. 权限控制
- 只有调研负责人和项目管理员可以变更状态
- 终止操作需要二次确认
- 已终止的记录只能查看，不能修改

## 🔧 技术实现

状态变更的核心代码：

```javascript
// 暂停调研
const pauseResearch = (recordId) => {
  const record = researchRecords.value.find(r => r.id === recordId)
  if (record) {
    record.status = 'paused'
    record.updateTime = new Date().toISOString()
    // 可以添加暂停原因记录
    message.success('调研已暂停')
  }
}

// 恢复调研
const resumeResearch = (recordId) => {
  const record = researchRecords.value.find(r => r.id === recordId)
  if (record) {
    record.status = 'active'
    record.updateTime = new Date().toISOString()
    message.success('调研已恢复')
  }
}

// 终止调研
const terminateResearch = (recordId) => {
  const record = researchRecords.value.find(r => r.id === recordId)
  if (record) {
    record.status = 'terminated'
    record.updateTime = new Date().toISOString()
    message.warning('调研已终止')
  }
}
```

---

## 📝 总结

调研记录的状态管理遵循清晰的业务逻辑，确保：

1. **状态转换合理**: 符合实际业务流程
2. **操作权限明确**: 不同状态下的可用操作不同
3. **数据完整性**: 每次状态变更都有记录
4. **用户体验友好**: 操作反馈及时，界面直观

通过这套状态管理机制，可以有效追踪和管理调研项目的生命周期。 