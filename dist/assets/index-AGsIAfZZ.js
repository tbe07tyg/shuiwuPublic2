import{u as q}from"./nodeTemplate-Cg-DSh24.js";import{_ as K,h as f,c as k,a as b,j as n,k as C,b as h,w as o,l as i,o as _,p as d,x as U,F as M,s as R,v as A,t as G,f as y}from"./index-CLrs7Nd9.js";const H={class:"template-center-page"},J={class:"page-header"},P={__name:"index",setup(Q){const c=q(),w=c.templateList,T=[{title:"模板名称",dataIndex:"name",key:"name"},{title:"节点数",key:"count",customRender:({record:l})=>l.nodes.length},{title:"操作",key:"actions"}],p=f(!1),m=f(null),s=f({name:"",nodes:[]});function g(l){l?(m.value=l.id,s.value={name:l.name,nodes:l.nodes.map(e=>({...e}))}):(m.value=null,s.value={name:"",nodes:[]}),p.value=!0}function N(){if(!s.value.name){y.error("请输入模板名称");return}if(!s.value.nodes.length){y.error("请添加至少一个节点");return}m.value?c.updateTemplate(m.value,{name:s.value.name,nodes:s.value.nodes.map(l=>({...l}))}):c.addTemplate({name:s.value.name,nodes:s.value.nodes.map(l=>({...l}))}),p.value=!1}function $(l){c.deleteTemplate(l.id)}function L(){s.value.nodes.push({id:Math.random().toString(36).slice(2,10),name:"",percent:0,condition:"",deadline:null,attachments:[]})}function B(l){s.value.nodes.splice(l,1)}function S(l){y.success(`模板"${l.name}"已应用到项目（示例）`)}return(l,e)=>{const u=i("a-button"),V=i("a-space"),D=i("a-table"),E=i("a-card"),v=i("a-input"),x=i("a-form-item"),I=i("a-input-number"),j=i("a-date-picker"),z=i("a-upload"),F=i("a-form"),O=i("a-modal");return _(),k("div",H,[b("div",J,[e[4]||(e[4]=b("h1",{class:"page-title"},"节点模板库",-1)),n(u,{type:"primary",onClick:e[0]||(e[0]=t=>g())},{default:o(()=>e[3]||(e[3]=[d("新建模板",-1)])),_:1,__:[3]})]),n(E,null,{default:o(()=>[n(D,{columns:T,"data-source":U(w),rowKey:"id"},{bodyCell:o(({column:t,record:r})=>[t.key==="actions"?(_(),C(V,{key:0},{default:o(()=>[n(u,{type:"link",onClick:a=>g(r)},{default:o(()=>e[5]||(e[5]=[d("编辑",-1)])),_:2,__:[5]},1032,["onClick"]),n(u,{type:"link",onClick:a=>S(r)},{default:o(()=>e[6]||(e[6]=[d("应用到项目",-1)])),_:2,__:[6]},1032,["onClick"]),n(u,{type:"link",danger:"",onClick:a=>$(r)},{default:o(()=>e[7]||(e[7]=[d("删除",-1)])),_:2,__:[7]},1032,["onClick"])]),_:2},1024)):h("",!0)]),_:1},8,["data-source"])]),_:1}),p.value?(_(),C(O,{key:0,open:p.value,"onUpdate:open":e[2]||(e[2]=t=>p.value=t),title:m.value?"编辑模板":"新建模板",onOk:N},{default:o(()=>[n(F,{model:s.value,layout:"vertical"},{default:o(()=>[n(x,{label:"模板名称",required:""},{default:o(()=>[n(v,{value:s.value.name,"onUpdate:value":e[1]||(e[1]=t=>s.value.name=t)},null,8,["value"])]),_:1}),n(x,{label:"节点配置"},{default:o(()=>[(_(!0),k(M,null,R(s.value.nodes,(t,r)=>(_(),k("div",{key:t.id,class:"template-node-item"},[n(v,{value:t.name,"onUpdate:value":a=>t.name=a,placeholder:"节点名称",style:{width:"120px","margin-right":"8px"}},null,8,["value","onUpdate:value"]),n(I,{value:t.percent,"onUpdate:value":a=>t.percent=a,min:0,max:100,style:{width:"80px","margin-right":"8px"}},null,8,["value","onUpdate:value"]),n(v,{value:t.condition,"onUpdate:value":a=>t.condition=a,placeholder:"条件说明",style:{width:"180px","margin-right":"8px"}},null,8,["value","onUpdate:value"]),n(j,{value:t.deadline,"onUpdate:value":a=>t.deadline=a,placeholder:"截止日期",style:{width:"140px","margin-right":"8px"},disabledDate:a=>a&&a<U(A)().startOf("day")},null,8,["value","onUpdate:value","disabledDate"]),n(z,{"file-list":t.attachments,"onUpdate:fileList":a=>t.attachments=a,"before-upload":()=>!1,"max-count":3,style:{width:"120px","margin-right":"8px"}},{default:o(()=>[n(u,{type:"link",size:"small"},{default:o(()=>{var a;return[d(G((a=t.attachments)!=null&&a.length?`已上传${t.attachments.length}个文件`:"上传附件"),1)]}),_:2},1024)]),_:2},1032,["file-list","onUpdate:fileList"]),n(u,{type:"link",danger:"",size:"small",onClick:a=>B(r)},{default:o(()=>e[8]||(e[8]=[d("移除",-1)])),_:2,__:[8]},1032,["onClick"])]))),128)),n(u,{type:"dashed",onClick:L,style:{"margin-top":"12px"}},{default:o(()=>e[9]||(e[9]=[d("添加节点",-1)])),_:1,__:[9]})]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"])):h("",!0)])}}},Y=K(P,[["__scopeId","data-v-5ddedcb3"]]);export{Y as default};
