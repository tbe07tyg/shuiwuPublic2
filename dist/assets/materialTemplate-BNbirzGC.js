import{d as S,e as u,f as n}from"./index-BG3bheTR.js";const t=u({configs:{apply:[],opening:[],midterm:[],acceptance:[]},loading:!1,lastUpdateTime:null,version:"1.0.0"}),w={apply:"立项申请",opening:"项目开题",midterm:"项目中期",acceptance:"项目验收"},g=()=>({apply:[{id:1,categoryName:"项目申请书",isRequired:!0,templateFileName:"项目申请书模板.docx",templateFilePath:"/templates/apply/project_application.docx",sortOrder:1,description:"详细的项目申请信息，包含项目背景、目标、实施方案等",businessType:"apply",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:2,categoryName:"可行性研究报告",isRequired:!0,templateFileName:"可行性研究报告模板.docx",templateFilePath:"/templates/apply/feasibility_study.docx",sortOrder:2,description:"项目技术可行性、经济可行性分析报告",businessType:"apply",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}],opening:[{id:11,categoryName:"开题报告",isRequired:!0,templateFileName:"开题报告模板.docx",templateFilePath:"/templates/opening/opening_report.docx",sortOrder:1,description:"项目开题报告，说明研究方案和计划",businessType:"opening",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}],midterm:[{id:21,categoryName:"中期报告",isRequired:!0,templateFileName:"中期报告模板.docx",templateFilePath:"/templates/midterm/midterm_report.docx",sortOrder:1,description:"项目中期进展报告",businessType:"midterm",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}],acceptance:[{id:31,categoryName:"验收报告",isRequired:!0,templateFileName:"验收报告模板.docx",templateFilePath:"/templates/acceptance/acceptance_report.docx",sortOrder:1,description:"项目验收报告",businessType:"acceptance",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}]}),d=new Map,p=e=>t.configs[e]||[],h=S(()=>{const e={};return Object.keys(t.configs).forEach(r=>{const o=t.configs[r]||[];e[r]={total:o.length,required:o.filter(a=>a.isRequired).length,optional:o.filter(a=>!a.isRequired).length}}),e}),f=()=>{try{const e=localStorage.getItem("materialTemplateConfigs");if(e){const r=JSON.parse(e);return t.configs=r.configs||{},t.version=r.version||"1.0.0",t.lastUpdateTime=r.lastUpdateTime,!0}}catch(e){console.error("加载配置失败:",e)}return!1},s=()=>{try{const e={configs:t.configs,version:t.version,lastUpdateTime:t.lastUpdateTime};return localStorage.setItem("materialTemplateConfigs",JSON.stringify(e)),!0}catch(e){return console.error("保存配置失败:",e),!1}},O=async()=>{t.loading=!0;try{f()||(t.configs=g(),t.lastUpdateTime=new Date().toISOString(),s()),n.success("配置加载成功")}catch(e){console.error("初始化配置失败:",e),n.error("配置加载失败")}finally{t.loading=!1}},D=async(e,r)=>{try{const o={...r,id:Date.now(),businessType:e,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return t.configs[e]||(t.configs[e]=[]),t.configs[e].push(o),t.lastUpdateTime=new Date().toISOString(),s(),c(e),n.success("添加配置成功"),o}catch(o){throw console.error("添加配置失败:",o),n.error("添加配置失败"),o}},I=async(e,r,o)=>{try{const a=t.configs[e]||[],i=a.findIndex(m=>m.id===r);if(i===-1)throw new Error("配置项不存在");const l={...a[i],...o,updatedAt:new Date().toISOString()};return t.configs[e][i]=l,t.lastUpdateTime=new Date().toISOString(),s(),c(e),n.success("更新配置成功"),l}catch(a){throw console.error("更新配置失败:",a),n.error("更新配置失败"),a}},y=async(e,r)=>{try{const a=(t.configs[e]||[]).findIndex(i=>i.id===r);if(a===-1)throw new Error("配置项不存在");return t.configs[e].splice(a,1),t.lastUpdateTime=new Date().toISOString(),s(),c(e),n.success("删除配置成功"),!0}catch(o){throw console.error("删除配置失败:",o),n.error("删除配置失败"),o}},C=async(e,r)=>{try{return t.configs[e]=r.map(o=>({...o,businessType:e,updatedAt:new Date().toISOString()})),t.lastUpdateTime=new Date().toISOString(),s(),c(e),n.success("批量更新配置成功"),!0}catch(o){throw console.error("批量更新配置失败:",o),n.error("批量更新配置失败"),o}},x=async e=>{try{const r=g();return e?t.configs[e]=r[e]||[]:t.configs=r,t.lastUpdateTime=new Date().toISOString(),s(),e?c(e):Object.keys(r).forEach(o=>{c(o)}),n.success("重置配置成功"),!0}catch(r){throw console.error("重置配置失败:",r),n.error("重置配置失败"),r}},c=e=>{const r=d.get(e);if(r&&r.size>0){const o=p(e);r.forEach(a=>{try{a(o,e)}catch(i){console.error("页面更新回调执行失败:",i)}})}},U=(e,r)=>(d.has(e)||d.set(e,new Set),d.get(e).add(r),()=>{const o=d.get(e);o&&(o.delete(r),o.size===0&&d.delete(e))}),N={state:t,businessTypeMap:w,getConfigsStats:h,initConfigs:O,getConfigsByBusinessType:p,addConfig:D,updateConfig:I,deleteConfig:y,batchUpdateConfigs:C,resetToDefault:x,registerPageUpdateListener:U,notifyBusinessPageUpdate:c,saveConfigsToStorage:s,loadConfigsFromStorage:f};export{N as m};
