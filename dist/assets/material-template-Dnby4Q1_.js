import{m as f}from"./materialTemplate-DHg93JQh.js";import{M as oe}from"./MaterialTemplateSync-BJQWXxvI.js";import{j as n,I as le,_ as se,O as ie,Q as re,a4 as de,T as ce,P as me,E as ue,R as pe,z as ge,c as O,a as o,p as u,l,w as s,h as C,e as _e,d as ve,i as fe,M as te,f as F,o as y,t as c,F as ae,s as ye,k as P,b as T}from"./index-CLrs7Nd9.js";import{I as he}from"./InboxOutlined-D20kumRm.js";import{P as Ce}from"./PieChartOutlined-yJ1iVs9T.js";import{R as be}from"./RocketOutlined-Cm_STHdO.js";import"./UploadOutlined-U6qGJXGO.js";var Oe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M904 512h-56c-4.4 0-8 3.6-8 8v320H184V184h320c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V520c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M355.9 534.9L354 653.8c-.1 8.9 7.1 16.2 16 16.2h.4l118-2.9c2-.1 4-.9 5.4-2.3l415.9-415c3.1-3.1 3.1-8.2 0-11.3L785.4 114.3c-1.6-1.6-3.6-2.3-5.7-2.3s-4.1.8-5.7 2.3l-415.8 415a8.3 8.3 0 00-2.3 5.6zm63.5 23.6L779.7 199l45.2 45.1-360.5 359.7-45.7 1.1.7-46.4z"}}]},name:"form",theme:"outlined"};function ne(i){for(var t=1;t<arguments.length;t++){var m=arguments[t]!=null?Object(arguments[t]):{},e=Object.keys(m);typeof Object.getOwnPropertySymbols=="function"&&(e=e.concat(Object.getOwnPropertySymbols(m).filter(function(p){return Object.getOwnPropertyDescriptor(m,p).enumerable}))),e.forEach(function(p){we(i,p,m[p])})}return i}function we(i,t,m){return t in i?Object.defineProperty(i,t,{value:m,enumerable:!0,configurable:!0,writable:!0}):i[t]=m,i}var $=function(t,m){var e=ne({},t,m.attrs);return n(le,ne({},e,{icon:Oe}),null)};$.displayName="FormOutlined";$.inheritAttrs=!1;const ke={name:"MaterialTemplateManager",components:{FileTextOutlined:ge,ReloadOutlined:pe,FormOutlined:$,RocketOutlined:be,PieChartOutlined:Ce,CheckCircleOutlined:ue,PlusOutlined:me,EditOutlined:ce,DeleteOutlined:de,FileOutlined:re,EyeOutlined:ie,InboxOutlined:he,MaterialTemplateSync:oe},setup(){const i=C("apply"),t=C(!1),m=C(!1),e=C(!1),p=C(""),w=C(!1),x=C(!1),R=C("apply"),h={apply:"立项申请",opening:"项目开题",midterm:"项目中期",acceptance:"项目验收"},g=_e({id:null,categoryName:"",isRequired:!0,sortOrder:1,description:"",templateFileName:"",templateFilePath:""}),_=C([]),S=C(!1),U={categoryName:[{required:!0,message:"请输入类目名称",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"}],sortOrder:[{required:!0,message:"请输入显示顺序",trigger:"blur"}]},q=[{title:"序号",dataIndex:"sortOrder",key:"sortOrder",width:80,align:"center",sorter:(a,d)=>a.sortOrder-d.sortOrder},{title:"类目名称",dataIndex:"categoryName",key:"categoryName",width:200},{title:"必传项",dataIndex:"isRequired",key:"isRequired",width:100,align:"center"},{title:"模板文件",dataIndex:"templateFileName",key:"templateFileName",width:250},{title:"描述说明",dataIndex:"description",key:"description",ellipsis:!0},{title:"操作",key:"action",width:180,align:"center"}],D={pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(a,d)=>`共 ${a} 条记录，当前显示 ${d[0]}-${d[1]} 条`},L=ve(()=>e.value?"编辑资料类目":"添加资料类目"),z=a=>f.getConfigsByBusinessType(a).length,E=a=>f.getConfigsByBusinessType(a).filter(r=>r.isRequired).length,I=a=>f.getConfigsByBusinessType(a).filter(r=>!r.isRequired).length,M=a=>{const d=f.getConfigsByBusinessType(a);return p.value?d.filter(r=>r.categoryName.toLowerCase().includes(p.value.toLowerCase())||r.description&&r.description.toLowerCase().includes(p.value.toLowerCase())).sort((r,v)=>(r.sortOrder||0)-(v.sortOrder||0)):d.sort((r,v)=>(r.sortOrder||0)-(v.sortOrder||0))},V=async()=>{w.value=!0;try{await f.initConfigs(),F.success("配置刷新成功")}catch{F.error("配置刷新失败")}finally{w.value=!1}},j=a=>{i.value=a},K=a=>{i.value=a,p.value=""},A=a=>{p.value=a},H=()=>{e.value=!1,k(),t.value=!0},Q=a=>{e.value=!0,Object.assign(g,a),a.templateFileName?_.value=[{uid:"1",name:a.templateFileName,status:"done"}]:_.value=[],t.value=!0},b=async a=>{te.confirm({title:"确认删除",content:`确定要删除类目"${a.categoryName}"吗？删除后将无法恢复，请谨慎操作！`,okText:"确定删除",cancelText:"取消",okType:"danger",async onOk(){try{await f.deleteConfig(i.value,a.id)}catch{}}})},B=async()=>{x.value=!0;try{const a={...g};e.value?await f.updateConfig(i.value,a.id,a):await f.addConfig(i.value,a),t.value=!1,k()}catch{}finally{x.value=!1}},k=()=>{const a=f.getConfigsByBusinessType(i.value);Object.assign(g,{id:null,categoryName:"",isRequired:!0,sortOrder:a.length+1,description:"",templateFileName:"",templateFilePath:""}),_.value=[]},J=()=>{k()},W=a=>a.size>10485760?(F.error("文件大小不能超过10MB"),!1):(S.value=!0,setTimeout(()=>{g.templateFileName=a.name,g.templateFilePath=`/templates/${i.value}/${a.name}`,_.value=[{uid:a.uid||Date.now().toString(),name:a.name,status:"done",url:g.templateFilePath,originFileObj:a}],S.value=!1,F.success(`模板文件 "${a.name}" 已选择`)},200),!1),G=a=>(g.templateFileName="",g.templateFilePath="",_.value=[],F.success("模板文件已移除"),!0),X=a=>{F.info(`正在下载模板：${a.templateFileName}`)},Y=a=>{R.value=a,m.value=!0},N=a=>{console.log("预览页面配置已更新",a)},Z=()=>{te.confirm({title:"确认重置",content:"确定要重置为默认配置吗？当前所有自定义配置将被清空，此操作无法撤销！",okText:"确定重置",cancelText:"取消",okType:"danger",async onOk(){await f.resetToDefault(i.value)}})};return fe(async()=>{w.value=!0;try{await f.initConfigs()}finally{w.value=!1}}),{activeTab:i,dialogVisible:t,previewVisible:m,categoryForm:g,categoryRules:U,searchKeyword:p,columns:q,loading:w,submitLoading:x,businessTabs:h,templateFileList:_,templateUploading:S,paginationConfig:D,previewBusinessType:R,dialogTitle:L,getBusinessStats:z,getRequiredStats:E,getOptionalStats:I,getFilteredConfigs:M,handleRefreshConfigs:V,handleStatCardClick:j,handleTabChange:K,handleSearch:A,handleAddCategory:H,handleEditCategory:Q,handleDeleteCategory:b,handleSaveCategory:B,handleDialogClose:J,resetCategoryForm:k,handleTemplateUpload:W,handleRemoveTemplate:G,handleDownloadTemplate:X,handlePreviewBusinessPage:Y,handlePreviewConfigUpdate:N,handleResetToDefault:Z}}},Fe={class:"material-template-manager"},Te={class:"page-header"},xe={class:"header-content"},Se={class:"page-title"},Re={class:"title-icon"},Be={class:"header-actions"},Ne={class:"stats-overview"},Pe={class:"stat-icon"},Ue={class:"stat-content"},qe={class:"stat-number"},De={class:"stat-detail"},Le={class:"stat-icon"},ze={class:"stat-content"},Ee={class:"stat-number"},Ie={class:"stat-detail"},Me={class:"stat-icon"},Ve={class:"stat-content"},je={class:"stat-number"},Ke={class:"stat-detail"},Ae={class:"stat-icon"},He={class:"stat-content"},Qe={class:"stat-number"},Je={class:"stat-detail"},We={class:"content-card"},Ge={class:"tab-content"},Xe={class:"toolbar"},Ye={class:"toolbar-left"},Ze={class:"toolbar-right"},$e={key:0,class:"template-file"},et={key:1,class:"no-template"},tt={key:2,class:"action-buttons"},at={class:"upload-tips"},nt={key:0,class:"upload-success"};function ot(i,t,m,e,p,w){const x=l("FileTextOutlined"),R=l("ReloadOutlined"),h=l("a-button"),g=l("FormOutlined"),_=l("a-col"),S=l("RocketOutlined"),U=l("PieChartOutlined"),q=l("CheckCircleOutlined"),D=l("a-row"),L=l("PlusOutlined"),z=l("EyeOutlined"),E=l("a-input-search"),I=l("a-tag"),M=l("FileOutlined"),V=l("EditOutlined"),j=l("DeleteOutlined"),K=l("a-table"),A=l("a-tab-pane"),H=l("a-tabs"),Q=l("a-input"),b=l("a-form-item"),B=l("a-radio"),k=l("a-radio-group"),J=l("a-input-number"),W=l("UploadOutlined"),G=l("a-upload"),X=l("a-textarea"),Y=l("a-form"),N=l("a-modal"),Z=l("MaterialTemplateSync");return y(),O("div",Fe,[o("div",Te,[o("div",xe,[o("h1",Se,[o("span",Re,[n(x)]),t[12]||(t[12]=u(" 材料提交模板维护 ",-1))]),t[13]||(t[13]=o("p",{class:"page-description"}," 统一管理各业务环节的资料类目和模板文件，实现配置的集中维护和实时同步 ",-1))]),o("div",Be,[n(h,{onClick:e.handleRefreshConfigs,loading:e.loading},{default:s(()=>[n(R),t[14]||(t[14]=u(" 刷新配置 ",-1))]),_:1,__:[14]},8,["onClick","loading"]),n(h,{type:"primary",danger:"",onClick:e.handleResetToDefault},{default:s(()=>t[15]||(t[15]=[u(" 重置默认 ",-1)])),_:1,__:[15]},8,["onClick"])])]),o("div",Ne,[n(D,{gutter:16},{default:s(()=>[n(_,{xs:12,sm:8,md:6,lg:6,xl:6},{default:s(()=>[o("div",{class:"stat-card pending",onClick:t[0]||(t[0]=a=>e.handleStatCardClick("apply"))},[o("div",Pe,[n(g)]),o("div",Ue,[o("div",qe,c(e.getBusinessStats("apply")),1),t[16]||(t[16]=o("div",{class:"stat-label"},"立项申请类目",-1)),o("div",De,"必传"+c(e.getRequiredStats("apply"))+" | 选传"+c(e.getOptionalStats("apply")),1)])])]),_:1}),n(_,{xs:12,sm:8,md:6,lg:6,xl:6},{default:s(()=>[o("div",{class:"stat-card reviewing",onClick:t[1]||(t[1]=a=>e.handleStatCardClick("opening"))},[o("div",Le,[n(S)]),o("div",ze,[o("div",Ee,c(e.getBusinessStats("opening")),1),t[17]||(t[17]=o("div",{class:"stat-label"},"项目开题类目",-1)),o("div",Ie,"必传"+c(e.getRequiredStats("opening"))+" | 选传"+c(e.getOptionalStats("opening")),1)])])]),_:1}),n(_,{xs:12,sm:8,md:6,lg:6,xl:6},{default:s(()=>[o("div",{class:"stat-card scheduled",onClick:t[2]||(t[2]=a=>e.handleStatCardClick("midterm"))},[o("div",Me,[n(U)]),o("div",Ve,[o("div",je,c(e.getBusinessStats("midterm")),1),t[18]||(t[18]=o("div",{class:"stat-label"},"项目中期类目",-1)),o("div",Ke,"必传"+c(e.getRequiredStats("midterm"))+" | 选传"+c(e.getOptionalStats("midterm")),1)])])]),_:1}),n(_,{xs:12,sm:8,md:6,lg:6,xl:6},{default:s(()=>[o("div",{class:"stat-card completed",onClick:t[3]||(t[3]=a=>e.handleStatCardClick("acceptance"))},[o("div",Ae,[n(q)]),o("div",He,[o("div",Qe,c(e.getBusinessStats("acceptance")),1),t[19]||(t[19]=o("div",{class:"stat-label"},"项目验收类目",-1)),o("div",Je,"必传"+c(e.getRequiredStats("acceptance"))+" | 选传"+c(e.getOptionalStats("acceptance")),1)])])]),_:1})]),_:1})]),o("div",We,[n(H,{activeKey:e.activeTab,"onUpdate:activeKey":t[5]||(t[5]=a=>e.activeTab=a),onChange:e.handleTabChange,class:"custom-tabs",type:"card"},{default:s(()=>[(y(!0),O(ae,null,ye(e.businessTabs,(a,d)=>(y(),P(A,{key:d,tab:a},{default:s(()=>[o("div",Ge,[o("div",Xe,[o("div",Ye,[n(h,{type:"primary",onClick:e.handleAddCategory},{default:s(()=>[n(L),t[20]||(t[20]=u(" 添加新类目 ",-1))]),_:1,__:[20]},8,["onClick"]),n(h,{onClick:r=>e.handlePreviewBusinessPage(d)},{default:s(()=>[n(z),t[21]||(t[21]=u(" 预览效果 ",-1))]),_:2,__:[21]},1032,["onClick"])]),o("div",Ze,[n(E,{value:e.searchKeyword,"onUpdate:value":t[4]||(t[4]=r=>e.searchKeyword=r),placeholder:"搜索类目名称",style:{width:"200px"},onSearch:e.handleSearch},null,8,["value","onSearch"])])]),n(K,{columns:e.columns,"data-source":e.getFilteredConfigs(d),pagination:e.paginationConfig,"row-key":"id",size:"middle",loading:e.loading},{bodyCell:s(({column:r,record:v})=>[r.key==="isRequired"?(y(),P(I,{key:0,color:v.isRequired?"red":"blue",size:"small"},{default:s(()=>[u(c(v.isRequired?"必传":"选传"),1)]),_:2},1032,["color"])):T("",!0),r.key==="templateFileName"?(y(),O(ae,{key:1},[v.templateFileName?(y(),O("div",$e,[n(M),o("span",null,c(v.templateFileName),1),n(h,{type:"link",size:"small",onClick:ee=>e.handleDownloadTemplate(v)},{default:s(()=>t[22]||(t[22]=[u(" 下载 ",-1)])),_:2,__:[22]},1032,["onClick"])])):(y(),O("span",et,"暂无模板"))],64)):T("",!0),r.key==="action"?(y(),O("div",tt,[n(h,{type:"primary",size:"small",onClick:ee=>e.handleEditCategory(v)},{default:s(()=>[n(V),t[23]||(t[23]=u(" 编辑 ",-1))]),_:2,__:[23]},1032,["onClick"]),n(h,{danger:"",size:"small",onClick:ee=>e.handleDeleteCategory(v)},{default:s(()=>[n(j),t[24]||(t[24]=u(" 删除 ",-1))]),_:2,__:[24]},1032,["onClick"])])):T("",!0)]),_:2},1032,["columns","data-source","pagination","loading"])])]),_:2},1032,["tab"]))),128))]),_:1},8,["activeKey","onChange"])]),n(N,{open:e.dialogVisible,"onUpdate:open":t[10]||(t[10]=a=>e.dialogVisible=a),title:e.dialogTitle,width:"700px",onCancel:e.handleDialogClose,onOk:e.handleSaveCategory,"confirm-loading":e.submitLoading},{default:s(()=>[n(Y,{ref:"categoryFormRef",model:e.categoryForm,rules:e.categoryRules,"label-col":{span:6},"wrapper-col":{span:18}},{default:s(()=>[n(b,{label:"类目名称",name:"categoryName"},{default:s(()=>[n(Q,{value:e.categoryForm.categoryName,"onUpdate:value":t[6]||(t[6]=a=>e.categoryForm.categoryName=a),placeholder:"请输入类目名称，如：项目申请书","allow-clear":""},null,8,["value"])]),_:1}),n(b,{label:"是否必传",name:"isRequired"},{default:s(()=>[n(k,{value:e.categoryForm.isRequired,"onUpdate:value":t[7]||(t[7]=a=>e.categoryForm.isRequired=a)},{default:s(()=>[n(B,{value:!0},{default:s(()=>t[25]||(t[25]=[u("必传",-1)])),_:1,__:[25]}),n(B,{value:!1},{default:s(()=>t[26]||(t[26]=[u("选传",-1)])),_:1,__:[26]})]),_:1},8,["value"])]),_:1}),n(b,{label:"显示顺序",name:"sortOrder"},{default:s(()=>[n(J,{value:e.categoryForm.sortOrder,"onUpdate:value":t[8]||(t[8]=a=>e.categoryForm.sortOrder=a),min:1,max:100,style:{width:"100%"},placeholder:"数字越小排序越靠前"},null,8,["value"])]),_:1}),n(b,{label:"模板文件"},{default:s(()=>[n(G,{"file-list":e.templateFileList,"before-upload":e.handleTemplateUpload,remove:e.handleRemoveTemplate,accept:".doc,.docx,.pdf,.xls,.xlsx","max-count":1,"show-upload-list":{showDownloadIcon:!1,showPreviewIcon:!1,showRemoveIcon:!0}},{default:s(()=>[n(h,{loading:e.templateUploading},{default:s(()=>[e.templateUploading?T("",!0):(y(),P(W,{key:0})),u(" "+c(e.templateUploading?"处理中...":e.templateFileList.length>0?"重新选择":"选择模板文件"),1)]),_:1},8,["loading"])]),_:1},8,["file-list","before-upload","remove"]),o("div",at,[t[27]||(t[27]=u(" 支持 Word、Excel、PDF 格式，文件大小不超过10MB ",-1)),e.templateFileList.length>0?(y(),O("span",nt," ✓ 文件已选择："+c(e.templateFileList[0].name),1)):T("",!0)])]),_:1}),n(b,{label:"描述说明"},{default:s(()=>[n(X,{value:e.categoryForm.description,"onUpdate:value":t[9]||(t[9]=a=>e.categoryForm.description=a),rows:4,placeholder:"请输入对该类目的详细说明，用于帮助用户理解该材料的用途和要求...",maxlength:500,"show-count":""},null,8,["value"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["open","title","onCancel","onOk","confirm-loading"]),n(N,{open:e.previewVisible,"onUpdate:open":t[11]||(t[11]=a=>e.previewVisible=a),title:`${e.businessTabs[e.previewBusinessType]}页面预览`,width:"90%",style:{top:"20px"},footer:null},{default:s(()=>[e.previewVisible?(y(),P(Z,{key:0,"business-type":e.previewBusinessType,"auto-load":!0,onConfigUpdate:e.handlePreviewConfigUpdate},null,8,["business-type","onConfigUpdate"])):T("",!0)]),_:1},8,["open","title"])])}const ut=se(ke,[["render",ot],["__scopeId","data-v-b2eba06f"]]);export{ut as default};
