import{j as l,I as Q,ao as V,h as y,_ as W,i as X,u as Y,c as k,a as f,p as u,x as w,w as i,l as c,m as Z,o as v,F as C,s as I,k as T,t as O,v as K,f as S,M as ee}from"./index-BG3bheTR.js";import{u as te,d as ae}from"./nodeTemplate-7quJkpsu.js";var ne={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M843.5 737.4c-12.4-75.2-79.2-129.1-155.3-125.4S550.9 676 546 752c-153.5-4.8-208-40.7-199.1-113.7 3.3-27.3 19.8-41.9 50.1-49 18.4-4.3 38.8-4.9 57.3-3.2 1.7.2 3.5.3 5.2.5 11.3 2.7 22.8 5 34.3 6.8 34.1 5.6 68.8 8.4 101.8 6.6 92.8-5 156-45.9 159.2-132.7 3.1-84.1-54.7-143.7-147.9-183.6-29.9-12.8-61.6-22.7-93.3-30.2-14.3-3.4-26.3-5.7-35.2-7.2-7.9-75.9-71.5-133.8-147.8-134.4-76.3-.6-140.9 56.1-150.1 131.9s40 146.3 114.2 163.9c74.2 17.6 149.9-23.3 175.7-95.1 9.4 1.7 18.7 3.6 28 5.8 28.2 6.6 56.4 15.4 82.4 26.6 70.7 30.2 109.3 70.1 107.5 119.9-1.6 44.6-33.6 65.2-96.2 68.6-27.5 1.5-57.6-.9-87.3-5.8-8.3-1.4-15.9-2.8-22.6-4.3-3.9-.8-6.6-1.5-7.8-1.8l-3.1-.6c-2.2-.3-5.9-.8-10.7-1.3-25-2.3-52.1-1.5-78.5 4.6-55.2 12.9-93.9 47.2-101.1 105.8-15.7 126.2 78.6 184.7 276 188.9 29.1 70.4 106.4 107.9 179.6 87 73.3-20.9 119.3-93.4 106.9-168.6zM329.1 345.2a83.3 83.3 0 11.01-166.61 83.3 83.3 0 01-.01 166.61zM695.6 845a83.3 83.3 0 11.01-166.61A83.3 83.3 0 01695.6 845z"}}]},name:"node-index",theme:"outlined"};function B(d){for(var s=1;s<arguments.length;s++){var o=arguments[s]!=null?Object(arguments[s]):{},a=Object.keys(o);typeof Object.getOwnPropertySymbols=="function"&&(a=a.concat(Object.getOwnPropertySymbols(o).filter(function(r){return Object.getOwnPropertyDescriptor(o,r).enumerable}))),a.forEach(function(r){oe(d,r,o[r])})}return d}function oe(d,s,o){return s in d?Object.defineProperty(d,s,{value:o,enumerable:!0,configurable:!0,writable:!0}):d[s]=o,d}var A=function(s,o){var a=B({},s,o.attrs);return l(Q,B({},a,{icon:ne}),null)};A.displayName="NodeIndexOutlined";A.inheritAttrs=!1;const le=V("implementation",()=>{const d=y({});function s(r,m){d.value[r]=m}function o(r){return d.value[r]||[]}function a(r,m,h){const x=d.value[r];if(x){const b=x.find(j=>j.id===m);b&&(b.status=h)}}return{projectNodes:d,saveProjectNodes:s,getProjectNodes:o,updateProjectNodeStatus:a}}),L=["materials","review","decision"],de=V("approval",()=>{const d=y([{id:"A001",title:"智能水表项目立项",applicant:"王五",department:"技术部",year:2024,duration:18,status:"未通过",budget:200,applyTime:"2024-01-15",fileList:[{uid:"1",name:"项目申请书.pdf",status:"done"},{uid:"2",name:"技术方案.docx",status:"done"}]},{id:"A002",title:"管网监测优化立项",applicant:"赵六",department:"工程部",year:2024,duration:12,status:"通过",budget:150,applyTime:"2024-02-20",fileList:[{uid:"3",name:"立项申请表.pdf",status:"done"},{uid:"4",name:"预算明细.xlsx",status:"done"},{uid:"5",name:"可行性报告.docx",status:"done"}]},{id:"A003",title:"水厂自动化改造",applicant:"李明",department:"自动化部",year:2024,duration:24,status:"未通过",budget:180,applyTime:"2024-03-10",fileList:[]},{id:"A004",title:"管网智能监控平台",applicant:"王强",department:"信息部",year:2024,duration:15,status:"通过",budget:220,applyTime:"2024-03-25",fileList:[{uid:"6",name:"项目计划书.pdf",status:"done"}]}]);function s(o){const a=d.value.find(m=>m.id===o);if(!a)return null;const r=L.indexOf(a.node);return r<L.length-1?(a.node=L[r+1],a.nodeHistory||(a.nodeHistory=[]),a.nodeHistory.push({node:a.node,time:Date.now()}),a.node):null}return{approvalList:d,submitAndNext:s}}),ie={class:"implementation-nodes-page"},se={class:"page-header"},re={class:"header-content"},ue={class:"page-title"},pe={class:"header-actions"},ce={class:"node-item"},me={__name:"index",setup(d){const s=y([{id:"P001",name:"项目A"},{id:"P002",name:"项目B"}]),o=y(""),a=y([{id:"N1",name:"首付款",percent:30,condition:"合同签订后7日内",dependency:""},{id:"N2",name:"中期款",percent:40,condition:"项目进度过半",dependency:"N1"},{id:"N3",name:"尾款",percent:30,condition:"项目验收合格",dependency:"N2"}]),m=te().templateList,h=y(),x=Z(),b=le();function j(g){const t=m.value.find(p=>p.id===g);t&&(a.value=t.nodes.map(p=>({...p,id:Math.random().toString(36).slice(2,10)})))}function z(){x.push({path:"/implementation/template"})}function D(){a.value.push({id:Math.random().toString(36).slice(2,10),name:"",percent:0,condition:"",dependency:null,deadline:null,attachments:[]})}function q(g){a.value.splice(g,1)}function $(){if(!o.value){S.error("请先选择项目");return}ee.confirm({title:`是否将当前配置保存到${o.value}项目？`,onOk:()=>{S.success("保存成功！")}})}function H(){if(!o.value){S.error("请先选择项目");return}b.saveProjectNodes(o.value,a.value);const t=de().approvalList.find(p=>p.id===o.value);t&&(t.nodeConfigured=!0),S.success("节点配置已发布到实施流程")}const N=Y();return X(()=>{if(N.query.projectId&&(o.value=N.query.projectId),N.query.nodes)try{a.value=JSON.parse(N.query.nodes)}catch{}}),(g,t)=>{const p=c("a-select-option"),U=c("a-select"),_=c("a-button"),P=c("a-card"),M=c("a-input"),E=c("a-input-number"),F=c("a-date-picker"),R=c("a-upload"),J=c("a-alert");return v(),k("div",ie,[f("div",se,[f("div",re,[f("h1",ue,[l(w(A)),t[3]||(t[3]=u(" 节点管理计划 "))]),t[4]||(t[4]=f("p",{class:"page-desc"},"配置项目实施节点，支持拖拽排序、属性编辑、依赖关系与流程预览",-1))]),f("div",pe,[l(U,{value:o.value,"onUpdate:value":t[0]||(t[0]=e=>o.value=e),placeholder:"选择项目",style:{width:"220px","margin-right":"12px"}},{default:i(()=>[(v(!0),k(C,null,I(s.value,e=>(v(),T(p,{key:e.id,value:e.id},{default:i(()=>[u(O(e.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),l(_,{type:"primary",onClick:$},{default:i(()=>t[5]||(t[5]=[u("保存配置")])),_:1,__:[5]}),l(_,{type:"dashed",onClick:H},{default:i(()=>t[6]||(t[6]=[u("发布到实施流程")])),_:1,__:[6]})])]),l(P,{class:"template-section",title:"节点模板库"},{default:i(()=>[l(U,{value:h.value,"onUpdate:value":t[1]||(t[1]=e=>h.value=e),placeholder:"选择模板",style:{width:"220px"},onChange:j},{default:i(()=>[(v(!0),k(C,null,I(w(m),e=>(v(),T(p,{key:e.id,value:e.id},{default:i(()=>[u(O(e.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),l(_,{type:"link",onClick:z},{default:i(()=>t[7]||(t[7]=[u("管理模板")])),_:1,__:[7]})]),_:1}),l(P,{class:"nodes-section",title:"节点配置"},{default:i(()=>[l(w(ae),{modelValue:a.value,"onUpdate:modelValue":t[2]||(t[2]=e=>a.value=e),"item-key":"id",animation:"200"},{item:i(({element:e,index:G})=>[f("div",ce,[t[9]||(t[9]=f("span",{class:"drag-handle"},"☰",-1)),l(M,{value:e.name,"onUpdate:value":n=>e.name=n,placeholder:"节点名称",style:{width:"120px","margin-right":"8px"}},null,8,["value","onUpdate:value"]),l(E,{value:e.percent,"onUpdate:value":n=>e.percent=n,min:0,max:100,style:{width:"80px","margin-right":"8px"},placeholder:"金额"},null,8,["value","onUpdate:value"]),l(M,{value:e.condition,"onUpdate:value":n=>e.condition=n,placeholder:"条件说明",style:{width:"180px","margin-right":"8px"}},null,8,["value","onUpdate:value"]),l(F,{value:e.deadline,"onUpdate:value":n=>e.deadline=n,placeholder:"截止日期",style:{width:"140px","margin-right":"8px"},disabledDate:n=>n&&n<w(K)().startOf("day")},null,8,["value","onUpdate:value","disabledDate"]),l(U,{value:e.dependency,"onUpdate:value":n=>e.dependency=n,placeholder:"节点数据类型",allowClear:"",style:{width:"120px","margin-right":"8px"}},{default:i(()=>[(v(!0),k(C,null,I(a.value.filter(n=>n.id!==e.id),n=>(v(),T(p,{key:n.id,value:n.id},{default:i(()=>[u(O(n.name),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value"]),l(R,{"file-list":e.attachments,"onUpdate:fileList":n=>e.attachments=n,"before-upload":()=>!1,"max-count":3,style:{width:"120px","margin-right":"8px"}},{default:i(()=>[l(_,{type:"link",size:"small"},{default:i(()=>{var n;return[u(O((n=e.attachments)!=null&&n.length?`已上传${e.attachments.length}个文件`:"上传附件"),1)]}),_:2},1024)]),_:2},1032,["file-list","onUpdate:fileList"]),l(_,{type:"link",danger:"",size:"small",onClick:n=>q(G)},{default:i(()=>t[8]||(t[8]=[u("移除")])),_:2,__:[8]},1032,["onClick"])])]),_:1},8,["modelValue"]),l(_,{type:"dashed",onClick:D,style:{"margin-top":"12px"}},{default:i(()=>t[10]||(t[10]=[u("添加节点")])),_:1,__:[10]})]),_:1}),l(P,{class:"flow-section",title:"流程图预览"},{default:i(()=>[l(J,{message:"流程图预览功能开发中...",type:"info","show-icon":""})]),_:1})])}}},_e=W(me,[["__scopeId","data-v-24c615ce"]]);export{_e as default};
