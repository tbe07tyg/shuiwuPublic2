import{_ as ue,h as M,d as z,v as U,A as me,c as L,o as r,j as t,b as W,k,a,l as c,w as l,p as d,t as y,x as ve,f as A,u as fe,m as _e,F as G,s as H}from"./index-CLrs7Nd9.js";import{U as ye}from"./UploadOutlined-U6qGJXGO.js";const je={class:"apply-step"},ke={key:0,class:"project-info-readonly"},be={style:{"text-align":"right","margin-top":"12px"}},ge={class:"form-section"},he={class:"form-row"},we={class:"form-row"},De={class:"form-row"},Se={class:"form-row"},xe={class:"form-row"},Ce={key:0,class:"form-actions"},Me={class:"form-section"},$e={class:"template-download"},Ye={class:"form-actions"},Pe={__name:"ApplyStep",props:{project:Object},emits:["submit"],setup(w,{emit:J}){var X,O,K,q,B,i,j,F,ne;const s=w,p=J,S=M(),m=M(!1),$=M(!1),V=M(!1),Y=M(!1),P=z(()=>{var o,e,D;return!((o=s.project)!=null&&o.name)||!((e=s.project)!=null&&e.leader)||!((D=s.project)!=null&&D.dept)}),E=z(()=>!0),n=M({name:((X=s.project)==null?void 0:X.name)||"",type:((O=s.project)==null?void 0:O.type)||"",leader:((K=s.project)==null?void 0:K.leader)||"",dept:((q=s.project)==null?void 0:q.dept)||"",startDate:(B=s.project)!=null&&B.start?U(s.project.start):null,endDate:(i=s.project)!=null&&i.end?U(s.project.end):null,budget:((F=(j=s.project)==null?void 0:j.fund)==null?void 0:F.total)||null,description:((ne=s.project)==null?void 0:ne.desc)||""}),x=[{label:"纵向课题",value:"纵向"},{label:"横向课题",value:"横向"},{label:"自筹项目",value:"自筹"}],T=M([]),Q={name:[{required:!0,message:"请输入项目名称"}],type:[{required:!0,message:"请选择项目类型"}],leader:[{required:!0,message:"请输入项目负责人"}],dept:[{required:!0,message:"请输入所属部门"}],startDate:[{required:!0,message:"请选择计划开始时间"}],endDate:[{required:!0,message:"请选择计划结束时间"}],budget:[{required:!0,message:"请输入申请预算"}],description:[{required:!0,message:"请输入项目简介"}]};function g(){var o,e,D,f,I,h,C,_,R;Y.value=!0,n.value={name:((o=s.project)==null?void 0:o.name)||"",type:((e=s.project)==null?void 0:e.type)||"",leader:((D=s.project)==null?void 0:D.leader)||"",dept:((f=s.project)==null?void 0:f.dept)||"",startDate:(I=s.project)!=null&&I.start?U(s.project.start):null,endDate:(h=s.project)!=null&&h.end?U(s.project.end):null,budget:((_=(C=s.project)==null?void 0:C.fund)==null?void 0:_.total)||null,description:((R=s.project)==null?void 0:R.desc)||""}}function Z(){var o,e,D,f,I,h,C,_,R;Y.value=!1,n.value={name:((o=s.project)==null?void 0:o.name)||"",type:((e=s.project)==null?void 0:e.type)||"",leader:((D=s.project)==null?void 0:D.leader)||"",dept:((f=s.project)==null?void 0:f.dept)||"",startDate:(I=s.project)!=null&&I.start?U(s.project.start):null,endDate:(h=s.project)!=null&&h.end?U(s.project.end):null,budget:((_=(C=s.project)==null?void 0:C.fund)==null?void 0:_.total)||null,description:((R=s.project)==null?void 0:R.desc)||""}}function ee(){var o;(o=S.value)==null||o.validateFields().then(()=>{V.value=!0,setTimeout(()=>{V.value=!1,Y.value=!1,A.success("项目信息已更新")},1e3)})}function te(o){return["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation"].includes(o.type)?(o.size/1024/1024<10||A.error("文件大小不能超过 10MB!"),!1):(A.error("只支持上传 PDF、Word、Excel、PPT 格式的文件!"),!1)}function ae({file:o,fileList:e}){T.value=e}function le(o){T.value=T.value.filter(e=>e.uid!==o.uid)}function N(o){A.info(`正在下载${o}模板...`)}function se(){$.value=!0,setTimeout(()=>{$.value=!1,A.success("草稿已保存")},1e3)}function v(){if(T.value.length===0){A.error("请至少上传一个申报文件");return}m.value=!0,setTimeout(()=>{m.value=!1,A.success("申报材料提交成功，已转入审核流程"),p("submit",{formData:n.value,files:T.value,action:"submit_materials"})},1500)}function b(){P.value&&v()}return me(()=>s.project,o=>{var e;o&&(n.value={name:o.name||"",type:o.type||"",leader:o.leader||"",dept:o.dept||"",startDate:o.start?U(o.start):null,endDate:o.end?U(o.end):null,budget:((e=o.fund)==null?void 0:e.total)||null,description:o.desc||""})},{immediate:!0}),(o,e)=>{const D=c("a-alert"),f=c("a-descriptions-item"),I=c("a-descriptions"),h=c("a-button"),C=c("a-input"),_=c("a-form-item"),R=c("a-select"),ie=c("a-input-number"),re=c("a-date-picker"),de=c("a-textarea"),oe=c("a-space"),ce=c("a-form"),pe=c("a-upload");return r(),L("div",je,[t(D,{message:P.value?"新建项目申报":"立项申报",description:P.value?"请填写项目基本信息并上传相关申报材料，完成后提交审核。":"项目基本信息已确定，请上传申报材料并提交审核。",type:"info","show-icon":"",style:{"margin-bottom":"24px"}},null,8,["message","description"]),P.value?W("",!0):(r(),L("div",ke,[e[12]||(e[12]=a("h4",{class:"section-title"},"项目基本信息",-1)),t(I,{column:2,bordered:""},{default:l(()=>[t(f,{label:"项目名称"},{default:l(()=>[d(y(w.project.name),1)]),_:1}),t(f,{label:"项目类型"},{default:l(()=>[d(y(w.project.type),1)]),_:1}),t(f,{label:"项目负责人"},{default:l(()=>[d(y(w.project.leader),1)]),_:1}),t(f,{label:"所属部门"},{default:l(()=>[d(y(w.project.dept),1)]),_:1}),t(f,{label:"计划开始时间"},{default:l(()=>[d(y(w.project.start),1)]),_:1}),t(f,{label:"计划结束时间"},{default:l(()=>[d(y(w.project.end),1)]),_:1}),t(f,{label:"申请预算"},{default:l(()=>{var u;return[d(y(((u=w.project.fund)==null?void 0:u.total)||"-")+"万元",1)]}),_:1}),t(f,{label:"项目状态"},{default:l(()=>[d(y(w.project.status),1)]),_:1}),t(f,{label:"项目简介",span:2},{default:l(()=>[d(y(w.project.desc),1)]),_:1})]),_:1}),a("div",be,[E.value?(r(),k(h,{key:0,type:"link",onClick:g},{default:l(()=>e[11]||(e[11]=[d(" 编辑项目信息 ",-1)])),_:1,__:[11]})):W("",!0)])])),P.value||Y.value?(r(),k(ce,{key:1,model:n.value,rules:Q,onFinish:b,ref_key:"formRef",ref:S,layout:"horizontal"},{default:l(()=>[a("div",ge,[e[13]||(e[13]=a("h4",{class:"section-title"},"项目基本信息",-1)),a("div",he,[t(_,{label:"项目名称",name:"name",class:"form-item-full"},{default:l(()=>[t(C,{value:n.value.name,"onUpdate:value":e[0]||(e[0]=u=>n.value.name=u),placeholder:"请输入项目名称"},null,8,["value"])]),_:1})]),a("div",we,[t(_,{label:"项目类型",name:"type",class:"form-item-half"},{default:l(()=>[t(R,{value:n.value.type,"onUpdate:value":e[1]||(e[1]=u=>n.value.type=u),options:x,placeholder:"请选择项目类型"},null,8,["value"])]),_:1}),t(_,{label:"项目负责人",name:"leader",class:"form-item-half"},{default:l(()=>[t(C,{value:n.value.leader,"onUpdate:value":e[2]||(e[2]=u=>n.value.leader=u),placeholder:"请输入负责人姓名"},null,8,["value"])]),_:1})]),a("div",De,[t(_,{label:"所属部门",name:"dept",class:"form-item-half"},{default:l(()=>[t(C,{value:n.value.dept,"onUpdate:value":e[3]||(e[3]=u=>n.value.dept=u),placeholder:"请输入所属部门"},null,8,["value"])]),_:1}),t(_,{label:"申请预算",name:"budget",class:"form-item-half"},{default:l(()=>[t(ie,{value:n.value.budget,"onUpdate:value":e[4]||(e[4]=u=>n.value.budget=u),min:0,precision:2,style:{width:"100%"},placeholder:"请输入申请预算（万元）","addon-after":"万元"},null,8,["value"])]),_:1})]),a("div",Se,[t(_,{label:"计划开始时间",name:"startDate",class:"form-item-half"},{default:l(()=>[t(re,{value:n.value.startDate,"onUpdate:value":e[5]||(e[5]=u=>n.value.startDate=u),placeholder:"请选择开始时间",style:{width:"100%"},format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["value"])]),_:1}),t(_,{label:"计划结束时间",name:"endDate",class:"form-item-half"},{default:l(()=>[t(re,{value:n.value.endDate,"onUpdate:value":e[6]||(e[6]=u=>n.value.endDate=u),placeholder:"请选择结束时间",style:{width:"100%"},format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["value"])]),_:1})]),a("div",xe,[t(_,{label:"项目简介",name:"description",class:"form-item-full"},{default:l(()=>[t(de,{value:n.value.description,"onUpdate:value":e[7]||(e[7]=u=>n.value.description=u),placeholder:"请简要描述项目内容、目标、预期成果等",rows:4,maxlength:500,"show-count":""},null,8,["value"])]),_:1})])]),Y.value?(r(),L("div",Ce,[t(oe,null,{default:l(()=>[t(h,{onClick:Z},{default:l(()=>e[14]||(e[14]=[d("取消",-1)])),_:1,__:[14]}),t(h,{type:"primary",onClick:ee,loading:V.value},{default:l(()=>e[15]||(e[15]=[d(" 保存项目信息 ",-1)])),_:1,__:[15]},8,["loading"])]),_:1})])):W("",!0)]),_:1},8,["model"])):W("",!0),a("div",Me,[e[19]||(e[19]=a("h4",{class:"section-title"},"申报材料上传",-1)),a("div",$e,[t(oe,null,{default:l(()=>[e[16]||(e[16]=a("span",null,"模板下载：",-1)),a("a",{onClick:e[8]||(e[8]=u=>N("申报书"))},"项目申报书模板.docx"),a("a",{onClick:e[9]||(e[9]=u=>N("预算"))},"预算表模板.xlsx"),a("a",{onClick:e[10]||(e[10]=u=>N("PPT"))},"汇报PPT模板.pptx")]),_:1,__:[16]})]),t(_,{label:"申报材料",name:"files",class:"upload-form-item"},{default:l(()=>[t(pe,{"file-list":T.value,"before-upload":te,onChange:ae,onRemove:le,multiple:"","list-type":"text",accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx"},{default:l(()=>[t(h,{type:"primary",ghost:""},{default:l(()=>[t(ve(ye)),e[17]||(e[17]=d(" 上传文件 ",-1))]),_:1,__:[17]})]),_:1},8,["file-list"]),e[18]||(e[18]=a("div",{class:"upload-tips"},[a("p",null,"• 支持格式：PDF、Word、Excel、PPT"),a("p",null,"• 单个文件大小不超过10MB"),a("p",null,"• 必须包含：项目申报书、预算表")],-1))]),_:1,__:[18]})]),a("div",Ye,[t(oe,null,{default:l(()=>[t(h,{onClick:se,loading:$.value},{default:l(()=>e[20]||(e[20]=[d(" 保存草稿 ",-1)])),_:1,__:[20]},8,["loading"]),t(h,{type:"primary",onClick:v,loading:m.value},{default:l(()=>e[21]||(e[21]=[d(" 提交审核 ",-1)])),_:1,__:[21]},8,["loading"])]),_:1})])])}}},Te=ue(Pe,[["__scopeId","data-v-5d969b09"]]),Ue={class:"project-detail-page"},Le={class:"project-detail-header"},qe={class:"project-title"},Be={class:"project-detail-main"},Ie={class:"project-steps-container"},Re={class:"phase-section phase-立项"},Ae={class:"phase-section phase-在研"},Ee={class:"phase-section phase-结题"},Fe={class:"phase-section phase-归档"},Ve={class:"project-step-content"},Ne={class:"step-header"},Oe={class:"step-desc"},We={__name:"detail",setup(w){const J=_e(),s=fe(),p=M(0),S=[{key:"research",title:"研究方向调研",status:"wait",phase:"立项",desc:"水厂实地调研、交流座谈、组建项目组、集体讨论"},{key:"apply",title:"提交申请",status:"wait",phase:"立项",desc:"结合本单位下年度计划上报科研管理部门"},{key:"approval",title:"项目立项",status:"wait",phase:"立项",desc:"承担单位技术创新部审批立项"},{key:"kickoff",title:"项目开题",status:"wait",phase:"在研",desc:"纳入承担单位下年度计划、技术创新部专家团队"},{key:"implementation",title:"项目实施",status:"wait",phase:"在研",desc:"技术创新部监管管理、承担单位推进实施"},{key:"midterm",title:"中期汇报",status:"wait",phase:"在研",desc:"技术创新部专家团队、配合单位现场开展"},{key:"acceptance",title:"项目验收",status:"wait",phase:"结题",desc:"技术创新部专家团队相关职能部门"},{key:"archive",title:"项目归档",status:"wait",phase:"归档",desc:"承担单位技术创新部归档管理"}],m=z(()=>S[p.value]),$=z(()=>p.value<=2?"立项":p.value<=5?"在研":p.value===6?"结题":"归档"),V=z(()=>Math.round(p.value/(S.length-1)*100)),Y={立项:"blue",在研:"processing",结题:"orange",归档:"default"},P={立项:"立项",在研:"在研",结题:"结题",归档:"归档"};function E(v){return v<p.value?"finish":v===p.value?"process":"wait"}function n(v,b){v<=p.value&&(p.value=v)}function x(v){console.log("步骤提交:",m.value.title,v),p.value<S.length-1&&p.value++}function T(){J.back()}function Q(){const v=s.params.id;return v&&v.startsWith("XM")?{code:v,name:"",type:"",leader:"",dept:"",start:"",end:"",status:"立项",desc:"",progress:0,stages:[],members:[],fund:{total:0,used:0,left:0},docs:[],logs:[{time:new Date().toISOString().split("T")[0],content:"项目创建"}]}:{code:"XM2024002",name:"水质监测系统",type:"横向",leader:"李四",dept:"管理部",start:"2024-01-01",end:"2024-12-31",status:"在研",desc:"本项目旨在提升水质监测自动化水平。",progress:60,stages:["需求分析","系统设计","开发测试","部署验收"],members:[{name:"李四",role:"负责人",phone:"13800000001"},{name:"王五",role:"成员",phone:"13800000002"}],fund:{total:100,used:60,left:40},docs:[{name:"项目立项书.pdf"},{name:"需求文档.docx"}],logs:[{time:"2024-01-01",content:"项目立项"},{time:"2024-03-01",content:"需求分析完成"},{time:"2024-05-01",content:"系统设计完成"}]}}const g=M(Q()),Z={template:"<div>研究方向调研（待开发）</div>"},ee={template:"<div>项目立项（待开发）</div>"},te={template:"<div>项目开题（待开发）</div>"},ae={template:"<div>项目实施（待开发）</div>"},le={template:"<div>中期汇报（待开发）</div>"},N={template:"<div>项目验收（待开发）</div>"},se={template:"<div>项目归档（待开发）</div>"};return(v,b)=>{const X=c("a-button"),O=c("a-tag"),K=c("a-progress"),q=c("a-step"),B=c("a-steps");return r(),L("div",Ue,[a("div",Le,[t(X,{type:"link",onClick:T},{default:l(()=>b[0]||(b[0]=[d("返回",-1)])),_:1,__:[0]}),a("span",qe,y(g.value.name)+"（"+y(g.value.code)+"）",1),t(O,{color:Y[$.value]},{default:l(()=>[d(y(P[$.value]),1)]),_:1},8,["color"]),t(K,{percent:V.value,status:"active",style:{width:"200px","margin-left":"32px"}},null,8,["percent"])]),a("div",Be,[a("div",Ie,[a("div",Re,[b[1]||(b[1]=a("div",{class:"phase-header"},"立项阶段",-1)),t(B,{direction:"vertical",current:p.value,class:"phase-steps"},{default:l(()=>[(r(!0),L(G,null,H(S.slice(0,3),(i,j)=>(r(),k(q,{key:i.key,title:i.title,status:E(j),onClick:F=>n(j,i),class:"step-item"},null,8,["title","status","onClick"]))),128))]),_:1},8,["current"])]),a("div",Ae,[b[2]||(b[2]=a("div",{class:"phase-header"},"在研阶段",-1)),t(B,{direction:"vertical",current:p.value-3,class:"phase-steps"},{default:l(()=>[(r(!0),L(G,null,H(S.slice(3,6),(i,j)=>(r(),k(q,{key:i.key,title:i.title,status:E(j+3),onClick:F=>n(j+3,i),class:"step-item"},null,8,["title","status","onClick"]))),128))]),_:1},8,["current"])]),a("div",Ee,[b[3]||(b[3]=a("div",{class:"phase-header"},"结题阶段",-1)),t(B,{direction:"vertical",current:p.value-6,class:"phase-steps"},{default:l(()=>[(r(!0),L(G,null,H(S.slice(6,7),(i,j)=>(r(),k(q,{key:i.key,title:i.title,status:E(j+6),onClick:F=>n(j+6,i),class:"step-item"},null,8,["title","status","onClick"]))),128))]),_:1},8,["current"])]),a("div",Fe,[b[4]||(b[4]=a("div",{class:"phase-header"},"归档阶段",-1)),t(B,{direction:"vertical",current:p.value-7,class:"phase-steps"},{default:l(()=>[(r(!0),L(G,null,H(S.slice(7),(i,j)=>(r(),k(q,{key:i.key,title:i.title,status:E(j+7),onClick:F=>n(j+7,i),class:"step-item"},null,8,["title","status","onClick"]))),128))]),_:1},8,["current"])])]),a("div",Ve,[a("div",Ne,[a("h3",null,y(m.value.title),1),t(O,{color:Y[$.value]},{default:l(()=>[d(y(P[$.value]),1)]),_:1},8,["color"])]),a("div",Oe,[a("p",null,y(m.value.desc),1)]),m.value.key==="research"?(r(),k(Z,{key:0,project:g.value,onSubmit:x},null,8,["project"])):m.value.key==="apply"?(r(),k(Te,{key:1,project:g.value,onSubmit:x},null,8,["project"])):m.value.key==="approval"?(r(),k(ee,{key:2,project:g.value,onSubmit:x},null,8,["project"])):m.value.key==="kickoff"?(r(),k(te,{key:3,project:g.value,onSubmit:x},null,8,["project"])):m.value.key==="implementation"?(r(),k(ae,{key:4,project:g.value,onSubmit:x},null,8,["project"])):m.value.key==="midterm"?(r(),k(le,{key:5,project:g.value,onSubmit:x},null,8,["project"])):m.value.key==="acceptance"?(r(),k(N,{key:6,project:g.value,onSubmit:x},null,8,["project"])):m.value.key==="archive"?(r(),k(se,{key:7,project:g.value,onSubmit:x},null,8,["project"])):W("",!0)])])])}}},Ke=ue(We,[["__scopeId","data-v-4e1ef442"]]);export{Ke as default};
