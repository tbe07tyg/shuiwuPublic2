import{_ as Pe,h as T,e as Y,d as ue,i as Ae,c as w,a as o,j as t,t as v,w as a,l as c,u as Be,v as z,f,m as Ee,o as _,b as h,F as q,s as V,k as P,p as u,x as F,O as Re,ab as je,Z as Oe,P as Ie}from"./index-CLrs7Nd9.js";const Me={class:"project-config-wizard"},qe={class:"wizard-header"},Ve={key:0,class:"subtitle"},Fe={key:1,class:"subtitle"},Ge={class:"steps-section"},Je={class:"wizard-content"},Le={key:0,class:"step-content"},Ze={key:1,class:"step-content"},He={class:"template-option"},Qe={class:"template-icon"},Xe={class:"template-name"},Ye={key:0,class:"template-info"},et={class:"template-description"},tt={class:"template-stats"},at={key:2,class:"step-content"},lt={class:"milestones-config"},nt={key:3,class:"step-content"},st={class:"wbs-config"},ot={class:"wbs-tree"},rt={style:{background:"#f0f0f0",padding:"10px","margin-bottom":"10px","font-size":"12px"}},it={key:0,style:{"text-align":"center",padding:"40px",color:"#999"}},ut={class:"tree-node"},dt={class:"node-title"},pt={key:0,class:"node-progress"},mt={class:"node-actions"},ft={class:"wbs-actions"},vt={class:"wizard-actions"},ct={key:0,class:"template-preview"},_t={class:"template-header"},gt={class:"template-icon"},yt={class:"template-description"},kt={class:"template-stats"},bt={class:"phases-preview"},Dt={class:"phase-header"},wt={class:"phase-number"},Ct={class:"phase-name"},xt={class:"phase-duration"},Ut={class:"phase-tasks"},St={__name:"config-wizard",setup($t){const de=Ee(),pe=Be(),C=T(0),G=T(!1),J=T(!1),p=Y({name:"",code:"",manager:"当前用户",department:"",budget:0,startDate:null,endDate:null,description:""}),$=Y({template:1,workMode:"hybrid",automation:["autoAssignTeam","autoCreateTasks"]}),L=T([{id:1,name:"标准研发模板",icon:"📊",description:"适用于常规软件开发项目，包含完整的开发生命周期管理",category:"软件开发",taskCount:25,milestoneCount:5,usageCount:156,isDefault:!0,structure:{phases:[{name:"需求分析阶段",tasks:["需求收集","需求分析","需求评审"],duration:10},{name:"设计阶段",tasks:["概要设计","详细设计","设计评审"],duration:15},{name:"开发阶段",tasks:["前端开发","后端开发","接口联调"],duration:30},{name:"测试阶段",tasks:["单元测试","集成测试","系统测试"],duration:15},{name:"上线阶段",tasks:["部署准备","生产发布","验证测试"],duration:5}],milestones:[{name:"需求确认",phase:"需求分析阶段",type:"review"},{name:"设计评审",phase:"设计阶段",type:"review"},{name:"开发完成",phase:"开发阶段",type:"delivery"},{name:"测试通过",phase:"测试阶段",type:"checkpoint"},{name:"项目交付",phase:"上线阶段",type:"delivery"}]}},{id:2,name:"敏捷开发模板",icon:"⚡",description:"基于Scrum框架的敏捷开发模板，支持快速迭代和持续交付",category:"敏捷开发",taskCount:18,milestoneCount:4,usageCount:89,structure:{phases:[{name:"Sprint 0 - 项目启动",tasks:["产品愿景","用户故事梳理","团队组建"],duration:5},{name:"Sprint 1",tasks:["Sprint规划","功能开发","Sprint评审"],duration:14},{name:"Sprint 2",tasks:["Sprint规划","功能开发","Sprint评审"],duration:14},{name:"项目收尾",tasks:["最终测试","产品发布","项目回顾"],duration:7}]}},{id:3,name:"瀑布开发模板",icon:"🏗️",description:"经典的瀑布模型，适合大型系统和复杂项目的严格管理",category:"大型系统",taskCount:35,milestoneCount:7,usageCount:42,structure:{phases:[{name:"项目启动",tasks:["项目章程","干系人分析","初步计划"],duration:7},{name:"需求工程",tasks:["需求获取","需求分析","需求规格","需求验证"],duration:20},{name:"系统设计",tasks:["架构设计","详细设计","接口设计","数据库设计"],duration:25},{name:"编码实现",tasks:["编码规范","模块开发","代码审查","单元测试"],duration:40},{name:"系统集成",tasks:["集成计划","集成测试","性能测试","安全测试"],duration:20},{name:"系统测试",tasks:["测试计划","功能测试","用户验收","缺陷修复"],duration:25},{name:"部署维护",tasks:["部署计划","生产部署","用户培训","维护交接"],duration:10}]}},{id:4,name:"科研项目模板",icon:"🔬",description:"专门为科研项目设计，符合科研管理规范和流程要求",category:"科研管理",taskCount:22,milestoneCount:6,usageCount:78,structure:{phases:[{name:"立项阶段",tasks:["项目申请","可行性分析","立项评审"],duration:15},{name:"开题阶段",tasks:["文献调研","技术路线","开题报告"],duration:20},{name:"实施阶段",tasks:["实验设计","数据采集","阶段性分析"],duration:180},{name:"中期阶段",tasks:["中期检查","进度汇报","调整方案"],duration:10},{name:"结题阶段",tasks:["成果整理","验收材料","结题答辩"],duration:30},{name:"成果转化",tasks:["论文发表","专利申请","技术转移"],duration:60}]}}]),y=ue(()=>L.value.find(l=>l.id===$.template)),N=T([{name:"项目开题",enabled:!0,plannedDate:null,owner:"pm",prepareDays:7,description:"准备开题报告，组织开题会议"},{name:"中期检查",enabled:!0,plannedDate:null,owner:"pm",prepareDays:10,description:"中期进展汇报，问题梳理分析"},{name:"项目验收",enabled:!0,plannedDate:null,owner:"pm",prepareDays:14,description:"整理项目成果，准备验收材料"}]),b=T([{title:"项目执行阶段",key:"0",children:[{title:"需求分析",key:"0-0",progress:0},{title:"系统设计",key:"0-1",progress:0},{title:"开发实现",key:"0-2",progress:0,children:[{title:"前端开发",key:"0-2-0",progress:0},{title:"后端开发",key:"0-2-1",progress:0}]},{title:"测试验证",key:"0-3",progress:0},{title:"部署上线",key:"0-4",progress:0}]}]),i=Y({visible:!1,isAdd:!1,editingKey:null,parentKey:null,formData:{title:"",description:"",duration:1,priority:"medium",assignee:[],tags:[]}}),ee=T(),me={title:[{required:!0,message:"请输入任务名称",trigger:"blur"},{min:2,max:50,message:"任务名称长度在 2 到 50 个字符",trigger:"blur"}],duration:[{required:!0,message:"请输入预估工期",trigger:"blur"}]},te=ue(()=>y.value?y.value.name:"标准研发模板"),fe=()=>{console.log("🔍 nextStep 被调用，当前步骤:",C.value),C.value===2&&(console.log("📊 里程碑验证详情:"),console.log("- milestones数据:",N.value),console.log("- 启用的里程碑:",N.value.filter(e=>e.enabled)),N.value.forEach((e,s)=>{console.log(`  ${s+1}. ${e.name}: enabled=${e.enabled}, plannedDate=${e.plannedDate}`)}));const l=ae();console.log("✅ 验证结果:",l),l?(console.log("🎯 验证通过，进入下一步"),C.value++,console.log("🔢 新的步骤:",C.value)):console.log("❌ 验证失败，停留在当前步骤")},ve=()=>{C.value--},ae=()=>{switch(C.value){case 0:if(!p.name)return f.error("请填写项目名称"),!1;break;case 1:if(!$.template)return f.error("请选择管理模板"),!1;break;case 2:const l=N.value.filter(e=>e.enabled);if(l.length===0)return f.error("至少启用一个里程碑"),!1;for(const e of l)if(!e.plannedDate||e.plannedDate===null||e.plannedDate==="")return f.error(`请设置"${e.name}"的计划时间`),!1;console.log("里程碑验证通过:",l.map(e=>({name:e.name,date:e.plannedDate})));break}return!0},E=(l,e)=>{for(const s of l){if(s.key===e)return s;if(s.children){const r=E(s.children,e);if(r)return r}}return null},j=(l=null)=>{const e=Date.now();return l?`${l}-${e}`:`${e}`},ce=l=>{console.log("编辑WBS节点:",l);const e=E(b.value,l);if(!e){f.error("未找到要编辑的节点");return}i.visible=!0,i.isAdd=!1,i.editingKey=l,i.formData={title:e.title||"",description:e.description||"",duration:e.duration||1,priority:e.priority||"medium",assignee:e.assignee||[],tags:e.tags||[]}},_e=l=>{console.log("添加子节点到:",l),i.visible=!0,i.isAdd=!0,i.editingKey=null,i.parentKey=l,i.formData={title:"",description:"",duration:1,priority:"medium",assignee:[],tags:[]}},ge=()=>{console.log("添加根节点"),i.visible=!0,i.isAdd=!0,i.editingKey=null,i.parentKey=null,i.formData={title:"",description:"",duration:1,priority:"medium",assignee:[],tags:[]}},le=async()=>{try{await ee.value.validate();const l={title:i.formData.title,description:i.formData.description,duration:i.formData.duration,priority:i.formData.priority,assignee:i.formData.assignee,tags:i.formData.tags,progress:0};if(i.isAdd){const e=j(i.parentKey),s={...l,key:e};if(i.parentKey){const r=E(b.value,i.parentKey);if(r)r.children||(r.children=[]),r.children.push(s),f.success("子节点添加成功");else{f.error("未找到父节点");return}}else b.value.push(s),f.success("根节点添加成功")}else{const e=E(b.value,i.editingKey);if(e)Object.assign(e,l),f.success("节点更新成功");else{f.error("未找到要编辑的节点");return}}i.visible=!1}catch(l){console.log("表单验证失败:",l)}},ye=()=>{const l=(e,s)=>{for(let r=0;r<e.length;r++){if(e[r].key===s)return e.splice(r,1),!0;if(e[r].children&&l(e[r].children,s))return!0}return!1};l(b.value,i.editingKey)?(f.success("节点删除成功"),i.visible=!1):f.error("删除失败，未找到节点")},ne=()=>{i.visible=!1},O=(l,e,s=null)=>{for(let r=0;r<l.length;r++){if(l[r].key===e)return{nodeList:l,index:r,parentKey:s,node:l[r]};if(l[r].children){const g=O(l[r].children,e,l[r].key);if(g)return g}}return null},ke=l=>{console.log("向上移动节点:",l);const e=O(b.value,l);if(!e){f.error("未找到要移动的节点");return}const{nodeList:s,index:r,parentKey:g,node:d}=e;if(r>0)s.splice(r,1),s.splice(r-1,0,d),f.success("节点上移成功");else if(g){const m=O(b.value,g);m?(s.splice(r,1),d.key=j(m.parentKey),I(d,d.key),m.nodeList.splice(m.index,0,d),f.success("节点提升层级成功")):f.warning("已在最顶层，无法继续上移")}else f.warning("已在最顶层，无法上移")},be=l=>{console.log("向下移动节点:",l);const e=O(b.value,l);if(!e){f.error("未找到要移动的节点");return}const{nodeList:s,index:r,node:g}=e;r<s.length-1?(s.splice(r,1),s.splice(r+1,0,g),f.success("节点下移成功")):f.warning("已在最底层，无法下移")},De=l=>{console.log("开始拖拽:",l)},we=l=>{console.log("拖拽进入:",l)},Ce=l=>{console.log("拖拽经过:",l)},xe=l=>{console.log("拖拽放置:",l);const e=l.node.key,s=l.dragNode.key,r=l.node.pos.split("-"),g=l.dropPosition-Number(r[r.length-1]);if(console.log("拖拽详情:",{dragKey:s,dropKey:e,dropPosition:g,dropToGap:l.dropToGap}),s===e||s.indexOf(e+"-")===0){f.warning("不能将节点拖拽到自己或子节点上");return}const d=se(b.value,s);if(!d){f.error("未找到要移动的节点");return}if(l.dropToGap)Ue(b.value,d,e,g),f.success("节点排序成功");else{const m=E(b.value,e);m&&(m.children||(m.children=[]),d.key=j(e),I(d,d.key),m.children.push(d),f.success("节点移动成功"))}},se=(l,e)=>{for(let s=0;s<l.length;s++){if(l[s].key===e)return l.splice(s,1)[0];if(l[s].children){const r=se(l[s].children,e);if(r)return r}}return null},Ue=(l,e,s,r)=>{let g=-1,d=null,m=null;const K=(S,R=null)=>{for(let W=0;W<S.length;W++){if(S[W].key===s)return g=W,d=S,m=R,!0;if(S[W].children&&K(S[W].children,S[W].key))return!0}return!1};if(K(l),g!==-1&&d){const S=r===-1?g:g+1;e.key=j(m),I(e,e.key),d.splice(S,0,e)}},I=(l,e)=>{l.children&&l.children.forEach((s,r)=>{s.key=`${e}-${Date.now()}-${r}`,I(s,s.key)})},Se=async()=>{if(ae())try{G.value=!0;const l={...p,...$,milestones:N.value.filter(e=>e.enabled),wbsStructure:b.value,configTime:new Date().toISOString()};console.log("项目配置数据:",l),await new Promise(e=>setTimeout(e,2e3)),f.success("项目配置完成！正在跳转到项目管理页面..."),setTimeout(()=>{de.push("/project-manager/projects")},1e3)}catch(l){console.error("配置失败:",l),f.error("配置失败，请重试")}finally{G.value=!1}},Z=l=>{console.log("handleTemplateChange 被调用，templateId:",l);const e=L.value.find(s=>s.id===l);console.log("找到的模板:",e),e&&e.structure?(console.log("模板结构:",e.structure),e.structure.milestones&&(N.value=e.structure.milestones.map((s,r)=>({name:s.name,description:`${s.name}阶段的关键节点`,plannedDate:z().add((r+1)*30,"day"),owner:"pm",prepareDays:7,enabled:!0,type:s.type||"checkpoint"})),console.log("更新后的里程碑:",N.value)),e.structure.phases&&(b.value=e.structure.phases.map((s,r)=>({key:`phase-${r}`,title:s.name,children:s.tasks.map((g,d)=>({key:`task-${r}-${d}`,title:g,children:[]}))})),console.log("更新后的WBS结构:",b.value)),f.success(`已应用模板: ${e.name}`)):console.log("模板未找到或没有结构数据")},$e=()=>{y.value&&(J.value=!0)},Ne=()=>{const{projectId:l,projectName:e,projectCode:s,fromApproval:r}=pe.query;l&&(r?(p.name="智能科研管理系统开发",p.code=`PRJ-2024-${l}`,p.department="技术研发部",p.budget=5e5,p.startDate=z(),p.endDate=z().add(6,"month"),p.description="开发一套智能化的科研管理系统，提升科研项目管理效率"):(p.name=e||"项目名称",p.code=s||`PRJ-${l}`,p.department="技术研发部",p.budget=5e5,p.startDate=z(),p.endDate=z().add(6,"month"),p.description="项目配置描述..."),N.value[0].plannedDate=z().add(1,"month"),N.value[1].plannedDate=z().add(3,"month"),N.value[2].plannedDate=z().add(6,"month"))};return Ae(()=>{Ne(),Z(1)}),(l,e)=>{const s=c("a-step"),r=c("a-steps"),g=c("a-input"),d=c("a-form-item"),m=c("a-col"),K=c("a-row"),S=c("a-input-number"),R=c("a-date-picker"),W=c("a-textarea"),H=c("a-form"),Q=c("a-tag"),k=c("a-select-option"),A=c("a-select"),x=c("a-button"),M=c("a-checkbox"),We=c("a-checkbox-group"),he=c("a-switch"),oe=c("a-card"),re=c("a-alert"),Ke=c("a-progress"),ze=c("a-tree"),X=c("a-statistic"),ie=c("a-modal"),Te=c("a-space");return _(),w("div",Me,[o("div",qe,[e[20]||(e[20]=o("h1",null,"项目配置向导",-1)),p.name?(_(),w("p",Ve,"正在配置项目："+v(p.name),1)):(_(),w("p",Fe,"项目初始化配置"))]),o("div",Ge,[t(r,{current:C.value,size:"small"},{default:a(()=>[t(s,{title:"基本信息",description:"确认项目基本信息"}),t(s,{title:"管理配置",description:"选择模板和模式"}),t(s,{title:"里程碑",description:"制定关键节点"}),t(s,{title:"任务规划",description:"创建初始WBS"})]),_:1},8,["current"])]),o("div",Je,[t(oe,{class:"step-card"},{default:a(()=>[C.value===0?(_(),w("div",Le,[e[21]||(e[21]=o("h3",null,"📋 确认项目基本信息",-1)),e[22]||(e[22]=o("p",{class:"step-desc"},"以下信息已从立项数据自动导入，您可以根据需要进行调整",-1)),t(H,{model:p,layout:"vertical",class:"config-form"},{default:a(()=>[t(K,{gutter:24},{default:a(()=>[t(m,{span:12},{default:a(()=>[t(d,{label:"项目名称",required:""},{default:a(()=>[t(g,{value:p.name,"onUpdate:value":e[0]||(e[0]=n=>p.name=n)},null,8,["value"])]),_:1})]),_:1}),t(m,{span:12},{default:a(()=>[t(d,{label:"项目编号"},{default:a(()=>[t(g,{value:p.code,"onUpdate:value":e[1]||(e[1]=n=>p.code=n),readonly:""},null,8,["value"])]),_:1})]),_:1})]),_:1}),t(K,{gutter:24},{default:a(()=>[t(m,{span:12},{default:a(()=>[t(d,{label:"项目经理"},{default:a(()=>[t(g,{value:p.manager,"onUpdate:value":e[2]||(e[2]=n=>p.manager=n),readonly:""},null,8,["value"])]),_:1})]),_:1}),t(m,{span:12},{default:a(()=>[t(d,{label:"所属部门"},{default:a(()=>[t(g,{value:p.department,"onUpdate:value":e[3]||(e[3]=n=>p.department=n),readonly:""},null,8,["value"])]),_:1})]),_:1})]),_:1}),t(K,{gutter:24},{default:a(()=>[t(m,{span:8},{default:a(()=>[t(d,{label:"项目预算"},{default:a(()=>[t(S,{value:p.budget,"onUpdate:value":e[4]||(e[4]=n=>p.budget=n),min:0,formatter:n=>`¥ ${n}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),style:{width:"100%"}},null,8,["value","formatter"])]),_:1})]),_:1}),t(m,{span:8},{default:a(()=>[t(d,{label:"开始时间"},{default:a(()=>[t(R,{value:p.startDate,"onUpdate:value":e[5]||(e[5]=n=>p.startDate=n),style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),t(m,{span:8},{default:a(()=>[t(d,{label:"结束时间"},{default:a(()=>[t(R,{value:p.endDate,"onUpdate:value":e[6]||(e[6]=n=>p.endDate=n),style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1}),t(d,{label:"项目描述"},{default:a(()=>[t(W,{value:p.description,"onUpdate:value":e[7]||(e[7]=n=>p.description=n),rows:4},null,8,["value"])]),_:1})]),_:1},8,["model"])])):h("",!0),C.value===1?(_(),w("div",Ze,[e[31]||(e[31]=o("h3",null,"⚙️ 项目管理配置",-1)),e[32]||(e[32]=o("p",{class:"step-desc"},"选择合适的管理模板和工作模式，设置自动化功能",-1)),t(H,{model:$,layout:"vertical",class:"config-form"},{default:a(()=>[t(K,{gutter:24},{default:a(()=>[t(m,{span:12},{default:a(()=>[t(d,{label:"管理模板"},{default:a(()=>[t(A,{value:$.template,"onUpdate:value":e[8]||(e[8]=n=>$.template=n),style:{width:"100%"},onChange:Z},{default:a(()=>[(_(!0),w(q,null,V(L.value,n=>(_(),P(k,{key:n.id,value:n.id},{default:a(()=>[o("div",He,[o("span",Qe,v(n.icon),1),o("span",Xe,v(n.name),1),t(Q,{size:"small",style:{"margin-left":"8px"}},{default:a(()=>[u(v(n.category),1)]),_:2},1024)])]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),y.value?(_(),w("div",Ye,[o("p",et,v(y.value.description),1),o("div",tt,[o("span",null,v(y.value.taskCount)+" 个任务",1),o("span",null,v(y.value.milestoneCount)+" 个里程碑",1),o("span",null,"已使用 "+v(y.value.usageCount)+" 次",1)]),t(x,{type:"link",size:"small",onClick:$e},{default:a(()=>[t(F(Re)),e[23]||(e[23]=u(" 预览模板结构 ",-1))]),_:1,__:[23]})])):h("",!0)]),_:1})]),_:1}),t(m,{span:12},{default:a(()=>[t(d,{label:"工作模式"},{default:a(()=>[t(A,{value:$.workMode,"onUpdate:value":e[9]||(e[9]=n=>$.workMode=n),style:{width:"100%"}},{default:a(()=>[t(k,{value:"hybrid"},{default:a(()=>e[24]||(e[24]=[u("混合模式",-1)])),_:1,__:[24]}),t(k,{value:"remote"},{default:a(()=>e[25]||(e[25]=[u("远程协作",-1)])),_:1,__:[25]}),t(k,{value:"onsite"},{default:a(()=>e[26]||(e[26]=[u("现场办公",-1)])),_:1,__:[26]})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),t(d,{label:"自动化设置"},{default:a(()=>[t(We,{value:$.automation,"onUpdate:value":e[10]||(e[10]=n=>$.automation=n)},{default:a(()=>[t(M,{value:"autoAssignTeam"},{default:a(()=>e[27]||(e[27]=[u("自动推荐团队成员",-1)])),_:1,__:[27]}),t(M,{value:"autoCreateTasks"},{default:a(()=>e[28]||(e[28]=[u("基于模板自动创建任务",-1)])),_:1,__:[28]}),t(M,{value:"autoReports"},{default:a(()=>e[29]||(e[29]=[u("自动生成进度报告",-1)])),_:1,__:[29]}),t(M,{value:"autoNotifications"},{default:a(()=>e[30]||(e[30]=[u("自动发送提醒通知",-1)])),_:1,__:[30]})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])])):h("",!0),C.value===2?(_(),w("div",at,[e[36]||(e[36]=o("h3",null,"🎯 制定项目里程碑",-1)),e[37]||(e[37]=o("p",{class:"step-desc"},"设置项目关键节点，用于向管理角色提交材料和进度跟踪",-1)),o("div",lt,[(_(!0),w(q,null,V(N.value,(n,U)=>(_(),w("div",{key:U,class:"milestone-item"},[t(oe,{size:"small",title:n.name},{extra:a(()=>[t(he,{checked:n.enabled,"onUpdate:checked":D=>n.enabled=D},null,8,["checked","onUpdate:checked"])]),default:a(()=>[t(K,{gutter:16},{default:a(()=>[t(m,{span:8},{default:a(()=>[t(d,{label:"计划时间"},{default:a(()=>[t(R,{value:n.plannedDate,"onUpdate:value":D=>n.plannedDate=D,style:{width:"100%"}},null,8,["value","onUpdate:value"])]),_:2},1024)]),_:2},1024),t(m,{span:8},{default:a(()=>[t(d,{label:"负责人"},{default:a(()=>[t(A,{value:n.owner,"onUpdate:value":D=>n.owner=D,style:{width:"100%"}},{default:a(()=>[t(k,{value:"pm"},{default:a(()=>e[33]||(e[33]=[u("项目经理",-1)])),_:1,__:[33]}),t(k,{value:"tech"},{default:a(()=>e[34]||(e[34]=[u("技术负责人",-1)])),_:1,__:[34]}),t(k,{value:"qa"},{default:a(()=>e[35]||(e[35]=[u("质量负责人",-1)])),_:1,__:[35]})]),_:2},1032,["value","onUpdate:value"])]),_:2},1024)]),_:2},1024),t(m,{span:8},{default:a(()=>[t(d,{label:"提前准备天数"},{default:a(()=>[t(S,{value:n.prepareDays,"onUpdate:value":D=>n.prepareDays=D,min:1,max:30,style:{width:"100%"}},null,8,["value","onUpdate:value"])]),_:2},1024)]),_:2},1024)]),_:2},1024),t(d,{label:"里程碑描述"},{default:a(()=>[t(W,{value:n.description,"onUpdate:value":D=>n.description=D,rows:2},null,8,["value","onUpdate:value"])]),_:2},1024)]),_:2},1032,["title"])]))),128))])])):h("",!0),C.value===3?(_(),w("div",nt,[e[51]||(e[51]=o("h3",null,"📊 创建初始WBS结构",-1)),e[52]||(e[52]=o("p",{class:"step-desc"},"基于选择的管理模板，创建初始的工作分解结构",-1)),o("div",st,[t(re,{message:"模板任务结构",description:`基于${te.value}，系统已为您生成初始任务结构，您可以根据需要进行调整`,type:"info","show-icon":"",style:{"margin-bottom":"24px"}},null,8,["description"]),o("div",ot,[o("div",rt,[e[39]||(e[39]=o("strong",null,"调试信息：",-1)),e[40]||(e[40]=o("br",null,null,-1)),u(" WBS结构长度: "+v(b.value.length),1),e[41]||(e[41]=o("br",null,null,-1)),u(" 当前步骤: "+v(C.value),1),e[42]||(e[42]=o("br",null,null,-1)),u(" 选中模板ID: "+v($.template),1),e[43]||(e[43]=o("br",null,null,-1)),u(" 选中模板对象: "+v(y.value?y.value.name:"未找到"),1),e[44]||(e[44]=o("br",null,null,-1)),u(" 模板名称: "+v(te.value),1),e[45]||(e[45]=o("br",null,null,-1)),o("details",null,[e[38]||(e[38]=o("summary",null,"WBS完整数据 (点击展开)",-1)),o("pre",null,v(JSON.stringify(b.value,null,2)),1)])]),t(re,{message:"拖拽排序提示",description:"您可以拖拽节点来调整任务顺序：拖拽到节点之间可以调整同级顺序，拖拽到节点内部可以设为子任务",type:"info","show-icon":"",closable:"",style:{"margin-bottom":"16px"}}),b.value.length===0?(_(),w("div",it,[e[47]||(e[47]=o("p",null,"🔧 WBS结构数据为空，请检查模板应用",-1)),t(x,{onClick:e[11]||(e[11]=n=>Z(1))},{default:a(()=>e[46]||(e[46]=[u("手动应用默认模板",-1)])),_:1,__:[46]})])):(_(),P(ze,{key:1,"tree-data":b.value,checkable:!1,selectable:!0,"default-expanded-keys":["0"],showLine:!0,showIcon:!1,draggable:!0,onDrop:xe,onDragenter:we,onDragover:Ce,onDragstart:De},{title:a(({title:n,key:U,progress:D})=>[o("div",ut,[o("span",dt,v(n),1),D!==void 0?(_(),w("span",pt,[t(Ke,{percent:D,size:"small",style:{width:"100px"}},null,8,["percent"])])):h("",!0),o("span",mt,[t(x,{type:"link",size:"small",onClick:B=>ke(U),title:"向上移动"},{icon:a(()=>[t(F(je))]),_:2},1032,["onClick"]),t(x,{type:"link",size:"small",onClick:B=>be(U),title:"向下移动"},{icon:a(()=>[t(F(Oe))]),_:2},1032,["onClick"]),t(x,{type:"link",size:"small",onClick:B=>ce(U)},{default:a(()=>e[48]||(e[48]=[u("编辑",-1)])),_:2,__:[48]},1032,["onClick"]),t(x,{type:"link",size:"small",onClick:B=>_e(U)},{default:a(()=>e[49]||(e[49]=[u("添加子项",-1)])),_:2,__:[49]},1032,["onClick"])])])]),_:1},8,["tree-data"]))]),o("div",ft,[t(x,{type:"dashed",onClick:ge},{default:a(()=>[t(F(Ie)),e[50]||(e[50]=u(" 添加根节点 ",-1))]),_:1,__:[50]})])])])):h("",!0),o("div",vt,[C.value>0?(_(),P(x,{key:0,onClick:ve},{default:a(()=>e[53]||(e[53]=[u("上一步",-1)])),_:1,__:[53]})):h("",!0),C.value<3?(_(),P(x,{key:1,type:"primary",onClick:fe},{default:a(()=>e[54]||(e[54]=[u("下一步",-1)])),_:1,__:[54]})):h("",!0),C.value===3?(_(),P(x,{key:2,type:"primary",onClick:Se,loading:G.value},{default:a(()=>e[55]||(e[55]=[u(" 完成配置 ",-1)])),_:1,__:[55]},8,["loading"])):h("",!0)])]),_:1})]),t(ie,{open:J.value,"onUpdate:open":e[12]||(e[12]=n=>J.value=n),title:"模板结构预览",width:"800px",footer:null},{default:a(()=>{var n;return[y.value?(_(),w("div",ct,[o("div",_t,[o("span",gt,v(y.value.icon),1),o("h3",null,v(y.value.name),1),t(Q,null,{default:a(()=>[u(v(y.value.category),1)]),_:1})]),o("p",yt,v(y.value.description),1),o("div",kt,[t(K,{gutter:16},{default:a(()=>[t(m,{span:8},{default:a(()=>{var U,D;return[t(X,{title:"项目阶段",value:((D=(U=y.value.structure)==null?void 0:U.phases)==null?void 0:D.length)||0,suffix:"个"},null,8,["value"])]}),_:1}),t(m,{span:8},{default:a(()=>[t(X,{title:"任务节点",value:y.value.taskCount,suffix:"个"},null,8,["value"])]),_:1}),t(m,{span:8},{default:a(()=>[t(X,{title:"里程碑",value:y.value.milestoneCount,suffix:"个"},null,8,["value"])]),_:1})]),_:1})]),o("div",bt,[e[56]||(e[56]=o("h4",null,"项目阶段结构",-1)),(_(!0),w(q,null,V(((n=y.value.structure)==null?void 0:n.phases)||[],(U,D)=>(_(),w("div",{key:D,class:"phase-item"},[o("div",Dt,[o("span",wt,v(D+1),1),o("span",Ct,v(U.name),1),o("span",xt,v(U.duration)+" 天",1)]),o("div",Ut,[(_(!0),w(q,null,V(U.tasks,B=>(_(),P(Q,{key:B,size:"small"},{default:a(()=>[u(v(B),1)]),_:2},1024))),128))])]))),128))])])):h("",!0)]}),_:1},8,["open"]),t(ie,{open:i.visible,"onUpdate:open":e[19]||(e[19]=n=>i.visible=n),title:i.isAdd?"添加任务节点":"编辑任务节点",width:"600px",onOk:le,onCancel:ne},{footer:a(()=>[t(Te,null,{default:a(()=>[t(x,{onClick:ne},{default:a(()=>e[69]||(e[69]=[u("取消",-1)])),_:1,__:[69]}),i.isAdd?h("",!0):(_(),P(x,{key:0,type:"danger",onClick:ye},{default:a(()=>e[70]||(e[70]=[u(" 删除节点 ",-1)])),_:1,__:[70]})),t(x,{type:"primary",onClick:le},{default:a(()=>[u(v(i.isAdd?"添加":"保存"),1)]),_:1})]),_:1})]),default:a(()=>[t(H,{model:i.formData,rules:me,ref_key:"wbsEditFormRef",ref:ee,layout:"vertical"},{default:a(()=>[t(d,{label:"任务名称",name:"title"},{default:a(()=>[t(g,{value:i.formData.title,"onUpdate:value":e[13]||(e[13]=n=>i.formData.title=n),placeholder:"请输入任务名称"},null,8,["value"])]),_:1}),t(d,{label:"任务描述",name:"description"},{default:a(()=>[t(W,{value:i.formData.description,"onUpdate:value":e[14]||(e[14]=n=>i.formData.description=n),placeholder:"请输入任务描述",rows:3},null,8,["value"])]),_:1}),t(K,{gutter:16},{default:a(()=>[t(m,{span:12},{default:a(()=>[t(d,{label:"预估工期(天)",name:"duration"},{default:a(()=>[t(S,{value:i.formData.duration,"onUpdate:value":e[15]||(e[15]=n=>i.formData.duration=n),min:1,max:365,placeholder:"预估工期",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),t(m,{span:12},{default:a(()=>[t(d,{label:"优先级",name:"priority"},{default:a(()=>[t(A,{value:i.formData.priority,"onUpdate:value":e[16]||(e[16]=n=>i.formData.priority=n),placeholder:"选择优先级"},{default:a(()=>[t(k,{value:"high"},{default:a(()=>e[57]||(e[57]=[u("高",-1)])),_:1,__:[57]}),t(k,{value:"medium"},{default:a(()=>e[58]||(e[58]=[u("中",-1)])),_:1,__:[58]}),t(k,{value:"low"},{default:a(()=>e[59]||(e[59]=[u("低",-1)])),_:1,__:[59]})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),t(d,{label:"负责人",name:"assignee"},{default:a(()=>[t(A,{value:i.formData.assignee,"onUpdate:value":e[17]||(e[17]=n=>i.formData.assignee=n),placeholder:"选择负责人",mode:"multiple"},{default:a(()=>[t(k,{value:"user1"},{default:a(()=>e[60]||(e[60]=[u("张三",-1)])),_:1,__:[60]}),t(k,{value:"user2"},{default:a(()=>e[61]||(e[61]=[u("李四",-1)])),_:1,__:[61]}),t(k,{value:"user3"},{default:a(()=>e[62]||(e[62]=[u("王五",-1)])),_:1,__:[62]}),t(k,{value:"user4"},{default:a(()=>e[63]||(e[63]=[u("赵六",-1)])),_:1,__:[63]})]),_:1},8,["value"])]),_:1}),t(d,{label:"任务标签",name:"tags"},{default:a(()=>[t(A,{value:i.formData.tags,"onUpdate:value":e[18]||(e[18]=n=>i.formData.tags=n),placeholder:"选择任务标签",mode:"tags"},{default:a(()=>[t(k,{value:"开发"},{default:a(()=>e[64]||(e[64]=[u("开发",-1)])),_:1,__:[64]}),t(k,{value:"测试"},{default:a(()=>e[65]||(e[65]=[u("测试",-1)])),_:1,__:[65]}),t(k,{value:"设计"},{default:a(()=>e[66]||(e[66]=[u("设计",-1)])),_:1,__:[66]}),t(k,{value:"文档"},{default:a(()=>e[67]||(e[67]=[u("文档",-1)])),_:1,__:[67]}),t(k,{value:"评审"},{default:a(()=>e[68]||(e[68]=[u("评审",-1)])),_:1,__:[68]})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"])])}}},Wt=Pe(St,[["__scopeId","data-v-ca3d813e"]]);export{Wt as default};
