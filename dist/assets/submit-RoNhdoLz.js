import{_ as ne,h as p,d as x,m as le,i as re,v as R,f as g,c as C,a as s,j as a,t as u,w as o,l as d,o as h,p as r,x as b,N as ie,b as D,F as ue,s as de,k as ce,z as pe,L as me}from"./index-BG3bheTR.js";/* empty css                                                                    */import{M as _e}from"./MaterialTemplateSync-CTByVy5g.js";import{P as fe}from"./ProjectOutlined-pD6foRXv.js";import{S as ve}from"./SaveOutlined-D-NlQ1oV.js";import{S as ye}from"./SendOutlined-pJ9NTnU4.js";import"./materialTemplate-BNbirzGC.js";import"./UploadOutlined-RXM_KW39.js";const ge={class:"submit-container"},he={class:"page-header"},be={class:"header-content"},qe={class:"page-title"},je={class:"page-description"},ke={class:"header-actions"},xe={class:"form-section"},Ce={class:"section-header"},Ie={class:"section-content"},we={class:"project-option"},Re={class:"project-name"},De={class:"project-info"},Le={class:"project-code"},Te={class:"project-status"},Se={key:0,class:"selected-project-info"},Ue={class:"form-section"},Oe={class:"section-header"},Pe={class:"section-content"},Me={key:0,class:"form-section"},ze={class:"section-header"},Ve={class:"review-comments-content"},Fe={class:"comments-text"},Be={class:"form-section"},Ne={key:0,class:"resubmit-notice"},Je={class:"form-actions"},Ae={__name:"submit",setup(Ee){const q=le(),P=p(),M=p(),z=p({allRequiredUploaded:!1,uploadedCount:0,totalCount:0}),w=p([]),I=x(()=>q.currentRoute.value.query.resubmit==="true"),m=x(()=>q.currentRoute.value.query.improvement==="true"),V=x(()=>m.value?"提交整改材料":I.value?"重新提交验收申请":"提交验收申请"),F=x(()=>m.value?"根据验收会议的整改要求，提交相应的整改材料和说明":I.value?"根据审核意见修改完善后重新提交验收申请":"填写项目验收申请信息并上传相关材料"),l=p({projectId:void 0,expectedDate:void 0,acceptanceType:void 0,description:"",remarks:""}),B={projectId:[{required:!0,message:"请选择项目"}],expectedDate:[{required:!0,message:"请选择预期验收时间"}],acceptanceType:[{required:!0,message:"请选择验收类型"}],description:[{required:!0,message:"请填写申请说明"}]},j=p([{id:1,name:"智慧城市大数据平台建设项目",code:"PROJ-2024-001",status:"实施中",startDate:"2023-06-01",endDate:"2024-05-31",leader:"张三",budget:500},{id:2,name:"区块链供应链金融平台",code:"PROJ-2024-002",status:"实施中",startDate:"2023-08-01",endDate:"2024-07-31",leader:"李四",budget:300},{id:3,name:"AI智能客服系统",code:"PROJ-2024-003",status:"即将结束",startDate:"2023-09-01",endDate:"2024-03-31",leader:"王五",budget:200}]),f=x(()=>j.value.find(t=>t.id===l.value.projectId)),L=p([{key:"acceptance_report",name:"项目验收报告",description:"详细的项目验收报告，包含项目完成情况、技术指标等",fileList:[]},{key:"summary_report",name:"项目总结报告",description:"项目实施过程总结，包含经验教训、改进建议等",fileList:[]},{key:"achievement_materials",name:"成果汇总材料",description:"项目产出的各类成果材料，如软件、报告、专利等",fileList:[]},{key:"financial_report",name:"财务决算报告",description:"项目资金使用情况的详细财务报告",fileList:[]}]),N=p([{key:"ip_list",name:"知识产权清单",description:"项目产生的专利、软著等知识产权清单",fileList:[]},{key:"test_report",name:"测试报告",description:"系统测试、性能测试等相关测试报告",fileList:[]},{key:"user_manual",name:"用户手册",description:"系统使用手册、操作指南等文档",fileList:[]},{key:"other_materials",name:"其他材料",description:"其他与项目验收相关的补充材料",fileList:[]}]),T=p(!1),k=p("");p(!1),p({});const J=t=>({实施中:"blue",即将结束:"orange",已完成:"green",暂停:"red"})[t]||"default",A=(t,e)=>{const c=j.value.find(n=>n.id===e.value);return c&&(c.name.toLowerCase().includes(t.toLowerCase())||c.code.toLowerCase().includes(t.toLowerCase()))},E=t=>t&&t<R().startOf("day"),$=()=>{q.go(-1)},G=t=>{console.log("Selected project:",t)},H=async()=>{try{g.success("草稿保存成功")}catch{g.error("草稿保存失败")}},K=async t=>{try{T.value=!0;const e=L.value.filter(n=>n.fileList.length===0);if(e.length>0){g.error(`请上传必需材料：${e.map(n=>n.name).join("、")}`);return}const c={...t,materials:{required:L.value.reduce((n,_)=>(n[_.key]=_.fileList,n),{}),optional:N.value.reduce((n,_)=>(n[_.key]=_.fileList,n),{})}};console.log("Submit data:",c),await new Promise(n=>setTimeout(n,2e3)),g.success("验收申请提交成功"),q.push("/acceptance/application/manage")}catch{g.error("提交失败，请重试")}finally{T.value=!1}},Q=t=>{const{configId:e,file:c,action:n}=t;if(n==="add")w.value.push({configId:e,file:c});else if(n==="remove"){const _=w.value.findIndex(v=>v.configId===e);_>-1&&w.value.splice(_,1)}},W=t=>{z.value=t},X=t=>{console.log("验收材料配置已更新:",t)};return re(()=>{const t=q.currentRoute.value;if(t.query.resubmit==="true"){if(t.query.projectId){const e=parseInt(t.query.projectId);j.value.find(n=>n.id===e)&&(l.value.projectId=e)}t.query.expectedTime&&(l.value.expectedDate=R(t.query.expectedTime)),t.query.description&&(l.value.description=decodeURIComponent(t.query.description)),t.query.rejectionReason?k.value=decodeURIComponent(t.query.rejectionReason):t.query.reviewComments&&(k.value=decodeURIComponent(t.query.reviewComments)),l.value.acceptanceType="final",g.info("已自动填充项目信息，请重新上传验收材料并完善申请信息")}if(t.query.improvement==="true"){if(t.query.projectId){const e=parseInt(t.query.projectId);j.value.find(n=>n.id===e)&&(l.value.projectId=e)}t.query.expectedTime&&(l.value.expectedDate=R(t.query.expectedTime)),t.query.description&&(l.value.description=decodeURIComponent(t.query.description)),t.query.improvementRequirements&&(k.value=decodeURIComponent(t.query.improvementRequirements)),l.value.acceptanceType="final",g.info("已自动填充项目信息，请根据整改要求上传相关材料")}}),(t,e)=>{const c=d("a-button"),n=d("a-select-option"),_=d("a-select"),v=d("a-form-item"),y=d("a-descriptions-item"),Y=d("a-tag"),Z=d("a-descriptions"),ee=d("a-date-picker"),S=d("a-col"),te=d("a-row"),U=d("a-textarea"),O=d("a-alert"),ae=d("a-space"),oe=d("a-form"),se=d("a-card");return h(),C("div",ge,[s("div",he,[s("div",be,[s("h1",qe,u(V.value),1),s("p",je,u(F.value),1)]),s("div",ke,[a(c,{onClick:$},{default:o(()=>[a(b(ie)),e[5]||(e[5]=r(" 返回列表 "))]),_:1,__:[5]})])]),a(se,{bordered:!1},{default:o(()=>[a(oe,{ref_key:"formRef",ref:P,model:l.value,rules:B,layout:"vertical",onFinish:K},{default:o(()=>[s("div",xe,[s("div",Ce,[s("h3",null,[a(b(fe)),e[6]||(e[6]=r(" 项目选择 "))]),e[7]||(e[7]=s("p",null,"选择需要申请验收的项目",-1))]),s("div",Ie,[a(v,{label:"选择项目",name:"projectId",rules:[{required:!0,message:"请选择项目"}]},{default:o(()=>[a(_,{value:l.value.projectId,"onUpdate:value":e[0]||(e[0]=i=>l.value.projectId=i),placeholder:"请选择项目",size:"large","show-search":"","filter-option":A,onChange:G},{default:o(()=>[(h(!0),C(ue,null,de(j.value,i=>(h(),ce(n,{key:i.id,value:i.id},{default:o(()=>[s("div",we,[s("div",Re,u(i.name),1),s("div",De,[s("span",Le,u(i.code),1),s("span",Te,u(i.status),1)])])]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),f.value?(h(),C("div",Se,[a(Z,{column:2,bordered:"",size:"small"},{default:o(()=>[a(y,{label:"项目名称",span:2},{default:o(()=>[r(u(f.value.name),1)]),_:1}),a(y,{label:"项目编号"},{default:o(()=>[r(u(f.value.code),1)]),_:1}),a(y,{label:"项目状态"},{default:o(()=>[a(Y,{color:J(f.value.status)},{default:o(()=>[r(u(f.value.status),1)]),_:1},8,["color"])]),_:1}),a(y,{label:"开始时间"},{default:o(()=>[r(u(f.value.startDate),1)]),_:1}),a(y,{label:"计划结束时间"},{default:o(()=>[r(u(f.value.endDate),1)]),_:1}),a(y,{label:"项目负责人"},{default:o(()=>[r(u(f.value.leader),1)]),_:1}),a(y,{label:"项目总预算"},{default:o(()=>[r(u(f.value.budget)+"万元 ",1)]),_:1})]),_:1})])):D("",!0)])]),s("div",Ue,[s("div",Oe,[s("h3",null,[a(b(pe)),e[8]||(e[8]=r(" 申请信息 "))]),e[9]||(e[9]=s("p",null,"填写验收申请的基本信息",-1))]),s("div",Pe,[a(te,{gutter:24},{default:o(()=>[a(S,{xs:24,md:12},{default:o(()=>[a(v,{label:"预期验收时间",name:"expectedDate",rules:[{required:!0,message:"请选择预期验收时间"}]},{default:o(()=>[a(ee,{value:l.value.expectedDate,"onUpdate:value":e[1]||(e[1]=i=>l.value.expectedDate=i),placeholder:"请选择预期验收时间",size:"large",style:{width:"100%"},"disabled-date":E},null,8,["value"])]),_:1})]),_:1}),a(S,{xs:24,md:12},{default:o(()=>[a(v,{label:"验收类型",name:"acceptanceType",rules:[{required:!0,message:"请选择验收类型"}]},{default:o(()=>[a(_,{value:l.value.acceptanceType,"onUpdate:value":e[2]||(e[2]=i=>l.value.acceptanceType=i),placeholder:"请选择验收类型",size:"large"},{default:o(()=>[a(n,{value:"final"},{default:o(()=>e[10]||(e[10]=[r("结题验收")])),_:1,__:[10]}),a(n,{value:"phase"},{default:o(()=>e[11]||(e[11]=[r("阶段验收")])),_:1,__:[11]}),a(n,{value:"special"},{default:o(()=>e[12]||(e[12]=[r("专项验收")])),_:1,__:[12]})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),a(v,{label:"申请说明",name:"description",rules:[{required:!0,message:"请填写申请说明"}]},{default:o(()=>[a(U,{value:l.value.description,"onUpdate:value":e[3]||(e[3]=i=>l.value.description=i),placeholder:"请详细说明项目完成情况、主要成果及验收准备情况",rows:4,size:"large","show-count":"",maxlength:500},null,8,["value"])]),_:1}),a(v,{label:"备注说明",name:"remarks"},{default:o(()=>[a(U,{value:l.value.remarks,"onUpdate:value":e[4]||(e[4]=i=>l.value.remarks=i),placeholder:"其他需要说明的事项（选填）",rows:3,size:"large","show-count":"",maxlength:200},null,8,["value"])]),_:1})])]),(I.value||m.value)&&k.value?(h(),C("div",Me,[s("div",ze,[s("h3",null,[a(b(me)),r(" "+u(m.value?"整改要求":"审核意见"),1)]),s("p",null,"请仔细阅读以下"+u(m.value?"整改要求":"审核意见")+"，并据此修改完善申请材料",1)]),s("div",Ve,[a(O,{message:m.value?"验收会议整改要求":"材料审核意见",type:m.value?"warning":"error","show-icon":""},{description:o(()=>[s("div",Fe,u(k.value),1)]),_:1},8,["message","type"])])])):D("",!0),s("div",Be,[I.value||m.value?(h(),C("div",Ne,[a(O,{message:m.value?"整改材料提交":"重新提交提醒",description:m.value?"请根据验收会议的整改要求，上传相应的整改材料和说明文档。":"由于材料审核未通过，请根据审核意见重新准备并上传所有必需材料。",type:m.value?"warning":"info","show-icon":"",style:{"margin-bottom":"16px"}},null,8,["message","description","type"])])):D("",!0),a(_e,{ref_key:"materialTemplateSyncRef",ref:M,"business-type":"acceptance",onFilesChange:Q,onValidationChange:W,onConfigUpdate:X},null,512)]),s("div",Je,[a(ae,null,{default:o(()=>[a(c,{onClick:H},{default:o(()=>[a(b(ve)),e[13]||(e[13]=r(" 保存草稿 "))]),_:1,__:[13]}),a(c,{type:"primary","html-type":"submit"},{default:o(()=>[a(b(ye)),e[14]||(e[14]=r(" 提交申请 "))]),_:1,__:[14]})]),_:1})])]),_:1},8,["model"])]),_:1})])}}},Ze=ne(Ae,[["__scopeId","data-v-fb27926c"]]);export{Ze as default};
