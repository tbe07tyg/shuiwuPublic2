import{j as createVNode,I as Icon,_ as _export_sfc,a8 as useTaskSyncStore,h as ref,u as useRoute,e as reactive,i as onMounted,a1 as onUnmounted,d as computed,A as watch,f as api,M as Modal,a5 as nextTick,c as createElementBlock,a as createBaseVNode,w as withCtx,l as resolveComponent,t as toDisplayString,K as normalizeStyle,F as Fragment,ap as api$1,m as useRouter,o as openBlock,p as createTextVNode,x as unref,N as ArrowLeftOutlined,n as normalizeClass,b as createCommentVNode,k as createBlock,q as withModifiers,z as FileTextOutlined,P as PlusOutlined,T as EditOutlined,an as LeftOutlined,a9 as RightOutlined,a4 as DeleteOutlined,aa as CopyOutlined,W as CloseOutlined,s as renderList,Q as FileOutlined,aq as PlusSquareOutlined,ar as MinusSquareOutlined,Z as DownOutlined,R as ReloadOutlined,U as resolveDynamicComponent}from"./index-BG3bheTR.js";import{m as materialTemplateStore}from"./materialTemplate-BNbirzGC.js";import{M as MoreOutlined}from"./MoreOutlined-gm8wqwLf.js";import{P as PlayCircleOutlined}from"./PlayCircleOutlined-CYr-KMxw.js";import{U as UserOutlined}from"./UserOutlined-eJbNfDXj.js";import{B as BellOutlined}from"./BellOutlined-6oZgT64E.js";import{S as SyncOutlined}from"./SyncOutlined-BYcaCKWZ.js";var ArrowDownOutlined$1={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M862 465.3h-81c-4.6 0-9 2-12.1 5.5L550 723.1V160c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v563.1L255.1 470.8c-3-3.5-7.4-5.5-12.1-5.5h-81c-6.8 0-10.5 8.1-6 13.2L487.9 861a31.96 31.96 0 0048.3 0L868 478.5c4.5-5.2.8-13.2-6-13.2z"}}]},name:"arrow-down",theme:"outlined"};function _objectSpread$1(t){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?Object(arguments[e]):{},l=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(l=l.concat(Object.getOwnPropertySymbols(a).filter(function(o){return Object.getOwnPropertyDescriptor(a,o).enumerable}))),l.forEach(function(o){_defineProperty$1(t,o,a[o])})}return t}function _defineProperty$1(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}var ArrowDownOutlined=function(e,a){var l=_objectSpread$1({},e,a.attrs);return createVNode(Icon,_objectSpread$1({},l,{icon:ArrowDownOutlined$1}),null)};ArrowDownOutlined.displayName="ArrowDownOutlined";ArrowDownOutlined.inheritAttrs=!1;var ArrowUpOutlined$1={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M868 545.5L536.1 163a31.96 31.96 0 00-48.3 0L156 545.5a7.97 7.97 0 006 13.2h81c4.6 0 9-2 12.1-5.5L474 300.9V864c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V300.9l218.9 252.3c3 3.5 7.4 5.5 12.1 5.5h81c6.8 0 10.5-8 6-13.2z"}}]},name:"arrow-up",theme:"outlined"};function _objectSpread(t){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?Object(arguments[e]):{},l=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(l=l.concat(Object.getOwnPropertySymbols(a).filter(function(o){return Object.getOwnPropertyDescriptor(a,o).enumerable}))),l.forEach(function(o){_defineProperty(t,o,a[o])})}return t}function _defineProperty(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}var ArrowUpOutlined=function(e,a){var l=_objectSpread({},e,a.attrs);return createVNode(Icon,_objectSpread({},l,{icon:ArrowUpOutlined$1}),null)};ArrowUpOutlined.displayName="ArrowUpOutlined";ArrowUpOutlined.inheritAttrs=!1;const _hoisted_1={class:"project-monitor-page"},_hoisted_2={class:"project-header"},_hoisted_3={class:"header-left"},_hoisted_4={class:"project-info"},_hoisted_5={class:"project-title"},_hoisted_6={class:"project-meta"},_hoisted_7={class:"project-dates"},_hoisted_8={class:"header-right"},_hoisted_9={class:"progress-info"},_hoisted_10={class:"progress-value"},_hoisted_11={class:"wbs-tree-section"},_hoisted_12={class:"node-content"},_hoisted_13={class:"node-meta"},_hoisted_14={class:"node-progress"},_hoisted_15={class:"progress-text"},_hoisted_16={class:"node-responsible"},_hoisted_17={key:0,class:"milestone-actions"},_hoisted_18={class:"task-detail-section"},_hoisted_19={key:0,class:"wbs-task-detail"},_hoisted_20={class:"detail-title-bar"},_hoisted_21={class:"title-actions"},_hoisted_22={class:"detail-header"},_hoisted_23={class:"task-title-detail"},_hoisted_24={class:"task-meta-detail"},_hoisted_25={class:"task-description"},_hoisted_26={class:"description-content"},_hoisted_27={class:"detail-progress"},_hoisted_28={class:"progress-item"},_hoisted_29={class:"progress-content"},_hoisted_30={class:"progress-display"},_hoisted_31={class:"progress-value"},_hoisted_32={class:"assign-item"},_hoisted_33={class:"assign-content"},_hoisted_34={class:"assign-display"},_hoisted_35={key:0,class:"assigned-member-detail"},_hoisted_36={key:1,class:"unassigned"},_hoisted_37={key:0,class:"assign-select-wrapper"},_hoisted_38={class:"member-option-small"},_hoisted_39={style:{color:"#999","margin-left":"4px"}},_hoisted_40={class:"milestone-config"},_hoisted_41={class:"milestone-content"},_hoisted_42={key:0,class:"material-requirements"},_hoisted_43={class:"materials-list"},_hoisted_44={class:"material-content"},_hoisted_45={key:0,class:"material-description"},_hoisted_46={class:"description-text"},_hoisted_47={class:"task-settings"},_hoisted_48={class:"settings-content"},_hoisted_49={key:0,class:"reminder-settings"},_hoisted_50={class:"detail-time"},_hoisted_51={class:"time-item"},_hoisted_52={class:"time-item"},_hoisted_53={class:"time-item"},_hoisted_54={class:"assignment-actions"},_hoisted_55={key:1,class:"no-selection"},_hoisted_56=["data-task-key","onClick"],_hoisted_57={class:"task-info"},_hoisted_58={class:"task-title-section"},_hoisted_59={key:1,class:"expand-placeholder"},_hoisted_60={class:"task-meta"},_hoisted_61={class:"task-duration"},_hoisted_62={class:"task-bar-container"},_hoisted_63=["title"],_hoisted_64={class:"task-progress-info gantt-progress-override"},_hoisted_65=["title"],_hoisted_66={key:0,class:"task-status-text gantt-status-override"},_hoisted_67={key:1,class:"task-completed-text gantt-completed-override"},_hoisted_68={key:0,class:"critical-indicator"},_hoisted_69={key:0,class:"dependency-lines"},_hoisted_70={key:0,class:"progress-update-form"},_hoisted_71={class:"task-info-section"},_hoisted_72={class:"current-progress-text"},_hoisted_73={class:"progress-display"},_hoisted_74={class:"new-progress-text"},_hoisted_75={key:0,class:"completion-notice"},_hoisted_76={style:{"max-height":"500px","overflow-y":"auto"}},_hoisted_77={key:0,style:{"max-height":"600px","overflow-y":"auto"}},_hoisted_78={class:"task-update-history"},_hoisted_79={key:0,class:"no-history"},_hoisted_80={class:"history-item"},_hoisted_81={class:"history-header"},_hoisted_82={class:"history-user"},_hoisted_83={class:"history-action"},_hoisted_84={class:"history-time"},_hoisted_85={class:"history-detail"},_hoisted_86={key:0,class:"history-comments"},_hoisted_87={class:"comments-list"},_hoisted_88={class:"comment-header"},_hoisted_89={class:"comment-user"},_hoisted_90={class:"comment-time"},_hoisted_91={class:"comment-content"},_hoisted_92={class:"add-pm-comment"},_hoisted_93={class:"task-update-history"},_hoisted_94={class:"update-item"},_hoisted_95={class:"update-header"},_hoisted_96={class:"update-user"},_hoisted_97={class:"update-time"},_hoisted_98={class:"update-content"},_hoisted_99={key:0,class:"progress-update"},_hoisted_100={key:0},_hoisted_101={key:1},_hoisted_102={key:2,class:"issues"},_hoisted_103={key:1,class:"status-change"},_hoisted_104={key:0},_hoisted_105={key:2,class:"task-created"},_hoisted_106={key:3,class:"task-assigned"},_hoisted_107={key:0,class:"no-history"},_hoisted_108={key:0,class:"milestone-detail"},_hoisted_109={class:"milestone-basic-info"},_hoisted_110={class:"milestone-materials"},_hoisted_111={key:0},_hoisted_112={style:{"margin-top":"16px"}},_hoisted_113=["onClick"],_hoisted_114={key:0,style:{"margin-top":"16px"}},_hoisted_115=["onClick"],_hoisted_116=["onClick"],_hoisted_117={style:{"margin-top":"16px",display:"flex",gap:"8px"}},_hoisted_118={key:0},_hoisted_119=["src"],_sfc_main={__name:"monitor",setup(__props){const router=useRouter(),route=useRoute(),taskSyncStore=useTaskSyncStore(),projectInfo=ref({id:route.params.id,name:route.query.name||"数据分析平台建设",code:route.query.code||"SJFX-2024-001",status:"active",progress:route.query.progress?Number(route.query.progress):65,startDate:route.query.startDate||"2024-01-15",endDate:route.query.endDate||"2024-12-31"}),wbsData=ref([{title:"需求分析阶段",key:"1",status:"completed",progress:100,plannedProgress:100,responsible:"张三",description:"完成项目需求分析，包括业务需求调研和技术需求分析，为后续开发奠定基础。",startDate:"2024-01-15",endDate:"2024-02-15",duration:31,isCritical:!1,children:[{title:"业务需求调研",key:"1-1",status:"completed",progress:100,responsible:"李四",assignedTo:{id:2,name:"李开发",role:"developer"},description:"深入了解业务流程，收集用户需求，整理业务功能清单。",startDate:"2024-01-15",endDate:"2024-01-25",duration:10,isCritical:!1},{title:"技术需求分析",key:"1-2",status:"completed",progress:100,responsible:"王五",assignedTo:{id:3,name:"王后端",role:"developer"},description:"分析技术实现方案，评估技术风险，确定技术栈和架构方案。",startDate:"2024-01-26",endDate:"2024-02-15",duration:20,isCritical:!1},{title:"🎯 项目开题里程碑",key:"1-milestone",status:"completed",progress:100,responsible:"项目经理",description:"完成开题报告，组织开题会议",startDate:"2024-02-15",endDate:"2024-02-15",duration:1,isCritical:!0,isMilestone:!0,milestoneType:"opening",actualDate:"2024-02-10",materials:["开题报告","技术方案","预算计划"],dependsOn:["1-1","1-2"]}]},{title:"系统设计阶段",key:"2",status:"completed",progress:100,responsible:"赵六",description:"完成系统整体设计，包括架构设计和数据库设计，为开发阶段提供详细的技术方案。",startDate:"2024-02-16",endDate:"2024-03-31",duration:44,isCritical:!1,children:[{title:"架构设计",key:"2-1",status:"completed",progress:100,responsible:"孙七",startDate:"2024-02-16",endDate:"2024-03-05",duration:18,isCritical:!1},{title:"数据库设计",key:"2-2",status:"completed",progress:100,responsible:"周八",startDate:"2024-03-06",endDate:"2024-03-31",duration:25,isCritical:!1}]},{title:"开发实施阶段",key:"3",status:"active",progress:75,responsible:"吴九",description:"按照设计方案进行系统开发，包括前端、后端和数据处理模块的开发实施。这是项目的核心阶段，需要确保代码质量和进度控制。",startDate:"2024-04-01",endDate:"2024-09-30",duration:183,isCritical:!0,children:[{title:"前端开发",key:"3-1",status:"active",progress:80,plannedProgress:75,responsible:"郑十",assignedTo:{id:2,name:"李开发",role:"developer"},startDate:"2024-04-01",endDate:"2024-07-31",duration:122,isCritical:!1},{title:"后端开发",key:"3-2",status:"active",progress:70,plannedProgress:85,responsible:"钱一",assignedTo:{id:3,name:"王后端",role:"developer"},startDate:"2024-04-15",endDate:"2024-08-31",duration:139,isCritical:!0},{title:"数据处理模块",key:"3-3",status:"pending",progress:30,plannedProgress:45,responsible:"孙二",assignedTo:null,startDate:"2024-06-01",endDate:"2024-09-30",duration:122,isCritical:!0}]},{title:"测试验收阶段",key:"4",status:"pending",progress:0,responsible:"李三",startDate:"2024-10-01",endDate:"2024-11-30",duration:61,isCritical:!0,children:[{title:"单元测试",key:"4-1",status:"pending",progress:0,responsible:"王四",startDate:"2024-10-01",endDate:"2024-10-31",duration:31,isCritical:!1},{title:"集成测试",key:"4-2",status:"pending",progress:0,responsible:"张五",startDate:"2024-11-01",endDate:"2024-11-30",duration:30,isCritical:!0},{title:"🎯 项目验收里程碑",key:"4-milestone",status:"upcoming",progress:0,responsible:"项目经理",description:"整理项目成果，准备验收材料",startDate:"2024-11-30",endDate:"2024-11-30",duration:1,isCritical:!0,isMilestone:!0,milestoneType:"acceptance",materials:["验收报告","成果清单","技术文档"],dependsOn:["4-1","4-2"]}]}]),expandedKeys=ref(["1","2","3","4"]),selectedKeys=ref([]),selectedTask=ref(null),wbsEditMode=ref(!1),lastMilestoneType=ref("opening"),forceShowTaskDetail=ref(!1),recentlyUpdatedMap=reactive({});function markTaskRecentlyUpdated(t,e=2e3){recentlyUpdatedMap[t]=Date.now(),setTimeout(()=>{delete recentlyUpdatedMap[t]},e)}onMounted(()=>{if(wbsData.value.length>0){const t=wbsData.value[0];selectedKeys.value=[t.key],selectedTask.value=t,console.log("组件挂载完成，默认选中任务:",t.title)}validateTaskManagementFeatures();try{taskSyncStore.registerWBSProject(String(projectInfo.value.id),wbsData.value)}catch{}document.addEventListener("keydown",handleKeyboardShortcuts)}),onUnmounted(()=>{document.removeEventListener("keydown",handleKeyboardShortcuts)});const validateTaskManagementFeatures=()=>{var t;console.log("=== 任务管理功能验证 ===");const totalTasks=getAllTaskKeys(wbsData.value).length;console.log(`✓ WBS数据加载: ${totalTasks} 个任务`),console.log(`✓ 选中状态: selectedKeys=${selectedKeys.value}, selectedTask=${((t=selectedTask.value)==null?void 0:t.title)||"无"}`),console.log(`✓ 编辑模式: wbsEditMode=${wbsEditMode.value}`),console.log(`✓ 展开状态: expandedKeys=${expandedKeys.value.length} 个节点`);const criticalFunctions=["onTaskSelect","selectTask","clearTaskSelection","openTaskEditModal","handleTaskEdit","addChildTask","deleteWBSTask"];criticalFunctions.forEach(funcName=>{typeof eval(funcName)=="function"?console.log(`✓ 函数 ${funcName} 已定义`):console.error(`✗ 函数 ${funcName} 未定义`)}),console.log(`✓ 编辑弹窗: taskEditModalVisible=${taskEditModalVisible.value}`),console.log(`✓ 详情弹窗: taskDetailModalVisible=${taskDetailModalVisible.value}`),console.log("=== 验证完成 ===")},progressModalVisible=ref(!1),progressUpdating=ref(!1),progressForm=reactive({newProgress:0,workNote:"",estimatedDate:null}),taskEditModalVisible=ref(!1),taskEditLoading=ref(!1),taskEditFormRef=ref(),taskEditForm=reactive({title:"",description:"",startDate:null,endDate:null,status:"pending",isCritical:!1}),taskDetailModalVisible=ref(!1),selectedTaskDetail=ref(null),taskDetailActiveTab=ref("info"),pmCommentTexts=ref({}),operationDetailVisible=ref(!1),selectedOperation=ref(null),filePreviewVisible=ref(!1),filePreviewSrc=ref(""),milestoneModalVisible=ref(!1),selectedMilestone=ref(null),showAssignSelect=ref(!1),leftPanelWidth=ref(750),rightPanelWidth=computed(()=>{const t=window.innerWidth-48;return Math.max(500,t-leftPanelWidth.value-16)}),isResizing=ref(!1),monitorContentRef=ref(null),leftPanelRef=ref(null),ganttContainerRef=ref(null),ganttHeaderRef=ref(null),ganttTimelineRef=ref(null),ganttBodyRef=ref(null),ganttScrollCleanup=ref(null),availableTeamMembers=computed(()=>[{id:1,name:"张经理",role:"manager"},{id:2,name:"李开发",role:"developer"},{id:3,name:"王后端",role:"developer"},{id:4,name:"赵测试",role:"tester"},{id:5,name:"钱设计",role:"designer"},{id:6,name:"孙产品",role:"product"},{id:7,name:"周架构",role:"architect"}]),timeScale=ref("month"),timelineData=ref([]),unreadUpdates=ref(0),projectUnreadCount=computed(()=>taskSyncStore.getUnreadCountForProject(String(projectInfo.value.id))),getTaskUnreadBadge=(t,e)=>taskSyncStore.getUnreadCountForTask(String(t),String(e)),wbsViewMode=ref("tree"),selectedRowKeys=ref([]),tableColumns=[{title:"任务",dataIndex:"title",key:"title",width:260},{title:"状态",dataIndex:"status",key:"status",width:100},{title:"进度",dataIndex:"progress",key:"progress",width:160},{title:"负责人",dataIndex:"responsible",key:"responsible",width:120},{title:"操作",key:"action",width:140,fixed:"right"}],tableRowSelection=reactive({selectedRowKeys,onChange:t=>{selectedRowKeys.value=t}});function statusText(t){return t==="completed"?"已完成":t==="active"?"进行中":"待开始"}function jumpToNode(t){wbsViewMode.value="tree",selectTask(String(t))}function openDetail(t){selectTask(String(t))}const isTableDrawerOpen=ref(!1),tableDrawerHeight=ref(Number(localStorage.getItem("pm.tableDrawerHeight")||0)||Math.round(window.innerHeight*.6));function handleViewModeChange(t){t==="table"?isTableDrawerOpen.value=!0:isTableDrawerOpen.value=!1}function closeTableDrawer(){isTableDrawerOpen.value=!1,wbsViewMode.value="tree"}const filterStatus=ref(),filterAssignee=ref(""),filterOverdue=ref(!1),filterUnread=ref(!1);function resetTableFilters(){filterStatus.value=void 0,filterAssignee.value="",filterOverdue.value=!1,filterUnread.value=!1}const filteredFlatTasks=computed(()=>flatTasks.value.filter(e=>{var a;return!(filterStatus.value&&e.status!==filterStatus.value||filterAssignee.value&&(((a=e.assignedTo)==null?void 0:a.name)||e.responsible||"").indexOf(filterAssignee.value)===-1||filterOverdue.value&&!(e.endDate&&new Date(e.endDate)<new Date)||filterUnread.value&&!(getTaskUnreadBadge(String(projectInfo.value.id),String(e.key))>0))}));async function batchStart(){if(!selectedRowKeys.value.length)return;const t=selectedRowKeys.value.map(e=>{var a;return{projectId:String(projectInfo.value.id),taskKey:String(e),data:{status:"active",progress:Math.max(10,Number(((a=findNodeByKey(e))==null?void 0:a.progress)||0))}}});await taskSyncStore.batchUpdateTasks(t)}async function batchComplete(){if(!selectedRowKeys.value.length)return;const t=selectedRowKeys.value.map(e=>({projectId:String(projectInfo.value.id),taskKey:String(e),data:{status:"completed",progress:100,completedAt:new Date().toISOString()}}));await taskSyncStore.batchUpdateTasks(t)}function findNodeByKey(t){const e=a=>{for(const l of a){if(String(l.key)===String(t))return l;if(l.children){const o=e(l.children);if(o)return o}}return null};return e(wbsData.value)}const flatTasks=computed(()=>{const t=[],e=(a,l=0)=>{a.forEach(o=>{const n=o.plannedProgress!==void 0?o.plannedProgress:generatePlannedProgress(o);t.push({...o,level:l,plannedProgress:n}),o.children&&e(o.children,l+1)})};return e(wbsData.value),t}),generatePlannedProgress=t=>{switch(t.status){case"completed":return 100;case"active":return Math.min(100,t.progress+Math.floor(Math.random()*20)-10);case"pending":return Math.min(100,t.progress+Math.floor(Math.random()*15)+5);default:return t.progress}},visibleGanttTasks=computed(()=>{const t=[],e=(a,l=0)=>{a.forEach(o=>{t.push({...o,level:l}),o.children&&expandedKeys.value.includes(o.key)&&e(o.children,l+1)})};return e(wbsData.value),t}),generateTimeline=()=>{const t=[];let e=null,a=null;const l=o=>{o.forEach(n=>{if(n.startDate){const r=new Date(n.startDate);(!e||r<e)&&(e=r)}if(n.endDate){const r=new Date(n.endDate);(!a||r>a)&&(a=r)}n.children&&l(n.children)})};if(l(wbsData.value),!e||!a){const o=new Date().getFullYear();e=new Date(o,0,1),a=new Date(o,11,31)}else e=new Date(e.getFullYear(),e.getMonth()-1,1),a=new Date(a.getFullYear(),a.getMonth()+2,0);if(timeScale.value==="month")for(let o=new Date(e);o<=a;o.setMonth(o.getMonth()+1))t.push({key:o.getTime(),label:`${o.getFullYear()}-${String(o.getMonth()+1).padStart(2,"0")}`,width:90});else if(timeScale.value==="week"){const o=new Date(e);for(o.setDate(o.getDate()-o.getDay()+1);o<=a;)new Date(o).setDate(o.getDate()+6),t.push({key:o.getTime(),label:`${String(o.getMonth()+1).padStart(2,"0")}-${String(o.getDate()).padStart(2,"0")}`,width:70}),o.setDate(o.getDate()+7)}else if(timeScale.value==="day"){const o=new Date(e);for(;o<=a;)t.push({key:o.getTime(),label:`${String(o.getMonth()+1).padStart(2,"0")}-${String(o.getDate()).padStart(2,"0")}`,width:50}),o.setDate(o.getDate()+1)}timelineData.value=t},getStatusColor=t=>({active:"blue",completed:"green",pending:"orange",delayed:"red"})[t]||"default",getStatusText=t=>({active:"进行中",completed:"已完成",pending:"待开始",delayed:"已延期"})[t]||"未知",getTaskStatusColor=t=>({completed:"green",active:"blue",pending:"orange",delayed:"red"})[t]||"default",getTaskStatusText=t=>({completed:"已完成",active:"进行中",pending:"待开始",delayed:"已延期"})[t]||"未知",getProgressColor=t=>t>=80?"#52c41a":t>=60?"#1890ff":t>=40?"#faad14":"#f5222d",getMilestoneStatusColor=t=>({completed:"green",upcoming:"blue",overdue:"red",in_progress:"orange"})[t]||"default",getMilestoneStatusText=t=>({completed:"已完成",upcoming:"即将到来",overdue:"已逾期",in_progress:"进行中"})[t]||"未知",getMilestoneProgressColor=t=>t>=100?"#52c41a":t>=80?"#1890ff":t>=50?"#faad14":"#ff4d4f",getProgressFillColor=(t,e)=>(console.log(`任务进度: ${t}%, 状态: ${e}`),e==="completed"?"rgba(82, 196, 26, 0.8)":e==="active"?t>=80?"rgba(82, 196, 26, 0.7)":t>=60?"rgba(24, 144, 255, 0.7)":t>=40?"rgba(250, 173, 20, 0.7)":"rgba(245, 34, 45, 0.7)":e==="pending"?"rgba(250, 173, 20, 0.5)":"rgba(255, 255, 255, 0.25)"),getTaskBarStyle=t=>{if(!timelineData.value||timelineData.value.length===0)return{left:"0%",width:"0%"};const e=new Date(timelineData.value[0].key),a=new Date(timelineData.value[timelineData.value.length-1].key),l=new Date(t.startDate),o=new Date(t.endDate||t.startDate);if(timelineData.value.reduce((n,r)=>n+r.width,0),timeScale.value==="month"){const n=(l.getFullYear()-e.getFullYear())*12+(l.getMonth()-e.getMonth()),r=(o.getFullYear()-e.getFullYear())*12+(o.getMonth()-e.getMonth())+1,d=n*100/timelineData.value.length,c=(r-n)*100/timelineData.value.length;return{left:Math.max(0,d)+"%",width:Math.max(1,c)+"%"}}else{const n=e.getTime(),r=a.getTime(),d=l.getTime(),c=o.getTime(),u=r-n,g=d-n,v=c-d,T=g/u*100,f=v/u*100;return{left:Math.max(0,T)+"%",width:Math.max(.5,f)+"%"}}},goBack=()=>{router.go(-1)},expandAll=()=>{const t=e=>{let a=[];return e.forEach(l=>{a.push(l.key),l.children&&(a=a.concat(t(l.children)))}),a};expandedKeys.value=t(wbsData.value)},collapseAll=()=>{expandedKeys.value=[]},toggleTaskExpand=t=>{const e=expandedKeys.value.indexOf(t);e>-1?expandedKeys.value.splice(e,1):expandedKeys.value.push(t)},selectTask=t=>{console.log("甘特图任务选中:",t),selectedKeys.value=[t];const e=flatTasks.value.find(a=>a.key===t);e?(selectedTask.value=e,getAllTaskKeys(wbsData.value).includes(t)&&ensureTaskVisible(t),api.success(`已选中甘特图任务: ${e.title}`,1),openTaskDetailModal(e)):(console.warn("任务不存在:",t),api.warning("任务不存在"))},onTaskSelect=(t,{node:e})=>{selectedTask.value=e,console.log("任务选中:",e?e.title:"无"),e&&e.key&&(scrollToGanttTask(e.key),api.success(`已选中任务: ${e.title}`,1)),showAssignSelect.value=!1},clearTaskSelection=()=>{selectedKeys.value=[],selectedTask.value=null,showAssignSelect.value=!1},getAllTaskKeys=t=>{const e=[],a=l=>{l.forEach(o=>{e.push(o.key),o.children&&a(o.children)})};return a(t),e},ensureTaskVisible=t=>{const e=(l,o,n=[])=>{for(const r of l){if(r.key===o)return n;if(r.children){const d=e(r.children,o,[...n,r.key]);if(d)return d}}return null},a=e(wbsData.value,t);a&&a.forEach(l=>{expandedKeys.value.includes(l)||expandedKeys.value.push(l)})},scrollToGanttTask=t=>{ensureTaskVisible(t),nextTick(()=>{setTimeout(()=>{const e=ganttContainerRef.value;if(!e)return;const a=e.querySelector(".gantt-body");if(!a)return;const l=e.querySelector(`.gantt-row[data-task-key="${t}"]`);if(l)scrollToElement(l,a);else{const o=visibleGanttTasks.value.findIndex(r=>r.key===t);if(o===-1)return;const n=e.querySelectorAll(".gantt-row");n[o]&&scrollToElement(n[o],a)}},300)})},scrollToElement=(t,e)=>{const a=e.getBoundingClientRect(),l=t.getBoundingClientRect(),o=a.height/2,n=l.top-a.top+e.scrollTop,r=l.height,d=n-o+r/2;e.scrollTo({top:Math.max(0,d),behavior:"smooth"}),t.classList.add("highlight-task"),setTimeout(()=>{t.classList.remove("highlight-task")},2e3)},refreshGantt=()=>{generateTimeline(),api.success("甘特图已刷新")},prepareMilestoneFromWBS=(t,e,a)=>{const l={projectId:projectInfo.value.id,projectName:projectInfo.value.name,projectCode:projectInfo.value.code,fromPM:"true",milestoneType:e,taskKey:t};a==="opening"?(router.push({path:"/opening/applicant/submit",query:l}),api.info("正在跳转到开题材料提交页面...")):a==="midterm"?(router.push({path:"/midterm/applicant/submit",query:l}),api.info("正在跳转到中期材料提交页面...")):a==="acceptance"?(router.push({path:"/acceptance/applicant/submit",query:l}),api.info("正在跳转到验收材料提交页面...")):api.info(`准备${e}材料`)};watch(timeScale,()=>{generateTimeline()},{immediate:!1});const updateTaskProgress=()=>{if(!selectedTask.value){api.warning("请先选择一个任务");return}progressForm.newProgress=selectedTask.value.progress,progressForm.workNote="",progressForm.estimatedDate=null,progressModalVisible.value=!0},handleProgressUpdate=async()=>{if(!selectedTask.value){api.warning("请先选择一个任务");return}if(progressForm.newProgress<selectedTask.value.progress){api.error("新进度不能小于当前进度");return}if(!progressForm.workNote.trim()){api.error("请输入工作说明");return}progressUpdating.value=!0;try{await new Promise(a=>setTimeout(a,1e3));const t={progress:progressForm.newProgress,status:progressForm.newProgress===100?"completed":"active"};await taskSyncStore.updateTask(projectInfo.value.id,selectedTask.value.key,t),Object.assign(selectedTask.value,t);const e={taskId:selectedTask.value.key,oldProgress:selectedTask.value.progress,newProgress:progressForm.newProgress,workNote:progressForm.workNote,updateTime:new Date().toISOString(),updater:"当前用户"};console.log("进度更新记录:",e),api.success(`任务进度已更新为 ${progressForm.newProgress}%`),progressForm.newProgress===100&&api.success("🎉 任务已标记为完成！"),closeProgressModal()}catch(t){console.error("更新进度失败:",t),api.error("更新进度失败，请重试")}finally{progressUpdating.value=!1}},closeProgressModal=()=>{progressModalVisible.value=!1,progressForm.newProgress=0,progressForm.workNote="",progressForm.estimatedDate=null},disabledDate=t=>t&&t<new Date().setHours(0,0,0,0),handleQuickAssign=async t=>{if(!selectedTask.value){api.warning("请先选择一个任务");return}if(!t){selectedTask.value.assignedTo=null,await taskSyncStore.updateTask(projectInfo.value.id,selectedTask.value.key,{assignedTo:null}),api.info(`任务"${selectedTask.value.title}"已取消分配`);return}const e=availableTeamMembers.value.find(a=>a.id===t);e&&(selectedTask.value.assignedTo=e,await taskSyncStore.updateTask(projectInfo.value.id,selectedTask.value.key,{assignedTo:e}),api.success(`任务"${selectedTask.value.title}"已分配给${e.name}`))},handleQuickAssignAndHide=t=>{handleQuickAssign(t),showAssignSelect.value=!1},hideAssignSelect=()=>{setTimeout(()=>{showAssignSelect.value=!1},200)},handleMilestoneTypeChange=t=>{selectedTask.value&&(selectedTask.value.milestoneType=t,t&&(!selectedTask.value.materialRequirements||selectedTask.value.materialRequirements.length===0)&&initDefaultMaterialRequirements(t),t||(selectedTask.value.materialRequirements=[]))},initDefaultMaterialRequirements=async t=>{try{await materialTemplateStore.initConfigs();const a=materialTemplateStore.getConfigsByBusinessType(t).map((l,o)=>({id:Date.now()+o,name:l.categoryName,required:l.isRequired,description:l.description||"",templateFileName:l.templateFileName||"",templateFilePath:l.templateFilePath||"",fromTemplate:!0}));selectedTask.value&&(selectedTask.value.materialRequirements=[...a],a.length>0&&api.success(`已从材料模板自动加载${a.length}项材料需求`))}catch(e){console.error("初始化材料需求失败:",e),api.error("加载材料模板失败，请手动添加材料需求");const a={opening:[{name:"开题报告",required:!0},{name:"文献综述",required:!0},{name:"技术路线图",required:!1}],midterm:[{name:"中期检查报告",required:!0},{name:"阶段性成果",required:!0}],acceptance:[{name:"验收报告",required:!0},{name:"项目总结",required:!0}]};selectedTask.value&&a[t]&&(selectedTask.value.materialRequirements=a[t].map((l,o)=>({id:Date.now()+o,...l})))}},addMaterialRequirement=()=>{selectedTask.value&&(selectedTask.value.materialRequirements||(selectedTask.value.materialRequirements=[]),selectedTask.value.materialRequirements.push({id:Date.now(),name:"",required:!0}))},removeMaterialRequirement=t=>{selectedTask.value&&selectedTask.value.materialRequirements&&selectedTask.value.materialRequirements.splice(t,1)},handleReminderChange=t=>{const e=t&&t.target?t.target.checked:!!t;selectedTask.value&&(selectedTask.value.reminders||(selectedTask.value.reminders={}),selectedTask.value.reminders.enabled=e,e&&!selectedTask.value.reminders.beforeDeadline&&(selectedTask.value.reminders.beforeDeadline=[3,1]))},handleAllowMaterialUploadChange=t=>{const e=t&&t.target?t.target.checked:!!t;selectedTask.value&&(selectedTask.value.allowMaterialUpload=e,e&&(!selectedTask.value.materialRequirements||selectedTask.value.materialRequirements.length===0)&&(selectedTask.value.materialRequirements=[{id:Date.now(),name:"",required:!1}]))},saveTaskAssignment=async()=>{if(!selectedTask.value||!selectedTask.value.assignedTo){api.error("请先选择负责人");return}try{const t={taskKey:selectedTask.value.key,assignedTo:selectedTask.value.assignedTo,milestoneType:selectedTask.value.milestoneType,materialRequirements:selectedTask.value.materialRequirements||[],reminders:selectedTask.value.reminders||{enabled:!1},assignedAt:new Date().toISOString()};await taskSyncStore.updateTask(projectInfo.value.id,selectedTask.value.key,t),api.success("任务分配已保存"),sendTaskNotification()}catch(t){console.error("保存任务分配失败:",t),api.error("保存失败，请重试")}},sendTaskNotification=()=>{if(!selectedTask.value||!selectedTask.value.assignedTo){api.error("请先保存任务分配");return}const t={type:"task_assigned",recipientId:selectedTask.value.assignedTo.id,taskId:selectedTask.value.key,projectId:projectInfo.value.id,message:`您有新的任务分配：${selectedTask.value.title}`,data:{taskTitle:selectedTask.value.title,projectName:projectInfo.value.name,deadline:selectedTask.value.endDate,milestoneType:selectedTask.value.milestoneType,materialRequirements:selectedTask.value.materialRequirements}};console.log("发送任务通知:",t),api.success("任务通知已发送")},setupRealTimeSync=()=>{console.log("实时状态同步已启动")},openTaskEditModal=()=>{if(!selectedTask.value){api.warning("请先选择一个任务");return}console.log("打开任务编辑弹窗:",selectedTask.value.title),taskEditForm.title=selectedTask.value.title,taskEditForm.description=selectedTask.value.description||"",taskEditForm.startDate=selectedTask.value.startDate,taskEditForm.endDate=selectedTask.value.endDate,taskEditForm.status=selectedTask.value.status,taskEditForm.isCritical=selectedTask.value.isCritical||!1,selectedTask.value.isMilestone&&(taskEditForm.milestoneType=selectedTask.value.milestoneType,taskEditForm.materialRequirements=selectedTask.value.materialRequirements||[]),taskEditModalVisible.value=!0,nextTick(()=>{taskEditFormRef.value&&taskEditFormRef.value.clearValidate()})},closeTaskEditModal=()=>{taskEditModalVisible.value=!1,taskEditForm.title="",taskEditForm.description="",taskEditForm.startDate=null,taskEditForm.endDate=null,taskEditForm.status="pending",taskEditForm.isCritical=!1,taskEditFormRef.value&&taskEditFormRef.value.clearValidate()},openTaskDetailModal=t=>{selectedTaskDetail.value=t,taskDetailActiveTab.value="info",taskDetailModalVisible.value=!0},closeTaskDetailModal=()=>{taskDetailModalVisible.value=!1,selectedTaskDetail.value=null,taskDetailActiveTab.value="info",pmCommentTexts.value={}},getTaskOperationHistory=t=>t.operationHistory||[],getHistoryTypeColor=t=>({progress_update:"blue",material_submission:"green",status_change:"orange",task_start:"cyan",task_complete:"purple"})[t]||"blue",getHistoryTypeIcon=t=>({progress_update:"ClockCircleOutlined",material_submission:"FileTextOutlined",status_change:"EditOutlined",task_start:"PlayCircleOutlined",task_complete:"CheckCircleOutlined"})[t]||"ClockCircleOutlined",getHistoryActionText=t=>({progress_update:"更新了任务进度",material_submission:"提交了材料",status_change:"变更了任务状态",task_start:"开始了任务",task_complete:"完成了任务"})[t]||"执行了操作",getHistoryDetailText=t=>{switch(t.type){case"progress_update":const{oldProgress:e,newProgress:a,statusChange:l}=t.data;let o=`进度从 ${e}% 更新到 ${a}%`;return l&&(o+=`，状态从 ${getTaskStatusText(l.from)} 变更为 ${getTaskStatusText(l.to)}`),t.data.note&&(o+=`
备注：${t.data.note}`),o;case"material_submission":return`提交了 ${t.data.submissionCount} 个材料文件`;default:return"详细信息"}},formatHistoryTime=t=>{if(!t)return"";const e=new Date,a=new Date(t),l=e-a;return l<6e4?"刚刚":l<36e5?`${Math.floor(l/6e4)}分钟前`:l<864e5?`${Math.floor(l/36e5)}小时前`:l<2592e6?`${Math.floor(l/864e5)}天前`:a.toLocaleDateString("zh-CN")},showOperationDetail=t=>{selectedOperation.value=t,operationDetailVisible.value=!0},openOperationHistory=()=>{if(!selectedTask.value){api.warning("请先选择一个任务");return}(!Array.isArray(selectedTask.value.operationHistory)||selectedTask.value.operationHistory.length===0)&&api.info("当前任务暂无操作历史"),selectedOperation.value={type:"progress_update",user:"系统",timestamp:new Date().toISOString(),data:{note:"操作历史汇总"}},operationDetailVisible.value=!0},isPdf=t=>typeof t=="string"&&t.toLowerCase().endsWith(".pdf"),resolveFileUrl=t=>(t==null?void 0:t.url)||(t==null?void 0:t.path)||(t==null?void 0:t.fileUrl)||(typeof t=="string"?t:""),previewMaterial=t=>{const e=resolveFileUrl(t);if(!e){api.warning("无法预览：缺少文件地址");return}filePreviewSrc.value=e,filePreviewVisible.value=!0},downloadMaterial=t=>{const e=resolveFileUrl(t);if(!e){api.warning("无法下载：缺少文件地址");return}const a=document.createElement("a");a.href=e,a.download=(t==null?void 0:t.fileName)||(t==null?void 0:t.name)||"材料",a.target="_blank",a.click()},forwardToManagers=()=>{if(!selectedTaskDetail.value){api.warning("请先选择一个任务");return}const t=selectedTaskDetail.value.milestoneType,e={projectId:projectInfo.value.id,projectName:projectInfo.value.name,projectCode:projectInfo.value.code,fromPM:"true"};t==="opening"?router.push({path:"/opening/management/center",query:e}):t==="midterm"?router.push({path:"/midterm/management/center",query:e}):t==="acceptance"?router.push({path:"/acceptance/management/center",query:e}):(api.info("未知的里程碑类型，已跳转到项目管理页"),router.push({path:"/project-manager/projects"})),api.success("已为管理者准备材料页面")},addPMComment=async t=>{const e=pmCommentTexts.value[t.id];if(!e||!e.trim()){api.warning("请输入评论内容");return}const a={id:Date.now(),user:"张经理(项目经理)",userId:"pm_001",role:"project_manager",content:e.trim(),timestamp:new Date().toISOString()};t.comments||(t.comments=[]),t.comments.push(a),pmCommentTexts.value[t.id]="";try{await taskSyncStore.updateTask(selectedTaskDetail.value.projectId,selectedTaskDetail.value.key,{operationHistory:getTaskOperationHistory(selectedTaskDetail.value)}),api.success("评论添加成功，已同步到团队成员")}catch(l){console.error("同步评论失败:",l),api.error("评论添加失败")}},getTaskUpdateHistory=t=>t.updateHistory||[],getUpdateIcon=t=>({progress_update:"PercentageOutlined",status_change:"SyncOutlined",task_created:"PlusOutlined",task_assigned:"UserOutlined"})[t]||"InfoCircleOutlined",getUpdateTypeColor=t=>({progress_update:"blue",status_change:"orange",task_created:"green",task_assigned:"purple"})[t]||"default",getUpdateActionText=t=>({progress_update:"进度更新",status_change:"状态变更",task_created:"任务创建",task_assigned:"任务分配"})[t]||"其他操作",formatUpdateTime=t=>{const e=new Date(t);return new Date().getTime()-e.getTime()<24*60*60*1e3?e.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}):e.toLocaleDateString("zh-CN",{month:"2-digit",day:"2-digit"})},validateEndDate=(t,e)=>{if(!e||!taskEditForm.startDate)return Promise.resolve();const a=new Date(taskEditForm.startDate);return new Date(e)<=a?Promise.reject(new Error("结束时间必须晚于开始时间")):Promise.resolve()},disabledEndDate=t=>{if(!taskEditForm.startDate)return!1;const e=new Date(taskEditForm.startDate);return t&&t<=e},calculateDuration=(t,e)=>{if(!t||!e)return 0;const a=new Date(t),l=new Date(e),o=Math.abs(l-a);return Math.ceil(o/(1e3*60*60*24))},handleTaskEdit=async()=>{try{if(console.log("开始处理任务编辑..."),await taskEditFormRef.value.validate(),!selectedTask.value){api.error("没有选中的任务");return}console.log("表单验证通过，正在保存..."),taskEditLoading.value=!0;const t=calculateDuration(taskEditForm.startDate,taskEditForm.endDate),e={title:taskEditForm.title.trim(),description:taskEditForm.description.trim(),startDate:taskEditForm.startDate,endDate:taskEditForm.endDate,duration:t,status:taskEditForm.status,isCritical:taskEditForm.isCritical};await taskSyncStore.updateTask(projectInfo.value.id,selectedTask.value.key,e),Object.assign(selectedTask.value,e);const a=l=>{for(let o of l){if(o.key===selectedTask.value.key)return Object.assign(o,e),!0;if(o.children&&a(o.children))return!0}return!1};a(wbsData.value),generateTimeline(),console.log("任务编辑成功:",e),api.success(`任务 "${e.title}" 信息已成功更新`),closeTaskEditModal()}catch(t){console.error("任务编辑失败:",t),t.message?api.error(`任务编辑失败: ${t.message}`):api.error("任务编辑失败，请检查表单数据")}finally{taskEditLoading.value=!1}},duplicateTask=()=>{if(!selectedTask.value){api.warning("请先选择要复制的任务");return}const t=selectedTask.value,e=generateNewTaskKey(t.key.split("-")[0]),a={...t,key:e,title:`${t.title} (副本)`,status:"pending",progress:0,actualStartDate:null,actualEndDate:null,startDate:new Date().toISOString().split("T")[0],endDate:new Date(Date.now()+7*24*60*60*1e3).toISOString().split("T")[0],operationHistory:[]};t.children&&(a.children=t.children.map((l,o)=>({...l,key:`${e}-${o+1}`,title:`${l.title} (副本)`,status:"pending",progress:0,operationHistory:[]}))),wbsData.value.push(a),selectedKeys.value=[e],selectedTask.value=a,expandedKeys.value.push(e),console.log("任务复制成功:",a),api.success(`任务 "${t.title}" 已复制`)},handleKeyboardShortcuts=t=>{t.ctrlKey&&t.key==="e"&&(t.preventDefault(),selectedTask.value&&openTaskEditModal()),t.ctrlKey&&t.key==="d"&&(t.preventDefault(),selectedTask.value&&duplicateTask()),wbsEditMode.value&&selectedTask.value&&(t.key==="Tab"&&!t.shiftKey?(t.preventDefault(),indentTask(selectedTask.value.key)):t.key==="Tab"&&t.shiftKey&&(t.preventDefault(),outdentTask(selectedTask.value.key))),t.key==="Escape"&&(t.preventDefault(),clearTaskSelection()),t.key==="Delete"&&wbsEditMode.value&&(t.preventDefault(),selectedTask.value&&deleteWBSTask(selectedTask.value.key))},updateTaskInWBS=(t,e)=>{const a=l=>{for(let o of l){if(String(o.key)===String(t))return Object.assign(o,e),!0;if(o.children&&a(o.children))return!0}return!1};a(wbsData.value)},toggleWBSEditMode=()=>{wbsEditMode.value=!wbsEditMode.value,wbsEditMode.value?api.info("进入WBS结构编辑模式"):(generateTimeline(),api.success("WBS结构编辑完成"))},generateNewTaskKey=(t=null)=>{let e=0;const a=l=>{l.forEach(o=>{const n=String((o==null?void 0:o.key)??"");if(t!=null){const r=String(t);if(n.startsWith(r+"-")){const d=parseInt(n.split("-").pop());!isNaN(d)&&d>e&&(e=d)}}else{const r=parseInt(n);!isNaN(r)&&r>e&&(e=r)}o.children&&a(o.children)})};return a(wbsData.value),t!=null?`${String(t)}-${e+1}`:`${e+1}`},addChildTask=t=>{const a={key:generateNewTaskKey(t),title:"新建子任务",status:"pending",progress:0,plannedProgress:0,responsible:"未分配",description:"请编辑任务描述",startDate:new Date().toISOString().split("T")[0],endDate:new Date(Date.now()+7*24*60*60*1e3).toISOString().split("T")[0],duration:7,isCritical:!1,children:[]},l=o=>{for(let n of o){if(String(n.key)===String(t))return n.children||(n.children=[]),n.children.push(a),expandedKeys.value.includes(String(t))||expandedKeys.value.push(String(t)),!0;if(n.children&&l(n.children))return!0}return!1};l(wbsData.value),api.success("已添加新的子任务")},addSiblingTask=t=>{const{parent:e,index:a}=findTaskParentAndIndex(t),l=e?e.children:wbsData.value,n={key:generateNewTaskKey(e?String(e.key):null),title:"新建同级任务",status:"pending",progress:0,plannedProgress:0,responsible:"未分配",description:"请编辑任务描述",startDate:new Date().toISOString().split("T")[0],endDate:new Date(Date.now()+7*24*60*60*1e3).toISOString().split("T")[0],duration:7,isCritical:!1,children:[]};l.splice(a+1,0,n),api.success("已添加新的同级任务")},createMilestoneNode=(t="🎯 新建里程碑",e="opening")=>(lastMilestoneType.value=e,{key:"",title:t,status:"upcoming",progress:0,responsible:"项目经理",description:"请完善里程碑说明",startDate:new Date().toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0],duration:1,isCritical:!0,isMilestone:!0,milestoneType:e,materials:[]}),addMilestoneChild=(t,e="opening")=>{const a=generateNewTaskKey(t),l=createMilestoneNode(`🎯 ${getMilestoneTitleByType(e)}`,e);l.key=a;const o=n=>{for(let r of n){if(String(r.key)===String(t)){r.children||(r.children=[]),r.children.push(l);const d=String(t);return expandedKeys.value.includes(d)||expandedKeys.value.push(d),api.success("已添加里程碑（子级）"),!0}if(r.children&&o(r.children))return!0}return!1};o(wbsData.value)},addMilestoneSibling=(t,e="opening")=>{const{parent:a,index:l}=findTaskParentAndIndex(t),o=a?a.children:wbsData.value,n=generateNewTaskKey(a?String(a.key):null),r=createMilestoneNode(`🎯 ${getMilestoneTitleByType(e)}`,e);r.key=n,o.splice(l+1,0,r),api.success("已添加里程碑（同级）")},addTopLevelMilestone=(t="opening")=>{const e=generateNewTaskKey(null),a=createMilestoneNode(`🎯 ${getMilestoneTitleByType(t)}`,t);a.key=e,wbsData.value.push(a),expandedKeys.value.push(e),api.success("已添加顶级里程碑")},getMilestoneTitleByType=t=>t==="opening"?"项目开题里程碑":t==="midterm"?"项目中期里程碑":t==="acceptance"?"项目验收里程碑":"项目里程碑",toggleMilestone=(t,e)=>{const a=l=>{for(let o of l){if(String(o.key)===String(t))return e?(o.isMilestone=!0,o.milestoneType=o.milestoneType||lastMilestoneType.value||"opening",o.duration=1):(o.isMilestone=!1,delete o.milestoneType),markTaskRecentlyUpdated(t),api.success(e?"已设为里程碑":"已取消里程碑"),!0;if(o.children&&a(o.children))return!0}return!1};a(wbsData.value)},indentTask=t=>{const{parent:e,index:a}=findTaskParentAndIndex(t),l=e?e.children:wbsData.value;if(a<=0)return;const o=l[a-1];if(!o)return;const[n]=l.splice(a,1);o.children||(o.children=[]);const r=generateNewTaskKey(String(o.key)),d=n.key;n.key=r,o.children.push(n),expandedKeys.value.includes(o.key)||expandedKeys.value.push(o.key),selectedTask.value&&String(selectedTask.value.key)===String(d)&&(selectedTask.value.key=r,selectedKeys.value=[r]),api.success("已缩进为子级")},outdentTask=t=>{const{parent:e,index:a}=findTaskParentAndIndex(t);if(!e)return;const l=findTaskParentAndIndex(e.key),o=e.children,[n]=o.splice(a,1),r=l.parent?l.parent.children:wbsData.value,d=(l.parent?r.indexOf(e):wbsData.value.indexOf(e))+1,c=generateNewTaskKey(l.parent?String(l.parent.key):null),u=n.key;n.key=c,r.splice(d,0,n),selectedTask.value&&String(selectedTask.value.key)===String(u)&&(selectedTask.value.key=c,selectedKeys.value=[c]),api.success("已外移为同级")},handleTreeDrop=t=>{if(wbsEditMode.value)try{const e=String(t.dragNode.key),a=String(t.node.key),l=t.node.pos.split("-"),o=t.dropPosition-Number(l[l.length-1]),{parent:n,index:r}=findTaskParentAndIndex(e),d=n?n.children:wbsData.value,[c]=d.splice(r,1);if(t.dropToGap){const{parent:u,index:g}=findTaskParentAndIndex(a),v=u?u.children:wbsData.value,T=o>0?g+1:g,f=generateNewTaskKey(u?String(u.key):null),h=c.key;c.key=f,v.splice(T,0,c),selectedTask.value&&String(selectedTask.value.key)===String(h)&&(selectedTask.value.key=f,selectedKeys.value=[f])}else{const u=(()=>{const T=f=>{for(let h of f){if(String(h.key)===a)return h;if(h.children){const V=T(h.children);if(V)return V}}return null};return T(wbsData.value)})();if(!u)throw new Error("未找到目标节点");u.children||(u.children=[]);const g=generateNewTaskKey(String(u.key)),v=c.key;c.key=g,u.children.push(c),expandedKeys.value.includes(u.key)||expandedKeys.value.push(u.key),selectedTask.value&&String(selectedTask.value.key)===String(v)&&(selectedTask.value.key=g,selectedKeys.value=[g])}api.success("节点已重新排位")}catch(e){console.error(e),api.error("拖拽失败，请重试")}},editWBSTask=t=>{const e=findTaskByKey(t);e&&(selectedTask.value=e,openTaskEditModal())},findTaskByKey=t=>{const e=a=>{for(let l of a){if(l.key===t)return l;if(l.children){const o=e(l.children);if(o)return o}}return null};return e(wbsData.value)},deleteWBSTask=t=>{console.log("删除任务被调用:",t);const e=findTaskByKey(t);if(console.log("找到的任务:",e),!e){console.log("任务未找到"),api.error("未找到要删除的任务");return}if(e.children&&e.children.length>0){console.log("任务有子任务，不能删除"),api.warning("不能删除有子任务的任务，请先删除所有子任务");return}if(e.status==="active"&&e.progress>0){Modal.warning({title:"任务正在进行中",content:`任务"${e.title}"正在进行中（进度：${e.progress}%），确定要删除吗？`,okText:"仍要删除",cancelText:"取消",onOk(){performDelete(t,e)}});return}performDelete(t,e)},performDelete=(t,e)=>{console.log("准备显示删除确认对话框");const a=()=>{const l=o=>{for(let n=0;n<o.length;n++){if(o[n].key===t)return o.splice(n,1),!0;if(o[n].children&&l(o[n].children))return!0}return!1};l(wbsData.value),selectedTask.value&&selectedTask.value.key===t&&clearTaskSelection(),api.success("任务已删除")};try{console.log("开始调用Modal.confirm"),Modal.confirm({title:"确认删除",content:`确定要删除任务"${e.title}"吗？此操作不可恢复。`,okText:"删除",okType:"danger",cancelText:"取消",onOk(){console.log("用户确认删除"),a()},onCancel(){console.log("用户取消删除")}}),console.log("Modal.confirm调用完成")}catch(l){console.error("Modal.confirm调用失败:",l),api.error("删除确认对话框打开失败")}},canMoveUp=t=>{const{parent:e,index:a}=findTaskParentAndIndex(t);return a>0},canMoveDown=t=>{const{parent:e,index:a}=findTaskParentAndIndex(t);if(a===-1)return!1;const l=e?e.children:wbsData.value;return a<l.length-1},findTaskParentAndIndex=t=>{const e=(a,l=null)=>{for(let o=0;o<a.length;o++){if(a[o].key===t)return{parent:l,index:o};if(a[o].children){const n=e(a[o].children,a[o]);if(n.index!==-1)return n}}return{parent:null,index:-1}};return e(wbsData.value)},moveTaskUp=t=>{const{parent:e,index:a}=findTaskParentAndIndex(t);if(a<=0)return;const l=e?e.children:wbsData.value,o=l[a];l.splice(a,1),l.splice(a-1,0,o),api.success("任务已上移")},moveTaskDown=t=>{const{parent:e,index:a}=findTaskParentAndIndex(t),l=e?e.children:wbsData.value;if(a>=l.length-1)return;const o=l[a];l.splice(a,1),l.splice(a+1,0,o),api.success("任务已下移")},startResize=t=>{isResizing.value=!0;const e=t.clientX,a=leftPanelWidth.value,l=n=>{if(!isResizing.value)return;const r=n.clientX-e,d=a+r,c=700,u=window.innerWidth-500;leftPanelWidth.value=Math.max(c,Math.min(u,d))},o=()=>{isResizing.value=!1,document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",o),document.body.style.userSelect="",document.body.style.cursor=""};document.addEventListener("mousemove",l),document.addEventListener("mouseup",o),document.body.style.userSelect="none",document.body.style.cursor="col-resize"},handleResize=()=>{const e=window.innerWidth-48-500;leftPanelWidth.value>e&&(leftPanelWidth.value=Math.max(700,e))},setupGanttScrollSync=()=>{const t=ganttHeaderRef.value,e=ganttBodyRef.value;if(!t||!e)return;const a=(n,r)=>{let d=!1;const c=()=>{d||(d=!0,r.scrollLeft=n.scrollLeft,requestAnimationFrame(()=>{d=!1}))};return n.addEventListener("scroll",c),()=>n.removeEventListener("scroll",c)},l=a(t,e),o=a(e,t);ganttScrollCleanup.value=()=>{l(),o()}},handleTaskDataUpdated=t=>{const{projectId:e,taskKey:a,updates:l}=t.detail;if(String(e)===String(projectInfo.value.id)){if(console.log(`📥 监控页面接收到任务更新: ${a}`,l),updateTaskInWBS(a,l),selectedTask.value&&String(selectedTask.value.key)===String(a)){if(l&&Array.isArray(l.operationHistory)){const n=[...Array.isArray(selectedTask.value.operationHistory)?selectedTask.value.operationHistory:[]];l.operationHistory.forEach(r=>{n.find(d=>d.id===r.id)||n.push(r)}),selectedTask.value.operationHistory=n}Object.assign(selectedTask.value,l)}(l.startDate||l.endDate||l.progress!==void 0)&&generateTimeline();try{const o=flatTasks.value.find(n=>String(n.key)===String(a));if(o&&(l.progress!==void 0||l.status!==void 0)){const n=o.title||`任务(${a})`,r=l.progress!==void 0?`进度 ${l.progress}%`:"",d=l.status?`状态 ${getTaskStatusText(l.status)}`:"",c=[r,d].filter(Boolean).join("，");api.success({content:`成员更新：${n} → ${c}`,duration:3}),api$1.open({message:"成员进度更新",description:`${n}：${c}`,duration:3}),markTaskRecentlyUpdated(a),unreadUpdates.value+=1}}catch{}}};function markAllRead(){unreadUpdates.value=0,taskSyncStore.markProjectUpdatesRead(String(projectInfo.value.id))}function resetProjectProgress(){Modal.confirm({title:"确认重置项目进度？",content:"这将把所有任务设置为待开始(0%)，并清空操作历史（仅前端演示数据）。",okText:"重置",okType:"danger",cancelText:"取消",onOk:async()=>{const t=l=>{l.forEach(o=>{o.status="pending",o.progress=0,o.completedAt=null,o.operationHistory&&(o.operationHistory=[]),o.children&&t(o.children)})};t(wbsData.value);const e=[],a=l=>{l.forEach(o=>{e.push({projectId:String(projectInfo.value.id),taskKey:String(o.key),data:{status:"pending",progress:0,completedAt:null,operationHistory:[]}}),o.children&&a(o.children)})};a(wbsData.value),e.length&&await taskSyncStore.batchUpdateTasks(e),taskSyncStore.registerWBSProject(projectInfo.value.id,wbsData.value),generateTimeline(),unreadUpdates.value=0,api.success("项目进度已重置，成员看板同步更新")}})}async function resetSelectedTask(){if(!selectedTask.value)return;const t=String(selectedTask.value.key);Modal.confirm({title:"确认重置选中任务？",content:`将把任务「${selectedTask.value.title||t}」重置为待开始(0%)，并清空操作历史。`,okText:"重置",okType:"danger",cancelText:"取消",async onOk(){const e=a=>{a.forEach(l=>{String(l.key)===t&&(l.status="pending",l.progress=0,l.completedAt=null,l.operationHistory&&(l.operationHistory=[])),l.children&&e(l.children)})};e(wbsData.value),await taskSyncStore.updateTask(String(projectInfo.value.id),t,{status:"pending",progress:0,completedAt:null,operationHistory:[]}),taskSyncStore.registerWBSProject(projectInfo.value.id,wbsData.value),generateTimeline(),api.success("选中任务已重置，成员看板同步更新")}})}async function quickStartSelectedTask(){if(!selectedTask.value)return;const t=String(selectedTask.value.key),e=Math.max(10,Number(selectedTask.value.progress||0));selectedTask.value.status="active",selectedTask.value.progress=e,selectedTask.value.startedAt=new Date().toISOString(),await taskSyncStore.updateTask(String(projectInfo.value.id),t,{status:"active",progress:e,startedAt:selectedTask.value.startedAt}),generateTimeline(),api.success("任务已开始")}const syncFromCache=()=>{try{const t=taskSyncStore.getProjectTasks(projectInfo.value.id),e=new Map,a=o=>{if(o&&o.key!=null)return String(o.key);if(o&&o.taskKey){const n=String(o.taskKey),r=n.indexOf("_");return r>=0?n.slice(r+1):n}return o&&o.id!=null?String(o.id):""};t.forEach(o=>{const n=a(o);n&&e.set(n,o)});const l=o=>{o.forEach(n=>{const r=String(n.key),d=e.get(r);d&&(d.progress!==void 0&&(n.progress=d.progress),d.status&&(n.status=d.status)),n.children&&l(n.children)})};l(wbsData.value),generateTimeline(),api.success("已从缓存刷新任务进度")}catch(t){console.warn("syncFromCache failed",t),api.error("刷新失败")}};return onMounted(()=>{String(projectInfo.value.id)==="10001"&&(wbsData.value=[{title:"联调-前端集成与验证",key:9001,status:"active",progress:30,responsible:"张三(演示账号)",assignedTo:{id:99,name:"张三(演示账号)",role:"developer"},description:"在看板侧更新进度与评论，验证项目监控侧实时联动",startDate:"2025-01-22",endDate:"2025-02-15",duration:25,isCritical:!1},{title:"联调-材料提交流转",key:9002,status:"pending",progress:0,responsible:"张三(演示账号)",assignedTo:{id:99,name:"张三(演示账号)",role:"developer"},description:"从模板带出材料，成员提交，PM预审并转管理层",startDate:"2025-02-01",endDate:"2025-02-20",duration:20,isCritical:!1}]),taskSyncStore.registerWBSProject(projectInfo.value.id,wbsData.value),setupRealTimeSync(),generateTimeline();const t=flatTasks.value.find(e=>e.status==="active");t&&(selectedKeys.value=[t.key],selectedTask.value=t),window.addEventListener("resize",handleResize),nextTick(()=>{setupGanttScrollSync()}),window.addEventListener("taskDataUpdated",handleTaskDataUpdated),api.success("已接管当前项目的实时任务更新，团队成员的进度与材料提交将实时显示。")}),onUnmounted(()=>{window.removeEventListener("resize",handleResize),window.removeEventListener("taskDataUpdated",handleTaskDataUpdated),ganttScrollCleanup.value&&ganttScrollCleanup.value()}),(t,e)=>{const a=resolveComponent("a-button"),l=resolveComponent("a-tag"),o=resolveComponent("a-progress"),n=resolveComponent("a-segmented"),r=resolveComponent("a-menu-item"),d=resolveComponent("a-menu-divider"),c=resolveComponent("a-menu"),u=resolveComponent("a-dropdown"),g=resolveComponent("a-space"),v=resolveComponent("a-badge"),T=resolveComponent("a-sub-menu"),f=resolveComponent("a-tooltip"),h=resolveComponent("a-tree"),V=resolveComponent("a-avatar"),_=resolveComponent("a-select-option"),D=resolveComponent("a-select"),S=resolveComponent("a-input"),N=resolveComponent("a-checkbox"),W=resolveComponent("a-checkbox-group"),$=resolveComponent("a-empty"),U=resolveComponent("a-card"),b=resolveComponent("a-radio-button"),Y=resolveComponent("a-radio-group"),y=resolveComponent("a-form-item"),G=resolveComponent("a-slider"),z=resolveComponent("a-textarea"),B=resolveComponent("a-date-picker"),I=resolveComponent("a-form"),x=resolveComponent("a-modal"),Q=resolveComponent("a-switch"),p=resolveComponent("a-descriptions-item"),M=resolveComponent("a-descriptions"),E=resolveComponent("a-tab-pane"),X=resolveComponent("a-input-group"),R=resolveComponent("a-timeline-item"),A=resolveComponent("a-timeline"),J=resolveComponent("a-tabs"),j=resolveComponent("a-list-item-meta"),O=resolveComponent("a-list-item"),P=resolveComponent("a-list"),Z=resolveComponent("a-image"),K=resolveComponent("a-divider"),ee=resolveComponent("a-table"),te=resolveComponent("a-drawer");return openBlock(),createElementBlock(Fragment,null,[createBaseVNode("div",_hoisted_1,[createBaseVNode("div",_hoisted_2,[createBaseVNode("div",_hoisted_3,[createVNode(a,{type:"text",onClick:goBack,class:"back-btn"},{default:withCtx(()=>[createVNode(unref(ArrowLeftOutlined)),e[33]||(e[33]=createTextVNode(" 返回 "))]),_:1,__:[33]}),createBaseVNode("div",_hoisted_4,[createBaseVNode("h1",_hoisted_5,toDisplayString(projectInfo.value.name),1),createBaseVNode("div",_hoisted_6,[createVNode(l,{color:"blue"},{default:withCtx(()=>[createTextVNode(toDisplayString(projectInfo.value.code),1)]),_:1}),createVNode(l,{color:getStatusColor(projectInfo.value.status)},{default:withCtx(()=>[createTextVNode(toDisplayString(getStatusText(projectInfo.value.status)),1)]),_:1},8,["color"]),createBaseVNode("span",_hoisted_7,toDisplayString(projectInfo.value.startDate)+" - "+toDisplayString(projectInfo.value.endDate),1)])])]),createBaseVNode("div",_hoisted_8,[createVNode(o,{type:"circle",percent:projectInfo.value.progress,size:80,"stroke-color":getProgressColor(projectInfo.value.progress)},null,8,["percent","stroke-color"]),createBaseVNode("div",_hoisted_9,[e[34]||(e[34]=createBaseVNode("div",{class:"progress-text"},"整体进度",-1)),createBaseVNode("div",_hoisted_10,toDisplayString(projectInfo.value.progress)+"%",1)])])]),createBaseVNode("div",{class:"monitor-content",ref_key:"monitorContentRef",ref:monitorContentRef},[createBaseVNode("div",{class:"left-panel",style:normalizeStyle({width:leftPanelWidth.value+"px"}),ref_key:"leftPanelRef",ref:leftPanelRef},[createVNode(U,{title:"📋 WBS任务结构与详情",size:"small",class:"wbs-combined-card"},{extra:withCtx(()=>[createVNode(g,null,{default:withCtx(()=>[createVNode(a,{type:wbsEditMode.value?"primary":"default",size:"small",onClick:toggleWBSEditMode},{default:withCtx(()=>[createVNode(unref(EditOutlined)),createTextVNode(" "+toDisplayString(wbsEditMode.value?"完成编辑":"编辑结构"),1)]),_:1},8,["type"]),createVNode(n,{value:wbsViewMode.value,"onUpdate:value":e[0]||(e[0]=s=>wbsViewMode.value=s),options:[{label:"树视图",value:"tree"},{label:"表格视图",value:"table"}],size:"small",onChange:handleViewModeChange},null,8,["value"]),isTableDrawerOpen.value?(openBlock(),createBlock(a,{key:0,size:"small",onClick:batchStart,disabled:selectedRowKeys.value.length===0},{default:withCtx(()=>e[35]||(e[35]=[createTextVNode("批量开始")])),_:1,__:[35]},8,["disabled"])):createCommentVNode("",!0),isTableDrawerOpen.value?(openBlock(),createBlock(a,{key:1,size:"small",onClick:batchComplete,disabled:selectedRowKeys.value.length===0},{default:withCtx(()=>e[36]||(e[36]=[createTextVNode("批量完成")])),_:1,__:[36]},8,["disabled"])):createCommentVNode("",!0),wbsEditMode.value?(openBlock(),createBlock(u,{key:2,trigger:"['click']"},{overlay:withCtx(()=>[createVNode(c,null,{default:withCtx(()=>[createVNode(r,{onClick:e[1]||(e[1]=s=>addTopLevelMilestone(lastMilestoneType.value||"opening"))},{default:withCtx(()=>[createTextVNode("按最近类型（"+toDisplayString(getMilestoneTitleByType(lastMilestoneType.value||"opening"))+"）",1)]),_:1}),createVNode(d),createVNode(r,{onClick:e[2]||(e[2]=s=>addTopLevelMilestone("opening"))},{default:withCtx(()=>e[38]||(e[38]=[createTextVNode("开题里程碑")])),_:1,__:[38]}),createVNode(r,{onClick:e[3]||(e[3]=s=>addTopLevelMilestone("midterm"))},{default:withCtx(()=>e[39]||(e[39]=[createTextVNode("中期里程碑")])),_:1,__:[39]}),createVNode(r,{onClick:e[4]||(e[4]=s=>addTopLevelMilestone("acceptance"))},{default:withCtx(()=>e[40]||(e[40]=[createTextVNode("验收里程碑")])),_:1,__:[40]})]),_:1})]),default:withCtx(()=>[createVNode(a,{type:"primary",size:"small"},{default:withCtx(()=>[createVNode(unref(PlusOutlined)),e[37]||(e[37]=createTextVNode(" 顶级里程碑 "))]),_:1,__:[37]})]),_:1})):createCommentVNode("",!0),createVNode(a,{type:"text",size:"small",onClick:expandAll},{default:withCtx(()=>[createVNode(unref(PlusSquareOutlined)),e[41]||(e[41]=createTextVNode(" 展开全部 "))]),_:1,__:[41]}),createVNode(a,{type:"text",size:"small",onClick:collapseAll},{default:withCtx(()=>[createVNode(unref(MinusSquareOutlined)),e[42]||(e[42]=createTextVNode(" 收起全部 "))]),_:1,__:[42]})]),_:1})]),default:withCtx(()=>[createBaseVNode("div",{class:normalizeClass(["wbs-container",{"edit-mode-container":wbsEditMode.value,"force-show-task-detail":forceShowTaskDetail.value}])},[createBaseVNode("div",_hoisted_11,[createVNode(h,{expandedKeys:expandedKeys.value,"onUpdate:expandedKeys":e[6]||(e[6]=s=>expandedKeys.value=s),selectedKeys:selectedKeys.value,"onUpdate:selectedKeys":e[7]||(e[7]=s=>selectedKeys.value=s),"tree-data":wbsData.value,onSelect:onTaskSelect,class:normalizeClass(["wbs-tree",{"edit-mode-active":wbsEditMode.value}]),draggable:wbsEditMode.value,onDrop:handleTreeDrop},{title:withCtx(({key:s,title:i,status:k,progress:C,responsible:ae,assignedTo:q,children:H,isMilestone:w,milestoneType:F,materials:L})=>[createBaseVNode("div",{class:normalizeClass(["tree-node",{"edit-mode":wbsEditMode.value,"milestone-node":w,[`milestone-${F}`]:w&&F}])},[createBaseVNode("div",_hoisted_12,[createBaseVNode("span",{class:normalizeClass(["node-title",{"milestone-title":w}])},toDisplayString(i),3),getTaskUnreadBadge(String(projectInfo.value.id),String(s))>0?(openBlock(),createBlock(v,{key:0,count:getTaskUnreadBadge(String(projectInfo.value.id),String(s)),"overflow-count":99,class:"node-unread-badge"},null,8,["count"])):createCommentVNode("",!0),createVNode(l,{color:w?getMilestoneStatusColor(k):getTaskStatusColor(k),size:"small",class:"node-status"},{default:withCtx(()=>[createTextVNode(toDisplayString(w?getMilestoneStatusText(k):getTaskStatusText(k)),1)]),_:2},1032,["color"]),w?(openBlock(),createBlock(v,{key:1,count:L&&L.length||0,color:"#1890ff",size:"small"},null,8,["count"])):createCommentVNode("",!0)]),createBaseVNode("div",_hoisted_13,[createBaseVNode("div",_hoisted_14,[createVNode(o,{percent:C,size:"small","show-info":!1,"stroke-color":w?getMilestoneProgressColor(C):getProgressColor(C)},null,8,["percent","stroke-color"]),createBaseVNode("span",_hoisted_15,toDisplayString(C)+"%",1)]),createBaseVNode("span",_hoisted_16,toDisplayString(q&&q.name||ae||"未分配"),1),w&&k==="upcoming"?(openBlock(),createElementBlock("div",_hoisted_17,[createVNode(a,{type:"primary",size:"small",onClick:withModifiers(m=>prepareMilestoneFromWBS(s,i,F),["stop"])},{default:withCtx(()=>[createVNode(unref(FileTextOutlined)),e[43]||(e[43]=createTextVNode(" 准备材料 "))]),_:2,__:[43]},1032,["onClick"])])):createCommentVNode("",!0)]),wbsEditMode.value?(openBlock(),createElementBlock("div",{key:0,class:"node-actions",onClick:e[5]||(e[5]=withModifiers(()=>{},["stop"]))},[createVNode(u,{trigger:"['click']"},{overlay:withCtx(()=>[createVNode(c,null,{default:withCtx(()=>[createVNode(r,{onClick:m=>addChildTask(s)},{default:withCtx(()=>e[44]||(e[44]=[createTextVNode("+ 子任务")])),_:2,__:[44]},1032,["onClick"]),createVNode(r,{onClick:m=>addSiblingTask(s)},{default:withCtx(()=>e[45]||(e[45]=[createTextVNode("+ 同级任务")])),_:2,__:[45]},1032,["onClick"]),createVNode(T,{title:"+ 里程碑（子级）"},{default:withCtx(()=>[createVNode(r,{onClick:m=>addMilestoneChild(s,"opening")},{default:withCtx(()=>e[46]||(e[46]=[createTextVNode("开题")])),_:2,__:[46]},1032,["onClick"]),createVNode(r,{onClick:m=>addMilestoneChild(s,"midterm")},{default:withCtx(()=>e[47]||(e[47]=[createTextVNode("中期")])),_:2,__:[47]},1032,["onClick"]),createVNode(r,{onClick:m=>addMilestoneChild(s,"acceptance")},{default:withCtx(()=>e[48]||(e[48]=[createTextVNode("验收")])),_:2,__:[48]},1032,["onClick"]),createVNode(d),createVNode(r,{onClick:m=>addMilestoneChild(s,lastMilestoneType.value||"opening")},{default:withCtx(()=>[createTextVNode("按最近类型（"+toDisplayString(getMilestoneTitleByType(lastMilestoneType.value||"opening"))+"）",1)]),_:2},1032,["onClick"])]),_:2},1024),createVNode(T,{title:"+ 里程碑（同级）"},{default:withCtx(()=>[createVNode(r,{onClick:m=>addMilestoneSibling(s,"opening")},{default:withCtx(()=>e[49]||(e[49]=[createTextVNode("开题")])),_:2,__:[49]},1032,["onClick"]),createVNode(r,{onClick:m=>addMilestoneSibling(s,"midterm")},{default:withCtx(()=>e[50]||(e[50]=[createTextVNode("中期")])),_:2,__:[50]},1032,["onClick"]),createVNode(r,{onClick:m=>addMilestoneSibling(s,"acceptance")},{default:withCtx(()=>e[51]||(e[51]=[createTextVNode("验收")])),_:2,__:[51]},1032,["onClick"]),createVNode(d),createVNode(r,{onClick:m=>addMilestoneSibling(s,lastMilestoneType.value||"opening")},{default:withCtx(()=>[createTextVNode("按最近类型（"+toDisplayString(getMilestoneTitleByType(lastMilestoneType.value||"opening"))+"）",1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),default:withCtx(()=>[createVNode(a,{type:"text",size:"small",class:"action-btn"},{default:withCtx(()=>[createVNode(unref(PlusOutlined))]),_:1})]),_:2},1024),createVNode(f,{title:"编辑任务"},{default:withCtx(()=>[createVNode(a,{type:"text",size:"small",onClick:m=>editWBSTask(s),class:"action-btn"},{default:withCtx(()=>[createVNode(unref(EditOutlined))]),_:2},1032,["onClick"])]),_:2},1024),createVNode(f,{title:"左移（反缩进）"},{default:withCtx(()=>[createVNode(a,{type:"text",size:"small",onClick:m=>outdentTask(s),class:"action-btn"},{default:withCtx(()=>[createVNode(unref(LeftOutlined))]),_:2},1032,["onClick"])]),_:2},1024),createVNode(f,{title:"右移（缩进）"},{default:withCtx(()=>[createVNode(a,{type:"text",size:"small",onClick:m=>indentTask(s),class:"action-btn"},{default:withCtx(()=>[createVNode(unref(RightOutlined))]),_:2},1032,["onClick"])]),_:2},1024),createVNode(f,{title:"上移"},{default:withCtx(()=>[createVNode(a,{type:"text",size:"small",onClick:m=>moveTaskUp(s),class:"action-btn",disabled:!canMoveUp(s)},{default:withCtx(()=>[createVNode(unref(ArrowUpOutlined))]),_:2},1032,["onClick","disabled"])]),_:2},1024),createVNode(f,{title:"下移"},{default:withCtx(()=>[createVNode(a,{type:"text",size:"small",onClick:m=>moveTaskDown(s),class:"action-btn",disabled:!canMoveDown(s)},{default:withCtx(()=>[createVNode(unref(ArrowDownOutlined))]),_:2},1032,["onClick","disabled"])]),_:2},1024),createVNode(f,{title:"删除任务"},{default:withCtx(()=>[createVNode(a,{type:"text",size:"small",onClick:m=>deleteWBSTask(s),class:"action-btn delete-btn",disabled:H&&H.length>0},{default:withCtx(()=>[createVNode(unref(DeleteOutlined))]),_:2},1032,["onClick","disabled"])]),_:2},1024),createVNode(u,{trigger:"['click']"},{overlay:withCtx(()=>[createVNode(c,null,{default:withCtx(()=>[createVNode(r,{onClick:m=>toggleMilestone(s,!0)},{default:withCtx(()=>e[52]||(e[52]=[createTextVNode("设为里程碑")])),_:2,__:[52]},1032,["onClick"]),createVNode(r,{onClick:m=>toggleMilestone(s,!1)},{default:withCtx(()=>e[53]||(e[53]=[createTextVNode("取消里程碑")])),_:2,__:[53]},1032,["onClick"])]),_:2},1024)]),default:withCtx(()=>[createVNode(a,{type:"text",size:"small",class:"action-btn"},{default:withCtx(()=>[createVNode(unref(MoreOutlined))]),_:1})]),_:2},1024)])):createCommentVNode("",!0)],2)]),_:1},8,["expandedKeys","selectedKeys","tree-data","class","draggable"])]),e[84]||(e[84]=createBaseVNode("div",{class:"wbs-divider"},null,-1)),createBaseVNode("div",_hoisted_18,[selectedTask.value?(openBlock(),createElementBlock("div",_hoisted_19,[createBaseVNode("div",_hoisted_20,[e[57]||(e[57]=createBaseVNode("h3",{class:"detail-panel-title"},"任务详情",-1)),createBaseVNode("div",_hoisted_21,[createVNode(a,{type:"default",size:"small",onClick:openOperationHistory,class:"history-btn",title:"查看操作历史"},{default:withCtx(()=>{var s,i;return[createVNode(unref(FileTextOutlined)),e[54]||(e[54]=createTextVNode(" 操作历史 ")),getTaskUnreadBadge(String(projectInfo.value.id),String((s=selectedTask.value)==null?void 0:s.key))>0?(openBlock(),createBlock(v,{key:0,count:getTaskUnreadBadge(String(projectInfo.value.id),String((i=selectedTask.value)==null?void 0:i.key)),"overflow-count":99,style:{"margin-left":"6px"}},null,8,["count"])):createCommentVNode("",!0)]}),_:1,__:[54]}),createVNode(a,{type:"primary",size:"small",onClick:openTaskEditModal,class:"edit-btn",title:"编辑任务 (Ctrl+E)"},{default:withCtx(()=>[createVNode(unref(EditOutlined)),e[55]||(e[55]=createTextVNode(" 编辑 "))]),_:1,__:[55]}),createVNode(a,{type:"default",size:"small",onClick:duplicateTask,class:"duplicate-btn",title:"复制任务 (Ctrl+D)"},{default:withCtx(()=>[createVNode(unref(CopyOutlined)),e[56]||(e[56]=createTextVNode(" 复制 "))]),_:1,__:[56]}),createVNode(a,{type:"text",size:"small",onClick:clearTaskSelection,class:"close-btn",title:"清除选中 (Esc)"},{default:withCtx(()=>[createVNode(unref(CloseOutlined))]),_:1})])]),createBaseVNode("div",_hoisted_22,[createBaseVNode("h4",_hoisted_23,toDisplayString(selectedTask.value.title),1),createBaseVNode("div",_hoisted_24,[createVNode(l,{color:getTaskStatusColor(selectedTask.value.status)},{default:withCtx(()=>[createTextVNode(toDisplayString(getTaskStatusText(selectedTask.value.status)),1)]),_:1},8,["color"]),selectedTask.value.isCritical?(openBlock(),createBlock(l,{key:0,color:"red"},{default:withCtx(()=>e[58]||(e[58]=[createTextVNode(" 关键路径 ")])),_:1,__:[58]})):createCommentVNode("",!0)])]),createBaseVNode("div",_hoisted_25,[e[59]||(e[59]=createBaseVNode("label",null,"任务描述:",-1)),createBaseVNode("div",_hoisted_26,toDisplayString(selectedTask.value.description||"暂无描述"),1)]),createBaseVNode("div",_hoisted_27,[createBaseVNode("div",_hoisted_28,[e[62]||(e[62]=createBaseVNode("label",null,"完成进度:",-1)),createBaseVNode("div",_hoisted_29,[createBaseVNode("div",_hoisted_30,[createVNode(o,{percent:selectedTask.value.progress,size:"small","show-info":!1},null,8,["percent"]),createBaseVNode("span",_hoisted_31,toDisplayString(selectedTask.value.progress)+"%",1)]),selectedTask.value.status==="pending"?(openBlock(),createBlock(a,{key:0,type:"primary",size:"small",onClick:quickStartSelectedTask,class:"progress-update-btn"},{default:withCtx(()=>[createVNode(unref(PlayCircleOutlined)),e[60]||(e[60]=createTextVNode(" 开始任务 "))]),_:1,__:[60]})):createCommentVNode("",!0),createVNode(a,{type:"primary",size:"small",onClick:updateTaskProgress,class:"progress-update-btn"},{default:withCtx(()=>[createVNode(unref(EditOutlined)),e[61]||(e[61]=createTextVNode(" 更新进度 "))]),_:1,__:[61]})])]),createBaseVNode("div",_hoisted_32,[e[63]||(e[63]=createBaseVNode("label",null,"负责人:",-1)),createBaseVNode("div",_hoisted_33,[createBaseVNode("div",_hoisted_34,[selectedTask.value.assignedTo?(openBlock(),createElementBlock("div",_hoisted_35,[createVNode(V,{size:"small"},{default:withCtx(()=>[createTextVNode(toDisplayString(selectedTask.value.assignedTo.name.charAt(0)),1)]),_:1}),createBaseVNode("span",null,toDisplayString(selectedTask.value.assignedTo.name),1),createVNode(l,{size:"small"},{default:withCtx(()=>[createTextVNode(toDisplayString(selectedTask.value.assignedTo.role),1)]),_:1})])):(openBlock(),createElementBlock("span",_hoisted_36,"未分配"))]),createVNode(a,{type:"default",size:"small",onClick:e[8]||(e[8]=s=>showAssignSelect.value=!showAssignSelect.value),class:"assign-btn"},{default:withCtx(()=>[createVNode(unref(UserOutlined)),createTextVNode(" "+toDisplayString(selectedTask.value.assignedTo?"重新分配":"分配成员"),1)]),_:1})]),showAssignSelect.value?(openBlock(),createElementBlock("div",_hoisted_37,[createVNode(D,{value:selectedTask.value&&selectedTask.value.assignedTo&&selectedTask.value.assignedTo.id,placeholder:"选择团队成员",size:"small","allow-clear":"",style:{width:"100%"},onChange:handleQuickAssignAndHide,onBlur:hideAssignSelect},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(availableTeamMembers.value,s=>(openBlock(),createBlock(_,{key:s.id,value:s.id},{default:withCtx(()=>[createBaseVNode("div",_hoisted_38,[createVNode(V,{size:"small"},{default:withCtx(()=>[createTextVNode(toDisplayString(s.name.charAt(0)),1)]),_:2},1024),createBaseVNode("span",null,toDisplayString(s.name),1),createBaseVNode("small",_hoisted_39,"("+toDisplayString(s.role)+")",1)])]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])):createCommentVNode("",!0)])]),createBaseVNode("div",_hoisted_40,[e[67]||(e[67]=createBaseVNode("label",null,"里程碑类型:",-1)),createBaseVNode("div",_hoisted_41,[createVNode(D,{value:selectedTask.value.milestoneType,"onUpdate:value":e[9]||(e[9]=s=>selectedTask.value.milestoneType=s),placeholder:"选择里程碑类型",size:"small","allow-clear":"",style:{width:"100%"},onChange:handleMilestoneTypeChange},{default:withCtx(()=>[createVNode(_,{value:"opening"},{default:withCtx(()=>e[64]||(e[64]=[createTextVNode("项目开题")])),_:1,__:[64]}),createVNode(_,{value:"midterm"},{default:withCtx(()=>e[65]||(e[65]=[createTextVNode("项目中期")])),_:1,__:[65]}),createVNode(_,{value:"acceptance"},{default:withCtx(()=>e[66]||(e[66]=[createTextVNode("项目验收")])),_:1,__:[66]})]),_:1},8,["value"])])]),selectedTask.value.milestoneType||selectedTask.value.allowMaterialUpload?(openBlock(),createElementBlock("div",_hoisted_42,[e[70]||(e[70]=createBaseVNode("label",null,"材料需求:",-1)),createBaseVNode("div",_hoisted_43,[(openBlock(!0),createElementBlock(Fragment,null,renderList(selectedTask.value.materialRequirements||[],(s,i)=>(openBlock(),createElementBlock("div",{key:i,class:"material-item"},[createBaseVNode("div",_hoisted_44,[createVNode(S,{value:s.name,"onUpdate:value":k=>s.name=k,placeholder:"材料名称",size:"small",style:{flex:"1"}},null,8,["value","onUpdate:value"]),createVNode(l,{color:s.required?"red":"blue",size:"small"},{default:withCtx(()=>[createTextVNode(toDisplayString(s.required?"必需":"可选"),1)]),_:2},1032,["color"]),s.fromTemplate?(openBlock(),createBlock(l,{key:0,color:"green",size:"small"},{default:withCtx(()=>e[68]||(e[68]=[createTextVNode(" 模板 ")])),_:1,__:[68]})):createCommentVNode("",!0),s.templateFileName?(openBlock(),createBlock(f,{key:1,title:`模板文件: ${s.templateFileName}`},{default:withCtx(()=>[createVNode(unref(FileOutlined),{style:{color:"#1890ff",margin:"0 4px"}})]),_:2},1032,["title"])):createCommentVNode("",!0),createVNode(a,{type:"text",danger:"",size:"small",onClick:k=>removeMaterialRequirement(i)},{default:withCtx(()=>[createVNode(unref(DeleteOutlined))]),_:2},1032,["onClick"])]),s.description?(openBlock(),createElementBlock("div",_hoisted_45,[createBaseVNode("span",_hoisted_46,toDisplayString(s.description),1)])):createCommentVNode("",!0)]))),128)),createVNode(a,{type:"dashed",size:"small",onClick:addMaterialRequirement,style:{width:"100%","margin-top":"8px"}},{default:withCtx(()=>[createVNode(unref(PlusOutlined)),e[69]||(e[69]=createTextVNode(" 添加材料需求 "))]),_:1,__:[69]})])])):createCommentVNode("",!0),createBaseVNode("div",_hoisted_47,[e[77]||(e[77]=createBaseVNode("label",null,"任务设置:",-1)),createBaseVNode("div",_hoisted_48,[createVNode(N,{checked:!!(selectedTask.value.reminders&&selectedTask.value.reminders.enabled),onChange:handleReminderChange},{default:withCtx(()=>e[71]||(e[71]=[createTextVNode(" 启用任务提醒 ")])),_:1,__:[71]},8,["checked"]),createVNode(N,{style:{"margin-left":"12px"},checked:!!selectedTask.value.allowMaterialUpload,onChange:handleAllowMaterialUploadChange},{default:withCtx(()=>e[72]||(e[72]=[createTextVNode(" 允许材料上传（非里程碑） ")])),_:1,__:[72]},8,["checked"]),selectedTask.value.reminders&&selectedTask.value.reminders.enabled?(openBlock(),createElementBlock("div",_hoisted_49,[e[76]||(e[76]=createBaseVNode("span",{style:{"font-size":"12px",color:"#666"}},"提前提醒时间：",-1)),createVNode(W,{value:selectedTask.value.reminders.beforeDeadline,"onUpdate:value":e[10]||(e[10]=s=>selectedTask.value.reminders.beforeDeadline=s),size:"small"},{default:withCtx(()=>[createVNode(N,{value:7},{default:withCtx(()=>e[73]||(e[73]=[createTextVNode("7天")])),_:1,__:[73]}),createVNode(N,{value:3},{default:withCtx(()=>e[74]||(e[74]=[createTextVNode("3天")])),_:1,__:[74]}),createVNode(N,{value:1},{default:withCtx(()=>e[75]||(e[75]=[createTextVNode("1天")])),_:1,__:[75]})]),_:1},8,["value"])])):createCommentVNode("",!0)])]),createBaseVNode("div",_hoisted_50,[createBaseVNode("div",_hoisted_51,[e[78]||(e[78]=createBaseVNode("label",null,"开始时间:",-1)),createBaseVNode("span",null,toDisplayString(selectedTask.value.startDate),1)]),createBaseVNode("div",_hoisted_52,[e[79]||(e[79]=createBaseVNode("label",null,"结束时间:",-1)),createBaseVNode("span",null,toDisplayString(selectedTask.value.endDate),1)]),createBaseVNode("div",_hoisted_53,[e[80]||(e[80]=createBaseVNode("label",null,"持续时间:",-1)),createBaseVNode("span",null,toDisplayString(selectedTask.value.duration)+" 天",1)])]),createBaseVNode("div",_hoisted_54,[createVNode(g,null,{default:withCtx(()=>[createVNode(a,{type:"primary",size:"small",onClick:saveTaskAssignment,disabled:!selectedTask.value.assignedTo},{default:withCtx(()=>e[81]||(e[81]=[createTextVNode(" 保存分配 ")])),_:1,__:[81]},8,["disabled"]),createVNode(a,{size:"small",onClick:sendTaskNotification,disabled:!selectedTask.value.assignedTo},{default:withCtx(()=>e[82]||(e[82]=[createTextVNode(" 发送通知 ")])),_:1,__:[82]},8,["disabled"])]),_:1})])])):(openBlock(),createElementBlock("div",_hoisted_55,[createVNode($,{description:"点击左侧任务节点查看详情",image:!1,class:"empty-hint"},{image:withCtx(()=>e[83]||(e[83]=[createBaseVNode("div",{class:"empty-icon"},"📋",-1)])),_:1})]))])],2)]),_:1})],4),createBaseVNode("div",{class:"resize-handle",onMousedown:startResize,title:"拖拽调整WBS面板宽度"},e[85]||(e[85]=[createBaseVNode("div",{class:"resize-line"},null,-1)]),32),createBaseVNode("div",{class:"right-panel",style:normalizeStyle({width:rightPanelWidth.value+"px"})},[createVNode(U,{title:"📊 项目进度甘特图",size:"small",class:"gantt-card"},{extra:withCtx(()=>[createVNode(g,null,{default:withCtx(()=>[createVNode(v,{count:projectUnreadCount.value,"overflow-count":99},{default:withCtx(()=>[createVNode(a,{size:"small",onClick:markAllRead},{default:withCtx(()=>[createVNode(unref(BellOutlined)),e[86]||(e[86]=createTextVNode(" 更新提醒 "))]),_:1,__:[86]})]),_:1},8,["count"]),createVNode(a,{size:"small",onClick:syncFromCache},{default:withCtx(()=>[createVNode(unref(SyncOutlined)),e[87]||(e[87]=createTextVNode(" 刷新进度 "))]),_:1,__:[87]}),createVNode(a,{danger:"",size:"small",onClick:resetProjectProgress},{default:withCtx(()=>e[88]||(e[88]=[createTextVNode(" 重置项目进度 ")])),_:1,__:[88]}),createVNode(a,{danger:"",size:"small",onClick:resetSelectedTask,disabled:!selectedTask.value},{default:withCtx(()=>e[89]||(e[89]=[createTextVNode(" 重置选中任务 ")])),_:1,__:[89]},8,["disabled"]),createVNode(Y,{value:timeScale.value,"onUpdate:value":e[11]||(e[11]=s=>timeScale.value=s),size:"small"},{default:withCtx(()=>[createVNode(b,{value:"month"},{default:withCtx(()=>e[90]||(e[90]=[createTextVNode("月")])),_:1,__:[90]}),createVNode(b,{value:"week"},{default:withCtx(()=>e[91]||(e[91]=[createTextVNode("周")])),_:1,__:[91]}),createVNode(b,{value:"day"},{default:withCtx(()=>e[92]||(e[92]=[createTextVNode("日")])),_:1,__:[92]})]),_:1},8,["value"]),createVNode(a,{type:"primary",size:"small",onClick:refreshGantt},{default:withCtx(()=>[createVNode(unref(ReloadOutlined)),e[93]||(e[93]=createTextVNode(" 刷新 "))]),_:1,__:[93]})]),_:1})]),default:withCtx(()=>[createBaseVNode("div",{class:"gantt-container",ref_key:"ganttContainerRef",ref:ganttContainerRef},[createBaseVNode("div",{class:"gantt-header",ref_key:"ganttHeaderRef",ref:ganttHeaderRef},[createBaseVNode("div",{class:"gantt-timeline",ref_key:"ganttTimelineRef",ref:ganttTimelineRef},[(openBlock(!0),createElementBlock(Fragment,null,renderList(timelineData.value,s=>(openBlock(),createElementBlock("div",{key:s.key,class:"timeline-unit",style:normalizeStyle({width:s.width+"px"})},toDisplayString(s.label),5))),128))],512)],512),createBaseVNode("div",{class:"gantt-body",ref_key:"ganttBodyRef",ref:ganttBodyRef},[(openBlock(!0),createElementBlock(Fragment,null,renderList(visibleGanttTasks.value,s=>(openBlock(),createElementBlock("div",{key:s.key,class:normalizeClass(["gantt-row",{selected:selectedKeys.value.includes(s.key),"parent-task":s.children&&s.children.length>0,"child-task":s.level>0,"milestone-row":s.isMilestone,[`milestone-${s.milestoneType}`]:s.isMilestone&&s.milestoneType}]),"data-task-key":s.key,style:normalizeStyle({"padding-left":s.level*20+"px"}),onClick:i=>selectTask(s.key)},[createBaseVNode("div",_hoisted_57,[createBaseVNode("div",_hoisted_58,[s.children&&s.children.length>0?(openBlock(),createBlock(a,{key:0,type:"text",size:"small",class:"expand-btn",onClick:withModifiers(i=>toggleTaskExpand(s.key),["stop"])},{default:withCtx(()=>[expandedKeys.value.includes(s.key)?(openBlock(),createBlock(unref(DownOutlined),{key:0})):(openBlock(),createBlock(unref(RightOutlined),{key:1}))]),_:2},1032,["onClick"])):(openBlock(),createElementBlock("span",_hoisted_59)),createBaseVNode("span",{class:normalizeClass(["task-name",["level-"+s.level,{"milestone-name":s.isMilestone},recentlyUpdatedMap[String(s.key)]?"recently-updated":""]])},toDisplayString(s.title),3),s.isMilestone&&s.materials?(openBlock(),createBlock(v,{key:2,count:s.materials.length,color:"#1890ff",size:"small",style:{"margin-left":"8px"}},null,8,["count"])):createCommentVNode("",!0),s.assignedTo?(openBlock(),createBlock(V,{key:3,size:"small",class:"task-avatar",title:s.assignedTo.name},{default:withCtx(()=>[createTextVNode(toDisplayString(s.assignedTo.name.charAt(0)),1)]),_:2},1032,["title"])):createCommentVNode("",!0)]),createBaseVNode("div",_hoisted_60,[createBaseVNode("span",_hoisted_61,toDisplayString(s.duration)+"天",1),createVNode(l,{color:getTaskStatusColor(s.status),size:"small",class:"task-status-tag"},{default:withCtx(()=>[createTextVNode(toDisplayString(getTaskStatusText(s.status)),1)]),_:2},1032,["color"])])]),createBaseVNode("div",_hoisted_62,[createBaseVNode("div",{class:normalizeClass(["task-bar",["status-"+s.status,"level-"+s.level,{"critical-path":s.isCritical,"parent-bar":s.children&&s.children.length>0}]]),style:normalizeStyle(getTaskBarStyle(s))},[createBaseVNode("div",{class:normalizeClass(["task-progress-track",{"recently-updated":recentlyUpdatedMap[String(s.key)]}])},[createBaseVNode("div",{class:"task-progress-fill",style:normalizeStyle({width:s.progress+"%",backgroundColor:getProgressFillColor(s.progress,s.status)}),title:`实际进度: ${s.progress}%`},null,12,_hoisted_63)],2),createBaseVNode("div",_hoisted_64,[createBaseVNode("span",{class:"task-progress-text gantt-text-override",title:`DEBUG: 原始进度=${s.progress}, 状态=${s.status}`},toDisplayString(s.progress)+"%",9,_hoisted_65),s.status!=="completed"?(openBlock(),createElementBlock("span",_hoisted_66,toDisplayString(getTaskStatusText(s.status)),1)):createCommentVNode("",!0),s.status==="completed"?(openBlock(),createElementBlock("span",_hoisted_67,"✓ 已完成")):createCommentVNode("",!0)]),s.isCritical&&s.status!=="completed"?(openBlock(),createElementBlock("div",_hoisted_68,"!")):createCommentVNode("",!0)],6),s.dependencies?(openBlock(),createElementBlock("div",_hoisted_69)):createCommentVNode("",!0)])],14,_hoisted_56))),128))],512)],512)]),_:1})],4)],512),createVNode(x,{open:progressModalVisible.value,"onUpdate:open":e[15]||(e[15]=s=>progressModalVisible.value=s),title:"更新任务进度",width:"500px",onOk:handleProgressUpdate,onCancel:closeProgressModal,confirmLoading:progressUpdating.value},{default:withCtx(()=>[selectedTask.value?(openBlock(),createElementBlock("div",_hoisted_70,[createBaseVNode("div",_hoisted_71,[createBaseVNode("h4",null,toDisplayString(selectedTask.value.title),1),createVNode(l,{color:getTaskStatusColor(selectedTask.value.status)},{default:withCtx(()=>[createTextVNode(toDisplayString(getTaskStatusText(selectedTask.value.status)),1)]),_:1},8,["color"])]),createVNode(I,{model:progressForm,layout:"vertical"},{default:withCtx(()=>[createVNode(y,{label:"当前进度"},{default:withCtx(()=>[createVNode(o,{percent:selectedTask.value.progress},null,8,["percent"]),createBaseVNode("span",_hoisted_72,toDisplayString(selectedTask.value.progress)+"%",1)]),_:1}),createVNode(y,{label:"新进度",rules:[{required:!0,message:"请设置新的进度值"}]},{default:withCtx(()=>[createVNode(G,{value:progressForm.newProgress,"onUpdate:value":e[12]||(e[12]=s=>progressForm.newProgress=s),min:selectedTask.value.progress,max:100,marks:{[selectedTask.value.progress]:"当前",100:"完成"}},null,8,["value","min","marks"]),createBaseVNode("div",_hoisted_73,[createBaseVNode("span",_hoisted_74,"新进度: "+toDisplayString(progressForm.newProgress)+"%",1),progressForm.newProgress===100?(openBlock(),createElementBlock("span",_hoisted_75," 🎉 任务将标记为已完成 ")):createCommentVNode("",!0)])]),_:1}),createVNode(y,{label:"工作说明",rules:[{required:!0,message:"请输入本次工作说明"}]},{default:withCtx(()=>[createVNode(z,{value:progressForm.workNote,"onUpdate:value":e[13]||(e[13]=s=>progressForm.workNote=s),placeholder:"请描述本次进度更新的工作内容、遇到的问题或需要的支持...",rows:4,"show-count":"",maxlength:500},null,8,["value"])]),_:1}),progressForm.newProgress<100?(openBlock(),createBlock(y,{key:0,label:"预计完成时间"},{default:withCtx(()=>[createVNode(B,{value:progressForm.estimatedDate,"onUpdate:value":e[14]||(e[14]=s=>progressForm.estimatedDate=s),placeholder:"选择预计完成时间",style:{width:"100%"},"disabled-date":disabledDate},null,8,["value"])]),_:1})):createCommentVNode("",!0)]),_:1},8,["model"])])):createCommentVNode("",!0)]),_:1},8,["open","confirmLoading"]),createVNode(x,{open:taskEditModalVisible.value,"onUpdate:open":e[22]||(e[22]=s=>taskEditModalVisible.value=s),title:"编辑任务信息",width:"600px",onOk:handleTaskEdit,onCancel:closeTaskEditModal,confirmLoading:taskEditLoading.value,okText:"保存",cancelText:"取消"},{default:withCtx(()=>[createBaseVNode("div",_hoisted_76,[createVNode(I,{ref_key:"taskEditFormRef",ref:taskEditFormRef,model:taskEditForm,"label-col":{span:6},"wrapper-col":{span:18},layout:"horizontal"},{default:withCtx(()=>[createVNode(y,{label:"任务标题",rules:[{required:!0,message:"请输入任务标题"}]},{default:withCtx(()=>[createVNode(S,{value:taskEditForm.title,"onUpdate:value":e[16]||(e[16]=s=>taskEditForm.title=s),placeholder:"请输入任务标题",maxlength:100,"show-count":""},null,8,["value"])]),_:1}),createVNode(y,{label:"任务描述",rules:[{required:!0,message:"请输入任务描述"}]},{default:withCtx(()=>[createVNode(z,{value:taskEditForm.description,"onUpdate:value":e[17]||(e[17]=s=>taskEditForm.description=s),placeholder:"请详细描述任务内容、目标和要求...",rows:4,"show-count":"",maxlength:500},null,8,["value"])]),_:1}),createVNode(y,{label:"计划开始时间",rules:[{required:!0,message:"请选择计划开始时间"}]},{default:withCtx(()=>[createVNode(B,{value:taskEditForm.startDate,"onUpdate:value":e[18]||(e[18]=s=>taskEditForm.startDate=s),placeholder:"选择计划开始时间",style:{width:"100%"},format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["value"])]),_:1}),createVNode(y,{label:"计划结束时间",rules:[{required:!0,message:"请选择计划结束时间"},{validator:validateEndDate}]},{default:withCtx(()=>[createVNode(B,{value:taskEditForm.endDate,"onUpdate:value":e[19]||(e[19]=s=>taskEditForm.endDate=s),placeholder:"选择计划结束时间",style:{width:"100%"},format:"YYYY-MM-DD","value-format":"YYYY-MM-DD","disabled-date":disabledEndDate},null,8,["value"])]),_:1},8,["rules"]),createVNode(y,{label:"任务状态"},{default:withCtx(()=>[createVNode(D,{value:taskEditForm.status,"onUpdate:value":e[20]||(e[20]=s=>taskEditForm.status=s),placeholder:"选择任务状态"},{default:withCtx(()=>[createVNode(_,{value:"pending"},{default:withCtx(()=>e[94]||(e[94]=[createTextVNode("待开始")])),_:1,__:[94]}),createVNode(_,{value:"active"},{default:withCtx(()=>e[95]||(e[95]=[createTextVNode("进行中")])),_:1,__:[95]}),createVNode(_,{value:"completed"},{default:withCtx(()=>e[96]||(e[96]=[createTextVNode("已完成")])),_:1,__:[96]}),createVNode(_,{value:"paused"},{default:withCtx(()=>e[97]||(e[97]=[createTextVNode("已暂停")])),_:1,__:[97]})]),_:1},8,["value"])]),_:1}),createVNode(y,{label:"关键路径"},{default:withCtx(()=>[createVNode(Q,{checked:taskEditForm.isCritical,"onUpdate:checked":e[21]||(e[21]=s=>taskEditForm.isCritical=s),"checked-children":"是","un-checked-children":"否"},null,8,["checked"])]),_:1})]),_:1},8,["model"])])]),_:1},8,["open","confirmLoading"]),createVNode(x,{open:taskDetailModalVisible.value,"onUpdate:open":e[24]||(e[24]=s=>taskDetailModalVisible.value=s),title:"任务详情",width:"800px",footer:null,onCancel:closeTaskDetailModal},{default:withCtx(()=>[selectedTaskDetail.value?(openBlock(),createElementBlock("div",_hoisted_77,[createVNode(J,{activeKey:taskDetailActiveTab.value,"onUpdate:activeKey":e[23]||(e[23]=s=>taskDetailActiveTab.value=s),type:"card"},{default:withCtx(()=>[createVNode(E,{key:"info",tab:"基本信息"},{default:withCtx(()=>[createVNode(M,{bordered:"",column:2},{default:withCtx(()=>[createVNode(p,{label:"任务名称",span:2},{default:withCtx(()=>[createTextVNode(toDisplayString(selectedTaskDetail.value.title),1)]),_:1}),createVNode(p,{label:"任务描述",span:2},{default:withCtx(()=>[createTextVNode(toDisplayString(selectedTaskDetail.value.description||"暂无描述"),1)]),_:1}),createVNode(p,{label:"任务状态"},{default:withCtx(()=>[createVNode(l,{color:getTaskStatusColor(selectedTaskDetail.value.status)},{default:withCtx(()=>[createTextVNode(toDisplayString(getTaskStatusText(selectedTaskDetail.value.status)),1)]),_:1},8,["color"])]),_:1}),createVNode(p,{label:"完成进度"},{default:withCtx(()=>[createTextVNode(toDisplayString(selectedTaskDetail.value.progress||0)+"% ",1)]),_:1}),createVNode(p,{label:"计划开始"},{default:withCtx(()=>[createTextVNode(toDisplayString(selectedTaskDetail.value.startDate),1)]),_:1}),createVNode(p,{label:"计划结束"},{default:withCtx(()=>[createTextVNode(toDisplayString(selectedTaskDetail.value.endDate),1)]),_:1}),createVNode(p,{label:"实际开始"},{default:withCtx(()=>[createTextVNode(toDisplayString(selectedTaskDetail.value.actualStartDate||"未开始"),1)]),_:1}),createVNode(p,{label:"实际结束"},{default:withCtx(()=>[createTextVNode(toDisplayString(selectedTaskDetail.value.actualEndDate||"未完成"),1)]),_:1}),createVNode(p,{label:"是否关键路径"},{default:withCtx(()=>[createVNode(l,{color:selectedTaskDetail.value.isCritical?"red":"default"},{default:withCtx(()=>[createTextVNode(toDisplayString(selectedTaskDetail.value.isCritical?"是":"否"),1)]),_:1},8,["color"])]),_:1}),createVNode(p,{label:"负责人"},{default:withCtx(()=>[createTextVNode(toDisplayString(selectedTaskDetail.value.assignee||"未分配"),1)]),_:1})]),_:1})]),_:1}),createVNode(E,{key:"history",tab:"操作历史"},{default:withCtx(()=>[createBaseVNode("div",_hoisted_78,[getTaskOperationHistory(selectedTaskDetail.value).length===0?(openBlock(),createElementBlock("div",_hoisted_79," 暂无操作历史 ")):(openBlock(),createBlock(A,{key:1},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(getTaskOperationHistory(selectedTaskDetail.value),s=>(openBlock(),createBlock(R,{key:s.id,color:getHistoryTypeColor(s.type)},{dot:withCtx(()=>[(openBlock(),createBlock(resolveDynamicComponent(getHistoryTypeIcon(s.type))))]),default:withCtx(()=>[createBaseVNode("div",_hoisted_80,[createBaseVNode("div",_hoisted_81,[createBaseVNode("span",_hoisted_82,toDisplayString(s.user),1),createBaseVNode("span",_hoisted_83,toDisplayString(getHistoryActionText(s.type)),1),createBaseVNode("span",_hoisted_84,toDisplayString(formatHistoryTime(s.timestamp)),1),createVNode(a,{type:"link",size:"small",onClick:i=>showOperationDetail(s)},{default:withCtx(()=>e[98]||(e[98]=[createTextVNode(" 查看详情 ")])),_:2,__:[98]},1032,["onClick"])]),createBaseVNode("div",_hoisted_85,toDisplayString(getHistoryDetailText(s)),1),s.comments&&s.comments.length>0?(openBlock(),createElementBlock("div",_hoisted_86,[createBaseVNode("div",_hoisted_87,[(openBlock(!0),createElementBlock(Fragment,null,renderList(s.comments,i=>(openBlock(),createElementBlock("div",{key:i.id,class:"comment-item"},[createBaseVNode("div",_hoisted_88,[createBaseVNode("span",_hoisted_89,toDisplayString(i.user),1),createBaseVNode("span",_hoisted_90,toDisplayString(formatHistoryTime(i.timestamp)),1)]),createBaseVNode("div",_hoisted_91,toDisplayString(i.content),1)]))),128))])])):createCommentVNode("",!0),createBaseVNode("div",_hoisted_92,[createVNode(X,{compact:""},{default:withCtx(()=>[createVNode(S,{value:pmCommentTexts.value[s.id],"onUpdate:value":i=>pmCommentTexts.value[s.id]=i,placeholder:"作为项目经理回复...",onPressEnter:i=>addPMComment(s),style:{width:"calc(100% - 80px)"}},null,8,["value","onUpdate:value","onPressEnter"]),createVNode(a,{type:"primary",onClick:i=>addPMComment(s),style:{width:"80px"}},{default:withCtx(()=>e[99]||(e[99]=[createTextVNode(" 回复 ")])),_:2,__:[99]},1032,["onClick"])]),_:2},1024)])])]),_:2},1032,["color"]))),128))]),_:1}))])]),_:1}),createVNode(E,{key:"legacy",tab:"旧版历史"},{default:withCtx(()=>[createBaseVNode("div",_hoisted_93,[createVNode(A,null,{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(getTaskUpdateHistory(selectedTaskDetail.value),s=>(openBlock(),createBlock(R,{key:s.id,color:getUpdateTypeColor(s.action)},{dot:withCtx(()=>[(openBlock(),createBlock(resolveDynamicComponent(getUpdateIcon(s.action))))]),default:withCtx(()=>[createBaseVNode("div",_hoisted_94,[createBaseVNode("div",_hoisted_95,[createBaseVNode("span",_hoisted_96,toDisplayString(s.userName),1),createBaseVNode("span",_hoisted_97,toDisplayString(formatUpdateTime(s.timestamp)),1),createVNode(l,{size:"small",color:getUpdateTypeColor(s.action)},{default:withCtx(()=>[createTextVNode(toDisplayString(getUpdateActionText(s.action)),1)]),_:2},1032,["color"])]),createBaseVNode("div",_hoisted_98,[s.action==="progress_update"?(openBlock(),createElementBlock("div",_hoisted_99,[createBaseVNode("p",null,[e[100]||(e[100]=createBaseVNode("strong",null,"进度变更：",-1)),createTextVNode(toDisplayString(s.oldProgress)+"% → "+toDisplayString(s.newProgress)+"%",1)]),s.workHours?(openBlock(),createElementBlock("p",_hoisted_100,[e[101]||(e[101]=createBaseVNode("strong",null,"工时：",-1)),createTextVNode(toDisplayString(s.workHours)+" 小时",1)])):createCommentVNode("",!0),s.comment?(openBlock(),createElementBlock("p",_hoisted_101,[e[102]||(e[102]=createBaseVNode("strong",null,"工作内容：",-1)),createTextVNode(toDisplayString(s.comment),1)])):createCommentVNode("",!0),s.issues?(openBlock(),createElementBlock("p",_hoisted_102,[e[103]||(e[103]=createBaseVNode("strong",null,"遇到问题：",-1)),createTextVNode(toDisplayString(s.issues),1)])):createCommentVNode("",!0)])):s.action==="status_change"?(openBlock(),createElementBlock("div",_hoisted_103,[createBaseVNode("p",null,[e[104]||(e[104]=createBaseVNode("strong",null,"状态变更：",-1)),createTextVNode(toDisplayString(s.oldStatus)+" → "+toDisplayString(s.newStatus),1)]),s.reason?(openBlock(),createElementBlock("p",_hoisted_104,[e[105]||(e[105]=createBaseVNode("strong",null,"变更原因：",-1)),createTextVNode(toDisplayString(s.reason),1)])):createCommentVNode("",!0)])):s.action==="task_created"?(openBlock(),createElementBlock("div",_hoisted_105,[createBaseVNode("p",null,[e[106]||(e[106]=createBaseVNode("strong",null,"任务创建：",-1)),createTextVNode(toDisplayString(s.comment||"任务已创建"),1)])])):s.action==="task_assigned"?(openBlock(),createElementBlock("div",_hoisted_106,[createBaseVNode("p",null,[e[107]||(e[107]=createBaseVNode("strong",null,"任务分配：",-1)),createTextVNode("分配给 "+toDisplayString(s.assignee),1)])])):createCommentVNode("",!0)])])]),_:2},1032,["color"]))),128))]),_:1}),getTaskUpdateHistory(selectedTaskDetail.value).length?createCommentVNode("",!0):(openBlock(),createElementBlock("div",_hoisted_107,[createVNode($,{description:"暂无更新记录"})]))])]),_:1})]),_:1},8,["activeKey"])])):createCommentVNode("",!0)]),_:1},8,["open"]),createVNode(x,{open:milestoneModalVisible.value,"onUpdate:open":e[25]||(e[25]=s=>milestoneModalVisible.value=s),title:"里程碑详情",footer:null,width:"700px"},{default:withCtx(()=>[selectedMilestone.value?(openBlock(),createElementBlock("div",_hoisted_108,[createBaseVNode("div",_hoisted_109,[createBaseVNode("h3",null,toDisplayString(selectedMilestone.value.name),1),createVNode(M,{column:2,bordered:"",size:"small"},{default:withCtx(()=>[createVNode(p,{label:"状态"},{default:withCtx(()=>[createVNode(l,{color:getMilestoneStatusColor(selectedMilestone.value.status)},{default:withCtx(()=>[createTextVNode(toDisplayString(getMilestoneStatusText(selectedMilestone.value.status)),1)]),_:1},8,["color"])]),_:1}),createVNode(p,{label:"完成度"},{default:withCtx(()=>[createTextVNode(toDisplayString(selectedMilestone.value.progress)+"% ",1)]),_:1}),createVNode(p,{label:"计划时间"},{default:withCtx(()=>[createTextVNode(toDisplayString(selectedMilestone.value.plannedDate),1)]),_:1}),createVNode(p,{label:"实际时间"},{default:withCtx(()=>[createTextVNode(toDisplayString(selectedMilestone.value.actualDate||"未完成"),1)]),_:1}),createVNode(p,{label:"负责人"},{default:withCtx(()=>[createTextVNode(toDisplayString(selectedMilestone.value.owner),1)]),_:1}),createVNode(p,{label:"描述",span:2},{default:withCtx(()=>[createTextVNode(toDisplayString(selectedMilestone.value.description),1)]),_:1})]),_:1})]),createBaseVNode("div",_hoisted_110,[e[110]||(e[110]=createBaseVNode("h4",null,"所需材料",-1)),createVNode(P,{dataSource:selectedMilestone.value.materials,size:"small",bordered:""},{renderItem:withCtx(({item:s})=>[createVNode(O,null,{actions:withCtx(()=>[createVNode(a,{size:"small",type:"link"},{default:withCtx(()=>e[108]||(e[108]=[createTextVNode("查看")])),_:1,__:[108]}),createVNode(a,{size:"small",type:"link"},{default:withCtx(()=>e[109]||(e[109]=[createTextVNode("下载")])),_:1,__:[109]})]),default:withCtx(()=>[createVNode(j,{title:s},null,8,["title"])]),_:2},1024)]),_:1},8,["dataSource"])])])):createCommentVNode("",!0)]),_:1},8,["open"]),createVNode(x,{open:operationDetailVisible.value,"onUpdate:open":e[27]||(e[27]=s=>operationDetailVisible.value=s),title:"操作详情",footer:null,width:"720px"},{default:withCtx(()=>{var s;return[selectedOperation.value?(openBlock(),createElementBlock("div",_hoisted_111,[createVNode(M,{bordered:"",size:"small",column:2},{default:withCtx(()=>[createVNode(p,{label:"类型"},{default:withCtx(()=>[createTextVNode(toDisplayString(getHistoryActionText(selectedOperation.value.type)),1)]),_:1}),createVNode(p,{label:"时间"},{default:withCtx(()=>[createTextVNode(toDisplayString(formatHistoryTime(selectedOperation.value.timestamp)),1)]),_:1}),createVNode(p,{label:"提交人"},{default:withCtx(()=>[createTextVNode(toDisplayString(selectedOperation.value.user),1)]),_:1}),createVNode(p,{label:"备注",span:2},{default:withCtx(()=>{var i;return[createTextVNode(toDisplayString(((i=selectedOperation.value.data)==null?void 0:i.note)||"—"),1)]}),_:1})]),_:1}),createBaseVNode("div",_hoisted_112,[e[111]||(e[111]=createBaseVNode("h4",null,"全部历史",-1)),createVNode(P,{dataSource:getTaskOperationHistory(selectedTask.value||{}),size:"small",bordered:""},{renderItem:withCtx(({item:i})=>[createVNode(O,null,{actions:withCtx(()=>[createBaseVNode("a",{onClick:withModifiers(k=>showOperationDetail(i),["prevent"])},"查看详情",8,_hoisted_113)]),default:withCtx(()=>[createVNode(g,null,{default:withCtx(()=>[createVNode(l,{color:getHistoryTypeColor(i.type)},{default:withCtx(()=>[createTextVNode(toDisplayString(getHistoryActionText(i.type)),1)]),_:2},1032,["color"]),createBaseVNode("span",null,toDisplayString(i.user),1),createBaseVNode("span",null,toDisplayString(formatHistoryTime(i.timestamp)),1)]),_:2},1024)]),_:2},1024)]),_:1},8,["dataSource"])]),selectedOperation.value.type==="material_submission"?(openBlock(),createElementBlock("div",_hoisted_114,[e[112]||(e[112]=createBaseVNode("h4",null,"提交的材料",-1)),createVNode(P,{dataSource:((s=selectedOperation.value.data)==null?void 0:s.materials)||[],bordered:""},{renderItem:withCtx(({item:i,index:k})=>[createVNode(O,null,{actions:withCtx(()=>[createBaseVNode("a",{onClick:withModifiers(C=>previewMaterial(i),["prevent"])},"在线预览",8,_hoisted_115),createBaseVNode("a",{onClick:withModifiers(C=>downloadMaterial(i),["prevent"])},"下载",8,_hoisted_116)]),default:withCtx(()=>[createVNode(j,{title:(i==null?void 0:i.name)||(i==null?void 0:i.fileName)||"材料"+(k+1)},null,8,["title"])]),_:2},1024)]),_:1},8,["dataSource"])])):createCommentVNode("",!0),createBaseVNode("div",_hoisted_117,[createVNode(a,{type:"primary",onClick:forwardToManagers},{default:withCtx(()=>e[113]||(e[113]=[createTextVNode("一键发给管理者")])),_:1,__:[113]}),createVNode(a,{onClick:e[26]||(e[26]=i=>operationDetailVisible.value=!1)},{default:withCtx(()=>e[114]||(e[114]=[createTextVNode("关闭")])),_:1,__:[114]})])])):createCommentVNode("",!0)]}),_:1},8,["open"]),createVNode(x,{open:filePreviewVisible.value,"onUpdate:open":e[28]||(e[28]=s=>filePreviewVisible.value=s),footer:null,width:"80%"},{title:withCtx(()=>e[115]||(e[115]=[createTextVNode("材料预览")])),default:withCtx(()=>[filePreviewSrc.value?(openBlock(),createElementBlock("div",_hoisted_118,[isPdf(filePreviewSrc.value)?(openBlock(),createElementBlock("iframe",{key:0,src:filePreviewSrc.value,style:{width:"100%",height:"75vh",border:"0"}},null,8,_hoisted_119)):(openBlock(),createBlock(Z,{key:1,src:filePreviewSrc.value,preview:!1,style:{"max-height":"75vh"}},null,8,["src"]))])):createCommentVNode("",!0)]),_:1},8,["open"])]),createVNode(te,{open:isTableDrawerOpen.value,placement:"bottom",height:tableDrawerHeight.value,mask:!1,closable:!0,onClose:closeTableDrawer,bodyStyle:{padding:"8px 16px"}},{title:withCtx(()=>[createVNode(g,null,{default:withCtx(()=>[e[124]||(e[124]=createBaseVNode("span",null,"📋 WBS任务表格视图",-1)),createVNode(K,{type:"vertical"}),createVNode(D,{value:filterStatus.value,"onUpdate:value":e[29]||(e[29]=s=>filterStatus.value=s),placeholder:"状态",style:{width:"110px"},"allow-clear":"",size:"small"},{default:withCtx(()=>[createVNode(_,{value:"pending"},{default:withCtx(()=>e[116]||(e[116]=[createTextVNode("待开始")])),_:1,__:[116]}),createVNode(_,{value:"active"},{default:withCtx(()=>e[117]||(e[117]=[createTextVNode("进行中")])),_:1,__:[117]}),createVNode(_,{value:"completed"},{default:withCtx(()=>e[118]||(e[118]=[createTextVNode("已完成")])),_:1,__:[118]})]),_:1},8,["value"]),createVNode(S,{value:filterAssignee.value,"onUpdate:value":e[30]||(e[30]=s=>filterAssignee.value=s),placeholder:"负责人","allow-clear":"",size:"small",style:{width:"120px"}},null,8,["value"]),createVNode(N,{checked:filterOverdue.value,"onUpdate:checked":e[31]||(e[31]=s=>filterOverdue.value=s),size:"small"},{default:withCtx(()=>e[119]||(e[119]=[createTextVNode("逾期")])),_:1,__:[119]},8,["checked"]),createVNode(N,{checked:filterUnread.value,"onUpdate:checked":e[32]||(e[32]=s=>filterUnread.value=s),size:"small"},{default:withCtx(()=>e[120]||(e[120]=[createTextVNode("有未读")])),_:1,__:[120]},8,["checked"]),createVNode(a,{size:"small",onClick:resetTableFilters},{default:withCtx(()=>e[121]||(e[121]=[createTextVNode("重置")])),_:1,__:[121]}),createVNode(K,{type:"vertical"}),createVNode(a,{size:"small",type:"primary",onClick:batchStart,disabled:selectedRowKeys.value.length===0},{default:withCtx(()=>e[122]||(e[122]=[createTextVNode("批量开始")])),_:1,__:[122]},8,["disabled"]),createVNode(a,{size:"small",onClick:batchComplete,disabled:selectedRowKeys.value.length===0},{default:withCtx(()=>e[123]||(e[123]=[createTextVNode("批量完成")])),_:1,__:[123]},8,["disabled"])]),_:1,__:[124]})]),default:withCtx(()=>[createVNode(ee,{dataSource:filteredFlatTasks.value,columns:tableColumns,"row-selection":tableRowSelection,size:"small",rowKey:"key",pagination:!1},{bodyCell:withCtx(({column:s,record:i})=>[s.key==="title"?(openBlock(),createElementBlock("span",{key:0,style:normalizeStyle({paddingLeft:(i.level||0)*16+"px"})},toDisplayString(i.title),5)):s.key==="status"?(openBlock(),createBlock(l,{key:1,color:i.status==="completed"?"green":i.status==="active"?"blue":"orange"},{default:withCtx(()=>[createTextVNode(toDisplayString(statusText(i.status)),1)]),_:2},1032,["color"])):s.key==="progress"?(openBlock(),createBlock(o,{key:2,percent:i.progress||0,size:"small"},null,8,["percent"])):s.key==="action"?(openBlock(),createBlock(g,{key:3},{default:withCtx(()=>[createVNode(a,{type:"link",size:"small",onClick:k=>jumpToNode(i.key)},{default:withCtx(()=>e[125]||(e[125]=[createTextVNode("定位")])),_:2,__:[125]},1032,["onClick"]),createVNode(a,{type:"link",size:"small",onClick:k=>openDetail(i.key)},{default:withCtx(()=>e[126]||(e[126]=[createTextVNode("详情")])),_:2,__:[126]},1032,["onClick"])]),_:2},1024)):createCommentVNode("",!0)]),_:1},8,["dataSource","row-selection"])]),_:1},8,["open","height"])],64)}}},monitor=_export_sfc(_sfc_main,[["__scopeId","data-v-9d2bad19"]]);export{monitor as default};
