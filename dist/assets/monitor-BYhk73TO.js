import{j as createVNode,I as Icon,_ as _export_sfc,a8 as useTaskSyncStore,h as ref,u as useRoute,e as reactive,i as onMounted,a1 as onUnmounted,d as computed,A as watch,f as api,M as Modal,a5 as nextTick,c as createElementBlock,a as createBaseVNode,w as withCtx,l as resolveComponent,t as toDisplayString,K as normalizeStyle,F as Fragment,ap as api$1,m as useRouter,o as openBlock,p as createTextVNode,x as unref,N as ArrowLeftOutlined,n as normalizeClass,b as createCommentVNode,k as createBlock,q as withModifiers,z as FileTextOutlined,P as PlusOutlined,T as EditOutlined,an as LeftOutlined,a9 as RightOutlined,a4 as DeleteOutlined,aa as CopyOutlined,W as CloseOutlined,s as renderList,Q as FileOutlined,aq as PlusSquareOutlined,ar as MinusSquareOutlined,Z as DownOutlined,R as ReloadOutlined,U as resolveDynamicComponent}from"./index-BG3bheTR.js";import{m as materialTemplateStore}from"./materialTemplate-BNbirzGC.js";import{M as MoreOutlined}from"./MoreOutlined-gm8wqwLf.js";import{P as PlayCircleOutlined}from"./PlayCircleOutlined-CYr-KMxw.js";import{U as UserOutlined}from"./UserOutlined-eJbNfDXj.js";import{B as BellOutlined}from"./BellOutlined-6oZgT64E.js";import{S as SyncOutlined}from"./SyncOutlined-BYcaCKWZ.js";var ArrowDownOutlined$1={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M862 465.3h-81c-4.6 0-9 2-12.1 5.5L550 723.1V160c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v563.1L255.1 470.8c-3-3.5-7.4-5.5-12.1-5.5h-81c-6.8 0-10.5 8.1-6 13.2L487.9 861a31.96 31.96 0 0048.3 0L868 478.5c4.5-5.2.8-13.2-6-13.2z"}}]},name:"arrow-down",theme:"outlined"};function _objectSpread$1(t){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?Object(arguments[e]):{},l=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(l=l.concat(Object.getOwnPropertySymbols(a).filter(function(o){return Object.getOwnPropertyDescriptor(a,o).enumerable}))),l.forEach(function(o){_defineProperty$1(t,o,a[o])})}return t}function _defineProperty$1(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}var ArrowDownOutlined=function(e,a){var l=_objectSpread$1({},e,a.attrs);return createVNode(Icon,_objectSpread$1({},l,{icon:ArrowDownOutlined$1}),null)};ArrowDownOutlined.displayName="ArrowDownOutlined";ArrowDownOutlined.inheritAttrs=!1;var ArrowUpOutlined$1={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M868 545.5L536.1 163a31.96 31.96 0 00-48.3 0L156 545.5a7.97 7.97 0 006 13.2h81c4.6 0 9-2 12.1-5.5L474 300.9V864c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V300.9l218.9 252.3c3 3.5 7.4 5.5 12.1 5.5h81c6.8 0 10.5-8 6-13.2z"}}]},name:"arrow-up",theme:"outlined"};function _objectSpread(t){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?Object(arguments[e]):{},l=Object.keys(a);typeof Object.getOwnPropertySymbols=="function"&&(l=l.concat(Object.getOwnPropertySymbols(a).filter(function(o){return Object.getOwnPropertyDescriptor(a,o).enumerable}))),l.forEach(function(o){_defineProperty(t,o,a[o])})}return t}function _defineProperty(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}var ArrowUpOutlined=function(e,a){var l=_objectSpread({},e,a.attrs);return createVNode(Icon,_objectSpread({},l,{icon:ArrowUpOutlined$1}),null)};ArrowUpOutlined.displayName="ArrowUpOutlined";ArrowUpOutlined.inheritAttrs=!1;const _hoisted_1={class:"project-monitor-page"},_hoisted_2={class:"project-header"},_hoisted_3={class:"header-left"},_hoisted_4={class:"project-info"},_hoisted_5={class:"project-title"},_hoisted_6={class:"project-meta"},_hoisted_7={class:"project-dates"},_hoisted_8={class:"header-right"},_hoisted_9={class:"progress-info"},_hoisted_10={class:"progress-value"},_hoisted_11={class:"wbs-tree-section"},_hoisted_12={class:"node-content"},_hoisted_13={class:"node-meta"},_hoisted_14={class:"node-progress"},_hoisted_15={class:"progress-text"},_hoisted_16={class:"node-responsible"},_hoisted_17={key:0,class:"milestone-actions"},_hoisted_18={class:"task-detail-section"},_hoisted_19={key:0,class:"wbs-task-detail"},_hoisted_20={class:"detail-title-bar"},_hoisted_21={class:"title-actions"},_hoisted_22={class:"detail-header"},_hoisted_23={class:"task-title-detail"},_hoisted_24={class:"task-meta-detail"},_hoisted_25={class:"task-description"},_hoisted_26={class:"description-content"},_hoisted_27={class:"detail-progress"},_hoisted_28={class:"progress-item"},_hoisted_29={class:"progress-content"},_hoisted_30={class:"progress-display"},_hoisted_31={class:"progress-value"},_hoisted_32={class:"assign-item"},_hoisted_33={class:"assign-content"},_hoisted_34={class:"assign-display"},_hoisted_35={key:0,class:"assigned-member-detail"},_hoisted_36={key:1,class:"unassigned"},_hoisted_37={key:0,class:"assign-select-wrapper"},_hoisted_38={class:"member-option-small"},_hoisted_39={style:{color:"#999","margin-left":"4px"}},_hoisted_40={class:"milestone-config"},_hoisted_41={class:"milestone-content"},_hoisted_42={key:0,class:"material-requirements"},_hoisted_43={class:"materials-list"},_hoisted_44={class:"material-content"},_hoisted_45={key:0,class:"material-description"},_hoisted_46={class:"description-text"},_hoisted_47={class:"task-settings"},_hoisted_48={class:"settings-content"},_hoisted_49={key:0,class:"reminder-settings"},_hoisted_50={class:"detail-time"},_hoisted_51={class:"time-item"},_hoisted_52={class:"time-item"},_hoisted_53={class:"time-item"},_hoisted_54={class:"assignment-actions"},_hoisted_55={key:1,class:"no-selection"},_hoisted_56=["data-task-key","onClick"],_hoisted_57={class:"task-info"},_hoisted_58={class:"task-title-section"},_hoisted_59={key:1,class:"expand-placeholder"},_hoisted_60={class:"task-meta"},_hoisted_61={class:"task-duration"},_hoisted_62={class:"task-bar-container"},_hoisted_63=["title"],_hoisted_64={class:"task-progress-info gantt-progress-override"},_hoisted_65=["title"],_hoisted_66={key:0,class:"task-status-text gantt-status-override"},_hoisted_67={key:1,class:"task-completed-text gantt-completed-override"},_hoisted_68={key:0,class:"critical-indicator"},_hoisted_69={key:0,class:"dependency-lines"},_hoisted_70={key:0,class:"progress-update-form"},_hoisted_71={class:"task-info-section"},_hoisted_72={class:"current-progress-text"},_hoisted_73={class:"progress-display"},_hoisted_74={class:"new-progress-text"},_hoisted_75={key:0,class:"completion-notice"},_hoisted_76={style:{"max-height":"500px","overflow-y":"auto"}},_hoisted_77={key:0,style:{"max-height":"600px","overflow-y":"auto"}},_hoisted_78={class:"task-update-history"},_hoisted_79={key:0,class:"no-history"},_hoisted_80={class:"history-item"},_hoisted_81={class:"history-header"},_hoisted_82={class:"history-user"},_hoisted_83={class:"history-action"},_hoisted_84={class:"history-time"},_hoisted_85={class:"history-detail"},_hoisted_86={key:0,class:"history-comments"},_hoisted_87={class:"comments-list"},_hoisted_88={class:"comment-header"},_hoisted_89={class:"comment-user"},_hoisted_90={class:"comment-time"},_hoisted_91={class:"comment-content"},_hoisted_92={class:"add-pm-comment"},_hoisted_93={class:"task-update-history"},_hoisted_94={class:"update-item"},_hoisted_95={class:"update-header"},_hoisted_96={class:"update-user"},_hoisted_97={class:"update-time"},_hoisted_98={class:"update-content"},_hoisted_99={key:0,class:"progress-update"},_hoisted_100={key:0},_hoisted_101={key:1},_hoisted_102={key:2,class:"issues"},_hoisted_103={key:1,class:"status-change"},_hoisted_104={key:0},_hoisted_105={key:2,class:"task-created"},_hoisted_106={key:3,class:"task-assigned"},_hoisted_107={key:0,class:"no-history"},_hoisted_108={key:0,class:"milestone-detail"},_hoisted_109={class:"milestone-basic-info"},_hoisted_110={class:"milestone-materials"},_hoisted_111={key:0},_hoisted_112={style:{"margin-top":"16px"}},_hoisted_113=["onClick"],_hoisted_114={key:0,style:{"margin-top":"16px"}},_hoisted_115=["onClick"],_hoisted_116=["onClick"],_hoisted_117={style:{"margin-top":"16px",display:"flex",gap:"8px"}},_hoisted_118={key:0},_hoisted_119=["src"],_sfc_main={__name:"monitor",setup(__props){const router=useRouter(),route=useRoute(),taskSyncStore=useTaskSyncStore(),projectInfo=ref({id:route.params.id,name:route.query.name||"æ•°æ®åˆ†æžå¹³å°å»ºè®¾",code:route.query.code||"SJFX-2024-001",status:"active",progress:route.query.progress?Number(route.query.progress):65,startDate:route.query.startDate||"2024-01-15",endDate:route.query.endDate||"2024-12-31"}),wbsData=ref([{title:"éœ€æ±‚åˆ†æžé˜¶æ®µ",key:"1",status:"completed",progress:100,plannedProgress:100,responsible:"å¼ ä¸‰",description:"å®Œæˆé¡¹ç›®éœ€æ±‚åˆ†æžï¼ŒåŒ…æ‹¬ä¸šåŠ¡éœ€æ±‚è°ƒç ”å’ŒæŠ€æœ¯éœ€æ±‚åˆ†æžï¼Œä¸ºåŽç»­å¼€å‘å¥ å®šåŸºç¡€ã€‚",startDate:"2024-01-15",endDate:"2024-02-15",duration:31,isCritical:!1,children:[{title:"ä¸šåŠ¡éœ€æ±‚è°ƒç ”",key:"1-1",status:"completed",progress:100,responsible:"æŽå››",assignedTo:{id:2,name:"æŽå¼€å‘",role:"developer"},description:"æ·±å…¥äº†è§£ä¸šåŠ¡æµç¨‹ï¼Œæ”¶é›†ç”¨æˆ·éœ€æ±‚ï¼Œæ•´ç†ä¸šåŠ¡åŠŸèƒ½æ¸…å•ã€‚",startDate:"2024-01-15",endDate:"2024-01-25",duration:10,isCritical:!1},{title:"æŠ€æœ¯éœ€æ±‚åˆ†æž",key:"1-2",status:"completed",progress:100,responsible:"çŽ‹äº”",assignedTo:{id:3,name:"çŽ‹åŽç«¯",role:"developer"},description:"åˆ†æžæŠ€æœ¯å®žçŽ°æ–¹æ¡ˆï¼Œè¯„ä¼°æŠ€æœ¯é£Žé™©ï¼Œç¡®å®šæŠ€æœ¯æ ˆå’Œæž¶æž„æ–¹æ¡ˆã€‚",startDate:"2024-01-26",endDate:"2024-02-15",duration:20,isCritical:!1},{title:"ðŸŽ¯ é¡¹ç›®å¼€é¢˜é‡Œç¨‹ç¢‘",key:"1-milestone",status:"completed",progress:100,responsible:"é¡¹ç›®ç»ç†",description:"å®Œæˆå¼€é¢˜æŠ¥å‘Šï¼Œç»„ç»‡å¼€é¢˜ä¼šè®®",startDate:"2024-02-15",endDate:"2024-02-15",duration:1,isCritical:!0,isMilestone:!0,milestoneType:"opening",actualDate:"2024-02-10",materials:["å¼€é¢˜æŠ¥å‘Š","æŠ€æœ¯æ–¹æ¡ˆ","é¢„ç®—è®¡åˆ’"],dependsOn:["1-1","1-2"]}]},{title:"ç³»ç»Ÿè®¾è®¡é˜¶æ®µ",key:"2",status:"completed",progress:100,responsible:"èµµå…­",description:"å®Œæˆç³»ç»Ÿæ•´ä½“è®¾è®¡ï¼ŒåŒ…æ‹¬æž¶æž„è®¾è®¡å’Œæ•°æ®åº“è®¾è®¡ï¼Œä¸ºå¼€å‘é˜¶æ®µæä¾›è¯¦ç»†çš„æŠ€æœ¯æ–¹æ¡ˆã€‚",startDate:"2024-02-16",endDate:"2024-03-31",duration:44,isCritical:!1,children:[{title:"æž¶æž„è®¾è®¡",key:"2-1",status:"completed",progress:100,responsible:"å­™ä¸ƒ",startDate:"2024-02-16",endDate:"2024-03-05",duration:18,isCritical:!1},{title:"æ•°æ®åº“è®¾è®¡",key:"2-2",status:"completed",progress:100,responsible:"å‘¨å…«",startDate:"2024-03-06",endDate:"2024-03-31",duration:25,isCritical:!1}]},{title:"å¼€å‘å®žæ–½é˜¶æ®µ",key:"3",status:"active",progress:75,responsible:"å´ä¹",description:"æŒ‰ç…§è®¾è®¡æ–¹æ¡ˆè¿›è¡Œç³»ç»Ÿå¼€å‘ï¼ŒåŒ…æ‹¬å‰ç«¯ã€åŽç«¯å’Œæ•°æ®å¤„ç†æ¨¡å—çš„å¼€å‘å®žæ–½ã€‚è¿™æ˜¯é¡¹ç›®çš„æ ¸å¿ƒé˜¶æ®µï¼Œéœ€è¦ç¡®ä¿ä»£ç è´¨é‡å’Œè¿›åº¦æŽ§åˆ¶ã€‚",startDate:"2024-04-01",endDate:"2024-09-30",duration:183,isCritical:!0,children:[{title:"å‰ç«¯å¼€å‘",key:"3-1",status:"active",progress:80,plannedProgress:75,responsible:"éƒ‘å",assignedTo:{id:2,name:"æŽå¼€å‘",role:"developer"},startDate:"2024-04-01",endDate:"2024-07-31",duration:122,isCritical:!1},{title:"åŽç«¯å¼€å‘",key:"3-2",status:"active",progress:70,plannedProgress:85,responsible:"é’±ä¸€",assignedTo:{id:3,name:"çŽ‹åŽç«¯",role:"developer"},startDate:"2024-04-15",endDate:"2024-08-31",duration:139,isCritical:!0},{title:"æ•°æ®å¤„ç†æ¨¡å—",key:"3-3",status:"pending",progress:30,plannedProgress:45,responsible:"å­™äºŒ",assignedTo:null,startDate:"2024-06-01",endDate:"2024-09-30",duration:122,isCritical:!0}]},{title:"æµ‹è¯•éªŒæ”¶é˜¶æ®µ",key:"4",status:"pending",progress:0,responsible:"æŽä¸‰",startDate:"2024-10-01",endDate:"2024-11-30",duration:61,isCritical:!0,children:[{title:"å•å…ƒæµ‹è¯•",key:"4-1",status:"pending",progress:0,responsible:"çŽ‹å››",startDate:"2024-10-01",endDate:"2024-10-31",duration:31,isCritical:!1},{title:"é›†æˆæµ‹è¯•",key:"4-2",status:"pending",progress:0,responsible:"å¼ äº”",startDate:"2024-11-01",endDate:"2024-11-30",duration:30,isCritical:!0},{title:"ðŸŽ¯ é¡¹ç›®éªŒæ”¶é‡Œç¨‹ç¢‘",key:"4-milestone",status:"upcoming",progress:0,responsible:"é¡¹ç›®ç»ç†",description:"æ•´ç†é¡¹ç›®æˆæžœï¼Œå‡†å¤‡éªŒæ”¶ææ–™",startDate:"2024-11-30",endDate:"2024-11-30",duration:1,isCritical:!0,isMilestone:!0,milestoneType:"acceptance",materials:["éªŒæ”¶æŠ¥å‘Š","æˆæžœæ¸…å•","æŠ€æœ¯æ–‡æ¡£"],dependsOn:["4-1","4-2"]}]}]),expandedKeys=ref(["1","2","3","4"]),selectedKeys=ref([]),selectedTask=ref(null),wbsEditMode=ref(!1),lastMilestoneType=ref("opening"),forceShowTaskDetail=ref(!1),recentlyUpdatedMap=reactive({});function markTaskRecentlyUpdated(t,e=2e3){recentlyUpdatedMap[t]=Date.now(),setTimeout(()=>{delete recentlyUpdatedMap[t]},e)}onMounted(()=>{if(wbsData.value.length>0){const t=wbsData.value[0];selectedKeys.value=[t.key],selectedTask.value=t,console.log("ç»„ä»¶æŒ‚è½½å®Œæˆï¼Œé»˜è®¤é€‰ä¸­ä»»åŠ¡:",t.title)}validateTaskManagementFeatures();try{taskSyncStore.registerWBSProject(String(projectInfo.value.id),wbsData.value)}catch{}document.addEventListener("keydown",handleKeyboardShortcuts)}),onUnmounted(()=>{document.removeEventListener("keydown",handleKeyboardShortcuts)});const validateTaskManagementFeatures=()=>{var t;console.log("=== ä»»åŠ¡ç®¡ç†åŠŸèƒ½éªŒè¯ ===");const totalTasks=getAllTaskKeys(wbsData.value).length;console.log(`âœ“ WBSæ•°æ®åŠ è½½: ${totalTasks} ä¸ªä»»åŠ¡`),console.log(`âœ“ é€‰ä¸­çŠ¶æ€: selectedKeys=${selectedKeys.value}, selectedTask=${((t=selectedTask.value)==null?void 0:t.title)||"æ— "}`),console.log(`âœ“ ç¼–è¾‘æ¨¡å¼: wbsEditMode=${wbsEditMode.value}`),console.log(`âœ“ å±•å¼€çŠ¶æ€: expandedKeys=${expandedKeys.value.length} ä¸ªèŠ‚ç‚¹`);const criticalFunctions=["onTaskSelect","selectTask","clearTaskSelection","openTaskEditModal","handleTaskEdit","addChildTask","deleteWBSTask"];criticalFunctions.forEach(funcName=>{typeof eval(funcName)=="function"?console.log(`âœ“ å‡½æ•° ${funcName} å·²å®šä¹‰`):console.error(`âœ— å‡½æ•° ${funcName} æœªå®šä¹‰`)}),console.log(`âœ“ ç¼–è¾‘å¼¹çª—: taskEditModalVisible=${taskEditModalVisible.value}`),console.log(`âœ“ è¯¦æƒ…å¼¹çª—: taskDetailModalVisible=${taskDetailModalVisible.value}`),console.log("=== éªŒè¯å®Œæˆ ===")},progressModalVisible=ref(!1),progressUpdating=ref(!1),progressForm=reactive({newProgress:0,workNote:"",estimatedDate:null}),taskEditModalVisible=ref(!1),taskEditLoading=ref(!1),taskEditFormRef=ref(),taskEditForm=reactive({title:"",description:"",startDate:null,endDate:null,status:"pending",isCritical:!1}),taskDetailModalVisible=ref(!1),selectedTaskDetail=ref(null),taskDetailActiveTab=ref("info"),pmCommentTexts=ref({}),operationDetailVisible=ref(!1),selectedOperation=ref(null),filePreviewVisible=ref(!1),filePreviewSrc=ref(""),milestoneModalVisible=ref(!1),selectedMilestone=ref(null),showAssignSelect=ref(!1),leftPanelWidth=ref(750),rightPanelWidth=computed(()=>{const t=window.innerWidth-48;return Math.max(500,t-leftPanelWidth.value-16)}),isResizing=ref(!1),monitorContentRef=ref(null),leftPanelRef=ref(null),ganttContainerRef=ref(null),ganttHeaderRef=ref(null),ganttTimelineRef=ref(null),ganttBodyRef=ref(null),ganttScrollCleanup=ref(null),availableTeamMembers=computed(()=>[{id:1,name:"å¼ ç»ç†",role:"manager"},{id:2,name:"æŽå¼€å‘",role:"developer"},{id:3,name:"çŽ‹åŽç«¯",role:"developer"},{id:4,name:"èµµæµ‹è¯•",role:"tester"},{id:5,name:"é’±è®¾è®¡",role:"designer"},{id:6,name:"å­™äº§å“",role:"product"},{id:7,name:"å‘¨æž¶æž„",role:"architect"}]),timeScale=ref("month"),timelineData=ref([]),unreadUpdates=ref(0),projectUnreadCount=computed(()=>taskSyncStore.getUnreadCountForProject(String(projectInfo.value.id))),getTaskUnreadBadge=(t,e)=>taskSyncStore.getUnreadCountForTask(String(t),String(e)),wbsViewMode=ref("tree"),selectedRowKeys=ref([]),tableColumns=[{title:"ä»»åŠ¡",dataIndex:"title",key:"title",width:260},{title:"çŠ¶æ€",dataIndex:"status",key:"status",width:100},{title:"è¿›åº¦",dataIndex:"progress",key:"progress",width:160},{title:"è´Ÿè´£äºº",dataIndex:"responsible",key:"responsible",width:120},{title:"æ“ä½œ",key:"action",width:140,fixed:"right"}],tableRowSelection=reactive({selectedRowKeys,onChange:t=>{selectedRowKeys.value=t}});function statusText(t){return t==="completed"?"å·²å®Œæˆ":t==="active"?"è¿›è¡Œä¸­":"å¾…å¼€å§‹"}function jumpToNode(t){wbsViewMode.value="tree",selectTask(String(t))}function openDetail(t){selectTask(String(t))}const isTableDrawerOpen=ref(!1),tableDrawerHeight=ref(Number(localStorage.getItem("pm.tableDrawerHeight")||0)||Math.round(window.innerHeight*.6));function handleViewModeChange(t){t==="table"?isTableDrawerOpen.value=!0:isTableDrawerOpen.value=!1}function closeTableDrawer(){isTableDrawerOpen.value=!1,wbsViewMode.value="tree"}const filterStatus=ref(),filterAssignee=ref(""),filterOverdue=ref(!1),filterUnread=ref(!1);function resetTableFilters(){filterStatus.value=void 0,filterAssignee.value="",filterOverdue.value=!1,filterUnread.value=!1}const filteredFlatTasks=computed(()=>flatTasks.value.filter(e=>{var a;return!(filterStatus.value&&e.status!==filterStatus.value||filterAssignee.value&&(((a=e.assignedTo)==null?void 0:a.name)||e.responsible||"").indexOf(filterAssignee.value)===-1||filterOverdue.value&&!(e.endDate&&new Date(e.endDate)<new Date)||filterUnread.value&&!(getTaskUnreadBadge(String(projectInfo.value.id),String(e.key))>0))}));async function batchStart(){if(!selectedRowKeys.value.length)return;const t=selectedRowKeys.value.map(e=>{var a;return{projectId:String(projectInfo.value.id),taskKey:String(e),data:{status:"active",progress:Math.max(10,Number(((a=findNodeByKey(e))==null?void 0:a.progress)||0))}}});await taskSyncStore.batchUpdateTasks(t)}async function batchComplete(){if(!selectedRowKeys.value.length)return;const t=selectedRowKeys.value.map(e=>({projectId:String(projectInfo.value.id),taskKey:String(e),data:{status:"completed",progress:100,completedAt:new Date().toISOString()}}));await taskSyncStore.batchUpdateTasks(t)}function findNodeByKey(t){const e=a=>{for(const l of a){if(String(l.key)===String(t))return l;if(l.children){const o=e(l.children);if(o)return o}}return null};return e(wbsData.value)}const flatTasks=computed(()=>{const t=[],e=(a,l=0)=>{a.forEach(o=>{const n=o.plannedProgress!==void 0?o.plannedProgress:generatePlannedProgress(o);t.push({...o,level:l,plannedProgress:n}),o.children&&e(o.children,l+1)})};return e(wbsData.value),t}),generatePlannedProgress=t=>{switch(t.status){case"completed":return 100;case"active":return Math.min(100,t.progress+Math.floor(Math.random()*20)-10);case"pending":return Math.min(100,t.progress+Math.floor(Math.random()*15)+5);default:return t.progress}},visibleGanttTasks=computed(()=>{const t=[],e=(a,l=0)=>{a.forEach(o=>{t.push({...o,level:l}),o.children&&expandedKeys.value.includes(o.key)&&e(o.children,l+1)})};return e(wbsData.value),t}),generateTimeline=()=>{const t=[];let e=null,a=null;const l=o=>{o.forEach(n=>{if(n.startDate){const r=new Date(n.startDate);(!e||r<e)&&(e=r)}if(n.endDate){const r=new Date(n.endDate);(!a||r>a)&&(a=r)}n.children&&l(n.children)})};if(l(wbsData.value),!e||!a){const o=new Date().getFullYear();e=new Date(o,0,1),a=new Date(o,11,31)}else e=new Date(e.getFullYear(),e.getMonth()-1,1),a=new Date(a.getFullYear(),a.getMonth()+2,0);if(timeScale.value==="month")for(let o=new Date(e);o<=a;o.setMonth(o.getMonth()+1))t.push({key:o.getTime(),label:`${o.getFullYear()}-${String(o.getMonth()+1).padStart(2,"0")}`,width:90});else if(timeScale.value==="week"){const o=new Date(e);for(o.setDate(o.getDate()-o.getDay()+1);o<=a;)new Date(o).setDate(o.getDate()+6),t.push({key:o.getTime(),label:`${String(o.getMonth()+1).padStart(2,"0")}-${String(o.getDate()).padStart(2,"0")}`,width:70}),o.setDate(o.getDate()+7)}else if(timeScale.value==="day"){const o=new Date(e);for(;o<=a;)t.push({key:o.getTime(),label:`${String(o.getMonth()+1).padStart(2,"0")}-${String(o.getDate()).padStart(2,"0")}`,width:50}),o.setDate(o.getDate()+1)}timelineData.value=t},getStatusColor=t=>({active:"blue",completed:"green",pending:"orange",delayed:"red"})[t]||"default",getStatusText=t=>({active:"è¿›è¡Œä¸­",completed:"å·²å®Œæˆ",pending:"å¾…å¼€å§‹",delayed:"å·²å»¶æœŸ"})[t]||"æœªçŸ¥",getTaskStatusColor=t=>({completed:"green",active:"blue",pending:"orange",delayed:"red"})[t]||"default",getTaskStatusText=t=>({completed:"å·²å®Œæˆ",active:"è¿›è¡Œä¸­",pending:"å¾…å¼€å§‹",delayed:"å·²å»¶æœŸ"})[t]||"æœªçŸ¥",getProgressColor=t=>t>=80?"#52c41a":t>=60?"#1890ff":t>=40?"#faad14":"#f5222d",getMilestoneStatusColor=t=>({completed:"green",upcoming:"blue",overdue:"red",in_progress:"orange"})[t]||"default",getMilestoneStatusText=t=>({completed:"å·²å®Œæˆ",upcoming:"å³å°†åˆ°æ¥",overdue:"å·²é€¾æœŸ",in_progress:"è¿›è¡Œä¸­"})[t]||"æœªçŸ¥",getMilestoneProgressColor=t=>t>=100?"#52c41a":t>=80?"#1890ff":t>=50?"#faad14":"#ff4d4f",getProgressFillColor=(t,e)=>(console.log(`ä»»åŠ¡è¿›åº¦: ${t}%, çŠ¶æ€: ${e}`),e==="completed"?"rgba(82, 196, 26, 0.8)":e==="active"?t>=80?"rgba(82, 196, 26, 0.7)":t>=60?"rgba(24, 144, 255, 0.7)":t>=40?"rgba(250, 173, 20, 0.7)":"rgba(245, 34, 45, 0.7)":e==="pending"?"rgba(250, 173, 20, 0.5)":"rgba(255, 255, 255, 0.25)"),getTaskBarStyle=t=>{if(!timelineData.value||timelineData.value.length===0)return{left:"0%",width:"0%"};const e=new Date(timelineData.value[0].key),a=new Date(timelineData.value[timelineData.value.length-1].key),l=new Date(t.startDate),o=new Date(t.endDate||t.startDate);if(timelineData.value.reduce((n,r)=>n+r.width,0),timeScale.value==="month"){const n=(l.getFullYear()-e.getFullYear())*12+(l.getMonth()-e.getMonth()),r=(o.getFullYear()-e.getFullYear())*12+(o.getMonth()-e.getMonth())+1,d=n*100/timelineData.value.length,c=(r-n)*100/timelineData.value.length;return{left:Math.max(0,d)+"%",width:Math.max(1,c)+"%"}}else{const n=e.getTime(),r=a.getTime(),d=l.getTime(),c=o.getTime(),u=r-n,g=d-n,v=c-d,T=g/u*100,f=v/u*100;return{left:Math.max(0,T)+"%",width:Math.max(.5,f)+"%"}}},goBack=()=>{router.go(-1)},expandAll=()=>{const t=e=>{let a=[];return e.forEach(l=>{a.push(l.key),l.children&&(a=a.concat(t(l.children)))}),a};expandedKeys.value=t(wbsData.value)},collapseAll=()=>{expandedKeys.value=[]},toggleTaskExpand=t=>{const e=expandedKeys.value.indexOf(t);e>-1?expandedKeys.value.splice(e,1):expandedKeys.value.push(t)},selectTask=t=>{console.log("ç”˜ç‰¹å›¾ä»»åŠ¡é€‰ä¸­:",t),selectedKeys.value=[t];const e=flatTasks.value.find(a=>a.key===t);e?(selectedTask.value=e,getAllTaskKeys(wbsData.value).includes(t)&&ensureTaskVisible(t),api.success(`å·²é€‰ä¸­ç”˜ç‰¹å›¾ä»»åŠ¡: ${e.title}`,1),openTaskDetailModal(e)):(console.warn("ä»»åŠ¡ä¸å­˜åœ¨:",t),api.warning("ä»»åŠ¡ä¸å­˜åœ¨"))},onTaskSelect=(t,{node:e})=>{selectedTask.value=e,console.log("ä»»åŠ¡é€‰ä¸­:",e?e.title:"æ— "),e&&e.key&&(scrollToGanttTask(e.key),api.success(`å·²é€‰ä¸­ä»»åŠ¡: ${e.title}`,1)),showAssignSelect.value=!1},clearTaskSelection=()=>{selectedKeys.value=[],selectedTask.value=null,showAssignSelect.value=!1},getAllTaskKeys=t=>{const e=[],a=l=>{l.forEach(o=>{e.push(o.key),o.children&&a(o.children)})};return a(t),e},ensureTaskVisible=t=>{const e=(l,o,n=[])=>{for(const r of l){if(r.key===o)return n;if(r.children){const d=e(r.children,o,[...n,r.key]);if(d)return d}}return null},a=e(wbsData.value,t);a&&a.forEach(l=>{expandedKeys.value.includes(l)||expandedKeys.value.push(l)})},scrollToGanttTask=t=>{ensureTaskVisible(t),nextTick(()=>{setTimeout(()=>{const e=ganttContainerRef.value;if(!e)return;const a=e.querySelector(".gantt-body");if(!a)return;const l=e.querySelector(`.gantt-row[data-task-key="${t}"]`);if(l)scrollToElement(l,a);else{const o=visibleGanttTasks.value.findIndex(r=>r.key===t);if(o===-1)return;const n=e.querySelectorAll(".gantt-row");n[o]&&scrollToElement(n[o],a)}},300)})},scrollToElement=(t,e)=>{const a=e.getBoundingClientRect(),l=t.getBoundingClientRect(),o=a.height/2,n=l.top-a.top+e.scrollTop,r=l.height,d=n-o+r/2;e.scrollTo({top:Math.max(0,d),behavior:"smooth"}),t.classList.add("highlight-task"),setTimeout(()=>{t.classList.remove("highlight-task")},2e3)},refreshGantt=()=>{generateTimeline(),api.success("ç”˜ç‰¹å›¾å·²åˆ·æ–°")},prepareMilestoneFromWBS=(t,e,a)=>{const l={projectId:projectInfo.value.id,projectName:projectInfo.value.name,projectCode:projectInfo.value.code,fromPM:"true",milestoneType:e,taskKey:t};a==="opening"?(router.push({path:"/opening/applicant/submit",query:l}),api.info("æ­£åœ¨è·³è½¬åˆ°å¼€é¢˜ææ–™æäº¤é¡µé¢...")):a==="midterm"?(router.push({path:"/midterm/applicant/submit",query:l}),api.info("æ­£åœ¨è·³è½¬åˆ°ä¸­æœŸææ–™æäº¤é¡µé¢...")):a==="acceptance"?(router.push({path:"/acceptance/applicant/submit",query:l}),api.info("æ­£åœ¨è·³è½¬åˆ°éªŒæ”¶ææ–™æäº¤é¡µé¢...")):api.info(`å‡†å¤‡${e}ææ–™`)};watch(timeScale,()=>{generateTimeline()},{immediate:!1});const updateTaskProgress=()=>{if(!selectedTask.value){api.warning("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªä»»åŠ¡");return}progressForm.newProgress=selectedTask.value.progress,progressForm.workNote="",progressForm.estimatedDate=null,progressModalVisible.value=!0},handleProgressUpdate=async()=>{if(!selectedTask.value){api.warning("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªä»»åŠ¡");return}if(progressForm.newProgress<selectedTask.value.progress){api.error("æ–°è¿›åº¦ä¸èƒ½å°äºŽå½“å‰è¿›åº¦");return}if(!progressForm.workNote.trim()){api.error("è¯·è¾“å…¥å·¥ä½œè¯´æ˜Ž");return}progressUpdating.value=!0;try{await new Promise(a=>setTimeout(a,1e3));const t={progress:progressForm.newProgress,status:progressForm.newProgress===100?"completed":"active"};await taskSyncStore.updateTask(projectInfo.value.id,selectedTask.value.key,t),Object.assign(selectedTask.value,t);const e={taskId:selectedTask.value.key,oldProgress:selectedTask.value.progress,newProgress:progressForm.newProgress,workNote:progressForm.workNote,updateTime:new Date().toISOString(),updater:"å½“å‰ç”¨æˆ·"};console.log("è¿›åº¦æ›´æ–°è®°å½•:",e),api.success(`ä»»åŠ¡è¿›åº¦å·²æ›´æ–°ä¸º ${progressForm.newProgress}%`),progressForm.newProgress===100&&api.success("ðŸŽ‰ ä»»åŠ¡å·²æ ‡è®°ä¸ºå®Œæˆï¼"),closeProgressModal()}catch(t){console.error("æ›´æ–°è¿›åº¦å¤±è´¥:",t),api.error("æ›´æ–°è¿›åº¦å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{progressUpdating.value=!1}},closeProgressModal=()=>{progressModalVisible.value=!1,progressForm.newProgress=0,progressForm.workNote="",progressForm.estimatedDate=null},disabledDate=t=>t&&t<new Date().setHours(0,0,0,0),handleQuickAssign=async t=>{if(!selectedTask.value){api.warning("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªä»»åŠ¡");return}if(!t){selectedTask.value.assignedTo=null,await taskSyncStore.updateTask(projectInfo.value.id,selectedTask.value.key,{assignedTo:null}),api.info(`ä»»åŠ¡"${selectedTask.value.title}"å·²å–æ¶ˆåˆ†é…`);return}const e=availableTeamMembers.value.find(a=>a.id===t);e&&(selectedTask.value.assignedTo=e,await taskSyncStore.updateTask(projectInfo.value.id,selectedTask.value.key,{assignedTo:e}),api.success(`ä»»åŠ¡"${selectedTask.value.title}"å·²åˆ†é…ç»™${e.name}`))},handleQuickAssignAndHide=t=>{handleQuickAssign(t),showAssignSelect.value=!1},hideAssignSelect=()=>{setTimeout(()=>{showAssignSelect.value=!1},200)},handleMilestoneTypeChange=t=>{selectedTask.value&&(selectedTask.value.milestoneType=t,t&&(!selectedTask.value.materialRequirements||selectedTask.value.materialRequirements.length===0)&&initDefaultMaterialRequirements(t),t||(selectedTask.value.materialRequirements=[]))},initDefaultMaterialRequirements=async t=>{try{await materialTemplateStore.initConfigs();const a=materialTemplateStore.getConfigsByBusinessType(t).map((l,o)=>({id:Date.now()+o,name:l.categoryName,required:l.isRequired,description:l.description||"",templateFileName:l.templateFileName||"",templateFilePath:l.templateFilePath||"",fromTemplate:!0}));selectedTask.value&&(selectedTask.value.materialRequirements=[...a],a.length>0&&api.success(`å·²ä»Žææ–™æ¨¡æ¿è‡ªåŠ¨åŠ è½½${a.length}é¡¹ææ–™éœ€æ±‚`))}catch(e){console.error("åˆå§‹åŒ–ææ–™éœ€æ±‚å¤±è´¥:",e),api.error("åŠ è½½ææ–™æ¨¡æ¿å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨æ·»åŠ ææ–™éœ€æ±‚");const a={opening:[{name:"å¼€é¢˜æŠ¥å‘Š",required:!0},{name:"æ–‡çŒ®ç»¼è¿°",required:!0},{name:"æŠ€æœ¯è·¯çº¿å›¾",required:!1}],midterm:[{name:"ä¸­æœŸæ£€æŸ¥æŠ¥å‘Š",required:!0},{name:"é˜¶æ®µæ€§æˆæžœ",required:!0}],acceptance:[{name:"éªŒæ”¶æŠ¥å‘Š",required:!0},{name:"é¡¹ç›®æ€»ç»“",required:!0}]};selectedTask.value&&a[t]&&(selectedTask.value.materialRequirements=a[t].map((l,o)=>({id:Date.now()+o,...l})))}},addMaterialRequirement=()=>{selectedTask.value&&(selectedTask.value.materialRequirements||(selectedTask.value.materialRequirements=[]),selectedTask.value.materialRequirements.push({id:Date.now(),name:"",required:!0}))},removeMaterialRequirement=t=>{selectedTask.value&&selectedTask.value.materialRequirements&&selectedTask.value.materialRequirements.splice(t,1)},handleReminderChange=t=>{const e=t&&t.target?t.target.checked:!!t;selectedTask.value&&(selectedTask.value.reminders||(selectedTask.value.reminders={}),selectedTask.value.reminders.enabled=e,e&&!selectedTask.value.reminders.beforeDeadline&&(selectedTask.value.reminders.beforeDeadline=[3,1]))},handleAllowMaterialUploadChange=t=>{const e=t&&t.target?t.target.checked:!!t;selectedTask.value&&(selectedTask.value.allowMaterialUpload=e,e&&(!selectedTask.value.materialRequirements||selectedTask.value.materialRequirements.length===0)&&(selectedTask.value.materialRequirements=[{id:Date.now(),name:"",required:!1}]))},saveTaskAssignment=async()=>{if(!selectedTask.value||!selectedTask.value.assignedTo){api.error("è¯·å…ˆé€‰æ‹©è´Ÿè´£äºº");return}try{const t={taskKey:selectedTask.value.key,assignedTo:selectedTask.value.assignedTo,milestoneType:selectedTask.value.milestoneType,materialRequirements:selectedTask.value.materialRequirements||[],reminders:selectedTask.value.reminders||{enabled:!1},assignedAt:new Date().toISOString()};await taskSyncStore.updateTask(projectInfo.value.id,selectedTask.value.key,t),api.success("ä»»åŠ¡åˆ†é…å·²ä¿å­˜"),sendTaskNotification()}catch(t){console.error("ä¿å­˜ä»»åŠ¡åˆ†é…å¤±è´¥:",t),api.error("ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•")}},sendTaskNotification=()=>{if(!selectedTask.value||!selectedTask.value.assignedTo){api.error("è¯·å…ˆä¿å­˜ä»»åŠ¡åˆ†é…");return}const t={type:"task_assigned",recipientId:selectedTask.value.assignedTo.id,taskId:selectedTask.value.key,projectId:projectInfo.value.id,message:`æ‚¨æœ‰æ–°çš„ä»»åŠ¡åˆ†é…ï¼š${selectedTask.value.title}`,data:{taskTitle:selectedTask.value.title,projectName:projectInfo.value.name,deadline:selectedTask.value.endDate,milestoneType:selectedTask.value.milestoneType,materialRequirements:selectedTask.value.materialRequirements}};console.log("å‘é€ä»»åŠ¡é€šçŸ¥:",t),api.success("ä»»åŠ¡é€šçŸ¥å·²å‘é€")},setupRealTimeSync=()=>{console.log("å®žæ—¶çŠ¶æ€åŒæ­¥å·²å¯åŠ¨")},openTaskEditModal=()=>{if(!selectedTask.value){api.warning("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªä»»åŠ¡");return}console.log("æ‰“å¼€ä»»åŠ¡ç¼–è¾‘å¼¹çª—:",selectedTask.value.title),taskEditForm.title=selectedTask.value.title,taskEditForm.description=selectedTask.value.description||"",taskEditForm.startDate=selectedTask.value.startDate,taskEditForm.endDate=selectedTask.value.endDate,taskEditForm.status=selectedTask.value.status,taskEditForm.isCritical=selectedTask.value.isCritical||!1,selectedTask.value.isMilestone&&(taskEditForm.milestoneType=selectedTask.value.milestoneType,taskEditForm.materialRequirements=selectedTask.value.materialRequirements||[]),taskEditModalVisible.value=!0,nextTick(()=>{taskEditFormRef.value&&taskEditFormRef.value.clearValidate()})},closeTaskEditModal=()=>{taskEditModalVisible.value=!1,taskEditForm.title="",taskEditForm.description="",taskEditForm.startDate=null,taskEditForm.endDate=null,taskEditForm.status="pending",taskEditForm.isCritical=!1,taskEditFormRef.value&&taskEditFormRef.value.clearValidate()},openTaskDetailModal=t=>{selectedTaskDetail.value=t,taskDetailActiveTab.value="info",taskDetailModalVisible.value=!0},closeTaskDetailModal=()=>{taskDetailModalVisible.value=!1,selectedTaskDetail.value=null,taskDetailActiveTab.value="info",pmCommentTexts.value={}},getTaskOperationHistory=t=>t.operationHistory||[],getHistoryTypeColor=t=>({progress_update:"blue",material_submission:"green",status_change:"orange",task_start:"cyan",task_complete:"purple"})[t]||"blue",getHistoryTypeIcon=t=>({progress_update:"ClockCircleOutlined",material_submission:"FileTextOutlined",status_change:"EditOutlined",task_start:"PlayCircleOutlined",task_complete:"CheckCircleOutlined"})[t]||"ClockCircleOutlined",getHistoryActionText=t=>({progress_update:"æ›´æ–°äº†ä»»åŠ¡è¿›åº¦",material_submission:"æäº¤äº†ææ–™",status_change:"å˜æ›´äº†ä»»åŠ¡çŠ¶æ€",task_start:"å¼€å§‹äº†ä»»åŠ¡",task_complete:"å®Œæˆäº†ä»»åŠ¡"})[t]||"æ‰§è¡Œäº†æ“ä½œ",getHistoryDetailText=t=>{switch(t.type){case"progress_update":const{oldProgress:e,newProgress:a,statusChange:l}=t.data;let o=`è¿›åº¦ä»Ž ${e}% æ›´æ–°åˆ° ${a}%`;return l&&(o+=`ï¼ŒçŠ¶æ€ä»Ž ${getTaskStatusText(l.from)} å˜æ›´ä¸º ${getTaskStatusText(l.to)}`),t.data.note&&(o+=`
å¤‡æ³¨ï¼š${t.data.note}`),o;case"material_submission":return`æäº¤äº† ${t.data.submissionCount} ä¸ªææ–™æ–‡ä»¶`;default:return"è¯¦ç»†ä¿¡æ¯"}},formatHistoryTime=t=>{if(!t)return"";const e=new Date,a=new Date(t),l=e-a;return l<6e4?"åˆšåˆš":l<36e5?`${Math.floor(l/6e4)}åˆ†é’Ÿå‰`:l<864e5?`${Math.floor(l/36e5)}å°æ—¶å‰`:l<2592e6?`${Math.floor(l/864e5)}å¤©å‰`:a.toLocaleDateString("zh-CN")},showOperationDetail=t=>{selectedOperation.value=t,operationDetailVisible.value=!0},openOperationHistory=()=>{if(!selectedTask.value){api.warning("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªä»»åŠ¡");return}(!Array.isArray(selectedTask.value.operationHistory)||selectedTask.value.operationHistory.length===0)&&api.info("å½“å‰ä»»åŠ¡æš‚æ— æ“ä½œåŽ†å²"),selectedOperation.value={type:"progress_update",user:"ç³»ç»Ÿ",timestamp:new Date().toISOString(),data:{note:"æ“ä½œåŽ†å²æ±‡æ€»"}},operationDetailVisible.value=!0},isPdf=t=>typeof t=="string"&&t.toLowerCase().endsWith(".pdf"),resolveFileUrl=t=>(t==null?void 0:t.url)||(t==null?void 0:t.path)||(t==null?void 0:t.fileUrl)||(typeof t=="string"?t:""),previewMaterial=t=>{const e=resolveFileUrl(t);if(!e){api.warning("æ— æ³•é¢„è§ˆï¼šç¼ºå°‘æ–‡ä»¶åœ°å€");return}filePreviewSrc.value=e,filePreviewVisible.value=!0},downloadMaterial=t=>{const e=resolveFileUrl(t);if(!e){api.warning("æ— æ³•ä¸‹è½½ï¼šç¼ºå°‘æ–‡ä»¶åœ°å€");return}const a=document.createElement("a");a.href=e,a.download=(t==null?void 0:t.fileName)||(t==null?void 0:t.name)||"ææ–™",a.target="_blank",a.click()},forwardToManagers=()=>{if(!selectedTaskDetail.value){api.warning("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªä»»åŠ¡");return}const t=selectedTaskDetail.value.milestoneType,e={projectId:projectInfo.value.id,projectName:projectInfo.value.name,projectCode:projectInfo.value.code,fromPM:"true"};t==="opening"?router.push({path:"/opening/management/center",query:e}):t==="midterm"?router.push({path:"/midterm/management/center",query:e}):t==="acceptance"?router.push({path:"/acceptance/management/center",query:e}):(api.info("æœªçŸ¥çš„é‡Œç¨‹ç¢‘ç±»åž‹ï¼Œå·²è·³è½¬åˆ°é¡¹ç›®ç®¡ç†é¡µ"),router.push({path:"/project-manager/projects"})),api.success("å·²ä¸ºç®¡ç†è€…å‡†å¤‡ææ–™é¡µé¢")},addPMComment=async t=>{const e=pmCommentTexts.value[t.id];if(!e||!e.trim()){api.warning("è¯·è¾“å…¥è¯„è®ºå†…å®¹");return}const a={id:Date.now(),user:"å¼ ç»ç†(é¡¹ç›®ç»ç†)",userId:"pm_001",role:"project_manager",content:e.trim(),timestamp:new Date().toISOString()};t.comments||(t.comments=[]),t.comments.push(a),pmCommentTexts.value[t.id]="";try{await taskSyncStore.updateTask(selectedTaskDetail.value.projectId,selectedTaskDetail.value.key,{operationHistory:getTaskOperationHistory(selectedTaskDetail.value)}),api.success("è¯„è®ºæ·»åŠ æˆåŠŸï¼Œå·²åŒæ­¥åˆ°å›¢é˜Ÿæˆå‘˜")}catch(l){console.error("åŒæ­¥è¯„è®ºå¤±è´¥:",l),api.error("è¯„è®ºæ·»åŠ å¤±è´¥")}},getTaskUpdateHistory=t=>t.updateHistory||[],getUpdateIcon=t=>({progress_update:"PercentageOutlined",status_change:"SyncOutlined",task_created:"PlusOutlined",task_assigned:"UserOutlined"})[t]||"InfoCircleOutlined",getUpdateTypeColor=t=>({progress_update:"blue",status_change:"orange",task_created:"green",task_assigned:"purple"})[t]||"default",getUpdateActionText=t=>({progress_update:"è¿›åº¦æ›´æ–°",status_change:"çŠ¶æ€å˜æ›´",task_created:"ä»»åŠ¡åˆ›å»º",task_assigned:"ä»»åŠ¡åˆ†é…"})[t]||"å…¶ä»–æ“ä½œ",formatUpdateTime=t=>{const e=new Date(t);return new Date().getTime()-e.getTime()<24*60*60*1e3?e.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}):e.toLocaleDateString("zh-CN",{month:"2-digit",day:"2-digit"})},validateEndDate=(t,e)=>{if(!e||!taskEditForm.startDate)return Promise.resolve();const a=new Date(taskEditForm.startDate);return new Date(e)<=a?Promise.reject(new Error("ç»“æŸæ—¶é—´å¿…é¡»æ™šäºŽå¼€å§‹æ—¶é—´")):Promise.resolve()},disabledEndDate=t=>{if(!taskEditForm.startDate)return!1;const e=new Date(taskEditForm.startDate);return t&&t<=e},calculateDuration=(t,e)=>{if(!t||!e)return 0;const a=new Date(t),l=new Date(e),o=Math.abs(l-a);return Math.ceil(o/(1e3*60*60*24))},handleTaskEdit=async()=>{try{if(console.log("å¼€å§‹å¤„ç†ä»»åŠ¡ç¼–è¾‘..."),await taskEditFormRef.value.validate(),!selectedTask.value){api.error("æ²¡æœ‰é€‰ä¸­çš„ä»»åŠ¡");return}console.log("è¡¨å•éªŒè¯é€šè¿‡ï¼Œæ­£åœ¨ä¿å­˜..."),taskEditLoading.value=!0;const t=calculateDuration(taskEditForm.startDate,taskEditForm.endDate),e={title:taskEditForm.title.trim(),description:taskEditForm.description.trim(),startDate:taskEditForm.startDate,endDate:taskEditForm.endDate,duration:t,status:taskEditForm.status,isCritical:taskEditForm.isCritical};await taskSyncStore.updateTask(projectInfo.value.id,selectedTask.value.key,e),Object.assign(selectedTask.value,e);const a=l=>{for(let o of l){if(o.key===selectedTask.value.key)return Object.assign(o,e),!0;if(o.children&&a(o.children))return!0}return!1};a(wbsData.value),generateTimeline(),console.log("ä»»åŠ¡ç¼–è¾‘æˆåŠŸ:",e),api.success(`ä»»åŠ¡ "${e.title}" ä¿¡æ¯å·²æˆåŠŸæ›´æ–°`),closeTaskEditModal()}catch(t){console.error("ä»»åŠ¡ç¼–è¾‘å¤±è´¥:",t),t.message?api.error(`ä»»åŠ¡ç¼–è¾‘å¤±è´¥: ${t.message}`):api.error("ä»»åŠ¡ç¼–è¾‘å¤±è´¥ï¼Œè¯·æ£€æŸ¥è¡¨å•æ•°æ®")}finally{taskEditLoading.value=!1}},duplicateTask=()=>{if(!selectedTask.value){api.warning("è¯·å…ˆé€‰æ‹©è¦å¤åˆ¶çš„ä»»åŠ¡");return}const t=selectedTask.value,e=generateNewTaskKey(t.key.split("-")[0]),a={...t,key:e,title:`${t.title} (å‰¯æœ¬)`,status:"pending",progress:0,actualStartDate:null,actualEndDate:null,startDate:new Date().toISOString().split("T")[0],endDate:new Date(Date.now()+7*24*60*60*1e3).toISOString().split("T")[0],operationHistory:[]};t.children&&(a.children=t.children.map((l,o)=>({...l,key:`${e}-${o+1}`,title:`${l.title} (å‰¯æœ¬)`,status:"pending",progress:0,operationHistory:[]}))),wbsData.value.push(a),selectedKeys.value=[e],selectedTask.value=a,expandedKeys.value.push(e),console.log("ä»»åŠ¡å¤åˆ¶æˆåŠŸ:",a),api.success(`ä»»åŠ¡ "${t.title}" å·²å¤åˆ¶`)},handleKeyboardShortcuts=t=>{t.ctrlKey&&t.key==="e"&&(t.preventDefault(),selectedTask.value&&openTaskEditModal()),t.ctrlKey&&t.key==="d"&&(t.preventDefault(),selectedTask.value&&duplicateTask()),wbsEditMode.value&&selectedTask.value&&(t.key==="Tab"&&!t.shiftKey?(t.preventDefault(),indentTask(selectedTask.value.key)):t.key==="Tab"&&t.shiftKey&&(t.preventDefault(),outdentTask(selectedTask.value.key))),t.key==="Escape"&&(t.preventDefault(),clearTaskSelection()),t.key==="Delete"&&wbsEditMode.value&&(t.preventDefault(),selectedTask.value&&deleteWBSTask(selectedTask.value.key))},updateTaskInWBS=(t,e)=>{const a=l=>{for(let o of l){if(String(o.key)===String(t))return Object.assign(o,e),!0;if(o.children&&a(o.children))return!0}return!1};a(wbsData.value)},toggleWBSEditMode=()=>{wbsEditMode.value=!wbsEditMode.value,wbsEditMode.value?api.info("è¿›å…¥WBSç»“æž„ç¼–è¾‘æ¨¡å¼"):(generateTimeline(),api.success("WBSç»“æž„ç¼–è¾‘å®Œæˆ"))},generateNewTaskKey=(t=null)=>{let e=0;const a=l=>{l.forEach(o=>{const n=String((o==null?void 0:o.key)??"");if(t!=null){const r=String(t);if(n.startsWith(r+"-")){const d=parseInt(n.split("-").pop());!isNaN(d)&&d>e&&(e=d)}}else{const r=parseInt(n);!isNaN(r)&&r>e&&(e=r)}o.children&&a(o.children)})};return a(wbsData.value),t!=null?`${String(t)}-${e+1}`:`${e+1}`},addChildTask=t=>{const a={key:generateNewTaskKey(t),title:"æ–°å»ºå­ä»»åŠ¡",status:"pending",progress:0,plannedProgress:0,responsible:"æœªåˆ†é…",description:"è¯·ç¼–è¾‘ä»»åŠ¡æè¿°",startDate:new Date().toISOString().split("T")[0],endDate:new Date(Date.now()+7*24*60*60*1e3).toISOString().split("T")[0],duration:7,isCritical:!1,children:[]},l=o=>{for(let n of o){if(String(n.key)===String(t))return n.children||(n.children=[]),n.children.push(a),expandedKeys.value.includes(String(t))||expandedKeys.value.push(String(t)),!0;if(n.children&&l(n.children))return!0}return!1};l(wbsData.value),api.success("å·²æ·»åŠ æ–°çš„å­ä»»åŠ¡")},addSiblingTask=t=>{const{parent:e,index:a}=findTaskParentAndIndex(t),l=e?e.children:wbsData.value,n={key:generateNewTaskKey(e?String(e.key):null),title:"æ–°å»ºåŒçº§ä»»åŠ¡",status:"pending",progress:0,plannedProgress:0,responsible:"æœªåˆ†é…",description:"è¯·ç¼–è¾‘ä»»åŠ¡æè¿°",startDate:new Date().toISOString().split("T")[0],endDate:new Date(Date.now()+7*24*60*60*1e3).toISOString().split("T")[0],duration:7,isCritical:!1,children:[]};l.splice(a+1,0,n),api.success("å·²æ·»åŠ æ–°çš„åŒçº§ä»»åŠ¡")},createMilestoneNode=(t="ðŸŽ¯ æ–°å»ºé‡Œç¨‹ç¢‘",e="opening")=>(lastMilestoneType.value=e,{key:"",title:t,status:"upcoming",progress:0,responsible:"é¡¹ç›®ç»ç†",description:"è¯·å®Œå–„é‡Œç¨‹ç¢‘è¯´æ˜Ž",startDate:new Date().toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0],duration:1,isCritical:!0,isMilestone:!0,milestoneType:e,materials:[]}),addMilestoneChild=(t,e="opening")=>{const a=generateNewTaskKey(t),l=createMilestoneNode(`ðŸŽ¯ ${getMilestoneTitleByType(e)}`,e);l.key=a;const o=n=>{for(let r of n){if(String(r.key)===String(t)){r.children||(r.children=[]),r.children.push(l);const d=String(t);return expandedKeys.value.includes(d)||expandedKeys.value.push(d),api.success("å·²æ·»åŠ é‡Œç¨‹ç¢‘ï¼ˆå­çº§ï¼‰"),!0}if(r.children&&o(r.children))return!0}return!1};o(wbsData.value)},addMilestoneSibling=(t,e="opening")=>{const{parent:a,index:l}=findTaskParentAndIndex(t),o=a?a.children:wbsData.value,n=generateNewTaskKey(a?String(a.key):null),r=createMilestoneNode(`ðŸŽ¯ ${getMilestoneTitleByType(e)}`,e);r.key=n,o.splice(l+1,0,r),api.success("å·²æ·»åŠ é‡Œç¨‹ç¢‘ï¼ˆåŒçº§ï¼‰")},addTopLevelMilestone=(t="opening")=>{const e=generateNewTaskKey(null),a=createMilestoneNode(`ðŸŽ¯ ${getMilestoneTitleByType(t)}`,t);a.key=e,wbsData.value.push(a),expandedKeys.value.push(e),api.success("å·²æ·»åŠ é¡¶çº§é‡Œç¨‹ç¢‘")},getMilestoneTitleByType=t=>t==="opening"?"é¡¹ç›®å¼€é¢˜é‡Œç¨‹ç¢‘":t==="midterm"?"é¡¹ç›®ä¸­æœŸé‡Œç¨‹ç¢‘":t==="acceptance"?"é¡¹ç›®éªŒæ”¶é‡Œç¨‹ç¢‘":"é¡¹ç›®é‡Œç¨‹ç¢‘",toggleMilestone=(t,e)=>{const a=l=>{for(let o of l){if(String(o.key)===String(t))return e?(o.isMilestone=!0,o.milestoneType=o.milestoneType||lastMilestoneType.value||"opening",o.duration=1):(o.isMilestone=!1,delete o.milestoneType),markTaskRecentlyUpdated(t),api.success(e?"å·²è®¾ä¸ºé‡Œç¨‹ç¢‘":"å·²å–æ¶ˆé‡Œç¨‹ç¢‘"),!0;if(o.children&&a(o.children))return!0}return!1};a(wbsData.value)},indentTask=t=>{const{parent:e,index:a}=findTaskParentAndIndex(t),l=e?e.children:wbsData.value;if(a<=0)return;const o=l[a-1];if(!o)return;const[n]=l.splice(a,1);o.children||(o.children=[]);const r=generateNewTaskKey(String(o.key)),d=n.key;n.key=r,o.children.push(n),expandedKeys.value.includes(o.key)||expandedKeys.value.push(o.key),selectedTask.value&&String(selectedTask.value.key)===String(d)&&(selectedTask.value.key=r,selectedKeys.value=[r]),api.success("å·²ç¼©è¿›ä¸ºå­çº§")},outdentTask=t=>{const{parent:e,index:a}=findTaskParentAndIndex(t);if(!e)return;const l=findTaskParentAndIndex(e.key),o=e.children,[n]=o.splice(a,1),r=l.parent?l.parent.children:wbsData.value,d=(l.parent?r.indexOf(e):wbsData.value.indexOf(e))+1,c=generateNewTaskKey(l.parent?String(l.parent.key):null),u=n.key;n.key=c,r.splice(d,0,n),selectedTask.value&&String(selectedTask.value.key)===String(u)&&(selectedTask.value.key=c,selectedKeys.value=[c]),api.success("å·²å¤–ç§»ä¸ºåŒçº§")},handleTreeDrop=t=>{if(wbsEditMode.value)try{const e=String(t.dragNode.key),a=String(t.node.key),l=t.node.pos.split("-"),o=t.dropPosition-Number(l[l.length-1]),{parent:n,index:r}=findTaskParentAndIndex(e),d=n?n.children:wbsData.value,[c]=d.splice(r,1);if(t.dropToGap){const{parent:u,index:g}=findTaskParentAndIndex(a),v=u?u.children:wbsData.value,T=o>0?g+1:g,f=generateNewTaskKey(u?String(u.key):null),h=c.key;c.key=f,v.splice(T,0,c),selectedTask.value&&String(selectedTask.value.key)===String(h)&&(selectedTask.value.key=f,selectedKeys.value=[f])}else{const u=(()=>{const T=f=>{for(let h of f){if(String(h.key)===a)return h;if(h.children){const V=T(h.children);if(V)return V}}return null};return T(wbsData.value)})();if(!u)throw new Error("æœªæ‰¾åˆ°ç›®æ ‡èŠ‚ç‚¹");u.children||(u.children=[]);const g=generateNewTaskKey(String(u.key)),v=c.key;c.key=g,u.children.push(c),expandedKeys.value.includes(u.key)||expandedKeys.value.push(u.key),selectedTask.value&&String(selectedTask.value.key)===String(v)&&(selectedTask.value.key=g,selectedKeys.value=[g])}api.success("èŠ‚ç‚¹å·²é‡æ–°æŽ’ä½")}catch(e){console.error(e),api.error("æ‹–æ‹½å¤±è´¥ï¼Œè¯·é‡è¯•")}},editWBSTask=t=>{const e=findTaskByKey(t);e&&(selectedTask.value=e,openTaskEditModal())},findTaskByKey=t=>{const e=a=>{for(let l of a){if(l.key===t)return l;if(l.children){const o=e(l.children);if(o)return o}}return null};return e(wbsData.value)},deleteWBSTask=t=>{console.log("åˆ é™¤ä»»åŠ¡è¢«è°ƒç”¨:",t);const e=findTaskByKey(t);if(console.log("æ‰¾åˆ°çš„ä»»åŠ¡:",e),!e){console.log("ä»»åŠ¡æœªæ‰¾åˆ°"),api.error("æœªæ‰¾åˆ°è¦åˆ é™¤çš„ä»»åŠ¡");return}if(e.children&&e.children.length>0){console.log("ä»»åŠ¡æœ‰å­ä»»åŠ¡ï¼Œä¸èƒ½åˆ é™¤"),api.warning("ä¸èƒ½åˆ é™¤æœ‰å­ä»»åŠ¡çš„ä»»åŠ¡ï¼Œè¯·å…ˆåˆ é™¤æ‰€æœ‰å­ä»»åŠ¡");return}if(e.status==="active"&&e.progress>0){Modal.warning({title:"ä»»åŠ¡æ­£åœ¨è¿›è¡Œä¸­",content:`ä»»åŠ¡"${e.title}"æ­£åœ¨è¿›è¡Œä¸­ï¼ˆè¿›åº¦ï¼š${e.progress}%ï¼‰ï¼Œç¡®å®šè¦åˆ é™¤å—ï¼Ÿ`,okText:"ä»è¦åˆ é™¤",cancelText:"å–æ¶ˆ",onOk(){performDelete(t,e)}});return}performDelete(t,e)},performDelete=(t,e)=>{console.log("å‡†å¤‡æ˜¾ç¤ºåˆ é™¤ç¡®è®¤å¯¹è¯æ¡†");const a=()=>{const l=o=>{for(let n=0;n<o.length;n++){if(o[n].key===t)return o.splice(n,1),!0;if(o[n].children&&l(o[n].children))return!0}return!1};l(wbsData.value),selectedTask.value&&selectedTask.value.key===t&&clearTaskSelection(),api.success("ä»»åŠ¡å·²åˆ é™¤")};try{console.log("å¼€å§‹è°ƒç”¨Modal.confirm"),Modal.confirm({title:"ç¡®è®¤åˆ é™¤",content:`ç¡®å®šè¦åˆ é™¤ä»»åŠ¡"${e.title}"å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚`,okText:"åˆ é™¤",okType:"danger",cancelText:"å–æ¶ˆ",onOk(){console.log("ç”¨æˆ·ç¡®è®¤åˆ é™¤"),a()},onCancel(){console.log("ç”¨æˆ·å–æ¶ˆåˆ é™¤")}}),console.log("Modal.confirmè°ƒç”¨å®Œæˆ")}catch(l){console.error("Modal.confirmè°ƒç”¨å¤±è´¥:",l),api.error("åˆ é™¤ç¡®è®¤å¯¹è¯æ¡†æ‰“å¼€å¤±è´¥")}},canMoveUp=t=>{const{parent:e,index:a}=findTaskParentAndIndex(t);return a>0},canMoveDown=t=>{const{parent:e,index:a}=findTaskParentAndIndex(t);if(a===-1)return!1;const l=e?e.children:wbsData.value;return a<l.length-1},findTaskParentAndIndex=t=>{const e=(a,l=null)=>{for(let o=0;o<a.length;o++){if(a[o].key===t)return{parent:l,index:o};if(a[o].children){const n=e(a[o].children,a[o]);if(n.index!==-1)return n}}return{parent:null,index:-1}};return e(wbsData.value)},moveTaskUp=t=>{const{parent:e,index:a}=findTaskParentAndIndex(t);if(a<=0)return;const l=e?e.children:wbsData.value,o=l[a];l.splice(a,1),l.splice(a-1,0,o),api.success("ä»»åŠ¡å·²ä¸Šç§»")},moveTaskDown=t=>{const{parent:e,index:a}=findTaskParentAndIndex(t),l=e?e.children:wbsData.value;if(a>=l.length-1)return;const o=l[a];l.splice(a,1),l.splice(a+1,0,o),api.success("ä»»åŠ¡å·²ä¸‹ç§»")},startResize=t=>{isResizing.value=!0;const e=t.clientX,a=leftPanelWidth.value,l=n=>{if(!isResizing.value)return;const r=n.clientX-e,d=a+r,c=700,u=window.innerWidth-500;leftPanelWidth.value=Math.max(c,Math.min(u,d))},o=()=>{isResizing.value=!1,document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",o),document.body.style.userSelect="",document.body.style.cursor=""};document.addEventListener("mousemove",l),document.addEventListener("mouseup",o),document.body.style.userSelect="none",document.body.style.cursor="col-resize"},handleResize=()=>{const e=window.innerWidth-48-500;leftPanelWidth.value>e&&(leftPanelWidth.value=Math.max(700,e))},setupGanttScrollSync=()=>{const t=ganttHeaderRef.value,e=ganttBodyRef.value;if(!t||!e)return;const a=(n,r)=>{let d=!1;const c=()=>{d||(d=!0,r.scrollLeft=n.scrollLeft,requestAnimationFrame(()=>{d=!1}))};return n.addEventListener("scroll",c),()=>n.removeEventListener("scroll",c)},l=a(t,e),o=a(e,t);ganttScrollCleanup.value=()=>{l(),o()}},handleTaskDataUpdated=t=>{const{projectId:e,taskKey:a,updates:l}=t.detail;if(String(e)===String(projectInfo.value.id)){if(console.log(`ðŸ“¥ ç›‘æŽ§é¡µé¢æŽ¥æ”¶åˆ°ä»»åŠ¡æ›´æ–°: ${a}`,l),updateTaskInWBS(a,l),selectedTask.value&&String(selectedTask.value.key)===String(a)){if(l&&Array.isArray(l.operationHistory)){const n=[...Array.isArray(selectedTask.value.operationHistory)?selectedTask.value.operationHistory:[]];l.operationHistory.forEach(r=>{n.find(d=>d.id===r.id)||n.push(r)}),selectedTask.value.operationHistory=n}Object.assign(selectedTask.value,l)}(l.startDate||l.endDate||l.progress!==void 0)&&generateTimeline();try{const o=flatTasks.value.find(n=>String(n.key)===String(a));if(o&&(l.progress!==void 0||l.status!==void 0)){const n=o.title||`ä»»åŠ¡(${a})`,r=l.progress!==void 0?`è¿›åº¦ ${l.progress}%`:"",d=l.status?`çŠ¶æ€ ${getTaskStatusText(l.status)}`:"",c=[r,d].filter(Boolean).join("ï¼Œ");api.success({content:`æˆå‘˜æ›´æ–°ï¼š${n} â†’ ${c}`,duration:3}),api$1.open({message:"æˆå‘˜è¿›åº¦æ›´æ–°",description:`${n}ï¼š${c}`,duration:3}),markTaskRecentlyUpdated(a),unreadUpdates.value+=1}}catch{}}};function markAllRead(){unreadUpdates.value=0,taskSyncStore.markProjectUpdatesRead(String(projectInfo.value.id))}function resetProjectProgress(){Modal.confirm({title:"ç¡®è®¤é‡ç½®é¡¹ç›®è¿›åº¦ï¼Ÿ",content:"è¿™å°†æŠŠæ‰€æœ‰ä»»åŠ¡è®¾ç½®ä¸ºå¾…å¼€å§‹(0%)ï¼Œå¹¶æ¸…ç©ºæ“ä½œåŽ†å²ï¼ˆä»…å‰ç«¯æ¼”ç¤ºæ•°æ®ï¼‰ã€‚",okText:"é‡ç½®",okType:"danger",cancelText:"å–æ¶ˆ",onOk:async()=>{const t=l=>{l.forEach(o=>{o.status="pending",o.progress=0,o.completedAt=null,o.operationHistory&&(o.operationHistory=[]),o.children&&t(o.children)})};t(wbsData.value);const e=[],a=l=>{l.forEach(o=>{e.push({projectId:String(projectInfo.value.id),taskKey:String(o.key),data:{status:"pending",progress:0,completedAt:null,operationHistory:[]}}),o.children&&a(o.children)})};a(wbsData.value),e.length&&await taskSyncStore.batchUpdateTasks(e),taskSyncStore.registerWBSProject(projectInfo.value.id,wbsData.value),generateTimeline(),unreadUpdates.value=0,api.success("é¡¹ç›®è¿›åº¦å·²é‡ç½®ï¼Œæˆå‘˜çœ‹æ¿åŒæ­¥æ›´æ–°")}})}async function resetSelectedTask(){if(!selectedTask.value)return;const t=String(selectedTask.value.key);Modal.confirm({title:"ç¡®è®¤é‡ç½®é€‰ä¸­ä»»åŠ¡ï¼Ÿ",content:`å°†æŠŠä»»åŠ¡ã€Œ${selectedTask.value.title||t}ã€é‡ç½®ä¸ºå¾…å¼€å§‹(0%)ï¼Œå¹¶æ¸…ç©ºæ“ä½œåŽ†å²ã€‚`,okText:"é‡ç½®",okType:"danger",cancelText:"å–æ¶ˆ",async onOk(){const e=a=>{a.forEach(l=>{String(l.key)===t&&(l.status="pending",l.progress=0,l.completedAt=null,l.operationHistory&&(l.operationHistory=[])),l.children&&e(l.children)})};e(wbsData.value),await taskSyncStore.updateTask(String(projectInfo.value.id),t,{status:"pending",progress:0,completedAt:null,operationHistory:[]}),taskSyncStore.registerWBSProject(projectInfo.value.id,wbsData.value),generateTimeline(),api.success("é€‰ä¸­ä»»åŠ¡å·²é‡ç½®ï¼Œæˆå‘˜çœ‹æ¿åŒæ­¥æ›´æ–°")}})}async function quickStartSelectedTask(){if(!selectedTask.value)return;const t=String(selectedTask.value.key),e=Math.max(10,Number(selectedTask.value.progress||0));selectedTask.value.status="active",selectedTask.value.progress=e,selectedTask.value.startedAt=new Date().toISOString(),await taskSyncStore.updateTask(String(projectInfo.value.id),t,{status:"active",progress:e,startedAt:selectedTask.value.startedAt}),generateTimeline(),api.success("ä»»åŠ¡å·²å¼€å§‹")}const syncFromCache=()=>{try{const t=taskSyncStore.getProjectTasks(projectInfo.value.id),e=new Map,a=o=>{if(o&&o.key!=null)return String(o.key);if(o&&o.taskKey){const n=String(o.taskKey),r=n.indexOf("_");return r>=0?n.slice(r+1):n}return o&&o.id!=null?String(o.id):""};t.forEach(o=>{const n=a(o);n&&e.set(n,o)});const l=o=>{o.forEach(n=>{const r=String(n.key),d=e.get(r);d&&(d.progress!==void 0&&(n.progress=d.progress),d.status&&(n.status=d.status)),n.children&&l(n.children)})};l(wbsData.value),generateTimeline(),api.success("å·²ä»Žç¼“å­˜åˆ·æ–°ä»»åŠ¡è¿›åº¦")}catch(t){console.warn("syncFromCache failed",t),api.error("åˆ·æ–°å¤±è´¥")}};return onMounted(()=>{String(projectInfo.value.id)==="10001"&&(wbsData.value=[{title:"è”è°ƒ-å‰ç«¯é›†æˆä¸ŽéªŒè¯",key:9001,status:"active",progress:30,responsible:"å¼ ä¸‰(æ¼”ç¤ºè´¦å·)",assignedTo:{id:99,name:"å¼ ä¸‰(æ¼”ç¤ºè´¦å·)",role:"developer"},description:"åœ¨çœ‹æ¿ä¾§æ›´æ–°è¿›åº¦ä¸Žè¯„è®ºï¼ŒéªŒè¯é¡¹ç›®ç›‘æŽ§ä¾§å®žæ—¶è”åŠ¨",startDate:"2025-01-22",endDate:"2025-02-15",duration:25,isCritical:!1},{title:"è”è°ƒ-ææ–™æäº¤æµè½¬",key:9002,status:"pending",progress:0,responsible:"å¼ ä¸‰(æ¼”ç¤ºè´¦å·)",assignedTo:{id:99,name:"å¼ ä¸‰(æ¼”ç¤ºè´¦å·)",role:"developer"},description:"ä»Žæ¨¡æ¿å¸¦å‡ºææ–™ï¼Œæˆå‘˜æäº¤ï¼ŒPMé¢„å®¡å¹¶è½¬ç®¡ç†å±‚",startDate:"2025-02-01",endDate:"2025-02-20",duration:20,isCritical:!1}]),taskSyncStore.registerWBSProject(projectInfo.value.id,wbsData.value),setupRealTimeSync(),generateTimeline();const t=flatTasks.value.find(e=>e.status==="active");t&&(selectedKeys.value=[t.key],selectedTask.value=t),window.addEventListener("resize",handleResize),nextTick(()=>{setupGanttScrollSync()}),window.addEventListener("taskDataUpdated",handleTaskDataUpdated),api.success("å·²æŽ¥ç®¡å½“å‰é¡¹ç›®çš„å®žæ—¶ä»»åŠ¡æ›´æ–°ï¼Œå›¢é˜Ÿæˆå‘˜çš„è¿›åº¦ä¸Žææ–™æäº¤å°†å®žæ—¶æ˜¾ç¤ºã€‚")}),onUnmounted(()=>{window.removeEventListener("resize",handleResize),window.removeEventListener("taskDataUpdated",handleTaskDataUpdated),ganttScrollCleanup.value&&ganttScrollCleanup.value()}),(t,e)=>{const a=resolveComponent("a-button"),l=resolveComponent("a-tag"),o=resolveComponent("a-progress"),n=resolveComponent("a-segmented"),r=resolveComponent("a-menu-item"),d=resolveComponent("a-menu-divider"),c=resolveComponent("a-menu"),u=resolveComponent("a-dropdown"),g=resolveComponent("a-space"),v=resolveComponent("a-badge"),T=resolveComponent("a-sub-menu"),f=resolveComponent("a-tooltip"),h=resolveComponent("a-tree"),V=resolveComponent("a-avatar"),_=resolveComponent("a-select-option"),D=resolveComponent("a-select"),S=resolveComponent("a-input"),N=resolveComponent("a-checkbox"),W=resolveComponent("a-checkbox-group"),$=resolveComponent("a-empty"),U=resolveComponent("a-card"),b=resolveComponent("a-radio-button"),Y=resolveComponent("a-radio-group"),y=resolveComponent("a-form-item"),G=resolveComponent("a-slider"),z=resolveComponent("a-textarea"),B=resolveComponent("a-date-picker"),I=resolveComponent("a-form"),x=resolveComponent("a-modal"),Q=resolveComponent("a-switch"),p=resolveComponent("a-descriptions-item"),M=resolveComponent("a-descriptions"),E=resolveComponent("a-tab-pane"),X=resolveComponent("a-input-group"),R=resolveComponent("a-timeline-item"),A=resolveComponent("a-timeline"),J=resolveComponent("a-tabs"),j=resolveComponent("a-list-item-meta"),O=resolveComponent("a-list-item"),P=resolveComponent("a-list"),Z=resolveComponent("a-image"),K=resolveComponent("a-divider"),ee=resolveComponent("a-table"),te=resolveComponent("a-drawer");return openBlock(),createElementBlock(Fragment,null,[createBaseVNode("div",_hoisted_1,[createBaseVNode("div",_hoisted_2,[createBaseVNode("div",_hoisted_3,[createVNode(a,{type:"text",onClick:goBack,class:"back-btn"},{default:withCtx(()=>[createVNode(unref(ArrowLeftOutlined)),e[33]||(e[33]=createTextVNode(" è¿”å›ž "))]),_:1,__:[33]}),createBaseVNode("div",_hoisted_4,[createBaseVNode("h1",_hoisted_5,toDisplayString(projectInfo.value.name),1),createBaseVNode("div",_hoisted_6,[createVNode(l,{color:"blue"},{default:withCtx(()=>[createTextVNode(toDisplayString(projectInfo.value.code),1)]),_:1}),createVNode(l,{color:getStatusColor(projectInfo.value.status)},{default:withCtx(()=>[createTextVNode(toDisplayString(getStatusText(projectInfo.value.status)),1)]),_:1},8,["color"]),createBaseVNode("span",_hoisted_7,toDisplayString(projectInfo.value.startDate)+" - "+toDisplayString(projectInfo.value.endDate),1)])])]),createBaseVNode("div",_hoisted_8,[createVNode(o,{type:"circle",percent:projectInfo.value.progress,size:80,"stroke-color":getProgressColor(projectInfo.value.progress)},null,8,["percent","stroke-color"]),createBaseVNode("div",_hoisted_9,[e[34]||(e[34]=createBaseVNode("div",{class:"progress-text"},"æ•´ä½“è¿›åº¦",-1)),createBaseVNode("div",_hoisted_10,toDisplayString(projectInfo.value.progress)+"%",1)])])]),createBaseVNode("div",{class:"monitor-content",ref_key:"monitorContentRef",ref:monitorContentRef},[createBaseVNode("div",{class:"left-panel",style:normalizeStyle({width:leftPanelWidth.value+"px"}),ref_key:"leftPanelRef",ref:leftPanelRef},[createVNode(U,{title:"ðŸ“‹ WBSä»»åŠ¡ç»“æž„ä¸Žè¯¦æƒ…",size:"small",class:"wbs-combined-card"},{extra:withCtx(()=>[createVNode(g,null,{default:withCtx(()=>[createVNode(a,{type:wbsEditMode.value?"primary":"default",size:"small",onClick:toggleWBSEditMode},{default:withCtx(()=>[createVNode(unref(EditOutlined)),createTextVNode(" "+toDisplayString(wbsEditMode.value?"å®Œæˆç¼–è¾‘":"ç¼–è¾‘ç»“æž„"),1)]),_:1},8,["type"]),createVNode(n,{value:wbsViewMode.value,"onUpdate:value":e[0]||(e[0]=s=>wbsViewMode.value=s),options:[{label:"æ ‘è§†å›¾",value:"tree"},{label:"è¡¨æ ¼è§†å›¾",value:"table"}],size:"small",onChange:handleViewModeChange},null,8,["value"]),isTableDrawerOpen.value?(openBlock(),createBlock(a,{key:0,size:"small",onClick:batchStart,disabled:selectedRowKeys.value.length===0},{default:withCtx(()=>e[35]||(e[35]=[createTextVNode("æ‰¹é‡å¼€å§‹")])),_:1,__:[35]},8,["disabled"])):createCommentVNode("",!0),isTableDrawerOpen.value?(openBlock(),createBlock(a,{key:1,size:"small",onClick:batchComplete,disabled:selectedRowKeys.value.length===0},{default:withCtx(()=>e[36]||(e[36]=[createTextVNode("æ‰¹é‡å®Œæˆ")])),_:1,__:[36]},8,["disabled"])):createCommentVNode("",!0),wbsEditMode.value?(openBlock(),createBlock(u,{key:2,trigger:"['click']"},{overlay:withCtx(()=>[createVNode(c,null,{default:withCtx(()=>[createVNode(r,{onClick:e[1]||(e[1]=s=>addTopLevelMilestone(lastMilestoneType.value||"opening"))},{default:withCtx(()=>[createTextVNode("æŒ‰æœ€è¿‘ç±»åž‹ï¼ˆ"+toDisplayString(getMilestoneTitleByType(lastMilestoneType.value||"opening"))+"ï¼‰",1)]),_:1}),createVNode(d),createVNode(r,{onClick:e[2]||(e[2]=s=>addTopLevelMilestone("opening"))},{default:withCtx(()=>e[38]||(e[38]=[createTextVNode("å¼€é¢˜é‡Œç¨‹ç¢‘")])),_:1,__:[38]}),createVNode(r,{onClick:e[3]||(e[3]=s=>addTopLevelMilestone("midterm"))},{default:withCtx(()=>e[39]||(e[39]=[createTextVNode("ä¸­æœŸé‡Œç¨‹ç¢‘")])),_:1,__:[39]}),createVNode(r,{onClick:e[4]||(e[4]=s=>addTopLevelMilestone("acceptance"))},{default:withCtx(()=>e[40]||(e[40]=[createTextVNode("éªŒæ”¶é‡Œç¨‹ç¢‘")])),_:1,__:[40]})]),_:1})]),default:withCtx(()=>[createVNode(a,{type:"primary",size:"small"},{default:withCtx(()=>[createVNode(unref(PlusOutlined)),e[37]||(e[37]=createTextVNode(" é¡¶çº§é‡Œç¨‹ç¢‘ "))]),_:1,__:[37]})]),_:1})):createCommentVNode("",!0),createVNode(a,{type:"text",size:"small",onClick:expandAll},{default:withCtx(()=>[createVNode(unref(PlusSquareOutlined)),e[41]||(e[41]=createTextVNode(" å±•å¼€å…¨éƒ¨ "))]),_:1,__:[41]}),createVNode(a,{type:"text",size:"small",onClick:collapseAll},{default:withCtx(()=>[createVNode(unref(MinusSquareOutlined)),e[42]||(e[42]=createTextVNode(" æ”¶èµ·å…¨éƒ¨ "))]),_:1,__:[42]})]),_:1})]),default:withCtx(()=>[createBaseVNode("div",{class:normalizeClass(["wbs-container",{"edit-mode-container":wbsEditMode.value,"force-show-task-detail":forceShowTaskDetail.value}])},[createBaseVNode("div",_hoisted_11,[createVNode(h,{expandedKeys:expandedKeys.value,"onUpdate:expandedKeys":e[6]||(e[6]=s=>expandedKeys.value=s),selectedKeys:selectedKeys.value,"onUpdate:selectedKeys":e[7]||(e[7]=s=>selectedKeys.value=s),"tree-data":wbsData.value,onSelect:onTaskSelect,class:normalizeClass(["wbs-tree",{"edit-mode-active":wbsEditMode.value}]),draggable:wbsEditMode.value,onDrop:handleTreeDrop},{title:withCtx(({key:s,title:i,status:k,progress:C,responsible:ae,assignedTo:q,children:H,isMilestone:w,milestoneType:F,materials:L})=>[createBaseVNode("div",{class:normalizeClass(["tree-node",{"edit-mode":wbsEditMode.value,"milestone-node":w,[`milestone-${F}`]:w&&F}])},[createBaseVNode("div",_hoisted_12,[createBaseVNode("span",{class:normalizeClass(["node-title",{"milestone-title":w}])},toDisplayString(i),3),getTaskUnreadBadge(String(projectInfo.value.id),String(s))>0?(openBlock(),createBlock(v,{key:0,count:getTaskUnreadBadge(String(projectInfo.value.id),String(s)),"overflow-count":99,class:"node-unread-badge"},null,8,["count"])):createCommentVNode("",!0),createVNode(l,{color:w?getMilestoneStatusColor(k):getTaskStatusColor(k),size:"small",class:"node-status"},{default:withCtx(()=>[createTextVNode(toDisplayString(w?getMilestoneStatusText(k):getTaskStatusText(k)),1)]),_:2},1032,["color"]),w?(openBlock(),createBlock(v,{key:1,count:L&&L.length||0,color:"#1890ff",size:"small"},null,8,["count"])):createCommentVNode("",!0)]),createBaseVNode("div",_hoisted_13,[createBaseVNode("div",_hoisted_14,[createVNode(o,{percent:C,size:"small","show-info":!1,"stroke-color":w?getMilestoneProgressColor(C):getProgressColor(C)},null,8,["percent","stroke-color"]),createBaseVNode("span",_hoisted_15,toDisplayString(C)+"%",1)]),createBaseVNode("span",_hoisted_16,toDisplayString(q&&q.name||ae||"æœªåˆ†é…"),1),w&&k==="upcoming"?(openBlock(),createElementBlock("div",_hoisted_17,[createVNode(a,{type:"primary",size:"small",onClick:withModifiers(m=>prepareMilestoneFromWBS(s,i,F),["stop"])},{default:withCtx(()=>[createVNode(unref(FileTextOutlined)),e[43]||(e[43]=createTextVNode(" å‡†å¤‡ææ–™ "))]),_:2,__:[43]},1032,["onClick"])])):createCommentVNode("",!0)]),wbsEditMode.value?(openBlock(),createElementBlock("div",{key:0,class:"node-actions",onClick:e[5]||(e[5]=withModifiers(()=>{},["stop"]))},[createVNode(u,{trigger:"['click']"},{overlay:withCtx(()=>[createVNode(c,null,{default:withCtx(()=>[createVNode(r,{onClick:m=>addChildTask(s)},{default:withCtx(()=>e[44]||(e[44]=[createTextVNode("+ å­ä»»åŠ¡")])),_:2,__:[44]},1032,["onClick"]),createVNode(r,{onClick:m=>addSiblingTask(s)},{default:withCtx(()=>e[45]||(e[45]=[createTextVNode("+ åŒçº§ä»»åŠ¡")])),_:2,__:[45]},1032,["onClick"]),createVNode(T,{title:"+ é‡Œç¨‹ç¢‘ï¼ˆå­çº§ï¼‰"},{default:withCtx(()=>[createVNode(r,{onClick:m=>addMilestoneChild(s,"opening")},{default:withCtx(()=>e[46]||(e[46]=[createTextVNode("å¼€é¢˜")])),_:2,__:[46]},1032,["onClick"]),createVNode(r,{onClick:m=>addMilestoneChild(s,"midterm")},{default:withCtx(()=>e[47]||(e[47]=[createTextVNode("ä¸­æœŸ")])),_:2,__:[47]},1032,["onClick"]),createVNode(r,{onClick:m=>addMilestoneChild(s,"acceptance")},{default:withCtx(()=>e[48]||(e[48]=[createTextVNode("éªŒæ”¶")])),_:2,__:[48]},1032,["onClick"]),createVNode(d),createVNode(r,{onClick:m=>addMilestoneChild(s,lastMilestoneType.value||"opening")},{default:withCtx(()=>[createTextVNode("æŒ‰æœ€è¿‘ç±»åž‹ï¼ˆ"+toDisplayString(getMilestoneTitleByType(lastMilestoneType.value||"opening"))+"ï¼‰",1)]),_:2},1032,["onClick"])]),_:2},1024),createVNode(T,{title:"+ é‡Œç¨‹ç¢‘ï¼ˆåŒçº§ï¼‰"},{default:withCtx(()=>[createVNode(r,{onClick:m=>addMilestoneSibling(s,"opening")},{default:withCtx(()=>e[49]||(e[49]=[createTextVNode("å¼€é¢˜")])),_:2,__:[49]},1032,["onClick"]),createVNode(r,{onClick:m=>addMilestoneSibling(s,"midterm")},{default:withCtx(()=>e[50]||(e[50]=[createTextVNode("ä¸­æœŸ")])),_:2,__:[50]},1032,["onClick"]),createVNode(r,{onClick:m=>addMilestoneSibling(s,"acceptance")},{default:withCtx(()=>e[51]||(e[51]=[createTextVNode("éªŒæ”¶")])),_:2,__:[51]},1032,["onClick"]),createVNode(d),createVNode(r,{onClick:m=>addMilestoneSibling(s,lastMilestoneType.value||"opening")},{default:withCtx(()=>[createTextVNode("æŒ‰æœ€è¿‘ç±»åž‹ï¼ˆ"+toDisplayString(getMilestoneTitleByType(lastMilestoneType.value||"opening"))+"ï¼‰",1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),default:withCtx(()=>[createVNode(a,{type:"text",size:"small",class:"action-btn"},{default:withCtx(()=>[createVNode(unref(PlusOutlined))]),_:1})]),_:2},1024),createVNode(f,{title:"ç¼–è¾‘ä»»åŠ¡"},{default:withCtx(()=>[createVNode(a,{type:"text",size:"small",onClick:m=>editWBSTask(s),class:"action-btn"},{default:withCtx(()=>[createVNode(unref(EditOutlined))]),_:2},1032,["onClick"])]),_:2},1024),createVNode(f,{title:"å·¦ç§»ï¼ˆåç¼©è¿›ï¼‰"},{default:withCtx(()=>[createVNode(a,{type:"text",size:"small",onClick:m=>outdentTask(s),class:"action-btn"},{default:withCtx(()=>[createVNode(unref(LeftOutlined))]),_:2},1032,["onClick"])]),_:2},1024),createVNode(f,{title:"å³ç§»ï¼ˆç¼©è¿›ï¼‰"},{default:withCtx(()=>[createVNode(a,{type:"text",size:"small",onClick:m=>indentTask(s),class:"action-btn"},{default:withCtx(()=>[createVNode(unref(RightOutlined))]),_:2},1032,["onClick"])]),_:2},1024),createVNode(f,{title:"ä¸Šç§»"},{default:withCtx(()=>[createVNode(a,{type:"text",size:"small",onClick:m=>moveTaskUp(s),class:"action-btn",disabled:!canMoveUp(s)},{default:withCtx(()=>[createVNode(unref(ArrowUpOutlined))]),_:2},1032,["onClick","disabled"])]),_:2},1024),createVNode(f,{title:"ä¸‹ç§»"},{default:withCtx(()=>[createVNode(a,{type:"text",size:"small",onClick:m=>moveTaskDown(s),class:"action-btn",disabled:!canMoveDown(s)},{default:withCtx(()=>[createVNode(unref(ArrowDownOutlined))]),_:2},1032,["onClick","disabled"])]),_:2},1024),createVNode(f,{title:"åˆ é™¤ä»»åŠ¡"},{default:withCtx(()=>[createVNode(a,{type:"text",size:"small",onClick:m=>deleteWBSTask(s),class:"action-btn delete-btn",disabled:H&&H.length>0},{default:withCtx(()=>[createVNode(unref(DeleteOutlined))]),_:2},1032,["onClick","disabled"])]),_:2},1024),createVNode(u,{trigger:"['click']"},{overlay:withCtx(()=>[createVNode(c,null,{default:withCtx(()=>[createVNode(r,{onClick:m=>toggleMilestone(s,!0)},{default:withCtx(()=>e[52]||(e[52]=[createTextVNode("è®¾ä¸ºé‡Œç¨‹ç¢‘")])),_:2,__:[52]},1032,["onClick"]),createVNode(r,{onClick:m=>toggleMilestone(s,!1)},{default:withCtx(()=>e[53]||(e[53]=[createTextVNode("å–æ¶ˆé‡Œç¨‹ç¢‘")])),_:2,__:[53]},1032,["onClick"])]),_:2},1024)]),default:withCtx(()=>[createVNode(a,{type:"text",size:"small",class:"action-btn"},{default:withCtx(()=>[createVNode(unref(MoreOutlined))]),_:1})]),_:2},1024)])):createCommentVNode("",!0)],2)]),_:1},8,["expandedKeys","selectedKeys","tree-data","class","draggable"])]),e[84]||(e[84]=createBaseVNode("div",{class:"wbs-divider"},null,-1)),createBaseVNode("div",_hoisted_18,[selectedTask.value?(openBlock(),createElementBlock("div",_hoisted_19,[createBaseVNode("div",_hoisted_20,[e[57]||(e[57]=createBaseVNode("h3",{class:"detail-panel-title"},"ä»»åŠ¡è¯¦æƒ…",-1)),createBaseVNode("div",_hoisted_21,[createVNode(a,{type:"default",size:"small",onClick:openOperationHistory,class:"history-btn",title:"æŸ¥çœ‹æ“ä½œåŽ†å²"},{default:withCtx(()=>{var s,i;return[createVNode(unref(FileTextOutlined)),e[54]||(e[54]=createTextVNode(" æ“ä½œåŽ†å² ")),getTaskUnreadBadge(String(projectInfo.value.id),String((s=selectedTask.value)==null?void 0:s.key))>0?(openBlock(),createBlock(v,{key:0,count:getTaskUnreadBadge(String(projectInfo.value.id),String((i=selectedTask.value)==null?void 0:i.key)),"overflow-count":99,style:{"margin-left":"6px"}},null,8,["count"])):createCommentVNode("",!0)]}),_:1,__:[54]}),createVNode(a,{type:"primary",size:"small",onClick:openTaskEditModal,class:"edit-btn",title:"ç¼–è¾‘ä»»åŠ¡ (Ctrl+E)"},{default:withCtx(()=>[createVNode(unref(EditOutlined)),e[55]||(e[55]=createTextVNode(" ç¼–è¾‘ "))]),_:1,__:[55]}),createVNode(a,{type:"default",size:"small",onClick:duplicateTask,class:"duplicate-btn",title:"å¤åˆ¶ä»»åŠ¡ (Ctrl+D)"},{default:withCtx(()=>[createVNode(unref(CopyOutlined)),e[56]||(e[56]=createTextVNode(" å¤åˆ¶ "))]),_:1,__:[56]}),createVNode(a,{type:"text",size:"small",onClick:clearTaskSelection,class:"close-btn",title:"æ¸…é™¤é€‰ä¸­ (Esc)"},{default:withCtx(()=>[createVNode(unref(CloseOutlined))]),_:1})])]),createBaseVNode("div",_hoisted_22,[createBaseVNode("h4",_hoisted_23,toDisplayString(selectedTask.value.title),1),createBaseVNode("div",_hoisted_24,[createVNode(l,{color:getTaskStatusColor(selectedTask.value.status)},{default:withCtx(()=>[createTextVNode(toDisplayString(getTaskStatusText(selectedTask.value.status)),1)]),_:1},8,["color"]),selectedTask.value.isCritical?(openBlock(),createBlock(l,{key:0,color:"red"},{default:withCtx(()=>e[58]||(e[58]=[createTextVNode(" å…³é”®è·¯å¾„ ")])),_:1,__:[58]})):createCommentVNode("",!0)])]),createBaseVNode("div",_hoisted_25,[e[59]||(e[59]=createBaseVNode("label",null,"ä»»åŠ¡æè¿°:",-1)),createBaseVNode("div",_hoisted_26,toDisplayString(selectedTask.value.description||"æš‚æ— æè¿°"),1)]),createBaseVNode("div",_hoisted_27,[createBaseVNode("div",_hoisted_28,[e[62]||(e[62]=createBaseVNode("label",null,"å®Œæˆè¿›åº¦:",-1)),createBaseVNode("div",_hoisted_29,[createBaseVNode("div",_hoisted_30,[createVNode(o,{percent:selectedTask.value.progress,size:"small","show-info":!1},null,8,["percent"]),createBaseVNode("span",_hoisted_31,toDisplayString(selectedTask.value.progress)+"%",1)]),selectedTask.value.status==="pending"?(openBlock(),createBlock(a,{key:0,type:"primary",size:"small",onClick:quickStartSelectedTask,class:"progress-update-btn"},{default:withCtx(()=>[createVNode(unref(PlayCircleOutlined)),e[60]||(e[60]=createTextVNode(" å¼€å§‹ä»»åŠ¡ "))]),_:1,__:[60]})):createCommentVNode("",!0),createVNode(a,{type:"primary",size:"small",onClick:updateTaskProgress,class:"progress-update-btn"},{default:withCtx(()=>[createVNode(unref(EditOutlined)),e[61]||(e[61]=createTextVNode(" æ›´æ–°è¿›åº¦ "))]),_:1,__:[61]})])]),createBaseVNode("div",_hoisted_32,[e[63]||(e[63]=createBaseVNode("label",null,"è´Ÿè´£äºº:",-1)),createBaseVNode("div",_hoisted_33,[createBaseVNode("div",_hoisted_34,[selectedTask.value.assignedTo?(openBlock(),createElementBlock("div",_hoisted_35,[createVNode(V,{size:"small"},{default:withCtx(()=>[createTextVNode(toDisplayString(selectedTask.value.assignedTo.name.charAt(0)),1)]),_:1}),createBaseVNode("span",null,toDisplayString(selectedTask.value.assignedTo.name),1),createVNode(l,{size:"small"},{default:withCtx(()=>[createTextVNode(toDisplayString(selectedTask.value.assignedTo.role),1)]),_:1})])):(openBlock(),createElementBlock("span",_hoisted_36,"æœªåˆ†é…"))]),createVNode(a,{type:"default",size:"small",onClick:e[8]||(e[8]=s=>showAssignSelect.value=!showAssignSelect.value),class:"assign-btn"},{default:withCtx(()=>[createVNode(unref(UserOutlined)),createTextVNode(" "+toDisplayString(selectedTask.value.assignedTo?"é‡æ–°åˆ†é…":"åˆ†é…æˆå‘˜"),1)]),_:1})]),showAssignSelect.value?(openBlock(),createElementBlock("div",_hoisted_37,[createVNode(D,{value:selectedTask.value&&selectedTask.value.assignedTo&&selectedTask.value.assignedTo.id,placeholder:"é€‰æ‹©å›¢é˜Ÿæˆå‘˜",size:"small","allow-clear":"",style:{width:"100%"},onChange:handleQuickAssignAndHide,onBlur:hideAssignSelect},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(availableTeamMembers.value,s=>(openBlock(),createBlock(_,{key:s.id,value:s.id},{default:withCtx(()=>[createBaseVNode("div",_hoisted_38,[createVNode(V,{size:"small"},{default:withCtx(()=>[createTextVNode(toDisplayString(s.name.charAt(0)),1)]),_:2},1024),createBaseVNode("span",null,toDisplayString(s.name),1),createBaseVNode("small",_hoisted_39,"("+toDisplayString(s.role)+")",1)])]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])):createCommentVNode("",!0)])]),createBaseVNode("div",_hoisted_40,[e[67]||(e[67]=createBaseVNode("label",null,"é‡Œç¨‹ç¢‘ç±»åž‹:",-1)),createBaseVNode("div",_hoisted_41,[createVNode(D,{value:selectedTask.value.milestoneType,"onUpdate:value":e[9]||(e[9]=s=>selectedTask.value.milestoneType=s),placeholder:"é€‰æ‹©é‡Œç¨‹ç¢‘ç±»åž‹",size:"small","allow-clear":"",style:{width:"100%"},onChange:handleMilestoneTypeChange},{default:withCtx(()=>[createVNode(_,{value:"opening"},{default:withCtx(()=>e[64]||(e[64]=[createTextVNode("é¡¹ç›®å¼€é¢˜")])),_:1,__:[64]}),createVNode(_,{value:"midterm"},{default:withCtx(()=>e[65]||(e[65]=[createTextVNode("é¡¹ç›®ä¸­æœŸ")])),_:1,__:[65]}),createVNode(_,{value:"acceptance"},{default:withCtx(()=>e[66]||(e[66]=[createTextVNode("é¡¹ç›®éªŒæ”¶")])),_:1,__:[66]})]),_:1},8,["value"])])]),selectedTask.value.milestoneType||selectedTask.value.allowMaterialUpload?(openBlock(),createElementBlock("div",_hoisted_42,[e[70]||(e[70]=createBaseVNode("label",null,"ææ–™éœ€æ±‚:",-1)),createBaseVNode("div",_hoisted_43,[(openBlock(!0),createElementBlock(Fragment,null,renderList(selectedTask.value.materialRequirements||[],(s,i)=>(openBlock(),createElementBlock("div",{key:i,class:"material-item"},[createBaseVNode("div",_hoisted_44,[createVNode(S,{value:s.name,"onUpdate:value":k=>s.name=k,placeholder:"ææ–™åç§°",size:"small",style:{flex:"1"}},null,8,["value","onUpdate:value"]),createVNode(l,{color:s.required?"red":"blue",size:"small"},{default:withCtx(()=>[createTextVNode(toDisplayString(s.required?"å¿…éœ€":"å¯é€‰"),1)]),_:2},1032,["color"]),s.fromTemplate?(openBlock(),createBlock(l,{key:0,color:"green",size:"small"},{default:withCtx(()=>e[68]||(e[68]=[createTextVNode(" æ¨¡æ¿ ")])),_:1,__:[68]})):createCommentVNode("",!0),s.templateFileName?(openBlock(),createBlock(f,{key:1,title:`æ¨¡æ¿æ–‡ä»¶: ${s.templateFileName}`},{default:withCtx(()=>[createVNode(unref(FileOutlined),{style:{color:"#1890ff",margin:"0 4px"}})]),_:2},1032,["title"])):createCommentVNode("",!0),createVNode(a,{type:"text",danger:"",size:"small",onClick:k=>removeMaterialRequirement(i)},{default:withCtx(()=>[createVNode(unref(DeleteOutlined))]),_:2},1032,["onClick"])]),s.description?(openBlock(),createElementBlock("div",_hoisted_45,[createBaseVNode("span",_hoisted_46,toDisplayString(s.description),1)])):createCommentVNode("",!0)]))),128)),createVNode(a,{type:"dashed",size:"small",onClick:addMaterialRequirement,style:{width:"100%","margin-top":"8px"}},{default:withCtx(()=>[createVNode(unref(PlusOutlined)),e[69]||(e[69]=createTextVNode(" æ·»åŠ ææ–™éœ€æ±‚ "))]),_:1,__:[69]})])])):createCommentVNode("",!0),createBaseVNode("div",_hoisted_47,[e[77]||(e[77]=createBaseVNode("label",null,"ä»»åŠ¡è®¾ç½®:",-1)),createBaseVNode("div",_hoisted_48,[createVNode(N,{checked:!!(selectedTask.value.reminders&&selectedTask.value.reminders.enabled),onChange:handleReminderChange},{default:withCtx(()=>e[71]||(e[71]=[createTextVNode(" å¯ç”¨ä»»åŠ¡æé†’ ")])),_:1,__:[71]},8,["checked"]),createVNode(N,{style:{"margin-left":"12px"},checked:!!selectedTask.value.allowMaterialUpload,onChange:handleAllowMaterialUploadChange},{default:withCtx(()=>e[72]||(e[72]=[createTextVNode(" å…è®¸ææ–™ä¸Šä¼ ï¼ˆéžé‡Œç¨‹ç¢‘ï¼‰ ")])),_:1,__:[72]},8,["checked"]),selectedTask.value.reminders&&selectedTask.value.reminders.enabled?(openBlock(),createElementBlock("div",_hoisted_49,[e[76]||(e[76]=createBaseVNode("span",{style:{"font-size":"12px",color:"#666"}},"æå‰æé†’æ—¶é—´ï¼š",-1)),createVNode(W,{value:selectedTask.value.reminders.beforeDeadline,"onUpdate:value":e[10]||(e[10]=s=>selectedTask.value.reminders.beforeDeadline=s),size:"small"},{default:withCtx(()=>[createVNode(N,{value:7},{default:withCtx(()=>e[73]||(e[73]=[createTextVNode("7å¤©")])),_:1,__:[73]}),createVNode(N,{value:3},{default:withCtx(()=>e[74]||(e[74]=[createTextVNode("3å¤©")])),_:1,__:[74]}),createVNode(N,{value:1},{default:withCtx(()=>e[75]||(e[75]=[createTextVNode("1å¤©")])),_:1,__:[75]})]),_:1},8,["value"])])):createCommentVNode("",!0)])]),createBaseVNode("div",_hoisted_50,[createBaseVNode("div",_hoisted_51,[e[78]||(e[78]=createBaseVNode("label",null,"å¼€å§‹æ—¶é—´:",-1)),createBaseVNode("span",null,toDisplayString(selectedTask.value.startDate),1)]),createBaseVNode("div",_hoisted_52,[e[79]||(e[79]=createBaseVNode("label",null,"ç»“æŸæ—¶é—´:",-1)),createBaseVNode("span",null,toDisplayString(selectedTask.value.endDate),1)]),createBaseVNode("div",_hoisted_53,[e[80]||(e[80]=createBaseVNode("label",null,"æŒç»­æ—¶é—´:",-1)),createBaseVNode("span",null,toDisplayString(selectedTask.value.duration)+" å¤©",1)])]),createBaseVNode("div",_hoisted_54,[createVNode(g,null,{default:withCtx(()=>[createVNode(a,{type:"primary",size:"small",onClick:saveTaskAssignment,disabled:!selectedTask.value.assignedTo},{default:withCtx(()=>e[81]||(e[81]=[createTextVNode(" ä¿å­˜åˆ†é… ")])),_:1,__:[81]},8,["disabled"]),createVNode(a,{size:"small",onClick:sendTaskNotification,disabled:!selectedTask.value.assignedTo},{default:withCtx(()=>e[82]||(e[82]=[createTextVNode(" å‘é€é€šçŸ¥ ")])),_:1,__:[82]},8,["disabled"])]),_:1})])])):(openBlock(),createElementBlock("div",_hoisted_55,[createVNode($,{description:"ç‚¹å‡»å·¦ä¾§ä»»åŠ¡èŠ‚ç‚¹æŸ¥çœ‹è¯¦æƒ…",image:!1,class:"empty-hint"},{image:withCtx(()=>e[83]||(e[83]=[createBaseVNode("div",{class:"empty-icon"},"ðŸ“‹",-1)])),_:1})]))])],2)]),_:1})],4),createBaseVNode("div",{class:"resize-handle",onMousedown:startResize,title:"æ‹–æ‹½è°ƒæ•´WBSé¢æ¿å®½åº¦"},e[85]||(e[85]=[createBaseVNode("div",{class:"resize-line"},null,-1)]),32),createBaseVNode("div",{class:"right-panel",style:normalizeStyle({width:rightPanelWidth.value+"px"})},[createVNode(U,{title:"ðŸ“Š é¡¹ç›®è¿›åº¦ç”˜ç‰¹å›¾",size:"small",class:"gantt-card"},{extra:withCtx(()=>[createVNode(g,null,{default:withCtx(()=>[createVNode(v,{count:projectUnreadCount.value,"overflow-count":99},{default:withCtx(()=>[createVNode(a,{size:"small",onClick:markAllRead},{default:withCtx(()=>[createVNode(unref(BellOutlined)),e[86]||(e[86]=createTextVNode(" æ›´æ–°æé†’ "))]),_:1,__:[86]})]),_:1},8,["count"]),createVNode(a,{size:"small",onClick:syncFromCache},{default:withCtx(()=>[createVNode(unref(SyncOutlined)),e[87]||(e[87]=createTextVNode(" åˆ·æ–°è¿›åº¦ "))]),_:1,__:[87]}),createVNode(a,{danger:"",size:"small",onClick:resetProjectProgress},{default:withCtx(()=>e[88]||(e[88]=[createTextVNode(" é‡ç½®é¡¹ç›®è¿›åº¦ ")])),_:1,__:[88]}),createVNode(a,{danger:"",size:"small",onClick:resetSelectedTask,disabled:!selectedTask.value},{default:withCtx(()=>e[89]||(e[89]=[createTextVNode(" é‡ç½®é€‰ä¸­ä»»åŠ¡ ")])),_:1,__:[89]},8,["disabled"]),createVNode(Y,{value:timeScale.value,"onUpdate:value":e[11]||(e[11]=s=>timeScale.value=s),size:"small"},{default:withCtx(()=>[createVNode(b,{value:"month"},{default:withCtx(()=>e[90]||(e[90]=[createTextVNode("æœˆ")])),_:1,__:[90]}),createVNode(b,{value:"week"},{default:withCtx(()=>e[91]||(e[91]=[createTextVNode("å‘¨")])),_:1,__:[91]}),createVNode(b,{value:"day"},{default:withCtx(()=>e[92]||(e[92]=[createTextVNode("æ—¥")])),_:1,__:[92]})]),_:1},8,["value"]),createVNode(a,{type:"primary",size:"small",onClick:refreshGantt},{default:withCtx(()=>[createVNode(unref(ReloadOutlined)),e[93]||(e[93]=createTextVNode(" åˆ·æ–° "))]),_:1,__:[93]})]),_:1})]),default:withCtx(()=>[createBaseVNode("div",{class:"gantt-container",ref_key:"ganttContainerRef",ref:ganttContainerRef},[createBaseVNode("div",{class:"gantt-header",ref_key:"ganttHeaderRef",ref:ganttHeaderRef},[createBaseVNode("div",{class:"gantt-timeline",ref_key:"ganttTimelineRef",ref:ganttTimelineRef},[(openBlock(!0),createElementBlock(Fragment,null,renderList(timelineData.value,s=>(openBlock(),createElementBlock("div",{key:s.key,class:"timeline-unit",style:normalizeStyle({width:s.width+"px"})},toDisplayString(s.label),5))),128))],512)],512),createBaseVNode("div",{class:"gantt-body",ref_key:"ganttBodyRef",ref:ganttBodyRef},[(openBlock(!0),createElementBlock(Fragment,null,renderList(visibleGanttTasks.value,s=>(openBlock(),createElementBlock("div",{key:s.key,class:normalizeClass(["gantt-row",{selected:selectedKeys.value.includes(s.key),"parent-task":s.children&&s.children.length>0,"child-task":s.level>0,"milestone-row":s.isMilestone,[`milestone-${s.milestoneType}`]:s.isMilestone&&s.milestoneType}]),"data-task-key":s.key,style:normalizeStyle({"padding-left":s.level*20+"px"}),onClick:i=>selectTask(s.key)},[createBaseVNode("div",_hoisted_57,[createBaseVNode("div",_hoisted_58,[s.children&&s.children.length>0?(openBlock(),createBlock(a,{key:0,type:"text",size:"small",class:"expand-btn",onClick:withModifiers(i=>toggleTaskExpand(s.key),["stop"])},{default:withCtx(()=>[expandedKeys.value.includes(s.key)?(openBlock(),createBlock(unref(DownOutlined),{key:0})):(openBlock(),createBlock(unref(RightOutlined),{key:1}))]),_:2},1032,["onClick"])):(openBlock(),createElementBlock("span",_hoisted_59)),createBaseVNode("span",{class:normalizeClass(["task-name",["level-"+s.level,{"milestone-name":s.isMilestone},recentlyUpdatedMap[String(s.key)]?"recently-updated":""]])},toDisplayString(s.title),3),s.isMilestone&&s.materials?(openBlock(),createBlock(v,{key:2,count:s.materials.length,color:"#1890ff",size:"small",style:{"margin-left":"8px"}},null,8,["count"])):createCommentVNode("",!0),s.assignedTo?(openBlock(),createBlock(V,{key:3,size:"small",class:"task-avatar",title:s.assignedTo.name},{default:withCtx(()=>[createTextVNode(toDisplayString(s.assignedTo.name.charAt(0)),1)]),_:2},1032,["title"])):createCommentVNode("",!0)]),createBaseVNode("div",_hoisted_60,[createBaseVNode("span",_hoisted_61,toDisplayString(s.duration)+"å¤©",1),createVNode(l,{color:getTaskStatusColor(s.status),size:"small",class:"task-status-tag"},{default:withCtx(()=>[createTextVNode(toDisplayString(getTaskStatusText(s.status)),1)]),_:2},1032,["color"])])]),createBaseVNode("div",_hoisted_62,[createBaseVNode("div",{class:normalizeClass(["task-bar",["status-"+s.status,"level-"+s.level,{"critical-path":s.isCritical,"parent-bar":s.children&&s.children.length>0}]]),style:normalizeStyle(getTaskBarStyle(s))},[createBaseVNode("div",{class:normalizeClass(["task-progress-track",{"recently-updated":recentlyUpdatedMap[String(s.key)]}])},[createBaseVNode("div",{class:"task-progress-fill",style:normalizeStyle({width:s.progress+"%",backgroundColor:getProgressFillColor(s.progress,s.status)}),title:`å®žé™…è¿›åº¦: ${s.progress}%`},null,12,_hoisted_63)],2),createBaseVNode("div",_hoisted_64,[createBaseVNode("span",{class:"task-progress-text gantt-text-override",title:`DEBUG: åŽŸå§‹è¿›åº¦=${s.progress}, çŠ¶æ€=${s.status}`},toDisplayString(s.progress)+"%",9,_hoisted_65),s.status!=="completed"?(openBlock(),createElementBlock("span",_hoisted_66,toDisplayString(getTaskStatusText(s.status)),1)):createCommentVNode("",!0),s.status==="completed"?(openBlock(),createElementBlock("span",_hoisted_67,"âœ“ å·²å®Œæˆ")):createCommentVNode("",!0)]),s.isCritical&&s.status!=="completed"?(openBlock(),createElementBlock("div",_hoisted_68,"!")):createCommentVNode("",!0)],6),s.dependencies?(openBlock(),createElementBlock("div",_hoisted_69)):createCommentVNode("",!0)])],14,_hoisted_56))),128))],512)],512)]),_:1})],4)],512),createVNode(x,{open:progressModalVisible.value,"onUpdate:open":e[15]||(e[15]=s=>progressModalVisible.value=s),title:"æ›´æ–°ä»»åŠ¡è¿›åº¦",width:"500px",onOk:handleProgressUpdate,onCancel:closeProgressModal,confirmLoading:progressUpdating.value},{default:withCtx(()=>[selectedTask.value?(openBlock(),createElementBlock("div",_hoisted_70,[createBaseVNode("div",_hoisted_71,[createBaseVNode("h4",null,toDisplayString(selectedTask.value.title),1),createVNode(l,{color:getTaskStatusColor(selectedTask.value.status)},{default:withCtx(()=>[createTextVNode(toDisplayString(getTaskStatusText(selectedTask.value.status)),1)]),_:1},8,["color"])]),createVNode(I,{model:progressForm,layout:"vertical"},{default:withCtx(()=>[createVNode(y,{label:"å½“å‰è¿›åº¦"},{default:withCtx(()=>[createVNode(o,{percent:selectedTask.value.progress},null,8,["percent"]),createBaseVNode("span",_hoisted_72,toDisplayString(selectedTask.value.progress)+"%",1)]),_:1}),createVNode(y,{label:"æ–°è¿›åº¦",rules:[{required:!0,message:"è¯·è®¾ç½®æ–°çš„è¿›åº¦å€¼"}]},{default:withCtx(()=>[createVNode(G,{value:progressForm.newProgress,"onUpdate:value":e[12]||(e[12]=s=>progressForm.newProgress=s),min:selectedTask.value.progress,max:100,marks:{[selectedTask.value.progress]:"å½“å‰",100:"å®Œæˆ"}},null,8,["value","min","marks"]),createBaseVNode("div",_hoisted_73,[createBaseVNode("span",_hoisted_74,"æ–°è¿›åº¦: "+toDisplayString(progressForm.newProgress)+"%",1),progressForm.newProgress===100?(openBlock(),createElementBlock("span",_hoisted_75," ðŸŽ‰ ä»»åŠ¡å°†æ ‡è®°ä¸ºå·²å®Œæˆ ")):createCommentVNode("",!0)])]),_:1}),createVNode(y,{label:"å·¥ä½œè¯´æ˜Ž",rules:[{required:!0,message:"è¯·è¾“å…¥æœ¬æ¬¡å·¥ä½œè¯´æ˜Ž"}]},{default:withCtx(()=>[createVNode(z,{value:progressForm.workNote,"onUpdate:value":e[13]||(e[13]=s=>progressForm.workNote=s),placeholder:"è¯·æè¿°æœ¬æ¬¡è¿›åº¦æ›´æ–°çš„å·¥ä½œå†…å®¹ã€é‡åˆ°çš„é—®é¢˜æˆ–éœ€è¦çš„æ”¯æŒ...",rows:4,"show-count":"",maxlength:500},null,8,["value"])]),_:1}),progressForm.newProgress<100?(openBlock(),createBlock(y,{key:0,label:"é¢„è®¡å®Œæˆæ—¶é—´"},{default:withCtx(()=>[createVNode(B,{value:progressForm.estimatedDate,"onUpdate:value":e[14]||(e[14]=s=>progressForm.estimatedDate=s),placeholder:"é€‰æ‹©é¢„è®¡å®Œæˆæ—¶é—´",style:{width:"100%"},"disabled-date":disabledDate},null,8,["value"])]),_:1})):createCommentVNode("",!0)]),_:1},8,["model"])])):createCommentVNode("",!0)]),_:1},8,["open","confirmLoading"]),createVNode(x,{open:taskEditModalVisible.value,"onUpdate:open":e[22]||(e[22]=s=>taskEditModalVisible.value=s),title:"ç¼–è¾‘ä»»åŠ¡ä¿¡æ¯",width:"600px",onOk:handleTaskEdit,onCancel:closeTaskEditModal,confirmLoading:taskEditLoading.value,okText:"ä¿å­˜",cancelText:"å–æ¶ˆ"},{default:withCtx(()=>[createBaseVNode("div",_hoisted_76,[createVNode(I,{ref_key:"taskEditFormRef",ref:taskEditFormRef,model:taskEditForm,"label-col":{span:6},"wrapper-col":{span:18},layout:"horizontal"},{default:withCtx(()=>[createVNode(y,{label:"ä»»åŠ¡æ ‡é¢˜",rules:[{required:!0,message:"è¯·è¾“å…¥ä»»åŠ¡æ ‡é¢˜"}]},{default:withCtx(()=>[createVNode(S,{value:taskEditForm.title,"onUpdate:value":e[16]||(e[16]=s=>taskEditForm.title=s),placeholder:"è¯·è¾“å…¥ä»»åŠ¡æ ‡é¢˜",maxlength:100,"show-count":""},null,8,["value"])]),_:1}),createVNode(y,{label:"ä»»åŠ¡æè¿°",rules:[{required:!0,message:"è¯·è¾“å…¥ä»»åŠ¡æè¿°"}]},{default:withCtx(()=>[createVNode(z,{value:taskEditForm.description,"onUpdate:value":e[17]||(e[17]=s=>taskEditForm.description=s),placeholder:"è¯·è¯¦ç»†æè¿°ä»»åŠ¡å†…å®¹ã€ç›®æ ‡å’Œè¦æ±‚...",rows:4,"show-count":"",maxlength:500},null,8,["value"])]),_:1}),createVNode(y,{label:"è®¡åˆ’å¼€å§‹æ—¶é—´",rules:[{required:!0,message:"è¯·é€‰æ‹©è®¡åˆ’å¼€å§‹æ—¶é—´"}]},{default:withCtx(()=>[createVNode(B,{value:taskEditForm.startDate,"onUpdate:value":e[18]||(e[18]=s=>taskEditForm.startDate=s),placeholder:"é€‰æ‹©è®¡åˆ’å¼€å§‹æ—¶é—´",style:{width:"100%"},format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["value"])]),_:1}),createVNode(y,{label:"è®¡åˆ’ç»“æŸæ—¶é—´",rules:[{required:!0,message:"è¯·é€‰æ‹©è®¡åˆ’ç»“æŸæ—¶é—´"},{validator:validateEndDate}]},{default:withCtx(()=>[createVNode(B,{value:taskEditForm.endDate,"onUpdate:value":e[19]||(e[19]=s=>taskEditForm.endDate=s),placeholder:"é€‰æ‹©è®¡åˆ’ç»“æŸæ—¶é—´",style:{width:"100%"},format:"YYYY-MM-DD","value-format":"YYYY-MM-DD","disabled-date":disabledEndDate},null,8,["value"])]),_:1},8,["rules"]),createVNode(y,{label:"ä»»åŠ¡çŠ¶æ€"},{default:withCtx(()=>[createVNode(D,{value:taskEditForm.status,"onUpdate:value":e[20]||(e[20]=s=>taskEditForm.status=s),placeholder:"é€‰æ‹©ä»»åŠ¡çŠ¶æ€"},{default:withCtx(()=>[createVNode(_,{value:"pending"},{default:withCtx(()=>e[94]||(e[94]=[createTextVNode("å¾…å¼€å§‹")])),_:1,__:[94]}),createVNode(_,{value:"active"},{default:withCtx(()=>e[95]||(e[95]=[createTextVNode("è¿›è¡Œä¸­")])),_:1,__:[95]}),createVNode(_,{value:"completed"},{default:withCtx(()=>e[96]||(e[96]=[createTextVNode("å·²å®Œæˆ")])),_:1,__:[96]}),createVNode(_,{value:"paused"},{default:withCtx(()=>e[97]||(e[97]=[createTextVNode("å·²æš‚åœ")])),_:1,__:[97]})]),_:1},8,["value"])]),_:1}),createVNode(y,{label:"å…³é”®è·¯å¾„"},{default:withCtx(()=>[createVNode(Q,{checked:taskEditForm.isCritical,"onUpdate:checked":e[21]||(e[21]=s=>taskEditForm.isCritical=s),"checked-children":"æ˜¯","un-checked-children":"å¦"},null,8,["checked"])]),_:1})]),_:1},8,["model"])])]),_:1},8,["open","confirmLoading"]),createVNode(x,{open:taskDetailModalVisible.value,"onUpdate:open":e[24]||(e[24]=s=>taskDetailModalVisible.value=s),title:"ä»»åŠ¡è¯¦æƒ…",width:"800px",footer:null,onCancel:closeTaskDetailModal},{default:withCtx(()=>[selectedTaskDetail.value?(openBlock(),createElementBlock("div",_hoisted_77,[createVNode(J,{activeKey:taskDetailActiveTab.value,"onUpdate:activeKey":e[23]||(e[23]=s=>taskDetailActiveTab.value=s),type:"card"},{default:withCtx(()=>[createVNode(E,{key:"info",tab:"åŸºæœ¬ä¿¡æ¯"},{default:withCtx(()=>[createVNode(M,{bordered:"",column:2},{default:withCtx(()=>[createVNode(p,{label:"ä»»åŠ¡åç§°",span:2},{default:withCtx(()=>[createTextVNode(toDisplayString(selectedTaskDetail.value.title),1)]),_:1}),createVNode(p,{label:"ä»»åŠ¡æè¿°",span:2},{default:withCtx(()=>[createTextVNode(toDisplayString(selectedTaskDetail.value.description||"æš‚æ— æè¿°"),1)]),_:1}),createVNode(p,{label:"ä»»åŠ¡çŠ¶æ€"},{default:withCtx(()=>[createVNode(l,{color:getTaskStatusColor(selectedTaskDetail.value.status)},{default:withCtx(()=>[createTextVNode(toDisplayString(getTaskStatusText(selectedTaskDetail.value.status)),1)]),_:1},8,["color"])]),_:1}),createVNode(p,{label:"å®Œæˆè¿›åº¦"},{default:withCtx(()=>[createTextVNode(toDisplayString(selectedTaskDetail.value.progress||0)+"% ",1)]),_:1}),createVNode(p,{label:"è®¡åˆ’å¼€å§‹"},{default:withCtx(()=>[createTextVNode(toDisplayString(selectedTaskDetail.value.startDate),1)]),_:1}),createVNode(p,{label:"è®¡åˆ’ç»“æŸ"},{default:withCtx(()=>[createTextVNode(toDisplayString(selectedTaskDetail.value.endDate),1)]),_:1}),createVNode(p,{label:"å®žé™…å¼€å§‹"},{default:withCtx(()=>[createTextVNode(toDisplayString(selectedTaskDetail.value.actualStartDate||"æœªå¼€å§‹"),1)]),_:1}),createVNode(p,{label:"å®žé™…ç»“æŸ"},{default:withCtx(()=>[createTextVNode(toDisplayString(selectedTaskDetail.value.actualEndDate||"æœªå®Œæˆ"),1)]),_:1}),createVNode(p,{label:"æ˜¯å¦å…³é”®è·¯å¾„"},{default:withCtx(()=>[createVNode(l,{color:selectedTaskDetail.value.isCritical?"red":"default"},{default:withCtx(()=>[createTextVNode(toDisplayString(selectedTaskDetail.value.isCritical?"æ˜¯":"å¦"),1)]),_:1},8,["color"])]),_:1}),createVNode(p,{label:"è´Ÿè´£äºº"},{default:withCtx(()=>[createTextVNode(toDisplayString(selectedTaskDetail.value.assignee||"æœªåˆ†é…"),1)]),_:1})]),_:1})]),_:1}),createVNode(E,{key:"history",tab:"æ“ä½œåŽ†å²"},{default:withCtx(()=>[createBaseVNode("div",_hoisted_78,[getTaskOperationHistory(selectedTaskDetail.value).length===0?(openBlock(),createElementBlock("div",_hoisted_79," æš‚æ— æ“ä½œåŽ†å² ")):(openBlock(),createBlock(A,{key:1},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(getTaskOperationHistory(selectedTaskDetail.value),s=>(openBlock(),createBlock(R,{key:s.id,color:getHistoryTypeColor(s.type)},{dot:withCtx(()=>[(openBlock(),createBlock(resolveDynamicComponent(getHistoryTypeIcon(s.type))))]),default:withCtx(()=>[createBaseVNode("div",_hoisted_80,[createBaseVNode("div",_hoisted_81,[createBaseVNode("span",_hoisted_82,toDisplayString(s.user),1),createBaseVNode("span",_hoisted_83,toDisplayString(getHistoryActionText(s.type)),1),createBaseVNode("span",_hoisted_84,toDisplayString(formatHistoryTime(s.timestamp)),1),createVNode(a,{type:"link",size:"small",onClick:i=>showOperationDetail(s)},{default:withCtx(()=>e[98]||(e[98]=[createTextVNode(" æŸ¥çœ‹è¯¦æƒ… ")])),_:2,__:[98]},1032,["onClick"])]),createBaseVNode("div",_hoisted_85,toDisplayString(getHistoryDetailText(s)),1),s.comments&&s.comments.length>0?(openBlock(),createElementBlock("div",_hoisted_86,[createBaseVNode("div",_hoisted_87,[(openBlock(!0),createElementBlock(Fragment,null,renderList(s.comments,i=>(openBlock(),createElementBlock("div",{key:i.id,class:"comment-item"},[createBaseVNode("div",_hoisted_88,[createBaseVNode("span",_hoisted_89,toDisplayString(i.user),1),createBaseVNode("span",_hoisted_90,toDisplayString(formatHistoryTime(i.timestamp)),1)]),createBaseVNode("div",_hoisted_91,toDisplayString(i.content),1)]))),128))])])):createCommentVNode("",!0),createBaseVNode("div",_hoisted_92,[createVNode(X,{compact:""},{default:withCtx(()=>[createVNode(S,{value:pmCommentTexts.value[s.id],"onUpdate:value":i=>pmCommentTexts.value[s.id]=i,placeholder:"ä½œä¸ºé¡¹ç›®ç»ç†å›žå¤...",onPressEnter:i=>addPMComment(s),style:{width:"calc(100% - 80px)"}},null,8,["value","onUpdate:value","onPressEnter"]),createVNode(a,{type:"primary",onClick:i=>addPMComment(s),style:{width:"80px"}},{default:withCtx(()=>e[99]||(e[99]=[createTextVNode(" å›žå¤ ")])),_:2,__:[99]},1032,["onClick"])]),_:2},1024)])])]),_:2},1032,["color"]))),128))]),_:1}))])]),_:1}),createVNode(E,{key:"legacy",tab:"æ—§ç‰ˆåŽ†å²"},{default:withCtx(()=>[createBaseVNode("div",_hoisted_93,[createVNode(A,null,{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(getTaskUpdateHistory(selectedTaskDetail.value),s=>(openBlock(),createBlock(R,{key:s.id,color:getUpdateTypeColor(s.action)},{dot:withCtx(()=>[(openBlock(),createBlock(resolveDynamicComponent(getUpdateIcon(s.action))))]),default:withCtx(()=>[createBaseVNode("div",_hoisted_94,[createBaseVNode("div",_hoisted_95,[createBaseVNode("span",_hoisted_96,toDisplayString(s.userName),1),createBaseVNode("span",_hoisted_97,toDisplayString(formatUpdateTime(s.timestamp)),1),createVNode(l,{size:"small",color:getUpdateTypeColor(s.action)},{default:withCtx(()=>[createTextVNode(toDisplayString(getUpdateActionText(s.action)),1)]),_:2},1032,["color"])]),createBaseVNode("div",_hoisted_98,[s.action==="progress_update"?(openBlock(),createElementBlock("div",_hoisted_99,[createBaseVNode("p",null,[e[100]||(e[100]=createBaseVNode("strong",null,"è¿›åº¦å˜æ›´ï¼š",-1)),createTextVNode(toDisplayString(s.oldProgress)+"% â†’ "+toDisplayString(s.newProgress)+"%",1)]),s.workHours?(openBlock(),createElementBlock("p",_hoisted_100,[e[101]||(e[101]=createBaseVNode("strong",null,"å·¥æ—¶ï¼š",-1)),createTextVNode(toDisplayString(s.workHours)+" å°æ—¶",1)])):createCommentVNode("",!0),s.comment?(openBlock(),createElementBlock("p",_hoisted_101,[e[102]||(e[102]=createBaseVNode("strong",null,"å·¥ä½œå†…å®¹ï¼š",-1)),createTextVNode(toDisplayString(s.comment),1)])):createCommentVNode("",!0),s.issues?(openBlock(),createElementBlock("p",_hoisted_102,[e[103]||(e[103]=createBaseVNode("strong",null,"é‡åˆ°é—®é¢˜ï¼š",-1)),createTextVNode(toDisplayString(s.issues),1)])):createCommentVNode("",!0)])):s.action==="status_change"?(openBlock(),createElementBlock("div",_hoisted_103,[createBaseVNode("p",null,[e[104]||(e[104]=createBaseVNode("strong",null,"çŠ¶æ€å˜æ›´ï¼š",-1)),createTextVNode(toDisplayString(s.oldStatus)+" â†’ "+toDisplayString(s.newStatus),1)]),s.reason?(openBlock(),createElementBlock("p",_hoisted_104,[e[105]||(e[105]=createBaseVNode("strong",null,"å˜æ›´åŽŸå› ï¼š",-1)),createTextVNode(toDisplayString(s.reason),1)])):createCommentVNode("",!0)])):s.action==="task_created"?(openBlock(),createElementBlock("div",_hoisted_105,[createBaseVNode("p",null,[e[106]||(e[106]=createBaseVNode("strong",null,"ä»»åŠ¡åˆ›å»ºï¼š",-1)),createTextVNode(toDisplayString(s.comment||"ä»»åŠ¡å·²åˆ›å»º"),1)])])):s.action==="task_assigned"?(openBlock(),createElementBlock("div",_hoisted_106,[createBaseVNode("p",null,[e[107]||(e[107]=createBaseVNode("strong",null,"ä»»åŠ¡åˆ†é…ï¼š",-1)),createTextVNode("åˆ†é…ç»™ "+toDisplayString(s.assignee),1)])])):createCommentVNode("",!0)])])]),_:2},1032,["color"]))),128))]),_:1}),getTaskUpdateHistory(selectedTaskDetail.value).length?createCommentVNode("",!0):(openBlock(),createElementBlock("div",_hoisted_107,[createVNode($,{description:"æš‚æ— æ›´æ–°è®°å½•"})]))])]),_:1})]),_:1},8,["activeKey"])])):createCommentVNode("",!0)]),_:1},8,["open"]),createVNode(x,{open:milestoneModalVisible.value,"onUpdate:open":e[25]||(e[25]=s=>milestoneModalVisible.value=s),title:"é‡Œç¨‹ç¢‘è¯¦æƒ…",footer:null,width:"700px"},{default:withCtx(()=>[selectedMilestone.value?(openBlock(),createElementBlock("div",_hoisted_108,[createBaseVNode("div",_hoisted_109,[createBaseVNode("h3",null,toDisplayString(selectedMilestone.value.name),1),createVNode(M,{column:2,bordered:"",size:"small"},{default:withCtx(()=>[createVNode(p,{label:"çŠ¶æ€"},{default:withCtx(()=>[createVNode(l,{color:getMilestoneStatusColor(selectedMilestone.value.status)},{default:withCtx(()=>[createTextVNode(toDisplayString(getMilestoneStatusText(selectedMilestone.value.status)),1)]),_:1},8,["color"])]),_:1}),createVNode(p,{label:"å®Œæˆåº¦"},{default:withCtx(()=>[createTextVNode(toDisplayString(selectedMilestone.value.progress)+"% ",1)]),_:1}),createVNode(p,{label:"è®¡åˆ’æ—¶é—´"},{default:withCtx(()=>[createTextVNode(toDisplayString(selectedMilestone.value.plannedDate),1)]),_:1}),createVNode(p,{label:"å®žé™…æ—¶é—´"},{default:withCtx(()=>[createTextVNode(toDisplayString(selectedMilestone.value.actualDate||"æœªå®Œæˆ"),1)]),_:1}),createVNode(p,{label:"è´Ÿè´£äºº"},{default:withCtx(()=>[createTextVNode(toDisplayString(selectedMilestone.value.owner),1)]),_:1}),createVNode(p,{label:"æè¿°",span:2},{default:withCtx(()=>[createTextVNode(toDisplayString(selectedMilestone.value.description),1)]),_:1})]),_:1})]),createBaseVNode("div",_hoisted_110,[e[110]||(e[110]=createBaseVNode("h4",null,"æ‰€éœ€ææ–™",-1)),createVNode(P,{dataSource:selectedMilestone.value.materials,size:"small",bordered:""},{renderItem:withCtx(({item:s})=>[createVNode(O,null,{actions:withCtx(()=>[createVNode(a,{size:"small",type:"link"},{default:withCtx(()=>e[108]||(e[108]=[createTextVNode("æŸ¥çœ‹")])),_:1,__:[108]}),createVNode(a,{size:"small",type:"link"},{default:withCtx(()=>e[109]||(e[109]=[createTextVNode("ä¸‹è½½")])),_:1,__:[109]})]),default:withCtx(()=>[createVNode(j,{title:s},null,8,["title"])]),_:2},1024)]),_:1},8,["dataSource"])])])):createCommentVNode("",!0)]),_:1},8,["open"]),createVNode(x,{open:operationDetailVisible.value,"onUpdate:open":e[27]||(e[27]=s=>operationDetailVisible.value=s),title:"æ“ä½œè¯¦æƒ…",footer:null,width:"720px"},{default:withCtx(()=>{var s;return[selectedOperation.value?(openBlock(),createElementBlock("div",_hoisted_111,[createVNode(M,{bordered:"",size:"small",column:2},{default:withCtx(()=>[createVNode(p,{label:"ç±»åž‹"},{default:withCtx(()=>[createTextVNode(toDisplayString(getHistoryActionText(selectedOperation.value.type)),1)]),_:1}),createVNode(p,{label:"æ—¶é—´"},{default:withCtx(()=>[createTextVNode(toDisplayString(formatHistoryTime(selectedOperation.value.timestamp)),1)]),_:1}),createVNode(p,{label:"æäº¤äºº"},{default:withCtx(()=>[createTextVNode(toDisplayString(selectedOperation.value.user),1)]),_:1}),createVNode(p,{label:"å¤‡æ³¨",span:2},{default:withCtx(()=>{var i;return[createTextVNode(toDisplayString(((i=selectedOperation.value.data)==null?void 0:i.note)||"â€”"),1)]}),_:1})]),_:1}),createBaseVNode("div",_hoisted_112,[e[111]||(e[111]=createBaseVNode("h4",null,"å…¨éƒ¨åŽ†å²",-1)),createVNode(P,{dataSource:getTaskOperationHistory(selectedTask.value||{}),size:"small",bordered:""},{renderItem:withCtx(({item:i})=>[createVNode(O,null,{actions:withCtx(()=>[createBaseVNode("a",{onClick:withModifiers(k=>showOperationDetail(i),["prevent"])},"æŸ¥çœ‹è¯¦æƒ…",8,_hoisted_113)]),default:withCtx(()=>[createVNode(g,null,{default:withCtx(()=>[createVNode(l,{color:getHistoryTypeColor(i.type)},{default:withCtx(()=>[createTextVNode(toDisplayString(getHistoryActionText(i.type)),1)]),_:2},1032,["color"]),createBaseVNode("span",null,toDisplayString(i.user),1),createBaseVNode("span",null,toDisplayString(formatHistoryTime(i.timestamp)),1)]),_:2},1024)]),_:2},1024)]),_:1},8,["dataSource"])]),selectedOperation.value.type==="material_submission"?(openBlock(),createElementBlock("div",_hoisted_114,[e[112]||(e[112]=createBaseVNode("h4",null,"æäº¤çš„ææ–™",-1)),createVNode(P,{dataSource:((s=selectedOperation.value.data)==null?void 0:s.materials)||[],bordered:""},{renderItem:withCtx(({item:i,index:k})=>[createVNode(O,null,{actions:withCtx(()=>[createBaseVNode("a",{onClick:withModifiers(C=>previewMaterial(i),["prevent"])},"åœ¨çº¿é¢„è§ˆ",8,_hoisted_115),createBaseVNode("a",{onClick:withModifiers(C=>downloadMaterial(i),["prevent"])},"ä¸‹è½½",8,_hoisted_116)]),default:withCtx(()=>[createVNode(j,{title:(i==null?void 0:i.name)||(i==null?void 0:i.fileName)||"ææ–™"+(k+1)},null,8,["title"])]),_:2},1024)]),_:1},8,["dataSource"])])):createCommentVNode("",!0),createBaseVNode("div",_hoisted_117,[createVNode(a,{type:"primary",onClick:forwardToManagers},{default:withCtx(()=>e[113]||(e[113]=[createTextVNode("ä¸€é”®å‘ç»™ç®¡ç†è€…")])),_:1,__:[113]}),createVNode(a,{onClick:e[26]||(e[26]=i=>operationDetailVisible.value=!1)},{default:withCtx(()=>e[114]||(e[114]=[createTextVNode("å…³é—­")])),_:1,__:[114]})])])):createCommentVNode("",!0)]}),_:1},8,["open"]),createVNode(x,{open:filePreviewVisible.value,"onUpdate:open":e[28]||(e[28]=s=>filePreviewVisible.value=s),footer:null,width:"80%"},{title:withCtx(()=>e[115]||(e[115]=[createTextVNode("ææ–™é¢„è§ˆ")])),default:withCtx(()=>[filePreviewSrc.value?(openBlock(),createElementBlock("div",_hoisted_118,[isPdf(filePreviewSrc.value)?(openBlock(),createElementBlock("iframe",{key:0,src:filePreviewSrc.value,style:{width:"100%",height:"75vh",border:"0"}},null,8,_hoisted_119)):(openBlock(),createBlock(Z,{key:1,src:filePreviewSrc.value,preview:!1,style:{"max-height":"75vh"}},null,8,["src"]))])):createCommentVNode("",!0)]),_:1},8,["open"])]),createVNode(te,{open:isTableDrawerOpen.value,placement:"bottom",height:tableDrawerHeight.value,mask:!1,closable:!0,onClose:closeTableDrawer,bodyStyle:{padding:"8px 16px"}},{title:withCtx(()=>[createVNode(g,null,{default:withCtx(()=>[e[124]||(e[124]=createBaseVNode("span",null,"ðŸ“‹ WBSä»»åŠ¡è¡¨æ ¼è§†å›¾",-1)),createVNode(K,{type:"vertical"}),createVNode(D,{value:filterStatus.value,"onUpdate:value":e[29]||(e[29]=s=>filterStatus.value=s),placeholder:"çŠ¶æ€",style:{width:"110px"},"allow-clear":"",size:"small"},{default:withCtx(()=>[createVNode(_,{value:"pending"},{default:withCtx(()=>e[116]||(e[116]=[createTextVNode("å¾…å¼€å§‹")])),_:1,__:[116]}),createVNode(_,{value:"active"},{default:withCtx(()=>e[117]||(e[117]=[createTextVNode("è¿›è¡Œä¸­")])),_:1,__:[117]}),createVNode(_,{value:"completed"},{default:withCtx(()=>e[118]||(e[118]=[createTextVNode("å·²å®Œæˆ")])),_:1,__:[118]})]),_:1},8,["value"]),createVNode(S,{value:filterAssignee.value,"onUpdate:value":e[30]||(e[30]=s=>filterAssignee.value=s),placeholder:"è´Ÿè´£äºº","allow-clear":"",size:"small",style:{width:"120px"}},null,8,["value"]),createVNode(N,{checked:filterOverdue.value,"onUpdate:checked":e[31]||(e[31]=s=>filterOverdue.value=s),size:"small"},{default:withCtx(()=>e[119]||(e[119]=[createTextVNode("é€¾æœŸ")])),_:1,__:[119]},8,["checked"]),createVNode(N,{checked:filterUnread.value,"onUpdate:checked":e[32]||(e[32]=s=>filterUnread.value=s),size:"small"},{default:withCtx(()=>e[120]||(e[120]=[createTextVNode("æœ‰æœªè¯»")])),_:1,__:[120]},8,["checked"]),createVNode(a,{size:"small",onClick:resetTableFilters},{default:withCtx(()=>e[121]||(e[121]=[createTextVNode("é‡ç½®")])),_:1,__:[121]}),createVNode(K,{type:"vertical"}),createVNode(a,{size:"small",type:"primary",onClick:batchStart,disabled:selectedRowKeys.value.length===0},{default:withCtx(()=>e[122]||(e[122]=[createTextVNode("æ‰¹é‡å¼€å§‹")])),_:1,__:[122]},8,["disabled"]),createVNode(a,{size:"small",onClick:batchComplete,disabled:selectedRowKeys.value.length===0},{default:withCtx(()=>e[123]||(e[123]=[createTextVNode("æ‰¹é‡å®Œæˆ")])),_:1,__:[123]},8,["disabled"])]),_:1,__:[124]})]),default:withCtx(()=>[createVNode(ee,{dataSource:filteredFlatTasks.value,columns:tableColumns,"row-selection":tableRowSelection,size:"small",rowKey:"key",pagination:!1},{bodyCell:withCtx(({column:s,record:i})=>[s.key==="title"?(openBlock(),createElementBlock("span",{key:0,style:normalizeStyle({paddingLeft:(i.level||0)*16+"px"})},toDisplayString(i.title),5)):s.key==="status"?(openBlock(),createBlock(l,{key:1,color:i.status==="completed"?"green":i.status==="active"?"blue":"orange"},{default:withCtx(()=>[createTextVNode(toDisplayString(statusText(i.status)),1)]),_:2},1032,["color"])):s.key==="progress"?(openBlock(),createBlock(o,{key:2,percent:i.progress||0,size:"small"},null,8,["percent"])):s.key==="action"?(openBlock(),createBlock(g,{key:3},{default:withCtx(()=>[createVNode(a,{type:"link",size:"small",onClick:k=>jumpToNode(i.key)},{default:withCtx(()=>e[125]||(e[125]=[createTextVNode("å®šä½")])),_:2,__:[125]},1032,["onClick"]),createVNode(a,{type:"link",size:"small",onClick:k=>openDetail(i.key)},{default:withCtx(()=>e[126]||(e[126]=[createTextVNode("è¯¦æƒ…")])),_:2,__:[126]},1032,["onClick"])]),_:2},1024)):createCommentVNode("",!0)]),_:1},8,["dataSource","row-selection"])]),_:1},8,["open","height"])],64)}}},monitor=_export_sfc(_sfc_main,[["__scopeId","data-v-9d2bad19"]]);export{monitor as default};
