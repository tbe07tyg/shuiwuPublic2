import{_ as oe,h as f,d as x,m as se,i as ne,f as _,v as R,c as C,a as s,j as a,t as c,w as o,l as p,o as j,p as u,x as b,N as re,b as D,F as le,s as ie,k as ue,z as de,L as ce}from"./index-CLrs7Nd9.js";/* empty css                                                                    */import{M as pe}from"./MaterialTemplateSync-BJQWXxvI.js";import{P as me}from"./ProjectOutlined-CMgGj_eA.js";import{S as fe}from"./SaveOutlined-DGz4ayyx.js";import{S as ve}from"./SendOutlined-Dvnn5skW.js";import"./materialTemplate-DHg93JQh.js";import"./UploadOutlined-U6qGJXGO.js";const _e={class:"submit-container"},ye={class:"page-header"},ge={class:"header-content"},qe={class:"page-title"},he={class:"page-description"},je={class:"header-actions"},be={class:"form-section"},Ie={class:"section-header"},xe={class:"section-content"},Ce={class:"project-option"},ke={class:"project-name"},Re={class:"project-info"},we={class:"project-code"},Te={class:"project-status"},De={key:0,class:"selected-project-info"},Se={class:"form-section"},Ue={class:"section-header"},Le={class:"section-content"},Oe={key:0,class:"form-section"},Pe={class:"section-header"},Fe={class:"review-comments-content"},Ne={class:"comments-text"},ze={class:"form-section"},Me={key:0,class:"resubmit-notice"},Ve={class:"form-actions"},Be={__name:"submit",setup($e){const g=se(),F=f(),w=f(),S=f({allRequiredUploaded:!1,uploadedCount:0,totalCount:0}),T=f([]),k=x(()=>g.currentRoute.value.query.resubmit==="true"),v=x(()=>g.currentRoute.value.query.improvement==="true"),N=x(()=>v.value?"提交整改材料":k.value?"重新提交验收申请":"提交验收申请"),z=x(()=>v.value?"根据验收会议的整改要求，提交相应的整改材料和说明":k.value?"根据审核意见修改完善后重新提交验收申请":"填写项目验收申请信息并上传相关材料"),n=f({projectId:void 0,expectedDate:void 0,acceptanceType:void 0,description:"",remarks:""}),M={projectId:[{required:!0,message:"请选择项目"}],expectedDate:[{required:!0,message:"请选择预期验收时间"}],acceptanceType:[{required:!0,message:"请选择验收类型"}],description:[{required:!0,message:"请填写申请说明"}]},h=f([{id:1,name:"智慧城市大数据平台建设项目",code:"PROJ-2024-001",status:"实施中",startDate:"2023-06-01",endDate:"2024-05-31",leader:"张三",budget:500},{id:2,name:"区块链供应链金融平台",code:"PROJ-2024-002",status:"实施中",startDate:"2023-08-01",endDate:"2024-07-31",leader:"李四",budget:300},{id:3,name:"AI智能客服系统",code:"PROJ-2024-003",status:"即将结束",startDate:"2023-09-01",endDate:"2024-03-31",leader:"王五",budget:200}]),y=x(()=>h.value.find(e=>e.id===n.value.projectId));f([{key:"acceptance_report",name:"项目验收报告",description:"详细的项目验收报告，包含项目完成情况、技术指标等",fileList:[]},{key:"summary_report",name:"项目总结报告",description:"项目实施过程总结，包含经验教训、改进建议等",fileList:[]},{key:"achievement_materials",name:"成果汇总材料",description:"项目产出的各类成果材料，如软件、报告、专利等",fileList:[]},{key:"financial_report",name:"财务决算报告",description:"项目资金使用情况的详细财务报告",fileList:[]}]),f([{key:"ip_list",name:"知识产权清单",description:"项目产生的专利、软著等知识产权清单",fileList:[]},{key:"test_report",name:"测试报告",description:"系统测试、性能测试等相关测试报告",fileList:[]},{key:"user_manual",name:"用户手册",description:"系统使用手册、操作指南等文档",fileList:[]},{key:"other_materials",name:"其他材料",description:"其他与项目验收相关的补充材料",fileList:[]}]);const U=f(!1),I=f("");f(!1),f({});const V=e=>({实施中:"blue",即将结束:"orange",已完成:"green",暂停:"red"})[e]||"default",B=(e,t)=>{const i=h.value.find(l=>l.id===t.value);return i&&(i.name.toLowerCase().includes(e.toLowerCase())||i.code.toLowerCase().includes(e.toLowerCase()))},$=e=>e&&e<R().startOf("day"),A=()=>{g.go(-1)},J=e=>{console.log("Selected project:",e)},E=e=>{const{configId:t,file:i,action:l}=e;if(l==="add")T.value.push({configId:t,file:i});else if(l==="remove"){const q=T.value.findIndex(m=>m.configId===t);q>-1&&T.value.splice(q,1)}},G=e=>{S.value=e},H=e=>{console.log("开题材料配置已更新:",e)},K=async()=>{try{_.success("草稿保存成功")}catch{_.error("草稿保存失败")}},Q=async e=>{var t,i;try{if(U.value=!0,!S.value.allRequiredUploaded){const r=(t=w.value)==null?void 0:t.validateRequiredFiles();if(r&&!r.valid){_.error(`请上传以下必传材料：${r.missingFiles.join("、")}`);return}}const l=((i=w.value)==null?void 0:i.getAllUploadedFiles())||[],q={...e,materials:l.map(r=>({configId:r.configId,categoryName:r.config.categoryName,fileName:r.file.name,fileSize:r.file.size,isRequired:r.config.isRequired}))};console.log("Submit data:",q),await new Promise(r=>setTimeout(r,2e3)),_.success("开题申请提交成功");const m=g.currentRoute.value;m.query.fromPM==="true"&&m.query.projectId?(g.push({path:`/project-manager/projects/monitor/${m.query.projectId}`,query:{action:"milestone_submitted",milestoneType:m.query.milestoneType,submitTime:new Date().toISOString()}}),_.info("正在返回项目监控页面...")):g.push("/opening/applicant/manage")}catch{_.error("提交失败，请重试")}finally{U.value=!1}};return ne(()=>{const e=g.currentRoute.value;if(e.query.fromPM==="true"){if(e.query.projectId){const t=parseInt(e.query.projectId),i=h.value.find(l=>l.id===t);i&&(n.value.projectId=t,_.success(`已自动关联项目：${e.query.projectName||i.name}`))}e.query.milestoneType&&e.query.milestoneType.includes("开题")&&(n.value.acceptanceType="opening",n.value.description=`${e.query.projectName}项目开题申请材料`),n.value.expectedDate=R().add(7,"day"),_.info("已从项目监控页面自动填充基础信息，请补充完整申请材料")}if(e.query.resubmit==="true"){if(e.query.projectId){const t=parseInt(e.query.projectId);h.value.find(l=>l.id===t)&&(n.value.projectId=t)}e.query.expectedTime&&(n.value.expectedDate=R(e.query.expectedTime)),e.query.description&&(n.value.description=decodeURIComponent(e.query.description)),e.query.rejectionReason?I.value=decodeURIComponent(e.query.rejectionReason):e.query.reviewComments&&(I.value=decodeURIComponent(e.query.reviewComments)),n.value.acceptanceType="final",_.info("已自动填充项目信息，请重新上传验收材料并完善申请信息")}if(e.query.improvement==="true"){if(e.query.projectId){const t=parseInt(e.query.projectId);h.value.find(l=>l.id===t)&&(n.value.projectId=t)}e.query.expectedTime&&(n.value.expectedDate=R(e.query.expectedTime)),e.query.description&&(n.value.description=decodeURIComponent(e.query.description)),e.query.improvementRequirements&&(I.value=decodeURIComponent(e.query.improvementRequirements)),n.value.acceptanceType="final",_.info("已自动填充项目信息，请根据整改要求上传相关材料")}}),(e,t)=>{const i=p("a-button"),l=p("a-select-option"),q=p("a-select"),m=p("a-form-item"),r=p("a-descriptions-item"),W=p("a-tag"),X=p("a-descriptions"),Y=p("a-date-picker"),L=p("a-col"),Z=p("a-row"),O=p("a-textarea"),P=p("a-alert"),ee=p("a-space"),te=p("a-form"),ae=p("a-card");return j(),C("div",_e,[s("div",ye,[s("div",ge,[s("h1",qe,c(N.value),1),s("p",he,c(z.value),1)]),s("div",je,[a(i,{onClick:A},{default:o(()=>[a(b(re)),t[5]||(t[5]=u(" 返回列表 ",-1))]),_:1,__:[5]})])]),a(ae,{bordered:!1},{default:o(()=>[a(te,{ref_key:"formRef",ref:F,model:n.value,rules:M,layout:"vertical",onFinish:Q},{default:o(()=>[s("div",be,[s("div",Ie,[s("h3",null,[a(b(me)),t[6]||(t[6]=u(" 项目选择 ",-1))]),t[7]||(t[7]=s("p",null,"选择需要申请开题的项目",-1))]),s("div",xe,[a(m,{label:"选择项目",name:"projectId",rules:[{required:!0,message:"请选择项目"}]},{default:o(()=>[a(q,{value:n.value.projectId,"onUpdate:value":t[0]||(t[0]=d=>n.value.projectId=d),placeholder:"请选择项目",size:"large","show-search":"","filter-option":B,onChange:J},{default:o(()=>[(j(!0),C(le,null,ie(h.value,d=>(j(),ue(l,{key:d.id,value:d.id},{default:o(()=>[s("div",Ce,[s("div",ke,c(d.name),1),s("div",Re,[s("span",we,c(d.code),1),s("span",Te,c(d.status),1)])])]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),y.value?(j(),C("div",De,[a(X,{column:2,bordered:"",size:"small"},{default:o(()=>[a(r,{label:"项目名称",span:2},{default:o(()=>[u(c(y.value.name),1)]),_:1}),a(r,{label:"项目编号"},{default:o(()=>[u(c(y.value.code),1)]),_:1}),a(r,{label:"项目状态"},{default:o(()=>[a(W,{color:V(y.value.status)},{default:o(()=>[u(c(y.value.status),1)]),_:1},8,["color"])]),_:1}),a(r,{label:"开始时间"},{default:o(()=>[u(c(y.value.startDate),1)]),_:1}),a(r,{label:"计划结束时间"},{default:o(()=>[u(c(y.value.endDate),1)]),_:1}),a(r,{label:"项目负责人"},{default:o(()=>[u(c(y.value.leader),1)]),_:1}),a(r,{label:"项目总预算"},{default:o(()=>[u(c(y.value.budget)+"万元 ",1)]),_:1})]),_:1})])):D("",!0)])]),s("div",Se,[s("div",Ue,[s("h3",null,[a(b(de)),t[8]||(t[8]=u(" 申请信息 ",-1))]),t[9]||(t[9]=s("p",null,"填写开题申请的基本信息",-1))]),s("div",Le,[a(Z,{gutter:24},{default:o(()=>[a(L,{xs:24,md:12},{default:o(()=>[a(m,{label:"预期开题时间",name:"expectedDate",rules:[{required:!0,message:"请选择预期验收时间"}]},{default:o(()=>[a(Y,{value:n.value.expectedDate,"onUpdate:value":t[1]||(t[1]=d=>n.value.expectedDate=d),placeholder:"请选择预期开题时间",size:"large",style:{width:"100%"},"disabled-date":$},null,8,["value"])]),_:1})]),_:1}),a(L,{xs:24,md:12},{default:o(()=>[a(m,{label:"开题类型",name:"acceptanceType",rules:[{required:!0,message:"请选择验收类型"}]},{default:o(()=>[a(q,{value:n.value.acceptanceType,"onUpdate:value":t[2]||(t[2]=d=>n.value.acceptanceType=d),placeholder:"请选择验收类型",size:"large"},{default:o(()=>[a(l,{value:"preliminary"},{default:o(()=>t[10]||(t[10]=[u("初步开题",-1)])),_:1,__:[10]}),a(l,{value:"formal"},{default:o(()=>t[11]||(t[11]=[u("正式开题",-1)])),_:1,__:[11]}),a(l,{value:"special"},{default:o(()=>t[12]||(t[12]=[u("专项开题",-1)])),_:1,__:[12]})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),a(m,{label:"申请说明",name:"description",rules:[{required:!0,message:"请填写申请说明"}]},{default:o(()=>[a(O,{value:n.value.description,"onUpdate:value":t[3]||(t[3]=d=>n.value.description=d),placeholder:"请详细说明项目准备情况、研究方案及开题准备情况",rows:4,size:"large","show-count":"",maxlength:500},null,8,["value"])]),_:1}),a(m,{label:"备注说明",name:"remarks"},{default:o(()=>[a(O,{value:n.value.remarks,"onUpdate:value":t[4]||(t[4]=d=>n.value.remarks=d),placeholder:"其他需要说明的事项（选填）",rows:3,size:"large","show-count":"",maxlength:200},null,8,["value"])]),_:1})])]),(k.value||v.value)&&I.value?(j(),C("div",Oe,[s("div",Pe,[s("h3",null,[a(b(ce)),u(" "+c(v.value?"整改要求":"审核意见"),1)]),s("p",null,"请仔细阅读以下"+c(v.value?"整改要求":"审核意见")+"，并据此修改完善申请材料",1)]),s("div",Fe,[a(P,{message:v.value?"开题会议整改要求":"材料审核意见",type:v.value?"warning":"error","show-icon":""},{description:o(()=>[s("div",Ne,c(I.value),1)]),_:1},8,["message","type"])])])):D("",!0),s("div",ze,[k.value||v.value?(j(),C("div",Me,[a(P,{message:v.value?"整改材料提交":"重新提交提醒",description:v.value?"请根据开题会议的整改要求，上传相应的整改材料和说明文档。":"由于材料审核未通过，请根据审核意见重新准备并上传所有必需材料。",type:v.value?"warning":"info","show-icon":"",style:{"margin-bottom":"16px"}},null,8,["message","description","type"])])):D("",!0),a(pe,{ref_key:"materialTemplateSyncRef",ref:w,"business-type":"opening",onFilesChange:E,onValidationChange:G,onConfigUpdate:H},null,512)]),s("div",Ve,[a(ee,null,{default:o(()=>[a(i,{onClick:K},{default:o(()=>[a(b(fe)),t[13]||(t[13]=u(" 保存草稿 ",-1))]),_:1,__:[13]}),a(i,{type:"primary","html-type":"submit"},{default:o(()=>[a(b(ve)),t[14]||(t[14]=u(" 提交申请 ",-1))]),_:1,__:[14]})]),_:1})])]),_:1},8,["model"])]),_:1})])}}},Xe=oe(Be,[["__scopeId","data-v-5c74e0e7"]]);export{Xe as default};
