# é¡¹ç›®é‡Œç¨‹ç¢‘ä»»åŠ¡åˆ†é…ä¸ææ–™æäº¤ç®¡ç†æœ€ä½³è®¾è®¡æ–¹æ¡ˆ

**æ–¹æ¡ˆç‰ˆæœ¬**: v2.0  
**è®¾è®¡æ—¥æœŸ**: 2025å¹´1æœˆ28æ—¥  
**æ›´æ–°å†…å®¹**: èšç„¦å‰ç«¯è®¾è®¡ï¼Œå¼ºåŒ–å›¢é˜Ÿæˆå‘˜ä¸é¡¹ç›®ç»ç†è”åŠ¨æœºåˆ¶  
**åŸºäºéœ€æ±‚**: é¡¹ç›®é‡Œç¨‹ç¢‘ä»»åŠ¡åˆ†é…ä¸ææ–™æäº¤ç®¡ç†éœ€æ±‚æ–‡æ¡£  

---

## ğŸ¯ æ–¹æ¡ˆæ¦‚è¿°

**è®¾è®¡ç†å¿µ**: ä¸“æ³¨å‰ç«¯é¡µé¢è®¾è®¡å’Œäº¤äº’é€»è¾‘ï¼Œåç«¯APIé¢„ç•™æ¥å£ã€‚é‡ç‚¹æ„å»ºå›¢é˜Ÿæˆå‘˜ä»»åŠ¡çœ‹æ¿ä¸é¡¹ç›®ç»ç†ç›‘æ§é¡µé¢çš„å®æ—¶è”åŠ¨æœºåˆ¶ï¼Œç¡®ä¿ä»»åŠ¡è¿›åº¦æ›´æ–°ã€ææ–™æäº¤ç­‰æ“ä½œèƒ½å¤ŸåŒæ­¥åæ˜ åˆ°é¡¹ç›®ç›‘æ§è§†å›¾ä¸­ã€‚

**æ ¸å¿ƒç‰¹è‰²**: 
- ç®€åŒ–å›¢é˜Ÿæˆå‘˜å·¥ä½œå°ä¸ºçº¯ä»»åŠ¡çœ‹æ¿æ¨¡å¼
- æ™ºèƒ½ä»»åŠ¡æ’åºï¼ˆä¼˜å…ˆçº§+æ—¶é—´åŒé‡å› ç´ ï¼‰
- å®æ—¶æ•°æ®åŒæ­¥å’ŒçŠ¶æ€è”åŠ¨

## ğŸ“Š ç°çŠ¶åˆ†æ

### âœ… å·²æœ‰åŸºç¡€è®¾æ–½
1. **å›¢é˜Ÿç®¡ç†ç³»ç»Ÿ**(`src/views/project-manager/team/index.vue`)
   - å®Œæ•´çš„å›¢é˜Ÿæˆå‘˜ç®¡ç†åŠŸèƒ½
   - æ”¯æŒæˆå‘˜æ·»åŠ ã€ç¼–è¾‘ã€æƒé™åˆ†é…
   - æˆå‘˜ç»©æ•ˆè¯„ä¼°å’Œé¡¹ç›®åˆ†é…

2. **WBSä»»åŠ¡ç®¡ç†**(`src/views/project-manager/projects/monitor.vue`, `taskSync.js`)
   - æ ‘å½¢WBSç»“æ„ç¼–è¾‘å’Œç®¡ç†
   - ä»»åŠ¡æ•°æ®åŒæ­¥æœºåˆ¶(`useTaskSyncStore`)
   - ä»»åŠ¡ç¼–è¾‘å’Œåˆ†é…åŸºç¡€åŠŸèƒ½

3. **å›¢é˜Ÿæˆå‘˜å·¥ä½œå°**(`src/views/team-member/dashboard/index.vue`)
   - ä¸ªäººä»»åŠ¡çœ‹æ¿å’Œç­›é€‰
   - é¡¹ç›®å‚ä¸æƒ…å†µå±•ç¤º
   - åŸºç¡€çš„ä»»åŠ¡çŠ¶æ€ç®¡ç†

4. **ææ–™ç®¡ç†ç³»ç»Ÿ**
   - ææ–™æ¨¡æ¿ç®¡ç†(`src/store/materialTemplate.js`)
   - å¼€é¢˜/ç«‹é¡¹/ä¸­æœŸ/éªŒæ”¶å®¡æ ¸æµç¨‹
   - ææ–™æäº¤å’Œé¢„è§ˆåŠŸèƒ½

### ğŸ”§ éœ€è¦è¡¥å¼ºçš„åŠŸèƒ½
1. **WBSä»»åŠ¡ä¸å›¢é˜Ÿæˆå‘˜çš„å…³è”æœºåˆ¶**
2. **é‡Œç¨‹ç¢‘ææ–™éœ€æ±‚å®šä¹‰åŠŸèƒ½**
3. **ä»»åŠ¡æé†’å’Œå‚¬åŠç³»ç»Ÿ**
4. **é¡¹ç›®ç»ç†ææ–™é¢„å®¡åŠŸèƒ½**
5. **ä¸¤çº§å®¡æ ¸æµè½¬æœºåˆ¶**

---

## ğŸ—ï¸ è®¾è®¡æ–¹æ¡ˆ

### é˜¶æ®µä¸€ï¼šWBSä»»åŠ¡åˆ†é…å¢å¼º

#### 1.1 å¢å¼ºWBSä»»åŠ¡æ•°æ®æ¨¡å‹
```javascript
// æ‰©å±•ç°æœ‰çš„WBSä»»åŠ¡ç»“æ„
const enhancedWBSTask = {
  // ç°æœ‰å­—æ®µ
  key: '0-1',
  title: 'éœ€æ±‚åˆ†æ',
  description: '...',
  startDate: '2025-01-28',
  endDate: '2025-02-10',
  
  // æ–°å¢å­—æ®µ
  assignedTo: {
    primary: 'user_001',        // ä¸»è´£äººID
    collaborators: ['user_002', 'user_003'], // åä½œäººå‘˜
    assignedBy: 'pm_001',       // åˆ†é…äºº
    assignedAt: '2025-01-28T10:00:00Z'
  },
  
  // é‡Œç¨‹ç¢‘å…³è”
  milestoneType: 'opening',     // å…³è”çš„é‡Œç¨‹ç¢‘ç±»å‹
  materialRequirements: [       // ææ–™éœ€æ±‚
    {
      materialId: 'mat_001',
      name: 'å¼€é¢˜æŠ¥å‘Š',
      template: 'opening_report.docx',
      required: true,
      deadline: '2025-02-08'
    }
  ],
  
  // æé†’è®¾ç½®
  reminders: {
    enabled: true,
    beforeDeadline: [3, 1],     // æå‰3å¤©ã€1å¤©æé†’
    overdue: true               // é€¾æœŸæé†’
  }
}
```

#### 1.2 ä¿®æ”¹WBSç¼–è¾‘ç•Œé¢
**ä½ç½®**: `src/views/project-manager/projects/config-wizard.vue`

åœ¨WBSç¼–è¾‘å¼¹çª—ä¸­æ–°å¢ï¼š
- **è´Ÿè´£äººåˆ†é…**ï¼šä¸‹æ‹‰é€‰æ‹©ä¸»è´£äººå’Œåä½œäººå‘˜
- **é‡Œç¨‹ç¢‘å…³è”**ï¼šé€‰æ‹©ä»»åŠ¡å±äºå“ªä¸ªé‡Œç¨‹ç¢‘
- **ææ–™éœ€æ±‚**ï¼šé…ç½®è¯¥ä»»åŠ¡éœ€è¦æäº¤çš„ææ–™
- **æé†’è®¾ç½®**ï¼šé…ç½®ä»»åŠ¡æé†’è§„åˆ™

#### 1.3 å¢å¼ºä»»åŠ¡åŒæ­¥å­˜å‚¨
**ä½ç½®**: `src/store/taskSync.js`

æ‰©å±•ä»»åŠ¡åŒæ­¥å­˜å‚¨ï¼Œæ”¯æŒï¼š
```javascript
// ä»»åŠ¡åˆ†é…æ–¹æ³•
const assignTaskToMembers = (projectId, taskKey, assignment) => {
  // æ›´æ–°ä»»åŠ¡åˆ†é…ä¿¡æ¯
  // å‘é€åˆ†é…é€šçŸ¥
  // åŒæ­¥åˆ°å›¢é˜Ÿæˆå‘˜å·¥ä½œå°
}

// é‡Œç¨‹ç¢‘ææ–™éœ€æ±‚ç®¡ç†
const updateMilestoneRequirements = (projectId, milestoneType, requirements) => {
  // æ›´æ–°é‡Œç¨‹ç¢‘ææ–™éœ€æ±‚
  // ç”Ÿæˆå¯¹åº”çš„ææ–™æäº¤ä»»åŠ¡
}
```

### é˜¶æ®µäºŒï¼šå›¢é˜Ÿæˆå‘˜ä»»åŠ¡çœ‹æ¿é‡æ„

#### 2.1 ç²¾ç®€å›¢é˜Ÿæˆå‘˜å·¥ä½œå°è®¾è®¡
**ä½ç½®**: `src/views/team-member/tasks/index.vue` (é‡æ„ç°æœ‰dashboard)

**è®¾è®¡åŸåˆ™**ï¼š
- ç§»é™¤"ä¸ªäººå·¥ä½œå°"æ¦‚å¿µï¼Œä¸“æ³¨ä»»åŠ¡çœ‹æ¿
- ä¼˜åŒ–ä»»åŠ¡æ’åºé€»è¾‘ï¼šä¼˜å…ˆçº§ > æˆªæ­¢æ—¶é—´
- å¼ºåŒ–ä¸é¡¹ç›®ç»ç†é¡µé¢çš„å®æ—¶è”åŠ¨

```vue
<template>
  <div class="team-member-task-board">
    <!-- é¡µé¢å¤´éƒ¨ -->
    <div class="page-header">
      <h1>ğŸ“‹ æˆ‘çš„ä»»åŠ¡çœ‹æ¿</h1>
      <div class="header-stats">
        <a-statistic-countdown 
          title="ä»Šæ—¥å¾…åŠ" 
          :value="todayDeadlineCount" 
          format="D å¤© H æ—¶ m åˆ†"
        />
        <a-statistic title="æ€»ä»»åŠ¡" :value="totalTasks" />
        <a-statistic title="å®Œæˆç‡" :value="completionRate" suffix="%" />
      </div>
    </div>

    <!-- ä»»åŠ¡ç­›é€‰å™¨ -->
    <div class="task-filters">
      <a-space>
        <a-radio-group v-model:value="statusFilter" @change="refreshTasks">
          <a-radio-button value="all">å…¨éƒ¨ä»»åŠ¡</a-radio-button>
          <a-radio-button value="pending">å¾…å¤„ç†</a-radio-button>
          <a-radio-button value="in-progress">è¿›è¡Œä¸­</a-radio-button>
          <a-radio-button value="review">å¾…å®¡æ ¸</a-radio-button>
        </a-radio-group>
        
        <a-select 
          v-model:value="projectFilter" 
          placeholder="ç­›é€‰é¡¹ç›®"
          style="width: 200px"
          allow-clear>
          <a-select-option v-for="project in myProjects" 
                          :key="project.id" 
                          :value="project.id">
            {{ project.name }}
          </a-select-option>
        </a-select>
        
        <a-button @click="refreshTasks">
          <ReloadOutlined />
          åˆ·æ–°
        </a-button>
      </a-space>
    </div>

    <!-- ä»»åŠ¡çœ‹æ¿ä¸»ä½“ -->
    <div class="task-board-container">
      <!-- ç´§æ€¥ä»»åŠ¡æé†’æ¡ -->
      <div v-if="urgentTasks.length > 0" class="urgent-banner">
        <a-alert 
          type="error" 
          :message="`æœ‰ ${urgentTasks.length} ä¸ªç´§æ€¥ä»»åŠ¡éœ€è¦ç«‹å³å¤„ç†`"
          show-icon
          closable />
      </div>

      <!-- ä»»åŠ¡åˆ—è¡¨ -->
      <div class="tasks-list">
        <div 
          v-for="task in sortedTasks" 
          :key="task.id"
          :class="['task-card', `priority-${task.priority}`, `status-${task.status}`]"
          @click="openTaskDetail(task)">
          
          <!-- ä»»åŠ¡å¤´éƒ¨ä¿¡æ¯ -->
          <div class="task-header">
            <div class="task-title-section">
              <h3 class="task-title">{{ task.title }}</h3>
              <div class="task-meta">
                <!-- ä¼˜å…ˆçº§æ ‡ç­¾ -->
                <a-tag :color="getPriorityColor(task.priority)">
                  {{ getPriorityText(task.priority) }}
                </a-tag>
                
                <!-- ä»»åŠ¡ç±»å‹æ ‡ç­¾ -->
                <a-tag v-if="task.milestoneType" 
                       :color="getMilestoneColor(task.milestoneType)">
                  {{ getMilestoneText(task.milestoneType) }}
                </a-tag>
                
                <!-- æˆªæ­¢æ—¶é—´è­¦å‘Š -->
                <a-tag v-if="isUrgent(task)" color="red">
                  <ClockCircleOutlined />
                  {{ getUrgencyText(task) }}
                </a-tag>
              </div>
            </div>
            
            <!-- å¿«é€Ÿæ“ä½œæŒ‰é’® -->
            <div class="task-actions">
              <a-button 
                v-if="task.status === 'pending'" 
                type="primary" 
                size="small"
                @click.stop="startTask(task)">
                å¼€å§‹ä»»åŠ¡
              </a-button>
              
              <a-button 
                v-if="task.status === 'in-progress'" 
                type="primary" 
                size="small"
                @click.stop="updateProgress(task)">
                æ›´æ–°è¿›åº¦
              </a-button>
              
              <a-button 
                v-if="needMaterialSubmission(task)" 
                type="primary" 
                size="small"
                @click.stop="submitMaterial(task)">
                æäº¤ææ–™
              </a-button>
            </div>
          </div>

          <!-- ä»»åŠ¡å†…å®¹åŒº -->
          <div class="task-content">
            <div class="task-description">
              {{ task.description }}
            </div>
            
            <!-- è¿›åº¦æ¡ -->
            <div class="task-progress-section">
              <a-progress 
                :percent="task.progress" 
                :status="getProgressStatus(task)"
                size="small" />
              <span class="progress-text">{{ task.progress }}%</span>
            </div>
            
            <!-- é¡¹ç›®ä¿¡æ¯å’Œæˆªæ­¢æ—¶é—´ -->
            <div class="task-footer">
              <div class="project-info">
                <ProjectOutlined />
                {{ task.projectName }}
              </div>
              <div class="deadline-info" :class="{ 'overdue': isOverdue(task) }">
                <CalendarOutlined />
                æˆªæ­¢: {{ formatDeadline(task.deadline) }}
              </div>
            </div>
          </div>
        </div>
        
        <!-- ç©ºçŠ¶æ€ -->
        <div v-if="sortedTasks.length === 0" class="empty-state">
          <a-empty description="æš‚æ— ä»»åŠ¡" />
        </div>
      </div>
    </div>

    <!-- ä»»åŠ¡è¯¦æƒ…æŠ½å±‰ -->
    <TaskDetailDrawer 
      v-model:visible="taskDetailVisible"
      :task="selectedTask"
      @update-progress="handleProgressUpdate"
      @submit-material="handleMaterialSubmission"
      @task-completed="handleTaskCompletion" />

    <!-- è¿›åº¦æ›´æ–°æ¨¡æ€æ¡† -->
    <ProgressUpdateModal 
      v-model:visible="progressModalVisible"
      :task="selectedTask"
      @confirm="confirmProgressUpdate" />

    <!-- ææ–™æäº¤æ¨¡æ€æ¡† -->
    <MaterialSubmissionModal 
      v-model:visible="materialModalVisible"
      :task="selectedTask"
      @confirm="confirmMaterialSubmission" />
  </div>
</template>

<script setup>
import { ref, computed, onMounted, watch } from 'vue'
import { useTaskSyncStore } from '@/store/taskSync'
import { 
  ClockCircleOutlined, ProjectOutlined, CalendarOutlined,
  ReloadOutlined
} from '@ant-design/icons-vue'
import TaskDetailDrawer from './components/TaskDetailDrawer.vue'
import ProgressUpdateModal from './components/ProgressUpdateModal.vue'
import MaterialSubmissionModal from './components/MaterialSubmissionModal.vue'

// çŠ¶æ€ç®¡ç†
const taskSyncStore = useTaskSyncStore()
const statusFilter = ref('all')
const projectFilter = ref('')
const taskDetailVisible = ref(false)
const progressModalVisible = ref(false)
const materialModalVisible = ref(false)
const selectedTask = ref(null)

// ä»»åŠ¡æ•°æ®
const myTasks = ref([])
const myProjects = ref([])

// è®¡ç®—å±æ€§
const sortedTasks = computed(() => {
  let filtered = myTasks.value
  
  // çŠ¶æ€ç­›é€‰
  if (statusFilter.value !== 'all') {
    filtered = filtered.filter(task => task.status === statusFilter.value)
  }
  
  // é¡¹ç›®ç­›é€‰
  if (projectFilter.value) {
    filtered = filtered.filter(task => task.projectId === projectFilter.value)
  }
  
  // æ™ºèƒ½æ’åºï¼šä¼˜å…ˆçº§(1) > æˆªæ­¢æ—¶é—´(2)
  return filtered.sort((a, b) => {
    // ç¬¬ä¸€æ’åºå› ç´ ï¼šä¼˜å…ˆçº§ (high > medium > low)
    const priorityOrder = { high: 3, medium: 2, low: 1 }
    const priorityDiff = priorityOrder[b.priority] - priorityOrder[a.priority]
    if (priorityDiff !== 0) return priorityDiff
    
    // ç¬¬äºŒæ’åºå› ç´ ï¼šæˆªæ­¢æ—¶é—´ (è¶Šè¿‘è¶Šé å‰)
    return new Date(a.deadline) - new Date(b.deadline)
  })
})

const urgentTasks = computed(() => {
  return myTasks.value.filter(task => isUrgent(task) && task.status !== 'completed')
})

const totalTasks = computed(() => myTasks.value.length)
const completionRate = computed(() => {
  if (totalTasks.value === 0) return 0
  const completed = myTasks.value.filter(task => task.status === 'completed').length
  return Math.round((completed / totalTasks.value) * 100)
})

const todayDeadlineCount = computed(() => {
  const today = new Date()
  return myTasks.value.filter(task => {
    const deadline = new Date(task.deadline)
    return deadline.toDateString() === today.toDateString()
  }).length
})

// æ–¹æ³•å®šä¹‰
const refreshTasks = async () => {
  // ä»åç«¯è·å–å½“å‰ç”¨æˆ·çš„ä»»åŠ¡
  // TODO: åç«¯APIé¢„ç•™
  myTasks.value = await fetchMyTasks()
  myProjects.value = await fetchMyProjects()
}

const isUrgent = (task) => {
  const now = new Date()
  const deadline = new Date(task.deadline)
  const diffHours = (deadline - now) / (1000 * 60 * 60)
  return diffHours <= 24 && diffHours > 0 && task.status !== 'completed'
}

const isOverdue = (task) => {
  return new Date(task.deadline) < new Date() && task.status !== 'completed'
}

// ä»»åŠ¡æ“ä½œæ–¹æ³•
const startTask = async (task) => {
  task.status = 'in-progress'
  task.startedAt = new Date().toISOString()
  
  // åŒæ­¥åˆ°é¡¹ç›®ç»ç†ç›‘æ§é¡µé¢
  await taskSyncStore.updateTask(task.projectId, task.key, {
    status: 'in-progress',
    startedAt: task.startedAt
  })
  
  message.success('ä»»åŠ¡å·²å¼€å§‹')
}

const updateProgress = (task) => {
  selectedTask.value = task
  progressModalVisible.value = true
}

const submitMaterial = (task) => {
  selectedTask.value = task
  materialModalVisible.value = true
}

// è¿›åº¦æ›´æ–°å¤„ç†
const confirmProgressUpdate = async (progressData) => {
  const task = selectedTask.value
  task.progress = progressData.progress
  task.progressNote = progressData.note
  task.lastUpdateAt = new Date().toISOString()
  
  // å®æ—¶åŒæ­¥åˆ°é¡¹ç›®ç»ç†é¡µé¢
  await taskSyncStore.updateTask(task.projectId, task.key, {
    progress: progressData.progress,
    progressNote: progressData.note,
    lastUpdateAt: task.lastUpdateAt
  })
  
  progressModalVisible.value = false
  message.success('è¿›åº¦å·²æ›´æ–°ï¼Œé¡¹ç›®ç»ç†å°†åŒæ­¥çœ‹åˆ°æœ€æ–°çŠ¶æ€')
}

// ææ–™æäº¤å¤„ç†
const confirmMaterialSubmission = async (materialData) => {
  const task = selectedTask.value
  task.materials = materialData.files
  task.materialNote = materialData.note
  task.materialSubmittedAt = new Date().toISOString()
  task.status = 'review' // æäº¤ææ–™åçŠ¶æ€å˜ä¸ºå¾…å®¡æ ¸
  
  // åŒæ­¥åˆ°é¡¹ç›®ç»ç†ç›‘æ§é¡µé¢
  await taskSyncStore.updateTask(task.projectId, task.key, {
    materials: materialData.files,
    materialNote: materialData.note,
    materialSubmittedAt: task.materialSubmittedAt,
    status: 'review'
  })
  
  materialModalVisible.value = false
  message.success('ææ–™å·²æäº¤ï¼Œç­‰å¾…é¡¹ç›®ç»ç†å®¡æ ¸')
}

// ç”Ÿå‘½å‘¨æœŸ
onMounted(() => {
  refreshTasks()
})
</script>

<style scoped>
.team-member-task-board {
  padding: 24px;
  background: #f5f5f5;
  min-height: 100vh;
}

.page-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 24px;
  padding: 20px;
  background: white;
  border-radius: 18px;
  box-shadow: 0 4px 32px rgba(35,79,162,0.10);
}

.page-header h1 {
  margin: 0;
  color: #234fa2;
  font-size: 28px;
  font-weight: 600;
}

.header-stats {
  display: flex;
  gap: 32px;
}

.task-filters {
  margin-bottom: 16px;
  padding: 16px;
  background: white;
  border-radius: 12px;
}

.urgent-banner {
  margin-bottom: 16px;
}

.task-card {
  background: white;
  border-radius: 12px;
  padding: 20px;
  margin-bottom: 12px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.06);
  cursor: pointer;
  transition: all 0.3s;
  border-left: 4px solid transparent;
}

.task-card:hover {
  box-shadow: 0 4px 16px rgba(35,79,162,0.15);
  transform: translateY(-2px);
}

.task-card.priority-high {
  border-left-color: #ff4d4f;
}

.task-card.priority-medium {
  border-left-color: #faad14;
}

.task-card.priority-low {
  border-left-color: #52c41a;
}

.task-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 12px;
}

.task-title {
  margin: 0 0 8px 0;
  font-size: 16px;
  font-weight: 600;
  color: #234fa2;
}

.task-meta {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
}

.task-progress-section {
  display: flex;
  align-items: center;
  gap: 12px;
  margin: 12px 0;
}

.progress-text {
  font-size: 12px;
  color: #666;
  font-weight: 500;
}

.task-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 12px;
  color: #666;
}

.deadline-info.overdue {
  color: #ff4d4f;
  font-weight: 600;
}

.empty-state {
  text-align: center;
  padding: 60px 0;
}
</style>
```

#### 2.2 ä»»åŠ¡è¯¦æƒ…ç»„ä»¶è®¾è®¡
**åˆ›å»º**: `src/views/team-member/tasks/components/TaskDetailDrawer.vue`

```vue
<template>
  <a-drawer
    v-model:visible="visible"
    title="ä»»åŠ¡è¯¦æƒ…"
    placement="right"
    width="600">
    
    <div class="task-detail-content">
      <!-- ä»»åŠ¡åŸºç¡€ä¿¡æ¯ -->
      <div class="task-basic-info">
        <h2>{{ task?.title }}</h2>
        <a-descriptions :column="2" bordered>
          <a-descriptions-item label="æ‰€å±é¡¹ç›®">
            {{ task?.projectName }}
          </a-descriptions-item>
          <a-descriptions-item label="ä»»åŠ¡çŠ¶æ€">
            <a-tag :color="getStatusColor(task?.status)">
              {{ getStatusText(task?.status) }}
            </a-tag>
          </a-descriptions-item>
          <a-descriptions-item label="ä¼˜å…ˆçº§">
            <a-tag :color="getPriorityColor(task?.priority)">
              {{ getPriorityText(task?.priority) }}
            </a-tag>
          </a-descriptions-item>
          <a-descriptions-item label="æˆªæ­¢æ—¶é—´">
            <span :class="{ 'text-red': isOverdue(task) }">
              {{ formatDateTime(task?.deadline) }}
            </span>
          </a-descriptions-item>
          <a-descriptions-item label="åˆ†é…äºº">
            {{ task?.assignedByName }}
          </a-descriptions-item>
          <a-descriptions-item label="åˆ†é…æ—¶é—´">
            {{ formatDateTime(task?.assignedAt) }}
          </a-descriptions-item>
        </a-descriptions>
      </div>

      <!-- ä»»åŠ¡æè¿° -->
      <div class="task-description">
        <h3>ä»»åŠ¡æè¿°</h3>
        <div class="description-content">
          {{ task?.description }}
        </div>
      </div>

      <!-- è¿›åº¦è·Ÿè¸ª -->
      <div class="progress-tracking">
        <h3>è¿›åº¦è·Ÿè¸ª</h3>
        <a-progress 
          :percent="task?.progress || 0" 
          :status="getProgressStatus(task)"
          stroke-width="8" />
        
        <div class="progress-actions">
          <a-space>
            <a-button 
              type="primary" 
              @click="$emit('update-progress', task)"
              :disabled="task?.status === 'completed'">
              æ›´æ–°è¿›åº¦
            </a-button>
            <a-button 
              v-if="task?.progress === 100 && task?.status !== 'completed'"
              type="primary" 
              @click="markCompleted">
              æ ‡è®°å®Œæˆ
            </a-button>
          </a-space>
        </div>
      </div>

      <!-- ææ–™æäº¤ (ä»…é‡Œç¨‹ç¢‘ä»»åŠ¡æ˜¾ç¤º) -->
      <div v-if="task?.milestoneType" class="material-submission">
        <h3>ææ–™æäº¤</h3>
        <div class="material-requirements">
          <div v-for="requirement in task?.materialRequirements" 
               :key="requirement.id"
               class="requirement-item">
            <div class="requirement-header">
              <span class="requirement-name">{{ requirement.name }}</span>
              <a-tag v-if="requirement.required" color="red">å¿…éœ€</a-tag>
            </div>
            <div class="requirement-status">
              <a-tag v-if="requirement.submitted" color="green">
                å·²æäº¤
              </a-tag>
              <a-tag v-else color="orange">
                å¾…æäº¤
              </a-tag>
            </div>
          </div>
        </div>
        
        <div class="material-actions">
          <a-button 
            type="primary" 
            @click="$emit('submit-material', task)"
            :disabled="task?.status === 'completed'">
            <UploadOutlined />
            æäº¤ææ–™
          </a-button>
        </div>
      </div>

      <!-- æ“ä½œå†å² -->
      <div class="task-history">
        <h3>æ“ä½œå†å²</h3>
        <a-timeline>
          <a-timeline-item 
            v-for="history in task?.history" 
            :key="history.id"
            :color="getHistoryColor(history.type)">
            <template #dot>
              <component :is="getHistoryIcon(history.type)" />
            </template>
            <div class="history-content">
              <div class="history-action">{{ history.action }}</div>
              <div class="history-time">{{ formatDateTime(history.createdAt) }}</div>
              <div v-if="history.note" class="history-note">{{ history.note }}</div>
            </div>
          </a-timeline-item>
        </a-timeline>
      </div>
    </div>
  </a-drawer>
</template>

<script setup>
import { computed } from 'vue'
import { UploadOutlined } from '@ant-design/icons-vue'

const props = defineProps({
  visible: Boolean,
  task: Object
})

const emit = defineEmits(['update:visible', 'update-progress', 'submit-material', 'task-completed'])

const markCompleted = () => {
  emit('task-completed', props.task)
}
</script>
```

#### 2.3 è¿›åº¦æ›´æ–°æ¨¡æ€æ¡†ç»„ä»¶
**åˆ›å»º**: `src/views/team-member/tasks/components/ProgressUpdateModal.vue`

```vue
<template>
  <a-modal
    v-model:visible="visible"
    title="æ›´æ–°ä»»åŠ¡è¿›åº¦"
    @ok="handleConfirm"
    @cancel="handleCancel">
    
    <a-form :model="form" layout="vertical">
      <a-form-item label="å½“å‰è¿›åº¦" required>
        <a-slider 
          v-model:value="form.progress"
          :marks="progressMarks"
          :tip-formatter="val => `${val}%`" />
        <div class="progress-display">
          å½“å‰è¿›åº¦ï¼š<strong>{{ form.progress }}%</strong>
        </div>
      </a-form-item>
      
      <a-form-item label="è¿›åº¦è¯´æ˜">
        <a-textarea 
          v-model:value="form.note"
          placeholder="è¯·æè¿°å½“å‰è¿›å±•æƒ…å†µã€é‡åˆ°çš„é—®é¢˜æˆ–éœ€è¦çš„æ”¯æŒ..."
          :rows="4" />
      </a-form-item>
      
      <a-form-item label="é¢„è®¡å®Œæˆæ—¶é—´">
        <a-date-picker 
          v-model:value="form.estimatedCompletion"
          style="width: 100%"
          :disabled-date="disabledDate" />
      </a-form-item>
    </a-form>
  </a-modal>
</template>

<script setup>
import { ref, reactive, watch } from 'vue'
import { message } from 'ant-design-vue'

const props = defineProps({
  visible: Boolean,
  task: Object
})

const emit = defineEmits(['update:visible', 'confirm'])

const form = reactive({
  progress: 0,
  note: '',
  estimatedCompletion: null
})

const progressMarks = {
  0: '0%',
  25: '25%',
  50: '50%',
  75: '75%',
  100: '100%'
}

// ç›‘å¬ä»»åŠ¡å˜åŒ–ï¼Œåˆå§‹åŒ–è¡¨å•
watch(() => props.task, (newTask) => {
  if (newTask) {
    form.progress = newTask.progress || 0
    form.note = ''
    form.estimatedCompletion = null
  }
})

const disabledDate = (current) => {
  // ä¸èƒ½é€‰æ‹©è¿‡å»çš„æ—¥æœŸ
  return current && current < new Date().setHours(0, 0, 0, 0)
}

const handleConfirm = () => {
  if (form.progress < (props.task?.progress || 0)) {
    message.error('è¿›åº¦ä¸èƒ½å€’é€€')
    return
  }
  
  emit('confirm', {
    progress: form.progress,
    note: form.note,
    estimatedCompletion: form.estimatedCompletion
  })
}

const handleCancel = () => {
  emit('update:visible', false)
}
</script>
```

### é˜¶æ®µä¸‰ï¼šé¡¹ç›®ç»ç†ç›‘æ§é¡µé¢è”åŠ¨å¢å¼º

#### 3.1 ç›‘æ§é¡µé¢å®æ—¶æ›´æ–°æœºåˆ¶
**ä½ç½®**: `src/views/project-manager/projects/monitor.vue` (å¢å¼ºç°æœ‰åŠŸèƒ½)

**æ ¸å¿ƒç›®æ ‡**: å›¢é˜Ÿæˆå‘˜ä»»åŠ¡æ›´æ–°åï¼Œé¡¹ç›®ç»ç†ç›‘æ§é¡µé¢ç«‹å³åŒæ­¥æ˜¾ç¤ºæœ€æ–°çŠ¶æ€

**å…³é”®è”åŠ¨åŠŸèƒ½**ï¼š
1. **å®æ—¶ä»»åŠ¡çŠ¶æ€åŒæ­¥** - å›¢é˜Ÿæˆå‘˜æ›´æ–°è¿›åº¦åï¼ŒWBSå’Œç”˜ç‰¹å›¾ç«‹å³åæ˜ 
2. **ææ–™æäº¤é€šçŸ¥** - æˆå‘˜æäº¤ææ–™åï¼Œé¡¹ç›®ç»ç†æ”¶åˆ°å®æ—¶æé†’
3. **è¿›åº¦ç»Ÿè®¡è‡ªåŠ¨æ›´æ–°** - åŸºäºæˆå‘˜æ›´æ–°è‡ªåŠ¨é‡ç®—é¡¹ç›®æ•´ä½“è¿›åº¦

#### 3.2 ä»»åŠ¡åˆ†é…ç•Œé¢å¢å¼º
**ä½ç½®**: `src/views/project-manager/projects/monitor.vue` (WBSåŒºåŸŸ)

ä¸ºç°æœ‰çš„WBSç¼–è¾‘åŠŸèƒ½æ·»åŠ å›¢é˜Ÿæˆå‘˜åˆ†é…èƒ½åŠ›ï¼š

```javascript
// åœ¨monitor.vueä¸­æ·»åŠ ä»»åŠ¡åˆ†é…é€»è¾‘
const handleTaskAssignment = async (taskKey, assignmentData) => {
  // æ›´æ–°ä»»åŠ¡åˆ†é…ä¿¡æ¯
  await taskSyncStore.updateTask(projectInfo.value.id, taskKey, {
    assignedTo: assignmentData.assignedTo,
    milestoneType: assignmentData.milestoneType,
    materialRequirements: assignmentData.materialRequirements
  })
  
  // å‘é€åˆ†é…é€šçŸ¥ç»™å›¢é˜Ÿæˆå‘˜
  await sendTaskNotification(assignmentData.assignedTo.primary, taskKey)
  
  message.success('ä»»åŠ¡å·²åˆ†é…ï¼Œå›¢é˜Ÿæˆå‘˜å°†æ”¶åˆ°é€šçŸ¥')
}
```

#### 3.3 å®æ—¶çŠ¶æ€åŒæ­¥æœºåˆ¶
**å…³é”®æŠ€æœ¯ç‚¹**ï¼š
1. **åŸºäºPinia Storeçš„çŠ¶æ€å…±äº«** - ä½¿ç”¨`useTaskSyncStore`å®ç°è·¨é¡µé¢æ•°æ®åŒæ­¥
2. **Watchç›‘å¬æœºåˆ¶** - ç›‘å¬ä»»åŠ¡ç¼“å­˜å˜åŒ–ï¼Œè§¦å‘ç•Œé¢æ›´æ–°
3. **æ¶ˆæ¯é€šçŸ¥ç³»ç»Ÿ** - é‡è¦çŠ¶æ€å˜æ›´æ—¶æ¨é€å®æ—¶é€šçŸ¥

### é˜¶æ®µå››ï¼šåç«¯APIé¢„ç•™æ¥å£è®¾è®¡

#### 4.1 ä»»åŠ¡ç®¡ç†APIé¢„ç•™
```javascript
// ä»»åŠ¡åˆ†é…ç›¸å…³API
POST /api/projects/{projectId}/tasks/{taskId}/assign
PUT  /api/projects/{projectId}/tasks/{taskId}/update
GET  /api/users/{userId}/tasks  // è·å–ç”¨æˆ·ä»»åŠ¡

// ææ–™æäº¤ç›¸å…³API
POST /api/tasks/{taskId}/materials/submit
GET  /api/tasks/{taskId}/materials
PUT  /api/materials/{materialId}/review

// é€šçŸ¥ç›¸å…³API
POST /api/notifications/send
GET  /api/users/{userId}/notifications
```

#### 4.2 æ•°æ®åŒæ­¥APIé¢„ç•™
```javascript
// WebSocketè¿æ¥ç”¨äºå®æ—¶åŒæ­¥
WS /api/ws/task-updates/{projectId}

// æ‰¹é‡çŠ¶æ€åŒæ­¥
POST /api/projects/{projectId}/sync-task-status
GET  /api/projects/{projectId}/task-summary
---

## ğŸ”§ å‰ç«¯å®ç°é‡ç‚¹

### 1. è·¯ç”±é…ç½®å¢å¼º
**ä½ç½®**: `src/router/index.js`

```javascript
// å›¢é˜Ÿæˆå‘˜è·¯ç”±è°ƒæ•´
{
  path: '/team-member',
  component: Layout,
  children: [
    {
      path: 'tasks',
      name: 'TeamMemberTasks',
      component: () => import('@/views/team-member/tasks/index.vue'),
      meta: { title: 'æˆ‘çš„ä»»åŠ¡çœ‹æ¿', roles: ['team-member'] }
    }
    // ç§»é™¤åŸæœ‰çš„dashboardè·¯ç”±
  ]
},

// é¡¹ç›®ç»ç†è·¯ç”±å¢å¼º
{
  path: '/project-manager/projects',
  children: [
    {
      path: 'monitor/:id',
      name: 'ProjectMonitor',
      component: () => import('@/views/project-manager/projects/monitor.vue'),
      meta: { title: 'é¡¹ç›®ç›‘æ§' }
    },
    {
      path: 'material-review/:id',
      name: 'MaterialReview', 
      component: () => import('@/views/project-manager/projects/material-review.vue'),
      meta: { title: 'ææ–™å®¡æ ¸' }
    }
  ]
}
```

### 2. çŠ¶æ€ç®¡ç†å¢å¼º
**ä½ç½®**: `src/store/taskSync.js` (æ‰©å±•ç°æœ‰Store)

```javascript
// æ–°å¢ä»»åŠ¡åˆ†é…çŠ¶æ€ç®¡ç†
const taskAssignmentState = reactive({
  assignments: new Map(), // ä»»åŠ¡åˆ†é…è®°å½•
  notifications: [], // é€šçŸ¥åˆ—è¡¨
  realTimeUpdates: new Set() // å®æ—¶æ›´æ–°é˜Ÿåˆ—
})

// æ–°å¢æ–¹æ³•
const assignTaskToMember = async (projectId, taskKey, memberData) => {
  // åˆ†é…ä»»åŠ¡ç»™å›¢é˜Ÿæˆå‘˜
  // å‘é€é€šçŸ¥
  // æ›´æ–°ç¼“å­˜
}

const updateTaskProgress = async (projectId, taskKey, progressData) => {
  // æ›´æ–°ä»»åŠ¡è¿›åº¦
  // è§¦å‘å®æ—¶åŒæ­¥
  // é€šçŸ¥é¡¹ç›®ç»ç†
}
```

### 3. ç»„ä»¶å¤ç”¨ä¼˜åŒ–
å¤ç”¨ç°æœ‰ç»„ä»¶ï¼š
- **FilePreview.vue** - æ‰©å±•æ”¯æŒææ–™å®¡æ ¸
- **ç°æœ‰Modalç»„ä»¶** - è¿›åº¦æ›´æ–°ã€ææ–™æäº¤
- **notificationç³»ç»Ÿ** - ä»»åŠ¡æé†’å’ŒçŠ¶æ€é€šçŸ¥

### 4. æ™ºèƒ½æ’åºç®—æ³•
**å›¢é˜Ÿæˆå‘˜ä»»åŠ¡çœ‹æ¿æ’åºé€»è¾‘**ï¼š

```javascript
const sortTasks = (tasks) => {
  return tasks.sort((a, b) => {
    // ç¬¬ä¸€å› ç´ ï¼šä¼˜å…ˆçº§ (high=3, medium=2, low=1)
    const priorityWeight = { high: 3, medium: 2, low: 1 }
    const priorityDiff = priorityWeight[b.priority] - priorityWeight[a.priority]
    if (priorityDiff !== 0) return priorityDiff
    
    // ç¬¬äºŒå› ç´ ï¼šæˆªæ­¢æ—¶é—´ (è¶Šè¿‘è¶Šé å‰)
    const deadlineA = new Date(a.deadline)
    const deadlineB = new Date(b.deadline)
    return deadlineA - deadlineB
  })
}
---

## ğŸ“‹ å®æ–½è®¡åˆ’

### ğŸ• ç¬¬ä¸€å‘¨ï¼šå›¢é˜Ÿæˆå‘˜ä»»åŠ¡çœ‹æ¿é‡æ„
- [ ] é‡æ„`src/views/team-member/dashboard/index.vue`ä¸ºçº¯ä»»åŠ¡çœ‹æ¿
- [ ] å®ç°æ™ºèƒ½æ’åºç®—æ³•ï¼ˆä¼˜å…ˆçº§+æ—¶é—´ï¼‰
- [ ] å¼€å‘ä»»åŠ¡è¯¦æƒ…æŠ½å±‰ç»„ä»¶
- [ ] åˆ›å»ºè¿›åº¦æ›´æ–°å’Œææ–™æäº¤æ¨¡æ€æ¡†

### ğŸ•‘ ç¬¬äºŒå‘¨ï¼šé¡¹ç›®ç»ç†ç›‘æ§é¡µé¢å¢å¼º
- [ ] å¢å¼ºWBSä»»åŠ¡åˆ†é…åŠŸèƒ½
- [ ] å®ç°å®æ—¶çŠ¶æ€åŒæ­¥æœºåˆ¶
- [ ] å¼€å‘ä»»åŠ¡åˆ†é…é€šçŸ¥ç³»ç»Ÿ
- [ ] é›†æˆå›¢é˜Ÿæˆå‘˜é€‰æ‹©å™¨

### ğŸ•’ ç¬¬ä¸‰å‘¨ï¼šè”åŠ¨æœºåˆ¶å¼€å‘
- [ ] å®Œå–„`useTaskSyncStore`çŠ¶æ€ç®¡ç†
- [ ] å®ç°è·¨é¡µé¢å®æ—¶æ•°æ®åŒæ­¥
- [ ] å¼€å‘ææ–™æäº¤å®¡æ ¸æµç¨‹
- [ ] æµ‹è¯•å›¢é˜Ÿæˆå‘˜ä¸é¡¹ç›®ç»ç†è”åŠ¨

### ğŸ•“ ç¬¬å››å‘¨ï¼šä¼˜åŒ–å’Œé›†æˆæµ‹è¯•
- [ ] æ€§èƒ½ä¼˜åŒ–å’Œä»£ç é‡æ„
- [ ] å®Œå–„é”™è¯¯å¤„ç†å’Œè¾¹ç•Œæƒ…å†µ
- [ ] ç”¨æˆ·ä½“éªŒæµ‹è¯•å’Œè°ƒä¼˜
- [ ] æ–‡æ¡£ç¼–å†™å’Œéƒ¨ç½²å‡†å¤‡

---

## ğŸ¯ é¢„æœŸæ•ˆæœ

### 1. å›¢é˜Ÿåä½œæ•ˆç‡æå‡
- **æ˜ç¡®çš„ä»»åŠ¡åˆ†é…** - æ¯ä¸ªä»»åŠ¡éƒ½æœ‰æ˜ç¡®çš„è´Ÿè´£äººå’Œæˆªæ­¢æ—¶é—´
- **å®æ—¶è¿›åº¦å¯è§** - é¡¹ç›®ç»ç†å¯å®æ—¶äº†è§£ä»»åŠ¡è¿›å±•
- **æ™ºèƒ½ä¼˜å…ˆçº§æ’åº** - å›¢é˜Ÿæˆå‘˜ä¸“æ³¨æœ€é‡è¦å’Œæœ€ç´§æ€¥çš„ä»»åŠ¡

### 2. ææ–™ç®¡ç†æµç¨‹ä¼˜åŒ–
- **æ ‡å‡†åŒ–ææ–™æäº¤** - åŸºäºé‡Œç¨‹ç¢‘çš„ææ–™éœ€æ±‚æ¨¡æ¿
- **ä¸¤çº§å®¡æ ¸ä½“ç³»** - é¡¹ç›®ç»ç†é¢„å®¡ + ç®¡ç†å±‚ç»ˆå®¡
- **å…¨ç¨‹å¯è¿½æº¯** - å®Œæ•´çš„ææ–™æäº¤å’Œå®¡æ ¸è®°å½•

### 3. ç³»ç»Ÿè”åŠ¨æ€§å¢å¼º
- **çŠ¶æ€å®æ—¶åŒæ­¥** - ä»»åŠ¡æ›´æ–°ç«‹å³åæ˜ åˆ°é¡¹ç›®ç›‘æ§é¡µé¢
- **è‡ªåŠ¨åŒ–é€šçŸ¥** - é‡è¦çŠ¶æ€å˜æ›´è‡ªåŠ¨æ¨é€é€šçŸ¥
- **æ•°æ®ä¸€è‡´æ€§** - åŸºäºç»Ÿä¸€çŠ¶æ€ç®¡ç†ç¡®ä¿æ•°æ®å‡†ç¡®æ€§

---

**ä¼˜åŒ–åçš„è®¾è®¡æ–¹æ¡ˆå·²å®Œæˆï¼Œé‡ç‚¹å¼ºåŒ–äº†å›¢é˜Ÿæˆå‘˜ä»»åŠ¡çœ‹æ¿å’Œé¡¹ç›®ç»ç†ç›‘æ§é¡µé¢çš„è”åŠ¨æœºåˆ¶ã€‚**
