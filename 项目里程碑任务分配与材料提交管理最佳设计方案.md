# 项目里程碑任务分配与材料提交管理最佳设计方案

**方案版本**: v2.0  
**设计日期**: 2025年1月28日  
**更新内容**: 聚焦前端设计，强化团队成员与项目经理联动机制  
**基于需求**: 项目里程碑任务分配与材料提交管理需求文档  

---

## 🎯 方案概述

**设计理念**: 专注前端页面设计和交互逻辑，后端API预留接口。重点构建团队成员任务看板与项目经理监控页面的实时联动机制，确保任务进度更新、材料提交等操作能够同步反映到项目监控视图中。

**核心特色**: 
- 简化团队成员工作台为纯任务看板模式
- 智能任务排序（优先级+时间双重因素）
- 实时数据同步和状态联动

## 📊 现状分析

### ✅ 已有基础设施
1. **团队管理系统**(`src/views/project-manager/team/index.vue`)
   - 完整的团队成员管理功能
   - 支持成员添加、编辑、权限分配
   - 成员绩效评估和项目分配

2. **WBS任务管理**(`src/views/project-manager/projects/monitor.vue`, `taskSync.js`)
   - 树形WBS结构编辑和管理
   - 任务数据同步机制(`useTaskSyncStore`)
   - 任务编辑和分配基础功能

3. **团队成员工作台**(`src/views/team-member/dashboard/index.vue`)
   - 个人任务看板和筛选
   - 项目参与情况展示
   - 基础的任务状态管理

4. **材料管理系统**
   - 材料模板管理(`src/store/materialTemplate.js`)
   - 开题/立项/中期/验收审核流程
   - 材料提交和预览功能

### 🔧 需要补强的功能
1. **WBS任务与团队成员的关联机制**
2. **里程碑材料需求定义功能**
3. **任务提醒和催办系统**
4. **项目经理材料预审功能**
5. **两级审核流转机制**

---

## 🏗️ 设计方案

### 阶段一：WBS任务分配增强

#### 1.1 增强WBS任务数据模型
```javascript
// 扩展现有的WBS任务结构
const enhancedWBSTask = {
  // 现有字段
  key: '0-1',
  title: '需求分析',
  description: '...',
  startDate: '2025-01-28',
  endDate: '2025-02-10',
  
  // 新增字段
  assignedTo: {
    primary: 'user_001',        // 主责人ID
    collaborators: ['user_002', 'user_003'], // 协作人员
    assignedBy: 'pm_001',       // 分配人
    assignedAt: '2025-01-28T10:00:00Z'
  },
  
  // 里程碑关联
  milestoneType: 'opening',     // 关联的里程碑类型
  materialRequirements: [       // 材料需求
    {
      materialId: 'mat_001',
      name: '开题报告',
      template: 'opening_report.docx',
      required: true,
      deadline: '2025-02-08'
    }
  ],
  
  // 提醒设置
  reminders: {
    enabled: true,
    beforeDeadline: [3, 1],     // 提前3天、1天提醒
    overdue: true               // 逾期提醒
  }
}
```

#### 1.2 修改WBS编辑界面
**位置**: `src/views/project-manager/projects/config-wizard.vue`

在WBS编辑弹窗中新增：
- **负责人分配**：下拉选择主责人和协作人员
- **里程碑关联**：选择任务属于哪个里程碑
- **材料需求**：配置该任务需要提交的材料
- **提醒设置**：配置任务提醒规则

#### 1.3 增强任务同步存储
**位置**: `src/store/taskSync.js`

扩展任务同步存储，支持：
```javascript
// 任务分配方法
const assignTaskToMembers = (projectId, taskKey, assignment) => {
  // 更新任务分配信息
  // 发送分配通知
  // 同步到团队成员工作台
}

// 里程碑材料需求管理
const updateMilestoneRequirements = (projectId, milestoneType, requirements) => {
  // 更新里程碑材料需求
  // 生成对应的材料提交任务
}
```

### 阶段二：团队成员任务看板重构

#### 2.1 精简团队成员工作台设计
**位置**: `src/views/team-member/tasks/index.vue` (重构现有dashboard)

**设计原则**：
- 移除"个人工作台"概念，专注任务看板
- 优化任务排序逻辑：优先级 > 截止时间
- 强化与项目经理页面的实时联动

```vue
<template>
  <div class="team-member-task-board">
    <!-- 页面头部 -->
    <div class="page-header">
      <h1>📋 我的任务看板</h1>
      <div class="header-stats">
        <a-statistic-countdown 
          title="今日待办" 
          :value="todayDeadlineCount" 
          format="D 天 H 时 m 分"
        />
        <a-statistic title="总任务" :value="totalTasks" />
        <a-statistic title="完成率" :value="completionRate" suffix="%" />
      </div>
    </div>

    <!-- 任务筛选器 -->
    <div class="task-filters">
      <a-space>
        <a-radio-group v-model:value="statusFilter" @change="refreshTasks">
          <a-radio-button value="all">全部任务</a-radio-button>
          <a-radio-button value="pending">待处理</a-radio-button>
          <a-radio-button value="in-progress">进行中</a-radio-button>
          <a-radio-button value="review">待审核</a-radio-button>
        </a-radio-group>
        
        <a-select 
          v-model:value="projectFilter" 
          placeholder="筛选项目"
          style="width: 200px"
          allow-clear>
          <a-select-option v-for="project in myProjects" 
                          :key="project.id" 
                          :value="project.id">
            {{ project.name }}
          </a-select-option>
        </a-select>
        
        <a-button @click="refreshTasks">
          <ReloadOutlined />
          刷新
        </a-button>
      </a-space>
    </div>

    <!-- 任务看板主体 -->
    <div class="task-board-container">
      <!-- 紧急任务提醒条 -->
      <div v-if="urgentTasks.length > 0" class="urgent-banner">
        <a-alert 
          type="error" 
          :message="`有 ${urgentTasks.length} 个紧急任务需要立即处理`"
          show-icon
          closable />
      </div>

      <!-- 任务列表 -->
      <div class="tasks-list">
        <div 
          v-for="task in sortedTasks" 
          :key="task.id"
          :class="['task-card', `priority-${task.priority}`, `status-${task.status}`]"
          @click="openTaskDetail(task)">
          
          <!-- 任务头部信息 -->
          <div class="task-header">
            <div class="task-title-section">
              <h3 class="task-title">{{ task.title }}</h3>
              <div class="task-meta">
                <!-- 优先级标签 -->
                <a-tag :color="getPriorityColor(task.priority)">
                  {{ getPriorityText(task.priority) }}
                </a-tag>
                
                <!-- 任务类型标签 -->
                <a-tag v-if="task.milestoneType" 
                       :color="getMilestoneColor(task.milestoneType)">
                  {{ getMilestoneText(task.milestoneType) }}
                </a-tag>
                
                <!-- 截止时间警告 -->
                <a-tag v-if="isUrgent(task)" color="red">
                  <ClockCircleOutlined />
                  {{ getUrgencyText(task) }}
                </a-tag>
              </div>
            </div>
            
            <!-- 快速操作按钮 -->
            <div class="task-actions">
              <a-button 
                v-if="task.status === 'pending'" 
                type="primary" 
                size="small"
                @click.stop="startTask(task)">
                开始任务
              </a-button>
              
              <a-button 
                v-if="task.status === 'in-progress'" 
                type="primary" 
                size="small"
                @click.stop="updateProgress(task)">
                更新进度
              </a-button>
              
              <a-button 
                v-if="needMaterialSubmission(task)" 
                type="primary" 
                size="small"
                @click.stop="submitMaterial(task)">
                提交材料
              </a-button>
            </div>
          </div>

          <!-- 任务内容区 -->
          <div class="task-content">
            <div class="task-description">
              {{ task.description }}
            </div>
            
            <!-- 进度条 -->
            <div class="task-progress-section">
              <a-progress 
                :percent="task.progress" 
                :status="getProgressStatus(task)"
                size="small" />
              <span class="progress-text">{{ task.progress }}%</span>
            </div>
            
            <!-- 项目信息和截止时间 -->
            <div class="task-footer">
              <div class="project-info">
                <ProjectOutlined />
                {{ task.projectName }}
              </div>
              <div class="deadline-info" :class="{ 'overdue': isOverdue(task) }">
                <CalendarOutlined />
                截止: {{ formatDeadline(task.deadline) }}
              </div>
            </div>
          </div>
        </div>
        
        <!-- 空状态 -->
        <div v-if="sortedTasks.length === 0" class="empty-state">
          <a-empty description="暂无任务" />
        </div>
      </div>
    </div>

    <!-- 任务详情抽屉 -->
    <TaskDetailDrawer 
      v-model:visible="taskDetailVisible"
      :task="selectedTask"
      @update-progress="handleProgressUpdate"
      @submit-material="handleMaterialSubmission"
      @task-completed="handleTaskCompletion" />

    <!-- 进度更新模态框 -->
    <ProgressUpdateModal 
      v-model:visible="progressModalVisible"
      :task="selectedTask"
      @confirm="confirmProgressUpdate" />

    <!-- 材料提交模态框 -->
    <MaterialSubmissionModal 
      v-model:visible="materialModalVisible"
      :task="selectedTask"
      @confirm="confirmMaterialSubmission" />
  </div>
</template>

<script setup>
import { ref, computed, onMounted, watch } from 'vue'
import { useTaskSyncStore } from '@/store/taskSync'
import { 
  ClockCircleOutlined, ProjectOutlined, CalendarOutlined,
  ReloadOutlined
} from '@ant-design/icons-vue'
import TaskDetailDrawer from './components/TaskDetailDrawer.vue'
import ProgressUpdateModal from './components/ProgressUpdateModal.vue'
import MaterialSubmissionModal from './components/MaterialSubmissionModal.vue'

// 状态管理
const taskSyncStore = useTaskSyncStore()
const statusFilter = ref('all')
const projectFilter = ref('')
const taskDetailVisible = ref(false)
const progressModalVisible = ref(false)
const materialModalVisible = ref(false)
const selectedTask = ref(null)

// 任务数据
const myTasks = ref([])
const myProjects = ref([])

// 计算属性
const sortedTasks = computed(() => {
  let filtered = myTasks.value
  
  // 状态筛选
  if (statusFilter.value !== 'all') {
    filtered = filtered.filter(task => task.status === statusFilter.value)
  }
  
  // 项目筛选
  if (projectFilter.value) {
    filtered = filtered.filter(task => task.projectId === projectFilter.value)
  }
  
  // 智能排序：优先级(1) > 截止时间(2)
  return filtered.sort((a, b) => {
    // 第一排序因素：优先级 (high > medium > low)
    const priorityOrder = { high: 3, medium: 2, low: 1 }
    const priorityDiff = priorityOrder[b.priority] - priorityOrder[a.priority]
    if (priorityDiff !== 0) return priorityDiff
    
    // 第二排序因素：截止时间 (越近越靠前)
    return new Date(a.deadline) - new Date(b.deadline)
  })
})

const urgentTasks = computed(() => {
  return myTasks.value.filter(task => isUrgent(task) && task.status !== 'completed')
})

const totalTasks = computed(() => myTasks.value.length)
const completionRate = computed(() => {
  if (totalTasks.value === 0) return 0
  const completed = myTasks.value.filter(task => task.status === 'completed').length
  return Math.round((completed / totalTasks.value) * 100)
})

const todayDeadlineCount = computed(() => {
  const today = new Date()
  return myTasks.value.filter(task => {
    const deadline = new Date(task.deadline)
    return deadline.toDateString() === today.toDateString()
  }).length
})

// 方法定义
const refreshTasks = async () => {
  // 从后端获取当前用户的任务
  // TODO: 后端API预留
  myTasks.value = await fetchMyTasks()
  myProjects.value = await fetchMyProjects()
}

const isUrgent = (task) => {
  const now = new Date()
  const deadline = new Date(task.deadline)
  const diffHours = (deadline - now) / (1000 * 60 * 60)
  return diffHours <= 24 && diffHours > 0 && task.status !== 'completed'
}

const isOverdue = (task) => {
  return new Date(task.deadline) < new Date() && task.status !== 'completed'
}

// 任务操作方法
const startTask = async (task) => {
  task.status = 'in-progress'
  task.startedAt = new Date().toISOString()
  
  // 同步到项目经理监控页面
  await taskSyncStore.updateTask(task.projectId, task.key, {
    status: 'in-progress',
    startedAt: task.startedAt
  })
  
  message.success('任务已开始')
}

const updateProgress = (task) => {
  selectedTask.value = task
  progressModalVisible.value = true
}

const submitMaterial = (task) => {
  selectedTask.value = task
  materialModalVisible.value = true
}

// 进度更新处理
const confirmProgressUpdate = async (progressData) => {
  const task = selectedTask.value
  task.progress = progressData.progress
  task.progressNote = progressData.note
  task.lastUpdateAt = new Date().toISOString()
  
  // 实时同步到项目经理页面
  await taskSyncStore.updateTask(task.projectId, task.key, {
    progress: progressData.progress,
    progressNote: progressData.note,
    lastUpdateAt: task.lastUpdateAt
  })
  
  progressModalVisible.value = false
  message.success('进度已更新，项目经理将同步看到最新状态')
}

// 材料提交处理
const confirmMaterialSubmission = async (materialData) => {
  const task = selectedTask.value
  task.materials = materialData.files
  task.materialNote = materialData.note
  task.materialSubmittedAt = new Date().toISOString()
  task.status = 'review' // 提交材料后状态变为待审核
  
  // 同步到项目经理监控页面
  await taskSyncStore.updateTask(task.projectId, task.key, {
    materials: materialData.files,
    materialNote: materialData.note,
    materialSubmittedAt: task.materialSubmittedAt,
    status: 'review'
  })
  
  materialModalVisible.value = false
  message.success('材料已提交，等待项目经理审核')
}

// 生命周期
onMounted(() => {
  refreshTasks()
})
</script>

<style scoped>
.team-member-task-board {
  padding: 24px;
  background: #f5f5f5;
  min-height: 100vh;
}

.page-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 24px;
  padding: 20px;
  background: white;
  border-radius: 18px;
  box-shadow: 0 4px 32px rgba(35,79,162,0.10);
}

.page-header h1 {
  margin: 0;
  color: #234fa2;
  font-size: 28px;
  font-weight: 600;
}

.header-stats {
  display: flex;
  gap: 32px;
}

.task-filters {
  margin-bottom: 16px;
  padding: 16px;
  background: white;
  border-radius: 12px;
}

.urgent-banner {
  margin-bottom: 16px;
}

.task-card {
  background: white;
  border-radius: 12px;
  padding: 20px;
  margin-bottom: 12px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.06);
  cursor: pointer;
  transition: all 0.3s;
  border-left: 4px solid transparent;
}

.task-card:hover {
  box-shadow: 0 4px 16px rgba(35,79,162,0.15);
  transform: translateY(-2px);
}

.task-card.priority-high {
  border-left-color: #ff4d4f;
}

.task-card.priority-medium {
  border-left-color: #faad14;
}

.task-card.priority-low {
  border-left-color: #52c41a;
}

.task-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 12px;
}

.task-title {
  margin: 0 0 8px 0;
  font-size: 16px;
  font-weight: 600;
  color: #234fa2;
}

.task-meta {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
}

.task-progress-section {
  display: flex;
  align-items: center;
  gap: 12px;
  margin: 12px 0;
}

.progress-text {
  font-size: 12px;
  color: #666;
  font-weight: 500;
}

.task-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 12px;
  color: #666;
}

.deadline-info.overdue {
  color: #ff4d4f;
  font-weight: 600;
}

.empty-state {
  text-align: center;
  padding: 60px 0;
}
</style>
```

#### 2.2 任务详情组件设计
**创建**: `src/views/team-member/tasks/components/TaskDetailDrawer.vue`

```vue
<template>
  <a-drawer
    v-model:visible="visible"
    title="任务详情"
    placement="right"
    width="600">
    
    <div class="task-detail-content">
      <!-- 任务基础信息 -->
      <div class="task-basic-info">
        <h2>{{ task?.title }}</h2>
        <a-descriptions :column="2" bordered>
          <a-descriptions-item label="所属项目">
            {{ task?.projectName }}
          </a-descriptions-item>
          <a-descriptions-item label="任务状态">
            <a-tag :color="getStatusColor(task?.status)">
              {{ getStatusText(task?.status) }}
            </a-tag>
          </a-descriptions-item>
          <a-descriptions-item label="优先级">
            <a-tag :color="getPriorityColor(task?.priority)">
              {{ getPriorityText(task?.priority) }}
            </a-tag>
          </a-descriptions-item>
          <a-descriptions-item label="截止时间">
            <span :class="{ 'text-red': isOverdue(task) }">
              {{ formatDateTime(task?.deadline) }}
            </span>
          </a-descriptions-item>
          <a-descriptions-item label="分配人">
            {{ task?.assignedByName }}
          </a-descriptions-item>
          <a-descriptions-item label="分配时间">
            {{ formatDateTime(task?.assignedAt) }}
          </a-descriptions-item>
        </a-descriptions>
      </div>

      <!-- 任务描述 -->
      <div class="task-description">
        <h3>任务描述</h3>
        <div class="description-content">
          {{ task?.description }}
        </div>
      </div>

      <!-- 进度跟踪 -->
      <div class="progress-tracking">
        <h3>进度跟踪</h3>
        <a-progress 
          :percent="task?.progress || 0" 
          :status="getProgressStatus(task)"
          stroke-width="8" />
        
        <div class="progress-actions">
          <a-space>
            <a-button 
              type="primary" 
              @click="$emit('update-progress', task)"
              :disabled="task?.status === 'completed'">
              更新进度
            </a-button>
            <a-button 
              v-if="task?.progress === 100 && task?.status !== 'completed'"
              type="primary" 
              @click="markCompleted">
              标记完成
            </a-button>
          </a-space>
        </div>
      </div>

      <!-- 材料提交 (仅里程碑任务显示) -->
      <div v-if="task?.milestoneType" class="material-submission">
        <h3>材料提交</h3>
        <div class="material-requirements">
          <div v-for="requirement in task?.materialRequirements" 
               :key="requirement.id"
               class="requirement-item">
            <div class="requirement-header">
              <span class="requirement-name">{{ requirement.name }}</span>
              <a-tag v-if="requirement.required" color="red">必需</a-tag>
            </div>
            <div class="requirement-status">
              <a-tag v-if="requirement.submitted" color="green">
                已提交
              </a-tag>
              <a-tag v-else color="orange">
                待提交
              </a-tag>
            </div>
          </div>
        </div>
        
        <div class="material-actions">
          <a-button 
            type="primary" 
            @click="$emit('submit-material', task)"
            :disabled="task?.status === 'completed'">
            <UploadOutlined />
            提交材料
          </a-button>
        </div>
      </div>

      <!-- 操作历史 -->
      <div class="task-history">
        <h3>操作历史</h3>
        <a-timeline>
          <a-timeline-item 
            v-for="history in task?.history" 
            :key="history.id"
            :color="getHistoryColor(history.type)">
            <template #dot>
              <component :is="getHistoryIcon(history.type)" />
            </template>
            <div class="history-content">
              <div class="history-action">{{ history.action }}</div>
              <div class="history-time">{{ formatDateTime(history.createdAt) }}</div>
              <div v-if="history.note" class="history-note">{{ history.note }}</div>
            </div>
          </a-timeline-item>
        </a-timeline>
      </div>
    </div>
  </a-drawer>
</template>

<script setup>
import { computed } from 'vue'
import { UploadOutlined } from '@ant-design/icons-vue'

const props = defineProps({
  visible: Boolean,
  task: Object
})

const emit = defineEmits(['update:visible', 'update-progress', 'submit-material', 'task-completed'])

const markCompleted = () => {
  emit('task-completed', props.task)
}
</script>
```

#### 2.3 进度更新模态框组件
**创建**: `src/views/team-member/tasks/components/ProgressUpdateModal.vue`

```vue
<template>
  <a-modal
    v-model:visible="visible"
    title="更新任务进度"
    @ok="handleConfirm"
    @cancel="handleCancel">
    
    <a-form :model="form" layout="vertical">
      <a-form-item label="当前进度" required>
        <a-slider 
          v-model:value="form.progress"
          :marks="progressMarks"
          :tip-formatter="val => `${val}%`" />
        <div class="progress-display">
          当前进度：<strong>{{ form.progress }}%</strong>
        </div>
      </a-form-item>
      
      <a-form-item label="进度说明">
        <a-textarea 
          v-model:value="form.note"
          placeholder="请描述当前进展情况、遇到的问题或需要的支持..."
          :rows="4" />
      </a-form-item>
      
      <a-form-item label="预计完成时间">
        <a-date-picker 
          v-model:value="form.estimatedCompletion"
          style="width: 100%"
          :disabled-date="disabledDate" />
      </a-form-item>
    </a-form>
  </a-modal>
</template>

<script setup>
import { ref, reactive, watch } from 'vue'
import { message } from 'ant-design-vue'

const props = defineProps({
  visible: Boolean,
  task: Object
})

const emit = defineEmits(['update:visible', 'confirm'])

const form = reactive({
  progress: 0,
  note: '',
  estimatedCompletion: null
})

const progressMarks = {
  0: '0%',
  25: '25%',
  50: '50%',
  75: '75%',
  100: '100%'
}

// 监听任务变化，初始化表单
watch(() => props.task, (newTask) => {
  if (newTask) {
    form.progress = newTask.progress || 0
    form.note = ''
    form.estimatedCompletion = null
  }
})

const disabledDate = (current) => {
  // 不能选择过去的日期
  return current && current < new Date().setHours(0, 0, 0, 0)
}

const handleConfirm = () => {
  if (form.progress < (props.task?.progress || 0)) {
    message.error('进度不能倒退')
    return
  }
  
  emit('confirm', {
    progress: form.progress,
    note: form.note,
    estimatedCompletion: form.estimatedCompletion
  })
}

const handleCancel = () => {
  emit('update:visible', false)
}
</script>
```

### 阶段三：项目经理监控页面联动增强

#### 3.1 监控页面实时更新机制
**位置**: `src/views/project-manager/projects/monitor.vue` (增强现有功能)

**核心目标**: 团队成员任务更新后，项目经理监控页面立即同步显示最新状态

**关键联动功能**：
1. **实时任务状态同步** - 团队成员更新进度后，WBS和甘特图立即反映
2. **材料提交通知** - 成员提交材料后，项目经理收到实时提醒
3. **进度统计自动更新** - 基于成员更新自动重算项目整体进度

#### 3.2 任务分配界面增强
**位置**: `src/views/project-manager/projects/monitor.vue` (WBS区域)

为现有的WBS编辑功能添加团队成员分配能力：

```javascript
// 在monitor.vue中添加任务分配逻辑
const handleTaskAssignment = async (taskKey, assignmentData) => {
  // 更新任务分配信息
  await taskSyncStore.updateTask(projectInfo.value.id, taskKey, {
    assignedTo: assignmentData.assignedTo,
    milestoneType: assignmentData.milestoneType,
    materialRequirements: assignmentData.materialRequirements
  })
  
  // 发送分配通知给团队成员
  await sendTaskNotification(assignmentData.assignedTo.primary, taskKey)
  
  message.success('任务已分配，团队成员将收到通知')
}
```

#### 3.3 实时状态同步机制
**关键技术点**：
1. **基于Pinia Store的状态共享** - 使用`useTaskSyncStore`实现跨页面数据同步
2. **Watch监听机制** - 监听任务缓存变化，触发界面更新
3. **消息通知系统** - 重要状态变更时推送实时通知

### 阶段四：后端API预留接口设计

#### 4.1 任务管理API预留
```javascript
// 任务分配相关API
POST /api/projects/{projectId}/tasks/{taskId}/assign
PUT  /api/projects/{projectId}/tasks/{taskId}/update
GET  /api/users/{userId}/tasks  // 获取用户任务

// 材料提交相关API
POST /api/tasks/{taskId}/materials/submit
GET  /api/tasks/{taskId}/materials
PUT  /api/materials/{materialId}/review

// 通知相关API
POST /api/notifications/send
GET  /api/users/{userId}/notifications
```

#### 4.2 数据同步API预留
```javascript
// WebSocket连接用于实时同步
WS /api/ws/task-updates/{projectId}

// 批量状态同步
POST /api/projects/{projectId}/sync-task-status
GET  /api/projects/{projectId}/task-summary
---

## 🔧 前端实现重点

### 1. 路由配置增强
**位置**: `src/router/index.js`

```javascript
// 团队成员路由调整
{
  path: '/team-member',
  component: Layout,
  children: [
    {
      path: 'tasks',
      name: 'TeamMemberTasks',
      component: () => import('@/views/team-member/tasks/index.vue'),
      meta: { title: '我的任务看板', roles: ['team-member'] }
    }
    // 移除原有的dashboard路由
  ]
},

// 项目经理路由增强
{
  path: '/project-manager/projects',
  children: [
    {
      path: 'monitor/:id',
      name: 'ProjectMonitor',
      component: () => import('@/views/project-manager/projects/monitor.vue'),
      meta: { title: '项目监控' }
    },
    {
      path: 'material-review/:id',
      name: 'MaterialReview', 
      component: () => import('@/views/project-manager/projects/material-review.vue'),
      meta: { title: '材料审核' }
    }
  ]
}
```

### 2. 状态管理增强
**位置**: `src/store/taskSync.js` (扩展现有Store)

```javascript
// 新增任务分配状态管理
const taskAssignmentState = reactive({
  assignments: new Map(), // 任务分配记录
  notifications: [], // 通知列表
  realTimeUpdates: new Set() // 实时更新队列
})

// 新增方法
const assignTaskToMember = async (projectId, taskKey, memberData) => {
  // 分配任务给团队成员
  // 发送通知
  // 更新缓存
}

const updateTaskProgress = async (projectId, taskKey, progressData) => {
  // 更新任务进度
  // 触发实时同步
  // 通知项目经理
}
```

### 3. 组件复用优化
复用现有组件：
- **FilePreview.vue** - 扩展支持材料审核
- **现有Modal组件** - 进度更新、材料提交
- **notification系统** - 任务提醒和状态通知

### 4. 智能排序算法
**团队成员任务看板排序逻辑**：

```javascript
const sortTasks = (tasks) => {
  return tasks.sort((a, b) => {
    // 第一因素：优先级 (high=3, medium=2, low=1)
    const priorityWeight = { high: 3, medium: 2, low: 1 }
    const priorityDiff = priorityWeight[b.priority] - priorityWeight[a.priority]
    if (priorityDiff !== 0) return priorityDiff
    
    // 第二因素：截止时间 (越近越靠前)
    const deadlineA = new Date(a.deadline)
    const deadlineB = new Date(b.deadline)
    return deadlineA - deadlineB
  })
}
---

## 📋 实施计划

### 🕐 第一周：团队成员任务看板重构
- [ ] 重构`src/views/team-member/dashboard/index.vue`为纯任务看板
- [ ] 实现智能排序算法（优先级+时间）
- [ ] 开发任务详情抽屉组件
- [ ] 创建进度更新和材料提交模态框

### 🕑 第二周：项目经理监控页面增强
- [ ] 增强WBS任务分配功能
- [ ] 实现实时状态同步机制
- [ ] 开发任务分配通知系统
- [ ] 集成团队成员选择器

### 🕒 第三周：联动机制开发
- [ ] 完善`useTaskSyncStore`状态管理
- [ ] 实现跨页面实时数据同步
- [ ] 开发材料提交审核流程
- [ ] 测试团队成员与项目经理联动

### 🕓 第四周：优化和集成测试
- [ ] 性能优化和代码重构
- [ ] 完善错误处理和边界情况
- [ ] 用户体验测试和调优
- [ ] 文档编写和部署准备

---

## 🎯 预期效果

### 1. 团队协作效率提升
- **明确的任务分配** - 每个任务都有明确的负责人和截止时间
- **实时进度可见** - 项目经理可实时了解任务进展
- **智能优先级排序** - 团队成员专注最重要和最紧急的任务

### 2. 材料管理流程优化
- **标准化材料提交** - 基于里程碑的材料需求模板
- **两级审核体系** - 项目经理预审 + 管理层终审
- **全程可追溯** - 完整的材料提交和审核记录

### 3. 系统联动性增强
- **状态实时同步** - 任务更新立即反映到项目监控页面
- **自动化通知** - 重要状态变更自动推送通知
- **数据一致性** - 基于统一状态管理确保数据准确性

---

**优化后的设计方案已完成，重点强化了团队成员任务看板和项目经理监控页面的联动机制。**
