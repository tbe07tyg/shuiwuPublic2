<template>
  <div class="main-layout">
    <a-menu
      mode="inline"
      :selectedKeys="selectedKey"
      :openKeys="openKeys"
      @openChange="onOpenChange"
      class="main-sider"
      @click="onMenuClick"
      :theme="'light'"
      :inlineIndent="24"
      :style="{ width: '260px' }"
      :forceSubMenuRender="true"
      :multiple="false"
      :overflowedIndicator="null"
    >
      <!-- ä¸€çº§èœå•é¡¹ -->
      <a-menu-item key="dashboard">
        <DashboardOutlined />
        <span>å·¥ä½œå°</span>
      </a-menu-item>
      
      <!-- ä¸€çº§èœå•ï¼šé¡¹ç›®ç®¡ç† -->
      <a-sub-menu key="project" data-menu-id="project">
        <template #title>
          <ProjectOutlined />
          <span>é¡¹ç›®ç®¡ç†</span>
        </template>
        
        <!-- é¡¹ç›®è°ƒç ” -->
        <a-sub-menu key="project-research" data-menu-id="project-research">
          <template #title>
            <SearchOutlined />
            <span>é¡¹ç›®è°ƒç ”</span>
          </template>
          <a-menu-item key="research-requirements">
            <DatabaseOutlined />
            <span>éœ€æ±‚æ± ç®¡ç†</span>
          </a-menu-item>
          <a-menu-item key="research-results">
            <FileTextOutlined />
            <span>è°ƒç ”è®°å½•</span>
          </a-menu-item>
        </a-sub-menu>
        
        <!-- é¡¹ç›®ç«‹é¡¹ -->
        <a-menu-item key="project-approval">
          <AuditOutlined />
          <span>é¡¹ç›®ç«‹é¡¹</span>
        </a-menu-item>
        
        <!-- é¡¹ç›®å®æ–½ -->
        <a-sub-menu key="project-implementation" data-menu-id="project-implementation">
          <template #title>
            <SettingOutlined />
            <span>é¡¹ç›®å®æ–½</span>
          </template>
          
          <!-- é¡¹ç›®å¼€é¢˜ - è°ƒæ•´ä¸ºäºŒçº§èœå•é¡¹ -->
          <a-menu-item key="implementation-opening" class="implementation-sub-item">
            <RocketOutlined />
            <span>é¡¹ç›®å¼€é¢˜</span>
          </a-menu-item>
          
          <!-- é¡¹ç›®ä¸­æœŸ - è°ƒæ•´ä¸ºäºŒçº§èœå•é¡¹ -->
          <a-menu-item key="implementation-midterm" class="implementation-sub-item">
            <PieChartOutlined />
            <span>é¡¹ç›®ä¸­æœŸ</span>
          </a-menu-item>
          
          <!-- å…¶å®ƒèœå•é¡¹ä¿æŒä¸å˜ -->
          <a-menu-item key="implementation-contract" class="implementation-sub-item">
            <ContainerOutlined />
            <span>åˆåŒç®¡ç†</span>
          </a-menu-item>
          
          <a-menu-item key="implementation-payment" class="implementation-sub-item">
            <DollarOutlined />
            <span>ç»è´¹æ‰§è¡Œè¿›åº¦</span>
          </a-menu-item>
          
          <a-menu-item key="implementation-progress" class="implementation-sub-item">
            <LineChartOutlined />
            <span>è¿›åº¦ç›‘æ§</span>
          </a-menu-item>
        </a-sub-menu>
        
        <!-- é¡¹ç›®éªŒæ”¶ -->
        <a-menu-item key="project-acceptance">
          <CheckCircleOutlined />
          <span>é¡¹ç›®éªŒæ”¶</span>
        </a-menu-item>
        
        <!-- å†å²æ¡£æ¡ˆ (ä¸é¡¹ç›®è°ƒç ”ã€ç«‹é¡¹ã€å®æ–½ã€éªŒæ”¶åŒçº§) -->
        <a-sub-menu key="project-archive" data-menu-id="project-archive">
          <template #title>
            <DatabaseOutlined />
            <span>å†å²æ¡£æ¡ˆ</span>
          </template>
          <a-menu-item key="project-archive-list">
            <FileTextOutlined />
            <span>æ¡£æ¡ˆæŸ¥çœ‹</span>
          </a-menu-item>
        </a-sub-menu>
      </a-sub-menu>
      
      <!-- æˆæœç®¡ç† -->
      <a-menu-item key="achievements">
        <TrophyOutlined />
        <span>æˆæœç®¡ç†</span>
      </a-menu-item>
      
      <a-menu-item key="analysis">
        <BarChartOutlined />
        <span>ç»Ÿè®¡åˆ†æ</span>
      </a-menu-item>
      <a-menu-item key="knowledge-base">
        <FileTextOutlined />
        <span>çŸ¥è¯†åº“ç®¡ç†</span>
      </a-menu-item>
      <a-sub-menu key="maintenance">
        <template #title>
          <ToolOutlined />
          <span>æ—¥å¸¸ç»´æŠ¤</span>
        </template>

        <a-menu-item key="material-template-maintenance">
          <FileTextOutlined />
          <span>ææ–™æäº¤æ¨¡æ¿ç»´æŠ¤</span>
        </a-menu-item>
        <a-menu-item key="node-data-maintenance">
          <ClusterOutlined />
          <span>èŠ‚ç‚¹æ•°æ®ç±»å‹ç»´æŠ¤</span>
        </a-menu-item>
        <a-menu-item key="node-template-maintenance">
          <FileTextOutlined />
          <span>èŠ‚ç‚¹æ¨¡æ¿åº“ç»´æŠ¤</span>
        </a-menu-item>
        <a-menu-item key="implementation-nodes">
          <ClusterOutlined />
          <span>èŠ‚ç‚¹ç®¡ç†è®¡åˆ’</span>
            <div class="urgent-tag" v-if="hasUrgentNodes">ğŸ”´</div>
        </a-menu-item>
        <a-menu-item key="knowledge-maintenance">
          <FileTextOutlined />
          <span>çŸ¥è¯†åº“ç»´æŠ¤</span>
        </a-menu-item>
        <a-menu-item key="approval-doc-maintenance">
          <FileTextOutlined />
          <span>ç«‹é¡¹ç”³æŠ¥ä¹¦ç»´æŠ¤</span>
        </a-menu-item>
        <a-menu-item key="budget-template-maintenance">
          <FileTextOutlined />
          <span>é¢„ç®—æ¨¡æ¿ç»´æŠ¤</span>
        </a-menu-item>
        <a-menu-item key="ppt-template-maintenance">
          <FileTextOutlined />
          <span>ç«‹é¡¹pptæ¨¡æ¿ç»´æŠ¤</span>
        </a-menu-item>
        <a-menu-item key="inquiry-sms-template-maintenance">
          <MailOutlined />
          <span>è¯¢ä»·çŸ­ä¿¡æ¨¡æ¿ç»´æŠ¤</span>
        </a-menu-item>
        <a-menu-item key="role-permission-maintenance">
          <SafetyOutlined />
          <span>è§’è‰²ä¸æƒé™ç»´æŠ¤</span>
        </a-menu-item>

        <a-menu-item key="staff-maintenance">
          <UserOutlined />
          <span>å‘˜å·¥ç®¡ç†ç»´æŠ¤</span>
        </a-menu-item>
      </a-sub-menu>
      <a-menu-item key="settings">
        <SettingOutlined />
        <span>ç³»ç»Ÿè®¾ç½®</span>
      </a-menu-item>
      <a-menu-item key="preview">
        <AppstoreOutlined />
        <span>æ–¹æ¡ˆé¢„è§ˆ</span>
      </a-menu-item>
    </a-menu>
    
    <div class="main-content">
      <router-view />
    </div>
    
    <!-- é¡¹ç›®é˜¶æ®µé€‰æ‹©æŠ½å±‰ -->
    <a-drawer
      v-model:open="drawerVisible"
      :title="drawerTitle"
      placement="right"
      width="320"
      @close="closeDrawer"
    >
      <div class="drawer-content">
        <div class="drawer-options">
          <div class="option-item" @click="navigateToPage('submit')">
            <div class="option-icon">
              <FileAddOutlined />
            </div>
            <div class="option-info">
              <h3>ææ–™æäº¤</h3>
              <p>{{ drawerSubtitle.submit }}</p>
            </div>
            <div class="option-arrow">
              <RightOutlined />
            </div>
          </div>
          <div class="option-item" @click="navigateToPage('meeting')">
            <div class="option-icon">
              <ScheduleOutlined />
            </div>
            <div class="option-info">
              <h3>ç»„ç»‡ä¼šè®®</h3>
              <p>{{ drawerSubtitle.meeting }}</p>
            </div>
            <div class="option-arrow">
              <RightOutlined />
            </div>
          </div>
        </div>
      </div>
    </a-drawer>
  </div>
</template>

<script setup>
import { useRouter, useRoute } from 'vue-router'
import { ref, computed, onMounted, watch } from 'vue'
import { 
  AppstoreOutlined, ProjectOutlined, FileTextOutlined, SettingOutlined,
  DashboardOutlined, SearchOutlined, AuditOutlined, DatabaseOutlined,
  EnvironmentOutlined, TeamOutlined, FolderOutlined, SolutionOutlined,
  CheckCircleOutlined, ContainerOutlined,
  ClusterOutlined, DollarOutlined, SafetyOutlined,
  UnorderedListOutlined, BarChartOutlined, PieChartOutlined, FundOutlined,
  RocketOutlined, MailOutlined, ToolOutlined, UserOutlined,
  FileAddOutlined, ScheduleOutlined, RightOutlined, TrophyOutlined,
  PlusOutlined, FileSearchOutlined, LineChartOutlined
} from '@ant-design/icons-vue'

const router = useRouter()
const route = useRoute()

// æ‰‹åŠ¨ç®¡ç†çš„é€‰ä¸­çŠ¶æ€
const manualSelectedKeys = ref([])

// é€‰ä¸­çš„èœå•é¡¹
const selectedKey = computed(() => {
  // ä¼˜å…ˆä½¿ç”¨æ‰‹åŠ¨ç®¡ç†çš„é€‰ä¸­çŠ¶æ€
  if (manualSelectedKeys.value.length > 0) {
    return manualSelectedKeys.value
  }
  
  // å¦‚æœæœ‰è‡ªå®šä¹‰é€‰ä¸­çŠ¶æ€ï¼Œä½¿ç”¨å®ƒ
  if (customSelectedKeys.value.length > 0) {
    return customSelectedKeys.value
  }
  
  const path = route.path
  
  // ç²¾ç¡®åŒ¹é…èœå•é¡¹
  const routeToKeyMap = {
    '/dashboard': 'dashboard',
    '/project': 'project',  // é¡¹ç›®ç®¡ç†çˆ¶èœå•
    
    // é¡¹ç›®è°ƒç ”
    '/research/requirements': 'research-requirements',
    '/research/results': 'research-results',
    
    // é¡¹ç›®ç«‹é¡¹
    '/approval/center': 'approval-center',
    '/approval/materials': 'approval-materials', 
    '/approval/review': 'approval-review',
    '/approval/decision': 'approval-decision',
    
    // é¡¹ç›®å®æ–½
    '/implementation/center': 'implementation-center',
    '/implementation/contract': 'implementation-contract',
    '/implementation/nodes': 'implementation-nodes',
    '/implementation/payment': 'implementation-payment',
    '/implementation/progress': 'implementation-progress',
    '/implementation/opening': 'implementation-opening',
    '/implementation/midterm': 'implementation-midterm',
    '/implementation/approval': 'project-approval',
    '/implementation/acceptance': 'project-acceptance',
    
    // å…¶ä»–é¡µé¢
    '/project/archive': 'project-archive-list',
    '/analytics': 'analysis',
    '/achievements': 'achievements',
    '/literature': 'knowledge-base',
    '/settings': 'settings',
    '/preview': 'preview'
  }
  
  // ç›´æ¥åŒ¹é…è·¯å¾„
  if (routeToKeyMap[path]) {
    return [routeToKeyMap[path]]
  }
  
  // å¤„ç†åŠ¨æ€è·¯ç”±å’Œå­è·¯å¾„
  if (path.startsWith('/project/') && path !== '/project/archive') {
    return ['project']
  }
  
  // é»˜è®¤é€‰ä¸­å·¥ä½œå°
  return ['dashboard']
})

// é»˜è®¤å±•å¼€çš„èœå•
const openKeys = ref([
  'project',
  'project-research',
  'project-approval',
  'project-implementation',
  'project-archive',
  'maintenance'
])

// æ•°æ®ç»Ÿè®¡ (å®é™…é¡¹ç›®ä¸­ä»APIè·å–) - v3.0ç‰ˆæœ¬
const counts = ref({
  requirements: 123,
  results: 32,
  materials: 25,
  reviews: 3,
  decisions: 8,
  contracts: 12,
  payments: 18,
  progress: 25,
  opening: 15, // å¾…å¼€é¢˜é¡¹ç›®æ•°é‡ï¼ˆç®¡ç†è§’è‰²ï¼‰
  openingApplications: 6, // å¼€é¢˜ç”³è¯·æ•°é‡ï¼ˆç”³æŠ¥å•ä½è§’è‰²ï¼‰
  midterm: 18, // å¾…ä¸­æœŸæ£€æŸ¥é¡¹ç›®æ•°é‡ï¼ˆç®¡ç†è§’è‰²ï¼‰
  midtermApplications: 9, // ä¸­æœŸç”³è¯·æ•°é‡ï¼ˆç”³æŠ¥å•ä½è§’è‰²ï¼‰
  acceptance: 12, // å¾…éªŒæ”¶é¡¹ç›®æ•°é‡ï¼ˆç®¡ç†è§’è‰²ï¼‰
  applications: 8, // éªŒæ”¶ç”³è¯·æ•°é‡ï¼ˆç”³æŠ¥å•ä½è§’è‰²ï¼‰
  achievements: 45
})

// æœªè¯»æ•°é‡ç»Ÿè®¡
const unreadCount = ref({
  dashboard: 3,
  project: 15
})

// ç´§æ€¥äº‹é¡¹æ ‡è¯†
const hasUrgentResearch = computed(() => true) // æœ‰ç´§æ€¥è°ƒç ”ä»»åŠ¡
const hasUrgentApproval = computed(() => true) // æœ‰ç´§æ€¥å®¡æ‰¹
const hasUrgentImplementation = computed(() => true) // æœ‰ç´§æ€¥å®æ–½ä»»åŠ¡
const hasUrgentOpening = computed(() => true) // æœ‰ç´§æ€¥å¼€é¢˜ä»»åŠ¡
const hasUrgentMidterm = computed(() => true) // æœ‰ç´§æ€¥ä¸­æœŸä»»åŠ¡
const hasUrgentAcceptance = computed(() => true) // æœ‰ç´§æ€¥éªŒæ”¶ä»»åŠ¡
const hasUrgentNodes = computed(() => true) // æœ‰ç´§æ€¥èŠ‚ç‚¹

// æŠ½å±‰ç›¸å…³çŠ¶æ€
const drawerVisible = ref(false)
const currentStage = ref('')
const drawerTitle = ref('')
const customSelectedKeys = ref([])

// æŠ½å±‰å‰¯æ ‡é¢˜é…ç½® (v3.0ç§»é™¤acceptance)
const drawerSubtitle = computed(() => {
  const subtitles = {
    opening: {
      submit: 'ä¸Šä¼ å¼€é¢˜æŠ¥å‘Šã€å®æ–½æ–¹æ¡ˆç­‰ææ–™',
      meeting: 'ç»„ç»‡å¼€é¢˜è®ºè¯ä¼šè®®ã€æ”¶é›†ä¸“å®¶æ„è§'
    },
    midterm: {
      submit: 'æäº¤ä¸­æœŸæ£€æŸ¥æŠ¥å‘Šã€é˜¶æ®µæ€§æˆæœ',
      meeting: 'ç»„ç»‡ä¸­æœŸæ£€æŸ¥ä¼šè®®ã€è¯„å®¡è¿›å±•'
    }
  }
  return subtitles[currentStage.value] || { submit: '', meeting: '' }
})

function onOpenChange(keys) {
  openKeys.value = keys
}

function onMenuClick({ key, keyPath }) {
  // æ¸…é™¤æ‰€æœ‰é€‰ä¸­çŠ¶æ€
  customSelectedKeys.value = []
  manualSelectedKeys.value = []
  
  // è·¯ç”±æ˜ å°„
  const routeMap = {
    'dashboard': '/dashboard',
    'project': '/project',  // çˆ¶èœå•é¡¹ç›®ç®¡ç†çš„è·¯ç”±
    
    // é¡¹ç›®è°ƒç ”è·¯ç”±
    'research-requirements': '/research/requirements',
    'research-results': '/research/results',
    
    // é¡¹ç›®ç«‹é¡¹è·¯ç”±
    'approval-center': '/approval/center',
    'approval-materials': '/approval/materials',
    'approval-review': '/approval/review',
    'approval-decision': '/approval/decision',
    
    // é¡¹ç›®å®æ–½è·¯ç”±
    'implementation-center': '/implementation/center',
    'implementation-contract': '/implementation/contract',
    'implementation-nodes': '/implementation/nodes',
    'implementation-payment': '/implementation/payment',
    'implementation-progress': '/implementation/progress',
    
    // é¡¹ç›®å¼€é¢˜è·¯ç”± - ä½¿ç”¨æ–°çš„è·¯ç”±
    'implementation-opening': '/implementation/opening',
    
    // é¡¹ç›®ä¸­æœŸè·¯ç”± - ä½¿ç”¨æ–°çš„è·¯ç”±
    'implementation-midterm': '/implementation/midterm',
    
    // é¡¹ç›®ç«‹é¡¹è·¯ç”± - ç›´æ¥ä½¿ç”¨æ•´åˆé¡µé¢
    'project-approval': '/implementation/approval',
    
    // é¡¹ç›®éªŒæ”¶è·¯ç”± - ç›´æ¥ä½¿ç”¨æ•´åˆé¡µé¢
    'project-acceptance': '/implementation/acceptance',
    
    // é¡¹ç›®ç®¡ç†è·¯ç”±
    'project-archive-list': '/project/archive',
    
    // ç»Ÿè®¡åˆ†æè·¯ç”±
    'analysis': '/analytics',
    
    // æˆæœç®¡ç†è·¯ç”±
    'achievements': '/achievements',
    
    // ç»´æŠ¤ç›¸å…³èœå•
    'maintenance': '/settings', // æ—¥å¸¸ç»´æŠ¤æš‚æ—¶è·³è½¬åˆ°è®¾ç½®é¡µé¢
    'node-data-maintenance': '/settings',
    'node-template-maintenance': '/settings',
    'implementation-nodes': '/settings',
    'knowledge-maintenance': '/settings',
    'approval-doc-maintenance': '/settings',
    'budget-template-maintenance': '/settings',
    'ppt-template-maintenance': '/settings',
    'inquiry-sms-template-maintenance': '/settings',
    'role-permission-maintenance': '/settings',
    'staff-maintenance': '/settings',
    'material-template-maintenance': '/settings/material-template',
    
    // å…¶ä»–è·¯ç”±
    'knowledge-base': '/literature',
    'settings': '/settings',
    'preview': '/preview'
  }
  
  const path = routeMap[key]
  if (path) {
    router.push(path)
  }
}

// æ˜¾ç¤ºæŠ½å±‰ (v3.0ç§»é™¤acceptance)
function showDrawer(stage) {
  currentStage.value = stage
  const titles = {
    opening: 'é¡¹ç›®å¼€é¢˜',
    midterm: 'é¡¹ç›®ä¸­æœŸ'
  }
  drawerTitle.value = titles[stage] || ''
  drawerVisible.value = true
  
  // è®¾ç½®èœå•é€‰ä¸­çŠ¶æ€
  customSelectedKeys.value = [`implementation-${stage}`]
}

// å…³é—­æŠ½å±‰
function closeDrawer() {
  drawerVisible.value = false
  currentStage.value = ''
  drawerTitle.value = ''
  // æ¸…é™¤è‡ªå®šä¹‰é€‰ä¸­çŠ¶æ€
  customSelectedKeys.value = []
}

// å¯¼èˆªåˆ°å…·ä½“é¡µé¢
function navigateToPage(type) {
  const path = `/implementation/${currentStage.value}/${type}`
  router.push(path)
  closeDrawer()
}

// ç›‘å¬è·¯ç”±å˜åŒ–ï¼Œæ¸…é™¤æ‰‹åŠ¨é€‰ä¸­çŠ¶æ€
watch(() => route.path, () => {
  manualSelectedKeys.value = []
  customSelectedKeys.value = []
}, { immediate: true })

// é¡µé¢æŒ‚è½½åæ‰§è¡Œåˆå§‹åŒ–
onMounted(() => {
  // ç¡®ä¿åˆå§‹çŠ¶æ€æ­£ç¡®
  manualSelectedKeys.value = []
  customSelectedKeys.value = []
  
  // ç§»é™¤å†…è”æ ·å¼
  setTimeout(() => {
    removeInlineStyles()
  }, 100)
})

/* è¿™ä¸ªå‡½æ•°ä¼šæŸ¥æ‰¾èœå•é¡¹ä¸­çš„å†…è”æ ·å¼å¹¶ç§»é™¤ */
function removeInlineStyles() {
  // è·å–æ‰€æœ‰èœå•é¡¹
  const menuItems = document.querySelectorAll('.ant-menu-item, .ant-menu-submenu-title');
  
  // éå†èœå•é¡¹
  menuItems.forEach(item => {
    // ç§»é™¤å†…è”æ ·å¼
    const icons = item.querySelectorAll('.anticon');
    icons.forEach(icon => {
      icon.style.marginRight = '';
      icon.style.fontSize = '';
    });
    
    // ç§»é™¤spanä¸Šçš„å†…è”æ ·å¼
    const spans = item.querySelectorAll('span');
    spans.forEach(span => {
      span.style.fontSize = '';
      span.style.fontWeight = '';
      span.style.paddingLeft = '';
      
      // å¯¹äºæ˜¾ç¤ºä¸º...çš„èœå•é¡¹ï¼Œæ·»åŠ ç‰¹æ®Šç±»
      if (span.textContent.trim() === '...') {
        item.classList.add('menu-item-ellipsis');
        span.style.display = 'inline-block';
        span.style.maxWidth = '100%';
        span.style.overflow = 'visible';
      }
    });
  });
  
  // ä¿®å¤å¯èƒ½è¢«æˆªæ–­çš„èœå•é¡¹
  fixTruncatedMenuItems();
}

// æ·»åŠ æ–°æ–¹æ³•æ¥ä¿®å¤å¯èƒ½è¢«æˆªæ–­çš„èœå•é¡¹
function fixTruncatedMenuItems() {
  // æŸ¥æ‰¾æ‰€æœ‰èœå•é¡¹å†…å®¹å®¹å™¨
  const titleContents = document.querySelectorAll('.ant-menu-title-content');
  
  // éå†å¹¶åº”ç”¨ä¿®å¤
  titleContents.forEach(content => {
    content.style.whiteSpace = 'normal';
    content.style.wordBreak = 'break-word';
  });
}
</script>

<style scoped>
/* ä¸»å¸ƒå±€ */
.main-layout {
  display: flex;
  height: 100vh;
  background: #f5f8ff;
  overflow: hidden;
}

/* ä¾§è¾¹æ å®¹å™¨ */
.main-sider {
  position: relative;
  flex: 0 0 260px;
  max-width: 260px;
  min-width: 260px;
  width: 260px !important;
  height: 100vh;
  overflow-y: auto;
  overflow-x: hidden;
  background: #fff;
  border-radius: 16px 0 0 16px;
  box-shadow: 2px 0 8px rgba(35,79,162,0.06);
  padding: 24px 0;
}

/* ä¸»å†…å®¹åŒºåŸŸ */
.main-content {
  flex: 1;
  padding: 24px;
  overflow-y: auto;
  overflow-x: hidden;
  margin-left: 8px;
}

/* èœå•åŸºæœ¬æ ·å¼ */
:deep(.ant-menu) {
  background: transparent;
  border-right: none;
  font-family: "PingFang SC", "Microsoft YaHei", sans-serif;
}

/* æ¢å¤ç¼©è¿› - ä¸€çº§èœå• */
:deep(.ant-menu > .ant-menu-item),
:deep(.ant-menu > .ant-menu-submenu > .ant-menu-submenu-title) {
  padding-left: 24px !important;
}

/* äºŒçº§èœå•ç¼©è¿› */
:deep(.ant-menu-sub > .ant-menu-item),
:deep(.ant-menu-sub > .ant-menu-submenu > .ant-menu-submenu-title) {
  padding-left: 48px !important;
}

/* ä¸‰çº§èœå•ç¼©è¿› */
:deep(.ant-menu-sub .ant-menu-sub .ant-menu-item) {
  padding-left: 72px !important;
}

/* å­èœå•æ ·å¼ */
:deep(.ant-menu-sub) {
  position: relative !important;
  max-height: none !important;
  overflow: visible !important;
  background: transparent !important;
  box-shadow: none !important;
  border-right: none !important;
}

/* ä¼˜åŒ–èœå•å¸ƒå±€ï¼Œç¡®ä¿æ–‡æœ¬ä¸ä¼šè¢«æˆªæ–­ */
:deep(.ant-menu-item-only-child) {
  padding-right: 16px !important;
  width: auto !important;
}

/* ä¸‰ä¸ªç‚¹çš„èœå•é¡¹ç‰¹åˆ«å¤„ç† */
:deep(.ant-menu-item) span[title="..."], 
:deep(.ant-menu-submenu-title) span[title="..."] {
  max-width: none !important;
  font-weight: bold;
}

/* ä¼˜åŒ–å­èœå•å®¹å™¨ */
:deep(.ant-menu-inline) {
  width: 100%;
}

/* è°ƒæ•´èœå•é¡¹é€šç”¨æ ·å¼ */
:deep(.ant-menu-item), 
:deep(.ant-menu-submenu-title) {
  height: auto !important;
  min-height: 40px;
  line-height: 40px !important;
  margin: 4px 8px 4px 0 !important;
  border-radius: 0 8px 8px 0;
  display: flex !important;
  align-items: center !important;
  padding: 8px 16px !important;
  white-space: normal !important; /* å…è®¸æ–‡æœ¬æ¢è¡Œ */
  word-break: break-word;
  overflow: visible !important;
}

/* ç¡®ä¿å­èœå•é¡¹çš„å®½åº¦è¶³å¤Ÿ */
:deep(.ant-menu-item span),
:deep(.ant-menu-submenu-title span) {
  color: rgba(0, 0, 0, 0.85) !important;
  opacity: 1 !important;
  visibility: visible !important;
  display: inline-block !important;
  overflow: visible !important;
  white-space: normal !important; /* å…è®¸æ–‡æœ¬æ¢è¡Œ */
  max-width: 180px; /* æ§åˆ¶æ–‡æœ¬æœ€å¤§å®½åº¦ */
  word-break: break-word;
  overflow-wrap: break-word;
}

/* èœå•æ ·å¼ç»Ÿä¸€é…ç½® */

/* ä¸€çº§èœå•å›¾æ ‡å’Œæ–‡æœ¬æ ·å¼ */
:deep(.ant-menu > .ant-menu-item > .anticon),
:deep(.ant-menu > .ant-menu-submenu > .ant-menu-submenu-title > .anticon) {
  font-size: 18px !important;
  margin-right: 12px !important;
  min-width: 18px !important;
}

:deep(.ant-menu > .ant-menu-item > span),
:deep(.ant-menu > .ant-menu-submenu > .ant-menu-submenu-title > span) {
  font-size: 16px !important;
  font-weight: 600 !important;
}

/* äºŒçº§èœå•å›¾æ ‡å’Œæ–‡æœ¬æ ·å¼ */
:deep(.ant-menu-sub > .ant-menu-item > .anticon),
:deep(.ant-menu-sub > .ant-menu-submenu > .ant-menu-submenu-title > .anticon) {
  font-size: 16px !important;
  margin-right: 10px !important;
  min-width: 16px !important;
}

:deep(.ant-menu-sub > .ant-menu-item > span),
:deep(.ant-menu-sub > .ant-menu-submenu > .ant-menu-submenu-title > span) {
  font-size: 14px !important;
  font-weight: 500 !important;
}

/* ä¸‰çº§èœå•å›¾æ ‡å’Œæ–‡æœ¬æ ·å¼ */
:deep(.ant-menu-sub .ant-menu-sub .ant-menu-item > .anticon) {
  font-size: 14px !important;
  margin-right: 8px !important;
  min-width: 14px !important;
}

:deep(.ant-menu-sub .ant-menu-sub .ant-menu-item > span) {
  font-size: 13px !important;
  font-weight: 400 !important;
}

/* èœå•é¡¹æ‚¬åœå’Œé€‰ä¸­æ•ˆæœ */
:deep(.ant-menu-item:hover), 
:deep(.ant-menu-submenu-title:hover) {
  background-color: rgba(35, 79, 162, 0.08) !important;
  color: #234fa2 !important;
}

:deep(.ant-menu-item:hover .anticon),
:deep(.ant-menu-submenu-title:hover .anticon) {
  color: #234fa2 !important;
}

:deep(.ant-menu-item-selected) {
  background-color: rgba(35, 79, 162, 0.15) !important;
  color: #234fa2 !important;
  font-weight: 600 !important;
}

:deep(.ant-menu-item-selected .anticon) {
  color: #234fa2 !important;
}

:deep(.ant-menu-item-selected::after) {
  border-right: 3px solid #234fa2 !important;
}

/* ç¡®ä¿å­èœå•é€‰ä¸­æ—¶çˆ¶èœå•ä¹Ÿæœ‰ç›¸åº”æ ·å¼ */
:deep(.ant-menu-submenu-selected > .ant-menu-submenu-title) {
  color: #234fa2 !important;
  font-weight: 600 !important;
}

:deep(.ant-menu-submenu-selected > .ant-menu-submenu-title .anticon) {
  color: #234fa2 !important;
}

/* å±•å¼€çŠ¶æ€çš„å­èœå•å®¹å™¨æ ·å¼ */
:deep(.ant-menu-submenu-open > .ant-menu-submenu-title) {
  color: #234fa2 !important;
}

:deep(.ant-menu-submenu-open > .ant-menu-submenu-title .anticon) {
  color: #234fa2 !important;
}

/* èœå•é¡¹æ•°é‡æ ‡ç­¾æ ·å¼ */
.item-count {
  margin-left: 8px;
  color: #8c8c8c;
  font-size: 12px;
  background-color: #f5f5f5;
  padding: 0 6px;
  border-radius: 10px;
  display: inline-block;
  line-height: 1.5;
}

/* ç´§æ€¥æ ‡ç­¾æ ·å¼ */
.urgent-tag {
  margin-left: 8px;
  animation: pulse 1.5s infinite;
  filter: drop-shadow(0 0 2px rgba(255, 77, 79, 0.5));
}

@keyframes pulse {
  0% { opacity: 0.6; transform: scale(0.95); }
  50% { opacity: 1; transform: scale(1.05); }
  100% { opacity: 0.6; transform: scale(0.95); }
}

/* æŠ½å±‰æ ·å¼ */
.drawer-content {
  padding: 0;
}

.drawer-options {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.option-item {
  display: flex;
  align-items: center;
  padding: 20px 16px;
  background: #fff;
  border: 1px solid #f0f0f0;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
}

.option-item:hover {
  background: #f8f9ff;
  border-color: #234fa2;
  box-shadow: 0 4px 16px rgba(35, 79, 162, 0.15);
  transform: translateY(-2px);
}

.option-icon {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 48px;
  height: 48px;
  background: #f0f5ff;
  border-radius: 12px;
  margin-right: 16px;
  font-size: 20px;
  color: #234fa2;
  transition: all 0.3s ease;
}

.option-item:hover .option-icon {
  background: #234fa2;
  color: #fff;
}

.option-info {
  flex: 1;
}

.option-info h3 {
  margin: 0 0 4px 0;
  font-size: 16px;
  font-weight: 600;
  color: #262626;
}

.option-info p {
  margin: 0;
  font-size: 14px;
  color: #8c8c8c;
  line-height: 1.4;
}

.option-arrow {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 24px;
  height: 24px;
  color: #bfbfbf;
  font-size: 14px;
  transition: all 0.3s ease;
}

.option-item:hover .option-arrow {
  color: #234fa2;
  transform: translateX(4px);
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 768px) {
  .main-sider {
    position: fixed;
    left: 0;
    top: 0;
    z-index: 1000;
    width: 240px;
    transform: translateX(-100%);
    transition: transform 0.3s ease;
  }
  
  .main-sider.mobile-open {
    transform: translateX(0);
  }
  
  .main-content {
    padding: 16px;
  }
}

/* ä¸ºä¸åŒçº§åˆ«çš„èœå•æ·»åŠ ç±» */
.menu-icon-level1 {
  font-size: 20px !important;
  margin-right: 16px !important;
}

.menu-icon-level2 {
  font-size: 18px !important;
  margin-right: 12px !important;
}

.menu-icon-level3 {
  font-size: 16px !important;
  margin-right: 8px !important;
}

.menu-text-level1 {
  font-size: 16px;
  font-weight: 600;
}

.menu-text-level2 {
  font-size: 14px;
  font-weight: 500;
}

.menu-text-level3 {
  font-size: 13px;
  font-weight: 400;
}

/* ç¡®ä¿èœå•é¡¹å†…å®¹ä¸ä¼šè¢«æˆªæ–­ */
:deep(.ant-menu-title-content) {
  white-space: normal;
  word-break: break-word;
  flex: 1;
  max-width: 100%;
}

/* ä¿®å¤å¸¦æœ‰ä¸‰ä¸ªç‚¹çš„èœå•é¡¹ */
.menu-item-ellipsis span {
  max-width: 100% !important;
  text-overflow: clip !important;
  overflow: visible !important;
}

/* ä¿®å¤èœå•é¡¹æ–‡æœ¬å®½åº¦ */
:deep(.ant-menu-item span),
:deep(.ant-menu-submenu-title span) {
  display: inline-block !important;
  max-width: 100% !important;
  overflow: visible !important;
}

/* è°ƒæ•´èœå•é¡¹å›¾æ ‡çš„ä½ç½® */
:deep(.ant-menu-item) .anticon, 
:deep(.ant-menu-submenu-title) .anticon {
  font-size: 16px !important;
  margin-right: 12px !important;
  min-width: 16px !important;
}

/* å®æ–½ä¸‹çš„äºŒçº§èœå•é¡¹ç»Ÿä¸€æ ·å¼ - ä¸å…¶ä»–äºŒçº§èœå•ä¿æŒä¸€è‡´ */
.implementation-sub-item {
  position: relative;
  transition: all 0.2s ease-in-out;
  overflow: visible !important;
}

.implementation-sub-item .anticon {
  color: #595959;
  transition: all 0.25s ease;
}

.implementation-sub-item span:not(.item-count) {
  color: #595959;
  transition: all 0.25s ease;
}

.implementation-sub-item:hover .anticon {
  color: #234fa2;
  transform: scale(1.1);
}

.implementation-sub-item:hover span:not(.item-count) {
  color: #234fa2;
}

/* æ ‡ç­¾æ ·å¼ç¾åŒ– */
.custom-tabs :deep(.ant-tabs-nav) {
  margin-bottom: 24px;
  background: linear-gradient(to right, #f9f9f9, #f0f5ff);
  border-radius: 8px;
  padding: 6px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}

.custom-tabs :deep(.ant-tabs-tab) {
  margin: 0 4px;
  padding: 12px 20px;
  border-radius: 6px;
  transition: all 0.3s cubic-bezier(0.645, 0.045, 0.355, 1);
}

.custom-tabs :deep(.ant-tabs-tab-active) {
  background-color: #fff;
  box-shadow: 0 3px 10px rgba(24, 144, 255, 0.1);
}

.custom-tabs :deep(.ant-tabs-tab-btn) {
  font-weight: 500;
  font-size: 15px;
  transition: all 0.25s;
}

.custom-tabs :deep(.ant-tabs-tab:hover .ant-tabs-tab-btn) {
  color: #40a9ff;
  transform: translateY(-1px);
}


</style> 